; -*- comment-column:45; -*-

LC380=$c380                        ; referred to by disassembled table
;LEA92=$ea92
;LD856=$d856                     ; reference to default page 2 contents
;LE89A=$e89a                     ; ???
;LEA8E=$ea8e                     ; ???
LED4E=$ed4e
LEA64=$ea64                     ; referred to by disassembled table
;LF00B=$f00b                     ; possibly offset reference to table?
LFFED=$ffed
LFFFF=$ffff

LFC00=$fc00
LFC2C=$fc2c                                  ; ???
LFCE0=$fce0
LFCE5=$fce5
LFD00=$fd00
LFDFE=$fdfe
LFE00=$fe00
LFE02=$fe02
LFE03=$fe03
LFE04=$fe04
LFE05=$fe05
LFE06=$fe06
LFE07=$fe07
LFE08=$fe08

                .if version==300

                ; Bodge area
L9FFD_300=$9ffd
LDAC7_300=$dac7
LDC23_300=LDC36
LE3C1_300=$e3c1
LE2CC_300=$e2cc
LED16_300:=$ed16
;LED5A_300:=$ed5a
;LE756_300=$e756
;LE759_300=$e759
;LE75C_300=$e75c
;LE75F_300=$e75f
;LE762_300=$e762
;LE765_300=$e765
;LE768_300=$e768
;LF0B5_300=$f0b5
;LFBF7_300=$fbf7

LFC7F=$fc7f
                .endif
                
vduRoutinesPage=$c3
                
extendedVectorSpace=$d9f
romInformationTable=$2a0
beword: .macro value
                .byte >\value
                .byte <\value
                .endmacro
                
*=$c000
; CHARACTER SET
; =============
LC000:
                ; CHR$32 -  
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000

                ; CHR$33 - !
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00000000
                .byte %00011000
                .byte %00000000

                ; CHR$34 - "
                .byte %01101100
                .byte %01101100
                .byte %01101100
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000

                ; CHR$35 - #
                .byte %00110110
                .byte %00110110
                .byte %01111111
                .byte %00110110
                .byte %01111111
                .byte %00110110
                .byte %00110110
                .byte %00000000

                ; CHR$36 - $
                .byte %00001100
                .byte %00111111
                .byte %01101000
                .byte %00111110
                .byte %00001011
                .byte %01111110
                .byte %00011000
                .byte %00000000

                ; CHR$37 - %
                .byte %01100000
                .byte %01100110
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %01100110
                .byte %00000110
                .byte %00000000

                ; CHR$38 - &
                .byte %00111000
                .byte %01101100
                .byte %01101100
                .byte %00111000
                .byte %01101101
                .byte %01100110
                .byte %00111011
                .byte %00000000

                ; CHR$39 - '
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000

                ; CHR$40 - (
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %00110000
                .byte %00110000
                .byte %00011000
                .byte %00001100
                .byte %00000000

                ; CHR$41 - )
                .byte %00110000
                .byte %00011000
                .byte %00001100
                .byte %00001100
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %00000000

                ; CHR$42 - *
                .byte %00000000
                .byte %00011000
                .byte %01111110
                .byte %00111100
                .byte %01111110
                .byte %00011000
                .byte %00000000
                .byte %00000000

                ; CHR$43 - +
                .byte %00000000
                .byte %00011000
                .byte %00011000
                .byte %01111110
                .byte %00011000
                .byte %00011000
                .byte %00000000
                .byte %00000000

                ; CHR$44 - ,
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00011000
                .byte %00011000
                .byte %00110000

                ; CHR$45 - -
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %01111110
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000

                ; CHR$46 - .
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00011000
                .byte %00011000
                .byte %00000000

                ; CHR$47 - /
                .byte %00000000
                .byte %00000110
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %01100000
                .byte %00000000
                .byte %00000000

                ; CHR$48 - 0
                .byte %00111100
                .byte %01100110
                .byte %01101110
                .byte %01111110
                .byte %01110110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$49 - 1
                .byte %00011000
                .byte %00111000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %01111110
                .byte %00000000

                ; CHR$50 - 2
                .byte %00111100
                .byte %01100110
                .byte %00000110
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %01111110
                .byte %00000000

                ; CHR$51 - 3
                .byte %00111100
                .byte %01100110
                .byte %00000110
                .byte %00011100
                .byte %00000110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$52 - 4
                .byte %00001100
                .byte %00011100
                .byte %00111100
                .byte %01101100
                .byte %01111110
                .byte %00001100
                .byte %00001100
                .byte %00000000

                ; CHR$53 - 5
                .byte %01111110
                .byte %01100000
                .byte %01111100
                .byte %00000110
                .byte %00000110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$54 - 6
                .byte %00011100
                .byte %00110000
                .byte %01100000
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$55 - 7
                .byte %01111110
                .byte %00000110
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %00110000
                .byte %00110000
                .byte %00000000

                ; CHR$56 - 8
                .byte %00111100
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$57 - 9
                .byte %00111100
                .byte %01100110
                .byte %01100110
                .byte %00111110
                .byte %00000110
                .byte %00001100
                .byte %00111000
                .byte %00000000

                ; CHR$58 - :
                .byte %00000000
                .byte %00000000
                .byte %00011000
                .byte %00011000
                .byte %00000000
                .byte %00011000
                .byte %00011000
                .byte %00000000

                ; CHR$59 - ;
                .byte %00000000
                .byte %00000000
                .byte %00011000
                .byte %00011000
                .byte %00000000
                .byte %00011000
                .byte %00011000
                .byte %00110000

                ; CHR$60 - <
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %01100000
                .byte %00110000
                .byte %00011000
                .byte %00001100
                .byte %00000000

                ; CHR$61 - =
                .byte %00000000
                .byte %00000000
                .byte %01111110
                .byte %00000000
                .byte %01111110
                .byte %00000000
                .byte %00000000
                .byte %00000000

                ; CHR$62 - >
                .byte %00110000
                .byte %00011000
                .byte %00001100
                .byte %00000110
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %00000000

                ; CHR$63 - ?
                .byte %00111100
                .byte %01100110
                .byte %00001100
                .byte %00011000
                .byte %00011000
                .byte %00000000
                .byte %00011000
                .byte %00000000

                ; CHR$64 - @
                .byte %00111100
                .byte %01100110
                .byte %01101110
                .byte %01101010
                .byte %01101110
                .byte %01100000
                .byte %00111100
                .byte %00000000

                ; CHR$65 - A
                .byte %00111100
                .byte %01100110
                .byte %01100110
                .byte %01111110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00000000

                ; CHR$66 - B
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %01111100
                .byte %00000000

                ; CHR$67 - C
                .byte %00111100
                .byte %01100110
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$68 - D
                .byte %01111000
                .byte %01101100
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01101100
                .byte %01111000
                .byte %00000000

                ; CHR$69 - E
                .byte %01111110
                .byte %01100000
                .byte %01100000
                .byte %01111100
                .byte %01100000
                .byte %01100000
                .byte %01111110
                .byte %00000000

                ; CHR$70 - F
                .byte %01111110
                .byte %01100000
                .byte %01100000
                .byte %01111100
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %00000000

                ; CHR$71 - G
                .byte %00111100
                .byte %01100110
                .byte %01100000
                .byte %01101110
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$72 - H
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01111110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00000000

                ; CHR$73 - I
                .byte %01111110
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %01111110
                .byte %00000000

                ; CHR$74 - J
                .byte %00111110
                .byte %00001100
                .byte %00001100
                .byte %00001100
                .byte %00001100
                .byte %01101100
                .byte %00111000
                .byte %00000000

                ; CHR$75 - K
                .byte %01100110
                .byte %01101100
                .byte %01111000
                .byte %01110000
                .byte %01111000
                .byte %01101100
                .byte %01100110
                .byte %00000000

                ; CHR$76 - L
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %01111110
                .byte %00000000

                ; CHR$77 - M
                .byte %01100011
                .byte %01110111
                .byte %01111111
                .byte %01101011
                .byte %01101011
                .byte %01100011
                .byte %01100011
                .byte %00000000

                ; CHR$78 - N
                .byte %01100110
                .byte %01100110
                .byte %01110110
                .byte %01111110
                .byte %01101110
                .byte %01100110
                .byte %01100110
                .byte %00000000

                ; CHR$79 - O
                .byte %00111100
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$80 - P
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %01111100
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %00000000

                ; CHR$81 - Q
                .byte %00111100
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01101010
                .byte %01101100
                .byte %00110110
                .byte %00000000

                ; CHR$82 - R
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %01111100
                .byte %01101100
                .byte %01100110
                .byte %01100110
                .byte %00000000

                ; CHR$83 - S
                .byte %00111100
                .byte %01100110
                .byte %01100000
                .byte %00111100
                .byte %00000110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$84 - T
                .byte %01111110
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00000000

                ; CHR$85 - U
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$86 - V
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00011000
                .byte %00000000

                ; CHR$87 - W
                .byte %01100011
                .byte %01100011
                .byte %01101011
                .byte %01101011
                .byte %01111111
                .byte %01110111
                .byte %01100011
                .byte %00000000

                ; CHR$88 - X
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00011000
                .byte %00111100
                .byte %01100110
                .byte %01100110
                .byte %00000000

                ; CHR$89 - Y
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00000000

                ; CHR$90 - Z
                .byte %01111110
                .byte %00000110
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %01100000
                .byte %01111110
                .byte %00000000

                ; CHR$91 - [
                .byte %01111100
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %01111100
                .byte %00000000

                ; CHR$92 - \
                .byte %00000000
                .byte %01100000
                .byte %00110000
                .byte %00011000
                .byte %00001100
                .byte %00000110
                .byte %00000000
                .byte %00000000

                ; CHR$93 - ]
                .byte %00111110
                .byte %00000110
                .byte %00000110
                .byte %00000110
                .byte %00000110
                .byte %00000110
                .byte %00111110
                .byte %00000000

                ; CHR$94 - ^
                .byte %00011000
                .byte %00111100
                .byte %01100110
                .byte %01000010
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000

                ; CHR$95 - _
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %11111111

                ; CHR$96 - `
                .byte %00011100
                .byte %00110110
                .byte %00110000
                .byte %01111100
                .byte %00110000
                .byte %00110000
                .byte %01111110
                .byte %00000000

                ; CHR$97 - a
                .byte %00000000
                .byte %00000000
                .byte %00111100
                .byte %00000110
                .byte %00111110
                .byte %01100110
                .byte %00111110
                .byte %00000000

                ; CHR$98 - b
                .byte %01100000
                .byte %01100000
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01111100
                .byte %00000000

                ; CHR$99 - c
                .byte %00000000
                .byte %00000000
                .byte %00111100
                .byte %01100110
                .byte %01100000
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$100 - d
                .byte %00000110
                .byte %00000110
                .byte %00111110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111110
                .byte %00000000

                ; CHR$101 - e
                .byte %00000000
                .byte %00000000
                .byte %00111100
                .byte %01100110
                .byte %01111110
                .byte %01100000
                .byte %00111100
                .byte %00000000

                ; CHR$102 - f
                .byte %00011100
                .byte %00110000
                .byte %00110000
                .byte %01111100
                .byte %00110000
                .byte %00110000
                .byte %00110000
                .byte %00000000

                ; CHR$103 - g
                .byte %00000000
                .byte %00000000
                .byte %00111110
                .byte %01100110
                .byte %01100110
                .byte %00111110
                .byte %00000110
                .byte %00111100

                ; CHR$104 - h
                .byte %01100000
                .byte %01100000
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00000000

                ; CHR$105 - i
                .byte %00011000
                .byte %00000000
                .byte %00111000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00111100
                .byte %00000000

                ; CHR$106 - j
                .byte %00011000
                .byte %00000000
                .byte %00111000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %01110000

                ; CHR$107 - k
                .byte %01100000
                .byte %01100000
                .byte %01100110
                .byte %01101100
                .byte %01111000
                .byte %01101100
                .byte %01100110
                .byte %00000000

                ; CHR$108 - l
                .byte %00111000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00111100
                .byte %00000000

                ; CHR$109 - m
                .byte %00000000
                .byte %00000000
                .byte %00110110
                .byte %01111111
                .byte %01101011
                .byte %01101011
                .byte %01100011
                .byte %00000000

                ; CHR$110 - n
                .byte %00000000
                .byte %00000000
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00000000

                ; CHR$111 - o
                .byte %00000000
                .byte %00000000
                .byte %00111100
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00000000

                ; CHR$112 - p
                .byte %00000000
                .byte %00000000
                .byte %01111100
                .byte %01100110
                .byte %01100110
                .byte %01111100
                .byte %01100000
                .byte %01100000

                ; CHR$113 - q
                .byte %00000000
                .byte %00000000
                .byte %00111110
                .byte %01100110
                .byte %01100110
                .byte %00111110
                .byte %00000110
                .byte %00000111

                ; CHR$114 - r
                .byte %00000000
                .byte %00000000
                .byte %01101100
                .byte %01110110
                .byte %01100000
                .byte %01100000
                .byte %01100000
                .byte %00000000

                ; CHR$115 - s
                .byte %00000000
                .byte %00000000
                .byte %00111110
                .byte %01100000
                .byte %00111100
                .byte %00000110
                .byte %01111100
                .byte %00000000

                ; CHR$116 - t
                .byte %00110000
                .byte %00110000
                .byte %01111100
                .byte %00110000
                .byte %00110000
                .byte %00110000
                .byte %00011100
                .byte %00000000

                ; CHR$117 - u
                .byte %00000000
                .byte %00000000
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111110
                .byte %00000000

                ; CHR$118 - v
                .byte %00000000
                .byte %00000000
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111100
                .byte %00011000
                .byte %00000000

                ; CHR$119 - w
                .byte %00000000
                .byte %00000000
                .byte %01100011
                .byte %01101011
                .byte %01101011
                .byte %01111111
                .byte %00110110
                .byte %00000000

                ; CHR$120 - x
                .byte %00000000
                .byte %00000000
                .byte %01100110
                .byte %00111100
                .byte %00011000
                .byte %00111100
                .byte %01100110
                .byte %00000000

                ; CHR$121 - y
                .byte %00000000
                .byte %00000000
                .byte %01100110
                .byte %01100110
                .byte %01100110
                .byte %00111110
                .byte %00000110
                .byte %00111100

                ; CHR$122 - z
                .byte %00000000
                .byte %00000000
                .byte %01111110
                .byte %00001100
                .byte %00011000
                .byte %00110000
                .byte %01111110
                .byte %00000000

                ; CHR$123 - {
                .byte %00001100
                .byte %00011000
                .byte %00011000
                .byte %01110000
                .byte %00011000
                .byte %00011000
                .byte %00001100
                .byte %00000000

                ; CHR$124 - |
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00000000
                .byte %00011000
                .byte %00011000
                .byte %00011000
                .byte %00000000

                ; CHR$125 - }
                .byte %00110000
                .byte %00011000
                .byte %00011000
                .byte %00001110
                .byte %00011000
                .byte %00011000
                .byte %00110000
                .byte %00000000

                ; CHR$126 - ~
                .byte %00110001
                .byte %01101011
                .byte %01000110
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000
                .byte %00000000

                ; CHR$127 - 
                .byte %11111111
                .byte %11111111
                .byte %11111111
                .byte %11111111
                .byte %11111111
                .byte %11111111
                .byte %11111111
                .byte %11111111

; VDU DRIVERS
; ===========
LC300:
                jmp LCB12                    ; Initialise VDU drivers with MODE A
LC303:
                .byte 13
                .text "Acorn Electron "
                .byte 0
LC314:
                .byte 8                      ; Overlaps following &00 byte
                .byte 13
                .byte 13

LC317:
                .byte $00
                ora ($22),y                  ; C318= 11 22       ."
                .byte $33                    ; C31A= 33          3
                .byte $44                    ; C31B= 44          D
                eor $66,x                    ; C31C= 55 66       Uf
                .byte $77                    ; C31E= 77          w
                dey                          ; C31F= 88          .
                sta $BBAA,y                  ; C320= 99 AA BB    .*;
                ;cpy LEEDD                    ; C323= CC DD EE    L]n
                .byte $CC
                .byte $DD
                .byte $EE
                .byte $FF                    ; C326= FF          .

LC327:
                brk                          ; C327= 00          .
                eor $AA,x                    ; C328= 55 AA       U*
                .byte $FF                    ; C32A= FF          .

_:=[]
_..=[(LC48B,0)] ; VDU 0
_..=[(LC4B5,1)] ; VDU 1
_..=[(LC51C,0)] ; VDU 2
_..=[(LC527,0)] ; VDU 3
_..=[(LC52E,0)] ; VDU 4
_..=[(LC535,0)] ; VDU 5
_..=[(LC48B,0)] ; VDU 6
_..=[(LE64B,0)] ; VDU 7
_..=[(LC53E,0)] ; VDU 8
_..=[(LC5E2,0)] ; VDU 9
_..=[(LC66A,0)] ; VDU 10
_..=[(LC5D9,0)] ; VDU 11
_..=[(LC6F6,0)] ; VDU 12
_..=[(LC75E,0)] ; VDU 13
_..=[(LC513,0)] ; VDU 14
_..=[(LC52C,0)] ; VDU 15
_..=[(LC76C,0)] ; VDU 16
_..=[(LC7A5,1)] ; VDU 17
_..=[(LC7C4,2)] ; VDU 18
_..=[(LC841,5)] ; VDU 19
_..=[(LC7F6,0)] ; VDU 20
_..=[(LC521,0)] ; VDU 21
_..=[(LC8EC,1)] ; VDU 22
_..=[(LC8F2,9)] ; VDU 23
_..=[(LCA38,8)] ; VDU 24
_..=[(LC986,5)] ; VDU 25
_..=[(LCA02,0)] ; VDU 26
_..=[(LC48B,0)] ; VDU 27
_..=[(LC674,4)] ; VDU 28
_..=[(LCAA1,4)] ; VDU 29
_..=[(LC716,0)] ; VDU 30
_..=[(LC725,2)] ; VDU 31
_..=[(LCAAB,0)] ; VDU 32
vdu_routines=_

LC32B:
                .for i=0,i<len(vdu_routines),i+=1
                .byte <vdu_routines[i][0]
                .next
                
LC34C:
                .for i=0,i<len(vdu_routines),i+=1
                .if vdu_routines[i][1]==0
                .byte >vdu_routines[i][0]
                .else
                .cerror !(vdu_routines[i][0]>=(vduRoutinesPage<<8)&&vdu_routines[i][0]<(vduRoutinesPage<<8)+$7ff)
                .cerror !(vdu_routines[i][1]>=0&&vdu_routines[i][1]<16)
                .byte (16-vdu_routines[i][1])|((((>vdu_routines[i][0])-vduRoutinesPage)&$f)<<4)
                .endif
                .next

LC36D:
                brk                          ; C36D= 00          .
LC36E:
                brk                          ; C36E= 00          .
                .byte $02                    ; C36F= 02          .
                ;bra LC377                    ; C370= 80 05       ..
                .byte $80
                .byte $05

                brk                          ; C372= 00          .
                .byte $07                    ; C373= 07          .
                ; bra LC380                    ; C374= 80 0A       ..
                .byte $80
                .byte $0a

                brk                          ; C376= 00          .
LC377:
                ; tsb $0F80                    ; C377= 0C 80 0F    ...
                .byte $0c
                .byte $80
                .byte $0f
                brk                          ; C37A= 00          .
                ora ($80),y                  ; C37B= 11 80       ..
                ; trb $00                      ; C37D= 14 00       ..
                .byte $14
                .byte $00
                asl $80,x                    ; C37F= 16 80       ..
                ora $1B00,y                  ; C381= 19 00 1B    ...
                ; bra LC3A4                    ; C384= 80 1E       ..
                .byte $80
                .byte $1e

                brk                          ; C386= 00          .
                jsr $2380                    ; C387= 20 80 23     .#
                brk                          ; C38A= 00          .
                and $80                      ; C38B= 25 80       %.
                plp                          ; C38D= 28          (
                brk                          ; C38E= 00          .
                rol a                        ; C38F= 2A          *
                ; bra LC3BF                    ; C390= 80 2D       .-
                .byte $80
                .byte $2d

                brk                          ; C392= 00          .
                .byte $2F                    ; C393= 2F          /
                ; bra LC3C8                    ; C394= 80 32       .2
                .byte $80
                .byte $32

                brk                          ; C396= 00          .
                ; bit $80,x                    ; C397= 34 80       4.
                .byte $34
                .byte $80
                .byte $37                    ; C399= 37          7
                brk                          ; C39A= 00          .
                and $3C80,y                  ; C39B= 39 80 3C    9.<
                brk                          ; C39E= 00          .
                rol $4180,x                  ; C39F= 3E 80 41    >.A
                brk                          ; C3A2= 00          .
                .byte $43                    ; C3A3= 43          C
LC3A4:
                ; bra LC3EC                    ; C3A4= 80 46       .F
                .byte $80
                .byte $46

                brk                          ; C3A6= 00          .
                pha                          ; C3A7= 48          H
                ; bra LC3F5                    ; C3A8= 80 4B       .K
                .byte $80
                .byte $4b

                brk                          ; C3AA= 00          .
                ; eor $1F80                    ; C3AB= 4D 80 1F    M..
                .byte $4d
                .byte $80
LC3AD:
                .byte $1f
                .byte $1F                    ; C3AE= 1F          .
LC3AF:
                .byte $1F                    ; C3AF= 1F          .
                clc                          ; C3B0= 18          .
                .byte $1F                    ; C3B1= 1F          .
                .byte $1F                    ; C3B2= 1F          .
                clc                          ; C3B3= 18          .
LC3B4:
                .byte $4F                    ; C3B4= 4F          O
                .byte $27                    ; C3B5= 27          '
                .byte $13                    ; C3B6= 13          .
                .byte $4F                    ; C3B7= 4F          O
                .byte $27                    ; C3B8= 27          '
                .byte $13                    ; C3B9= 13          .
                .byte $27                    ; C3BA= 27          '
LC3BB:
                php                          ; C3BB= 08          .
                bpl LC3DE                    ; C3BC= 10 20       .
                php                          ; C3BE= 08          .
LC3BF:
                php                          ; C3BF= 08          .
                ;bpl LC3CA                    ; C3C0= 10 08       ..
                .byte $10
LC3C1:
                .byte $08
                tax                          ; C3C2= AA          *
                eor $88,x                    ; C3C3= 55 88       U.
                .byte $44                    ; C3C5= 44          D
                .byte $22                    ; C3C6= 22          "
                ;ora ($80),y                  ; C3C7= 11 80       ..
                .byte $11
LC3C8:
                .byte $80
                rti                          ; C3C9= 40          @

LC3CA:
                jsr $0810                    ; C3CA= 20 10 08     ..
LC3CD:
                ; tsb $02                      ; C3CD= 04 02       ..
                .byte $04
                .byte $02
LC3CF:
                ora ($03,x)                  ; C3CF= 01 03       ..
                .byte $0F                    ; C3D1= 0F          .
                ora ($01,x)                  ; C3D2= 01 01       ..
                .byte $03                    ; C3D4= 03          .
                ;ora ($00,x)                  ; C3D5= 01 00       ..
                .byte $01
LC3D6:
                .byte $00
LC3D7:
                .byte $FF                    ; C3D7= FF          .
LC3D8:
                brk                          ; C3D8= 00          .
                brk                          ; C3D9= 00          .
                .byte $FF                    ; C3DA= FF          .
LC3DB:
                .byte $FF                    ; C3DB= FF          .
                .byte $FF                    ; C3DC= FF          .
                .byte $FF                    ; C3DD= FF          .
LC3DE:
                brk                          ; C3DE= 00          .
                brk                          ; C3DF= 00          .
                .byte $FF                    ; C3E0= FF          .
                brk                          ; C3E1= 00          .
                .byte $0F                    ; C3E2= 0F          .
                ; beq LC3E4                    ; C3E3= F0 FF       p.
                .byte $f0
                .byte $ff
                brk                          ; C3E5= 00          .
                .byte $03                    ; C3E6= 03          .
                ; tsb $300F                    ; C3E7= 0C 0F 30    ..0
                .byte $0c
                .byte $0f
                .byte $30
                .byte $33                    ; C3EA= 33          3
                ; bit LC03F,x                  ; C3EB= 3C 3F C0    <?@
                .byte $3c
                .byte $3f
                .byte $c0
                .byte $C3                    ; C3EE= C3          C
                ; cpy LF0CF                    ; C3EF= CC CF F0    LOp
                .byte $cc
                .byte $cf
                .byte $f0
                .byte $F3                    ; C3F2= F3          s
                .byte $FC                    ; C3F3= FC          |
                .byte $FF                    ; C3F4= FF          .
LC3F5:
                .byte $07                    ; C3F5= 07          .
                .byte $03                    ; C3F6= 03          .
                ora ($00,x)                  ; C3F7= 01 00       ..
                .byte $07                    ; C3F9= 07          .
                .byte $03                    ; C3FA= 03          .
LC3FB:
                brk                          ; C3FB= 00          .
                brk                          ; C3FC= 00          .
                brk                          ; C3FD= 00          .
                ora ($02,x)                  ; C3FE= 01 02       ..
                .byte $02                    ; C400= 02          .
                .byte $03                    ; C401= 03          .
                .byte $03                    ; C402= 03          .
LC403:
                ; tsb $00                      ; C403= 04 00       ..
                .byte $04
                .byte $00
                asl $02                      ; C405= 06 02       ..
LC407:
                ; bvc LC449                    ; C407= 50 40       P@
                .byte $50
                .byte $40
                plp                          ; C409= 28          (
                ;jsr $4030                    ; C40A= 20 30 40     0@
                .byte $20
LC40B:
                .byte $30
                .byte $40
                cli                          ; C40D= 58          X
                rts                          ; C40E= 60          `

LC40F:
                rti                          ; C40F= 40          @

                ; bra LC3AF                    ; C410= 80 9D       ..
                .byte $80
LC411:
                .word LD29D
                .word LD295

routines_C415_C419=[LD281,LD28B,LD259,LD262]
                
LC415:
                .byte <routines_C415_C419
LC419:
                .byte >routines_C415_C419
LC41D:
                .byte $04
                ora $06                      ; C41E= 05 06       ..
                brk                          ; C420= 00          .
                ora ($02,x)                  ; C421= 01 02       ..
LC423:
                .byte $FF                    ; C423= FF          .
                ;beq LC435                    ; C424= F0 0F       p.
                .byte $F0
                .byte $0F
                brk                          ; C426= 00          .
LC427:
                ora ($22),y                  ; C427= 11 22       ."
                .byte $44                    ; C429= 44          D
                dey                          ; C42A= 88          .

; Electron Acorn bitmap for Ctrl-Break
; ------------------------------------
LC42B:
                .byte %00011000
                .byte %00111100
                .byte %00111100
                .byte %01111110
                .byte %01111110
                .byte %00000000
                .byte %01111110
                .byte %00111100

                .if version==300
message64K:
                .text '64K',0
messageTURBO:
                .text 'TURBO',0
                .cerror (>message64K)!=(>messageTURBO)
                .endif

LC433:
                ldx $026A                    ; Jump if VDU queue not empty
                bne LC48C
                bit $D0                      ; Jump if cursors not seperated
                bvc LC452
                jsr LC4E2
                jsr LCCC1                    ; Remove soft cursor
                bmi LC452                    ; Skip past if VDU21 set
                cmp #$0D                     ; Jump if not <CR>
                bne LC452
                lda #$BD                     ; b6+b1 - separate cursor+cursor editing
                jsr LC530
                lsr $035F
                lda #$0D                     ; Restore A=<CR>
LC452:
                cmp #$7F                     ; Jump with <DEL>
                beq LC467
                cmp #$20                     ; Jump with control codes
                bcc LC469
                bit $D0
                bmi LC464
                jsr LCEDF
                jsr LC5E2
LC464:
                jmp LC4D8

; VDU Control codes
; -----------------
LC467:
                lda #$20                     ; Offset=32 for <DEL>
LC469:
                tay
                lda LC32B,y                  ; get routine LSB
                sta $035D                    ; store routine MSB
                lda LC34C,y                  ; get routine MSB
                bmi LC4BF        ; branch taken if MSB usable directly
                tax                          ; 
                ora #$F0
                sta $026A        ; initialise initial VDU queue length
                txa
                lsr a
                lsr a
                lsr a
                lsr a
                clc
                adc #vduRoutinesPage
                sta $035E
                bit $D0
                bvs LC4A9
                clc
LC48B:
                rts

LC48C:
                sta $0224,x
                inx
                stx $026A
                bne LC4AC
                bit $D0
                bmi LC4AE
                bvs LC4A0
                jsr LD25F
                clc
                rts

LC4A0:
                jsr LC4E2
                jsr LCCC1
                jsr LD25F
LC4A9:
                jsr LC4DF
LC4AC:
                clc
                rts

LC4AE:
                ldy $035E
                cpy #$C4
                bne LC4AC
LC4B5:
                tax
                lda $D0
                lsr a
                bcc LC48B
                txa
                jmp LDEAE

LC4BF:
                sta $035E                    ; store routine MSB
                tya
                cmp #$08
                bcc LC4CD
                eor #$FF
                cmp #$F2
                eor #$FF
LC4CD:
                bit $D0
                bmi LC4F7
                php
                jsr LD25F
                plp
                bcc LC4DB
LC4D8:
                lda $D0
                lsr a
LC4DB:
                bit $D0
                bvc LC48B
LC4DF:
                jsr LCCC1
LC4E2:
                php
                pha
                ldx #$18
                ldy #$64
                jsr LCD1A
                jsr LCE42
                lda $D0
                eor #$02
                sta $D0
                pla
                plp
                rts

LC4F7:
                eor #$06                     ; C4F7= 49 06       I.
                bne LC4FF                    ; C4F9= D0 04       P.
                lda #$7F                     ; C4FB= A9 7F       ).
                bcc LC530                    ; C4FD= 90 31       .1
LC4FF:
                bcc LC504                    ; C4FF= 90 03       ..
                lda $D0                      ; C501= A5 D0       %P
                lsr a                        ; C503= 4A          J
LC504:
                rts                          ; C504= 60          `

LC505:
                lda $D0                      ; C505= A5 D0       %P
                and #$20                     ; C507= 29 20       )
                rts                          ; C509= 60          `

LC50A:
                jsr LD6DE                    ; C50A= 20 DE D6     ^V
                jsr LDEFB                    ; C50D= 20 FB DE     {^
                jmp LD6DE                    ; C510= 4C DE D6    L^V

LC513:
                ldy #$00                     ; C513= A0 00        .
                sty $0269                    ; C515= 8C 69 02    .i.
                lda #$04                     ; C518= A9 04       ).
                bne LC523                    ; C51A= D0 07       P.
LC51C:
                jsr LC50A                    ; C51C= 20 0A C5     .E
                lda #$94                     ; C51F= A9 94       ).
LC521:
                eor #$95                     ; C521= 49 95       I.
LC523:
                ora $D0                      ; C523= 05 D0       .P
                bne LC532                    ; C525= D0 0B       P.
LC527:
                jsr LC50A                    ; C527= 20 0A C5     .E
                lda #$0A                     ; C52A= A9 0A       ).
LC52C:
                eor #$2F                     ; C52C= 49 2F       I/
LC52E:
                eor #$DB                     ; C52E= 49 DB       I[
LC530:
                and $D0                      ; C530= 25 D0       %P
LC532:
                sta $D0                      ; C532= 85 D0       .P
LC534:
                rts                          ; C534= 60          `

LC535:
                lda $0361                    ; C535= AD 61 03    -a.
                beq LC534                    ; C538= F0 FA       pz
                lda #$20                     ; C53A= A9 20       )
                bne LC523                    ; C53C= D0 E5       Pe
LC53E:
                jsr LC505                    ; C53E= 20 05 C5     .E
                bne LC59D                    ; C541= D0 5A       PZ
                dec $0318                    ; C543= CE 18 03    N..
                ldx $0318                    ; C546= AE 18 03    ...
                cpx $0308                    ; C549= EC 08 03    l..
                bmi LC56C                    ; C54C= 30 1E       0.
                lda $D6                      ; C54E= A5 D6       %V
                sec                          ; C550= 38          8
                sbc $034F                    ; C551= ED 4F 03    mO.
                tax                          ; C554= AA          *
                lda $D7                      ; C555= A5 D7       %W
                sbc #$00                     ; C557= E9 00       i.
                cmp $034E                    ; C559= CD 4E 03    MN.
                bcs LC561                    ; C55C= B0 03       0.
                adc $0354                    ; C55E= 6D 54 03    mT.
LC561:
                stx $D6                      ; C561= 86 D6       .V
                bpl LC569                    ; C563= 10 04       ..
                sec                          ; C565= 38          8
                sbc $0354                    ; C566= ED 54 03    mT.
LC569:
                sta $D7                      ; C569= 85 D7       .W
                rts                          ; C56B= 60          `

LC56C:
                lda $030A                    ; C56C= AD 0A 03    -..
                sta $0318                    ; C56F= 8D 18 03    ...
LC572:
                dec $0269                    ; C572= CE 69 02    Ni.
                bpl LC57A                    ; C575= 10 03       ..
                inc $0269                    ; C577= EE 69 02    ni.
LC57A:
                ldx $0319                    ; C57A= AE 19 03    ...
                cpx $030B                    ; C57D= EC 0B 03    l..
                beq LC588                    ; C580= F0 06       p.
                dec $0319                    ; C582= CE 19 03    N..
                jmp LCE42                    ; C585= 4C 42 CE    LBN

LC588:
                clc                          ; C588= 18          .
                jsr LCC96                    ; C589= 20 96 CC     .L
                lda #$08                     ; C58C= A9 08       ).
                bit $D0                      ; C58E= 24 D0       $P
                bne LC597                    ; C590= D0 05       P.
                jsr LC9D1                    ; C592= 20 D1 C9     QI
                bne LC59A                    ; C595= D0 03       P.
LC597:
                jsr LCCDD                    ; C597= 20 DD CC     ]L
LC59A:
                jmp LC628                    ; C59A= 4C 28 C6    L(F

LC59D:
                ldx #$00                     ; C59D= A2 00       ".
LC59F:
                stx $D9                      ; C59F= 86 D9       .Y
                jsr LD01E                    ; C5A1= 20 1E D0     .P
                ldx $D9                      ; C5A4= A6 D9       &Y
                sec                          ; C5A6= 38          8
                lda $0324,x                  ; C5A7= BD 24 03    =$.
                sbc #$08                     ; C5AA= E9 08       i.
                sta $0324,x                  ; C5AC= 9D 24 03    .$.
                bcs LC5B4                    ; C5AF= B0 03       0.
                dec $0325,x                  ; C5B1= DE 25 03    ^%.
LC5B4:
                lda $D8                      ; C5B4= A5 D8       %X
                bne LC5D6                    ; C5B6= D0 1E       P.
                jsr LD01E                    ; C5B8= 20 1E D0     .P
                beq LC5D6                    ; C5BB= F0 19       p.
                ldx $D9                      ; C5BD= A6 D9       &Y
                lda $0304,x                  ; C5BF= BD 04 03    =..
                cpx #$01                     ; C5C2= E0 01       `.
                bcs LC5C8                    ; C5C4= B0 02       0.
                sbc #$06                     ; C5C6= E9 06       i.
LC5C8:
                sta $0324,x                  ; C5C8= 9D 24 03    .$.
                lda $0305,x                  ; C5CB= BD 05 03    =..
                sbc #$00                     ; C5CE= E9 00       i.
                sta $0325,x                  ; C5D0= 9D 25 03    .%.
                txa                          ; C5D3= 8A          .
                beq LC5DE                    ; C5D4= F0 08       p.
LC5D6:
                jmp LD0C9                    ; C5D6= 4C C9 D0    LIP

LC5D9:
                jsr LC505                    ; C5D9= 20 05 C5     .E
                beq LC572                    ; C5DC= F0 94       p.
LC5DE:
                ldx #$02                     ; C5DE= A2 02       ".
                bne LC630                    ; C5E0= D0 4E       PN
LC5E2:
                lda $D0                      ; C5E2= A5 D0       %P
                and #$20                     ; C5E4= 29 20       )
                bne LC62E                    ; C5E6= D0 46       PF
                ldx $0318                    ; C5E8= AE 18 03    ...
                cpx $030A                    ; C5EB= EC 0A 03    l..
                bcs LC600                    ; C5EE= B0 10       0.
                inc $0318                    ; C5F0= EE 18 03    n..
                lda $D6                      ; C5F3= A5 D6       %V
                adc $034F                    ; C5F5= 6D 4F 03    mO.
                tax                          ; C5F8= AA          *
                lda $D7                      ; C5F9= A5 D7       %W
                adc #$00                     ; C5FB= 69 00       i.
                jmp LC561                    ; C5FD= 4C 61 C5    LaE

LC600:
                lda $0308                    ; C600= AD 08 03    -..
                sta $0318                    ; C603= 8D 18 03    ...
LC606:
                clc                          ; C606= 18          .
                jsr LCAD8                    ; C607= 20 D8 CA     XJ
                ldx $0319                    ; C60A= AE 19 03    ...
                cpx $0309                    ; C60D= EC 09 03    l..
                bcs LC617                    ; C610= B0 05       0.
                inc $0319                    ; C612= EE 19 03    n..
                bcc LC62B                    ; C615= 90 14       ..
LC617:
                jsr LCC96                    ; C617= 20 96 CC     .L
                lda #$08                     ; C61A= A9 08       ).
                bit $D0                      ; C61C= 24 D0       $P
                bne LC625                    ; C61E= D0 05       P.
                jsr LC9E1                    ; C620= 20 E1 C9     aI
                bne LC628                    ; C623= D0 03       P.
LC625:
                jsr LCD3B                    ; C625= 20 3B CD     ;M
LC628:
                jsr LCDE8                    ; C628= 20 E8 CD     hM
LC62B:
                jmp LCE42                    ; C62B= 4C 42 CE    LBN

LC62E:
                ldx #$00                     ; C62E= A2 00       ".
LC630:
                stx $D9                      ; C630= 86 D9       .Y
                jsr LD01E                    ; C632= 20 1E D0     .P
                ldx $D9                      ; C635= A6 D9       &Y
                clc                          ; C637= 18          .
                lda $0324,x                  ; C638= BD 24 03    =$.
                adc #$08                     ; C63B= 69 08       i.
                sta $0324,x                  ; C63D= 9D 24 03    .$.
                bcc LC645                    ; C640= 90 03       ..
                inc $0325,x                  ; C642= FE 25 03    ~%.
LC645:
                lda $D8                      ; C645= A5 D8       %X
                bne LC667                    ; C647= D0 1E       P.
                jsr LD01E                    ; C649= 20 1E D0     .P
                beq LC667                    ; C64C= F0 19       p.
                ldx $D9                      ; C64E= A6 D9       &Y
                lda $0300,x                  ; C650= BD 00 03    =..
                cpx #$01                     ; C653= E0 01       `.
                bcc LC659                    ; C655= 90 02       ..
                adc #$06                     ; C657= 69 06       i.
LC659:
                sta $0324,x                  ; C659= 9D 24 03    .$.
                lda $0301,x                  ; C65C= BD 01 03    =..
                adc #$00                     ; C65F= 69 00       i.
                sta $0325,x                  ; C661= 9D 25 03    .%.
                txa                          ; C664= 8A          .
                beq LC66F                    ; C665= F0 08       p.
LC667:
                jmp LD0C9                    ; C667= 4C C9 D0    LIP

LC66A:
                jsr LC505                    ; C66A= 20 05 C5     .E
                beq LC606                    ; C66D= F0 97       p.
LC66F:
                ldx #$02                     ; C66F= A2 02       ".
                jmp LC59F                    ; C671= 4C 9F C5    L.E

LC674:
                ldx $0355                    ; C674= AE 55 03    .U.
                lda $0321                    ; C677= AD 21 03    -!.
                cmp $0323                    ; C67A= CD 23 03    M#.
                bcc LC6F5                    ; C67D= 90 76       .v
                cmp LC3AD,x                  ; C67F= DD AD C3    ]-C
                beq LC686                    ; C682= F0 02       p.
                bcs LC6F5                    ; C684= B0 6F       0o
LC686:
                lda $0322                    ; C686= AD 22 03    -".
                tay                          ; C689= A8          (
                cmp LC3B4,x                  ; C68A= DD B4 C3    ]4C
                beq LC691                    ; C68D= F0 02       p.
                bcs LC6F5                    ; C68F= B0 64       0d
LC691:
                sec                          ; C691= 38          8
                sbc $0320                    ; C692= ED 20 03    m .
                bmi LC6F5                    ; C695= 30 5E       0^
                tay                          ; C697= A8          (
                jsr LCA87                    ; C698= 20 87 CA     .J
                lda #$08                     ; C69B= A9 08       ).
                jsr LC523                    ; C69D= 20 23 C5     #E
                ldx #$20                     ; C6A0= A2 20       "
                ldy #$08                     ; C6A2= A0 08        .
                jsr LD3A1                    ; C6A4= 20 A1 D3     !S
                jsr LCE24                    ; C6A7= 20 24 CE     $N
LC6AA:
                bcs LC71B                    ; C6AA= B0 6F       0o
                rts                          ; C6AC= 60          `

LC6AD:
                ldy #$03                     ; C6AD= A0 03        .
LC6AF:
                .if version==300
                jsr LE75C_300
                .else
                lda ($F0),y                  ; C6AF= B1 F0       1p
                .endif
                sta $0328,y                  ; C6B1= 99 28 03    .(.
                dey                          ; C6B4= 88          .
                bpl LC6AF                    ; C6B5= 10 F8       .x
                jsr LD6DE                    ; C6B7= 20 DE D6     ^V
                ldx #$28                     ; C6BA= A2 28       "(
                jsr LD05A                    ; C6BC= 20 5A D0     ZP
                ldx #$28                     ; C6BF= A2 28       "(
                jsr LD775                    ; C6C1= 20 75 D7     uW
                bne LC6E1                    ; C6C4= D0 1B       P.
                lda ($D4),y                  ; C6C6= B1 D4       1T
LC6C8:
                asl a                        ; C6C8= 0A          .
                rol $D8                      ; C6C9= 26 D8       &X
                asl $D1                      ; C6CB= 06 D1       .Q
                php                          ; C6CD= 08          .
                bcs LC6D2                    ; C6CE= B0 02       0.
                lsr $D8                      ; C6D0= 46 D8       FX
LC6D2:
                plp                          ; C6D2= 28          (
                bne LC6C8                    ; C6D3= D0 F3       Ps
                lda $D8                      ; C6D5= A5 D8       %X
                and $0360                    ; C6D7= 2D 60 03    -`.
LC6DA:
                jsr LD6DE                    ; C6DA= 20 DE D6     ^V
                ldy #$04                     ; C6DD= A0 04        .
                bne LC6ED                    ; C6DF= D0 0C       P.
LC6E1:
                lda #$FF                     ; C6E1= A9 FF       ).
                bne LC6DA                    ; C6E3= D0 F5       Pu
LC6E5:
                and $0360                    ; C6E5= 2D 60 03    -`.
                tax                          ; C6E8= AA          *
                lda $036F,x                  ; C6E9= BD 6F 03    =o.
LC6EC:
                iny                          ; C6EC= C8          H
LC6ED:
                .if version==300
                jsr LE75F_300
                .else
                sta ($F0),y                  ; C6ED= 91 F0       .p
                .endif
                lda #$00                     ; C6EF= A9 00       ).
                cpy #$04                     ; C6F1= C0 04       @.
                bne LC6EC                    ; C6F3= D0 F7       Pw
LC6F5:
                rts                          ; C6F5= 60          `

LC6F6:
                jsr LC505                    ; C6F6= 20 05 C5     .E
                bne LC769                    ; C6F9= D0 6E       Pn
                lda $D0                      ; C6FB= A5 D0       %P
                and #$08                     ; C6FD= 29 08       ).
                bne LC704                    ; C6FF= D0 03       P.
                jmp LCB9D                    ; C701= 4C 9D CB    L.K

LC704:
                ldx $030B                    ; C704= AE 0B 03    ...
LC707:
                stx $0319                    ; C707= 8E 19 03    ...
                jsr LCDE8                    ; C70A= 20 E8 CD     hM
                ldx $0319                    ; C70D= AE 19 03    ...
                cpx $0309                    ; C710= EC 09 03    l..
                inx                          ; C713= E8          h
                bcc LC707                    ; C714= 90 F1       .q
LC716:
                jsr LC505                    ; C716= 20 05 C5     .E
                bne LC74D                    ; C719= D0 32       P2
LC71B:
                lda #$00                     ; C71B= A9 00       ).
                sta $0323                    ; C71D= 8D 23 03    .#.
                sta $0322                    ; C720= 8D 22 03    .".
                beq LC72A                    ; C723= F0 05       p.
LC725:
                jsr LC505                    ; C725= 20 05 C5     .E
                bne LC6F5                    ; C728= D0 CB       PK
LC72A:
                jsr LC746                    ; C72A= 20 46 C7     FG
                clc                          ; C72D= 18          .
                lda $0322                    ; C72E= AD 22 03    -".
                adc $0308                    ; C731= 6D 08 03    m..
                sta $0318                    ; C734= 8D 18 03    ...
                lda $0323                    ; C737= AD 23 03    -#.
                clc                          ; C73A= 18          .
                adc $030B                    ; C73B= 6D 0B 03    m..
                sta $0319                    ; C73E= 8D 19 03    ...
                jsr LCE24                    ; C741= 20 24 CE     $N
                bcc LC6F5                    ; C744= 90 AF       ./
LC746:
                ldx #$18                     ; C746= A2 18       ".
                ldy #$28                     ; C748= A0 28        (
                jmp LCD1A                    ; C74A= 4C 1A CD    L.M

LC74D:
                ldx #$06                     ; C74D= A2 06       ".
                ldy #$26                     ; C74F= A0 26        &
                jsr LD399                    ; C751= 20 99 D3     .S
LC754:
                ldx #$00                     ; C754= A2 00       ".
                ldy #$24                     ; C756= A0 24        $
                jsr LD399                    ; C758= 20 99 D3     .S
LC75B:
                jmp LD0C9                    ; C75B= 4C C9 D0    LIP

LC75E:
                jsr LC505                    ; C75E= 20 05 C5     .E
                bne LC754                    ; C761= D0 F1       Pq
                jsr LCDAA                    ; C763= 20 AA CD     *M
                jmp LCE42                    ; C766= 4C 42 CE    LBN

LC769:
                jsr LC74D                    ; C769= 20 4D C7     MG
LC76C:
                lda $0361                    ; C76C= AD 61 03    -a.
                beq LC7A4                    ; C76F= F0 33       p3
                ldx $035A                    ; C771= AE 5A 03    .Z.
                ldy $035C                    ; C774= AC 5C 03    ,\.
                jsr LCFC4                    ; C777= 20 C4 CF     DO
                ldx #$00                     ; C77A= A2 00       ".
                ldy #$28                     ; C77C= A0 28        (
                jsr LD393                    ; C77E= 20 93 D3     .S
                sec                          ; C781= 38          8
                lda $0306                    ; C782= AD 06 03    -..
                sbc $0302                    ; C785= ED 02 03    m..
                tay                          ; C788= A8          (
                iny                          ; C789= C8          H
                sty $0330                    ; C78A= 8C 30 03    .0.
LC78D:
                ldx #$2C                     ; C78D= A2 2C       ",
                ldy #$28                     ; C78F= A0 28        (
                jsr LD5BC                    ; C791= 20 BC D5     <U
                lda $032E                    ; C794= AD 2E 03    -..
                bne LC79C                    ; C797= D0 03       P.
                dec $032F                    ; C799= CE 2F 03    N/.
LC79C:
                dec $032E                    ; C79C= CE 2E 03    N..
                dec $0330                    ; C79F= CE 30 03    N0.
                bne LC78D                    ; C7A2= D0 E9       Pi
LC7A4:
                rts                          ; C7A4= 60          `

LC7A5:
                tay                          ; C7A5= A8          (
                bpl LC7BB                    ; C7A6= 10 13       ..
                and $0360                    ; C7A8= 2D 60 03    -`.
                php                          ; C7AB= 08          .
                sei                          ; C7AC= 78          x
                sta $D8                      ; C7AD= 85 D8       .X
                lda $034B                    ; C7AF= AD 4B 03    -K.
                and #$F0                     ; C7B2= 29 F0       )p
                ora $D8                      ; C7B4= 05 D8       .X
                sta $034B                    ; C7B6= 8D 4B 03    .K.
                plp                          ; C7B9= 28          (
                tya                          ; C7BA= 98          .
LC7BB:
                ldy #$00                     ; C7BB= A0 00        .
                beq LC7C6                    ; C7BD= F0 07       p.
LC7BF:
                pha                          ; C7BF= 48          H
                jsr LC7A5                    ; C7C0= 20 A5 C7     %G
                pla                          ; C7C3= 68          h
LC7C4:
                ldy #$02                     ; C7C4= A0 02        .
LC7C6:
                tax                          ; C7C6= AA          *
                bpl LC7CA                    ; C7C7= 10 01       ..
                iny                          ; C7C9= C8          H
LC7CA:
                and $0360                    ; C7CA= 2D 60 03    -`.
                sta $D8                      ; C7CD= 85 D8       .X
                lda $0360                    ; C7CF= AD 60 03    -`.
                and #$07                     ; C7D2= 29 07       ).
                clc                          ; C7D4= 18          .
                adc $D8                      ; C7D5= 65 D8       eX
                tax                          ; C7D7= AA          *
                lda LC3DE,x                  ; C7D8= BD DE C3    =^C
                sta $0357,y                  ; C7DB= 99 57 03    .W.
                cpy #$02                     ; C7DE= C0 02       @.
                bcs LC7EF                    ; C7E0= B0 0D       0.
                lda $0357                    ; C7E2= AD 57 03    -W.
                eor #$FF                     ; C7E5= 49 FF       I.
                sta $D3                      ; C7E7= 85 D3       .S
                eor $0358                    ; C7E9= 4D 58 03    MX.
                sta $D2                      ; C7EC= 85 D2       .R
                rts                          ; C7EE= 60          `

LC7EF:
                lda $0322                    ; C7EF= AD 22 03    -".
                sta $0359,y                  ; C7F2= 99 59 03    .Y.
                rts                          ; C7F5= 60          `

LC7F6:
                lda #$00                     ; C7F6= A9 00       ).
                sta $0322                    ; C7F8= 8D 22 03    .".
                lda $0360                    ; C7FB= AD 60 03    -`.
                and #$07                     ; C7FE= 29 07       ).
                jsr LC7BF                    ; C800= 20 BF C7     ?G
                lda #$80                     ; C803= A9 80       ).
                jsr LC7BF                    ; C805= 20 BF C7     ?G
                ldx $0360                    ; C808= AE 60 03    .`.
                stx $031F                    ; C80B= 8E 1F 03    ...
                cpx #$03                     ; C80E= E0 03       `.
                beq LC823                    ; C810= F0 11       p.
                bcc LC834                    ; C812= 90 20       .
                stx $0320                    ; C814= 8E 20 03    . .
LC817:
                jsr LC841                    ; C817= 20 41 C8     AH
                dec $0320                    ; C81A= CE 20 03    N .
                dec $031F                    ; C81D= CE 1F 03    N..
                bpl LC817                    ; C820= 10 F5       .u
                rts                          ; C822= 60          `

LC823:
                ldx #$07                     ; C823= A2 07       ".
                stx $0320                    ; C825= 8E 20 03    . .
LC828:
                jsr LC841                    ; C828= 20 41 C8     AH
                lsr $0320                    ; C82B= 4E 20 03    N .
                dec $031F                    ; C82E= CE 1F 03    N..
                bpl LC828                    ; C831= 10 F5       .u
                rts                          ; C833= 60          `

LC834:
                ldx #$07                     ; C834= A2 07       ".
                jsr LC83E                    ; C836= 20 3E C8     >H
                ldx #$00                     ; C839= A2 00       ".
                stx $031F                    ; C83B= 8E 1F 03    ...
LC83E:
                stx $0320                    ; C83E= 8E 20 03    . .
LC841:
                lda $0320                    ; C841= AD 20 03    - .
                ldx $031F                    ; C844= AE 1F 03    ...
LC847:
                clc                          ; C847= 18          .
LC848:
                php                          ; C848= 08          .
                sei                          ; C849= 78          x
                and #$0F                     ; C84A= 29 0F       ).
                sta $FB                      ; C84C= 85 FB       .{
                txa                          ; C84E= 8A          .
                and $0360                    ; C84F= 2D 60 03    -`.
                tay                          ; C852= A8          (
                lda $FB                      ; C853= A5 FB       %{
                bcs LC85A                    ; C855= B0 03       0.
                sta $036F,y                  ; C857= 99 6F 03    .o.
LC85A:
                cmp #$08                     ; C85A= C9 08       I.
                bcc LC863                    ; C85C= 90 05       ..
                eor $0248                    ; C85E= 4D 48 02    MH.
                sta $FB                      ; C861= 85 FB       .{
LC863:
                tya                          ; C863= 98          .
                ldx $0360                    ; C864= AE 60 03    .`.
                cpx #$03                     ; C867= E0 03       `.
                beq LC88A                    ; C869= F0 1F       p.
                bcc LC889                    ; C86B= 90 1C       ..
                lsr a                        ; C86D= 4A          J
                lsr a                        ; C86E= 4A          J
                php                          ; C86F= 08          .
                lsr a                        ; C870= 4A          J
                plp                          ; C871= 28          (
                rol a                        ; C872= 2A          *
                tax                          ; C873= AA          *
                tya                          ; C874= 98          .
                bit LC3CD                    ; C875= 2C CD C3    ,MC
                beq LC87B                    ; C878= F0 01       p.
                sec                          ; C87A= 38          8
LC87B:
                rol a                        ; C87B= 2A          *
                asl a                        ; C87C= 0A          .
                and #$06                     ; C87D= 29 06       ).
                tay                          ; C87F= A8          (
                cmp #$04                     ; C880= C9 04       I.
                bcc LC88D                    ; C882= 90 09       ..
                eor #$02                     ; C884= 49 02       I.
                tay                          ; C886= A8          (
                bcs LC88D                    ; C887= B0 04       0.
LC889:
                asl a                        ; C889= 0A          .
LC88A:
                tax                          ; C88A= AA          *
                ldy #$00                     ; C88B= A0 00        .
LC88D:
                stx $FA                      ; C88D= 86 FA       .z
                lda $FB                      ; C88F= A5 FB       %{
                lsr a                        ; C891= 4A          J
                jsr LC8C5                    ; C892= 20 C5 C8     EH
                lda $FB                      ; C895= A5 FB       %{
                iny                          ; C897= C8          H
                jsr LC8C5                    ; C898= 20 C5 C8     EH
                plp                          ; C89B= 28          (
                rts                          ; C89C= 60          `

LC89D:
                tax                          ; C89D= AA          *
                iny                          ; C89E= C8          H
                .if version==300
                jsr LE75C_300
                .else
                lda ($F0),y                  ; C89F= B1 F0       1p
                .endif
                bcs LC847                    ; C8A1= B0 A4       0$
LC8A3:
                lda $D8                      ; C8A3= A5 D8       %X
                pha                          ; C8A5= 48          H
                ldx $0360                    ; C8A6= AE 60 03    .`.
LC8A9:
                ldy $036F,x                  ; C8A9= BC 6F 03    <o.
                cpy #$08                     ; C8AC= C0 08       @.
                bcc LC8BE                    ; C8AE= 90 0E       ..
                txa                          ; C8B0= 8A          .
                pha                          ; C8B1= 48          H
                tya                          ; C8B2= 98          .
                and #$07                     ; C8B3= 29 07       ).
                eor $0248                    ; C8B5= 4D 48 02    MH.
                sec                          ; C8B8= 38          8
                jsr LC848                    ; C8B9= 20 48 C8     HH
                pla                          ; C8BC= 68          h
                tax                          ; C8BD= AA          *
LC8BE:
                dex                          ; C8BE= CA          J
                bpl LC8A9                    ; C8BF= 10 E8       .h
                pla                          ; C8C1= 68          h
                sta $D8                      ; C8C2= 85 D8       .X
                rts                          ; C8C4= 60          `

LC8C5:
                and #$03                     ; C8C5= 29 03       ).
                tax                          ; C8C7= AA          *
                lda LC423,x                  ; C8C8= BD 23 C4    =#D
                ldx $FA                      ; C8CB= A6 FA       &z
                and LC427,x                  ; C8CD= 3D 27 C4    ='D
                sta $FC                      ; C8D0= 85 FC       .|
                lda LC427,x                  ; C8D2= BD 27 C4    ='D
                eor #$FF                     ; C8D5= 49 FF       I.
                and $0804,y                  ; C8D7= 39 04 08    9..
                ora $FC                      ; C8DA= 05 FC       .|
                sta $0804,y                  ; C8DC= 99 04 08    ...
                tax                          ; C8DF= AA          *
                lda $034B                    ; C8E0= AD 4B 03    -K.
                and #$30                     ; C8E3= 29 30       )0
                bne LC8EB                    ; C8E5= D0 04       P.
                txa                          ; C8E7= 8A          .
                sta LFE08,y                  ; C8E8= 99 08 FE    ..~
LC8EB:
                rts                          ; C8EB= 60          `

LC8EC:
                lda $0323                    ; C8EC= AD 23 03    -#.
                jmp LCB30                    ; C8EF= 4C 30 CB    L0K

LC8F2:
                lda $031B                    ; C8F2= AD 1B 03    -..
                cmp #$20                     ; C8F5= C9 20       I
                bcc LC93E                    ; C8F7= 90 45       .E
                pha                          ; C8F9= 48          H
                lsr a                        ; C8FA= 4A          J
                lsr a                        ; C8FB= 4A          J
                lsr a                        ; C8FC= 4A          J
                lsr a                        ; C8FD= 4A          J
                lsr a                        ; C8FE= 4A          J
                tax                          ; C8FF= AA          *
LC900:
                lda LC3C8,x                  ; C900= BD C8 C3    =HC
                bit $0367                    ; C903= 2C 67 03    ,g.
                bne LC928                    ; C906= D0 20       P
                ora $0367                    ; C908= 0D 67 03    .g.
                sta $0367                    ; C90B= 8D 67 03    .g.
                txa                          ; C90E= 8A          .
                and #$03                     ; C90F= 29 03       ).
                clc                          ; C911= 18          .
                adc #$BF                     ; C912= 69 BF       i?
                sta $DD                      ; C914= 85 DD       .]
                lda $0367,x                  ; C916= BD 67 03    =g.
                sta $DB                      ; C919= 85 DB       .[
                ldy #$00                     ; C91B= A0 00        .
                sty $DA                      ; C91D= 84 DA       .Z
                sty $DC                      ; C91F= 84 DC       .\
LC921:
                lda ($DC),y                  ; C921= B1 DC       1\
                .if version==300
                jsr LE756_300
                .else
                sta ($DA),y                  ; C923= 91 DA       .Z
                .endif
                dey                          ; C925= 88          .
                bne LC921                    ; C926= D0 F9       Py
LC928:
                pla                          ; C928= 68          h
                jsr LCF4F                    ; C929= 20 4F CF     OO
                ldy #$07                     ; C92C= A0 07        .
LC92E:
                lda $031C,y                  ; C92E= B9 1C 03    9..
                sta ($DC),y                  ; C931= 91 DC       .\
                dey                          ; C933= 88          .
                bpl LC92E                    ; C934= 10 F8       .x
                rts                          ; C936= 60          `

LC937:
                lda $031F                    ; C937= AD 1F 03    -..
                clc                          ; C93A= 18          .
LC93B:
                jmp ($0226)                  ; C93B= 6C 26 02    l&.

LC93E:
                cmp #$01                     ; C93E= C9 01       I.
                beq LC96B                    ; C940= F0 29       p)
                bcs LC93B                    ; C942= B0 F7       0w
                sec                          ; C944= 38          8
                lda $031C                    ; C945= AD 1C 03    -..
                eor #$0A                     ; C948= 49 0A       I.
                bne LC93B                    ; C94A= D0 EF       Po
                lda $031D                    ; C94C= AD 1D 03    -..
                eor #$20                     ; C94F= 49 20       I
                and #$60                     ; C951= 29 60       )`
                beq LC95D                    ; C953= F0 08       p.
LC955:
                jsr LC97A                    ; C955= 20 7A C9     zI
                lda #$EF                     ; C958= A9 EF       )o
                jmp LC530                    ; C95A= 4C 30 C5    L0E

LC95D:
                lda #$10                     ; C95D= A9 10       ).
                jmp LC523                    ; C95F= 4C 23 C5    L#E

LC962:
                jsr LC97A                    ; C962= 20 7A C9     zI
                ldy #$00                     ; C965= A0 00        .
LC967:
                sty $035F                    ; C967= 8C 5F 03    ._.
                rts                          ; C96A= 60          `

LC96B:
                ldy $031C                    ; C96B= AC 1C 03    ,..
                beq LC95D                    ; C96E= F0 ED       pm
                cpy #$02                     ; C970= C0 02       @.
                beq LC962                    ; C972= F0 EE       pn
                bcc LC955                    ; C974= 90 DF       ._
LC976:
                ldy #$0A                     ; C976= A0 0A        .
                bne LC967                    ; C978= D0 ED       Pm
LC97A:
                php                          ; C97A= 08          .
                sei                          ; C97B= 78          x
                lda $034B                    ; C97C= AD 4B 03    -K.
                ora #$40                     ; C97F= 09 40       .@
                sta $034B                    ; C981= 8D 4B 03    .K.
                plp                          ; C984= 28          (
                rts                          ; C985= 60          `

LC986:
                ldx $0361                    ; C986= AE 61 03    .a.
                beq LC937                    ; C989= F0 AC       p,
                jmp LCF71                    ; C98B= 4C 71 CF    LqO

LC98E:
                clc                          ; C98E= 18          .
                lda $035F                    ; C98F= AD 5F 03    -_.
                adc $034A                    ; C992= 6D 4A 03    mJ.
                sta $034A                    ; C995= 8D 4A 03    .J.
                lda $034B                    ; C998= AD 4B 03    -K.
                bmi LC9D0                    ; C99B= 30 33       03
                bcc LC9A4                    ; C99D= 90 05       ..
                eor #$40                     ; C99F= 49 40       I@
                sta $034B                    ; C9A1= 8D 4B 03    .K.
LC9A4:
                and #$40                     ; C9A4= 29 40       )@
                beq LC9AF                    ; C9A6= F0 07       p.
                lda $0360                    ; C9A8= AD 60 03    -`.
                sbc #$04                     ; C9AB= E9 04       i.
                ora #$3F                     ; C9AD= 09 3F       .?
LC9AF:
                sta $FB                      ; C9AF= 85 FB       .{
                lda $D0                      ; C9B1= A5 D0       %P
                and #$30                     ; C9B3= 29 30       )0
                bne LC9D0                    ; C9B5= D0 19       P.
                tax                          ; C9B7= AA          *
                lda $0360                    ; C9B8= AD 60 03    -`.
                sta $FA                      ; C9BB= 85 FA       .z
                ldy #$07                     ; C9BD= A0 07        .
                sec                          ; C9BF= 38          8
LC9C0:
                lda $080C,x                  ; C9C0= BD 0C 08    =..
                eor $FB                      ; C9C3= 45 FB       E{
                sta ($D6),y                  ; C9C5= 91 D6       .V
                tya                          ; C9C7= 98          .
                adc #$07                     ; C9C8= 69 07       i.
                tay                          ; C9CA= A8          (
                inx                          ; C9CB= E8          h
                lsr $FA                      ; C9CC= 46 FA       Fz
                bne LC9C0                    ; C9CE= D0 F0       Pp
LC9D0:
                rts                          ; C9D0= 60          `

LC9D1:
                ldx $0350                    ; C9D1= AE 50 03    .P.
                lda $0351                    ; C9D4= AD 51 03    -Q.
                jsr LCC4F                    ; C9D7= 20 4F CC     OL
                bcs LC9F0                    ; C9DA= B0 14       0.
                adc $0354                    ; C9DC= 6D 54 03    mT.
                bcc LC9F0                    ; C9DF= 90 0F       ..
LC9E1:
                ldx $0350                    ; C9E1= AE 50 03    .P.
                lda $0351                    ; C9E4= AD 51 03    -Q.
                jsr LCAC9                    ; C9E7= 20 C9 CA     IJ
                bpl LC9F0                    ; C9EA= 10 04       ..
                sec                          ; C9EC= 38          8
                sbc $0354                    ; C9ED= ED 54 03    mT.
LC9F0:
                sta $0351                    ; C9F0= 8D 51 03    .Q.
                stx $0350                    ; C9F3= 8E 50 03    .P.
                pha                          ; C9F6= 48          H
                lsr a                        ; C9F7= 4A          J
                sta LFE03                    ; C9F8= 8D 03 FE    ..~
                txa                          ; C9FB= 8A          .
                ror a                        ; C9FC= 6A          j
                sta LFE02                    ; C9FD= 8D 02 FE    ..~
                pla                          ; CA00= 68          h
                rts                          ; CA01= 60          `

LCA02:
                lda #$00                     ; CA02= A9 00       ).
                ldx #$2C                     ; CA04= A2 2C       ",
LCA06:
                sta $0300,x                  ; CA06= 9D 00 03    ...
                dex                          ; CA09= CA          J
                bpl LCA06                    ; CA0A= 10 FA       .z
                ldx $0355                    ; CA0C= AE 55 03    .U.
                ldy LC3B4,x                  ; CA0F= BC B4 C3    <4C
                sty $030A                    ; CA12= 8C 0A 03    ...
                jsr LCA87                    ; CA15= 20 87 CA     .J
                ldy LC3AD,x                  ; CA18= BC AD C3    <-C
                sty $0309                    ; CA1B= 8C 09 03    ...
                ldy #$03                     ; CA1E= A0 03        .
                sty $0323                    ; CA20= 8C 23 03    .#.
                iny                          ; CA23= C8          H
                sty $0321                    ; CA24= 8C 21 03    .!.
                dec $0322                    ; CA27= CE 22 03    N".
                dec $0320                    ; CA2A= CE 20 03    N .
                jsr LCE42                    ; CA2D= 20 42 CE     BN
                jsr LCA38                    ; CA30= 20 38 CA     8J
                lda #$F7                     ; CA33= A9 F7       )w
                jmp LC530                    ; CA35= 4C 30 C5    L0E

LCA38:
                jsr LCA80                    ; CA38= 20 80 CA     .J
                ldx #$1C                     ; CA3B= A2 1C       ".
                ldy #$2C                     ; CA3D= A0 2C        ,
                jsr LD328                    ; CA3F= 20 28 D3     (S
                ora $032D                    ; CA42= 0D 2D 03    .-.
                bmi LCA80                    ; CA45= 30 39       09
                ldx #$20                     ; CA47= A2 20       "
                jsr LD05A                    ; CA49= 20 5A D0     ZP
                ldx #$1C                     ; CA4C= A2 1C       ".
                jsr LD05A                    ; CA4E= 20 5A D0     ZP
                lda $031F                    ; CA51= AD 1F 03    -..
                ora $031D                    ; CA54= 0D 1D 03    ...
                bmi LCA80                    ; CA57= 30 27       0'
                lda $0323                    ; CA59= AD 23 03    -#.
                bne LCA80                    ; CA5C= D0 22       P"
                ldx $0355                    ; CA5E= AE 55 03    .U.
                lda $0321                    ; CA61= AD 21 03    -!.
                sta $D8                      ; CA64= 85 D8       .X
                lda $0320                    ; CA66= AD 20 03    - .
                lsr $D8                      ; CA69= 46 D8       FX
                ror a                        ; CA6B= 6A          j
                lsr $D8                      ; CA6C= 46 D8       FX
                bne LCA80                    ; CA6E= D0 10       P.
                ror a                        ; CA70= 6A          j
                lsr a                        ; CA71= 4A          J
                cmp LC3B4,x                  ; CA72= DD B4 C3    ]4C
                beq LCA79                    ; CA75= F0 02       p.
                bpl LCA80                    ; CA77= 10 07       ..
LCA79:
                ldy #$00                     ; CA79= A0 00        .
                ldx #$1C                     ; CA7B= A2 1C       ".
                jsr LD393                    ; CA7D= 20 93 D3     .S
LCA80:
                ldx #$10                     ; CA80= A2 10       ".
                ldy #$28                     ; CA82= A0 28        (
                jmp LCD22                    ; CA84= 4C 22 CD    L"M

LCA87:
                iny                          ; CA87= C8          H
                tya                          ; CA88= 98          .
                ldy #$00                     ; CA89= A0 00        .
                sty $034D                    ; CA8B= 8C 4D 03    .M.
                sta $034C                    ; CA8E= 8D 4C 03    .L.
                lda $034F                    ; CA91= AD 4F 03    -O.
                lsr a                        ; CA94= 4A          J
                beq LCAA0                    ; CA95= F0 09       p.
LCA97:
                asl $034C                    ; CA97= 0E 4C 03    .L.
                rol $034D                    ; CA9A= 2E 4D 03    .M.
                lsr a                        ; CA9D= 4A          J
                bcc LCA97                    ; CA9E= 90 F7       .w
LCAA0:
                rts                          ; CAA0= 60          `

LCAA1:
                ldx #$20                     ; CAA1= A2 20       "
                ldy #$0C                     ; CAA3= A0 0C        .
                jsr LD3A1                    ; CAA5= 20 A1 D3     !S
                jmp LD0C9                    ; CAA8= 4C C9 D0    LIP

LCAAB:
                jsr LC53E                    ; CAAB= 20 3E C5     >E
                jsr LC505                    ; CAAE= 20 05 C5     .E
                bne LCABC                    ; CAB1= D0 09       P.
                sta $DC                      ; CAB3= 85 DC       .\
                lda #$C0                     ; CAB5= A9 C0       )@
                sta $DD                      ; CAB7= 85 DD       .]
                jmp LCEE2                    ; CAB9= 4C E2 CE    LbN

LCABC:
                lda #$7F                     ; CABC= A9 7F       ).
                jsr LCF4F                    ; CABE= 20 4F CF     OO
                ldx $035A                    ; CAC1= AE 5A 03    .Z.
                ldy #$00                     ; CAC4= A0 00        .
                jmp LCE94                    ; CAC6= 4C 94 CE    L.N

LCAC9:
                pha                          ; CAC9= 48          H
                txa                          ; CACA= 8A          .
                clc                          ; CACB= 18          .
                adc $0352                    ; CACC= 6D 52 03    mR.
                tax                          ; CACF= AA          *
                pla                          ; CAD0= 68          h
                adc $0353                    ; CAD1= 6D 53 03    mS.
                rts                          ; CAD4= 60          `

LCAD5:
                jsr LCB09                    ; CAD5= 20 09 CB     .K
LCAD8:
                jsr LE7D1                    ; CAD8= 20 D1 E7     Qg
                bcc LCADF                    ; CADB= 90 02       ..
                bmi LCAD5                    ; CADD= 30 F6       0v
LCADF:
                lda $D0                      ; CADF= A5 D0       %P
                eor #$04                     ; CAE1= 49 04       I.
                and #$46                     ; CAE3= 29 46       )F
                bne LCB11                    ; CAE5= D0 2A       P*
                lda $0269                    ; CAE7= AD 69 02    -i.
                bmi LCB0E                    ; CAEA= 30 22       0"
                lda $0319                    ; CAEC= AD 19 03    -..
                cmp $0309                    ; CAEF= CD 09 03    M..
                bcc LCB0E                    ; CAF2= 90 1A       ..
                lsr a                        ; CAF4= 4A          J
                lsr a                        ; CAF5= 4A          J
                sec                          ; CAF6= 38          8
                adc $0269                    ; CAF7= 6D 69 02    mi.
                adc $030B                    ; CAFA= 6D 0B 03    m..
                cmp $0309                    ; CAFD= CD 09 03    M..
                bcc LCB0E                    ; CB00= 90 0C       ..
                clc                          ; CB02= 18          .
LCB03:
                jsr LE7D1                    ; CB03= 20 D1 E7     Qg
                sec                          ; CB06= 38          8
                bpl LCB03                    ; CB07= 10 FA       .z
LCB09:
                lda #$FF                     ; CB09= A9 FF       ).
                sta $0269                    ; CB0B= 8D 69 02    .i.
LCB0E:
                inc $0269                    ; CB0E= EE 69 02    ni.
LCB11:
                rts                          ; CB11= 60          `

LCB12:
                pha                          ; CB12= 48          H
                ldx #$7F                     ; CB13= A2 7F       ".
                lda #$00                     ; CB15= A9 00       ).
                sta $D0                      ; CB17= 85 D0       .P
LCB19:
                sta $02FF,x                  ; CB19= 9D FF 02    ...
                dex                          ; CB1C= CA          J
                bne LCB19                    ; CB1D= D0 FA       Pz
                ldx #$04                     ; CB1F= A2 04       ".
LCB21:
                sta $080B,x                  ; CB21= 9D 0B 08    ...
                dex                          ; CB24= CA          J
                bne LCB21                    ; CB25= D0 FA       Pz
                jsr LCC5E                    ; CB27= 20 5E CC     ^L
                pla                          ; CB2A= 68          h
                ldx #$7F                     ; CB2B= A2 7F       ".
                stx $0366                    ; CB2D= 8E 66 03    .f.
LCB30:
                .if version==300
                jsr LDAC7_300
                php
                sei
                sta $0355
                lda $0282
                and #$C7
                ora $0355
                jsr LE3C1_300
                stx $0355
                .else
                jsr LDADA                    ; CB30= 20 DA DA     ZZ
                stx $0355                    ; CB33= 8E 55 03    .U.
                php                          ; CB36= 08          .
                sei                          ; CB37= 78          x
                sta $02F4                    ; CB38= 8D F4 02    .t.
                lda $0282                    ; CB3B= AD 82 02    -..
                and #$C7                     ; CB3E= 29 C7       )G
                ora $02F4                    ; CB40= 0D F4 02    .t.
                sta $0282                    ; CB43= 8D 82 02    ...
                sta LFE07                    ; CB46= 8D 07 FE    ..~
                .endif
                plp                          ; CB49= 28          (
                lda LC3CF,x                  ; CB4A= BD CF C3    =OC
                sta $0360                    ; CB4D= 8D 60 03    .`.
                lda LC3BB,x                  ; CB50= BD BB C3    =;C
                sta $034F                    ; CB53= 8D 4F 03    .O.
                lda LC3F5,x                  ; CB56= BD F5 C3    =uC
                sta $0361                    ; CB59= 8D 61 03    .a.
                bne LCB60                    ; CB5C= D0 02       P.
                lda #$07                     ; CB5E= A9 07       ).
LCB60:
                asl a                        ; CB60= 0A          .
                tay                          ; CB61= A8          (
                lda LC3C1,y                  ; CB62= B9 C1 C3    9AC
                sta $0363                    ; CB65= 8D 63 03    .c.
LCB68:
                asl a                        ; CB68= 0A          .
                bpl LCB68                    ; CB69= 10 FD       .}
                sta $0362                    ; CB6B= 8D 62 03    .b.
                ldy LC3FB,x                  ; CB6E= BC FB C3    <{C
                sty $0356                    ; CB71= 8C 56 03    .V.
                lda LC407,y                  ; CB74= B9 07 C4    9.D
                sta $0354                    ; CB77= 8D 54 03    .T.
                lda LC40B,y                  ; CB7A= B9 0B C4    9.D
                sta $034E                    ; CB7D= 8D 4E 03    .N.
                tya                          ; CB80= 98          .
                lsr a                        ; CB81= 4A          J
                eor #$01                     ; CB82= 49 01       I.
                tax                          ; CB84= AA          *
                lda LC40F,x                  ; CB85= BD 0F C4    =.D
                sta $0352                    ; CB88= 8D 52 03    .R.
                inx                          ; CB8B= E8          h
                stx $0353                    ; CB8C= 8E 53 03    .S.
                lda #$43                     ; CB8F= A9 43       )C
                jsr LC530                    ; CB91= 20 30 C5     0E
                jsr LC7F6                    ; CB94= 20 F6 C7     vG
                jsr LCA02                    ; CB97= 20 02 CA     .J
                jsr LC976                    ; CB9A= 20 76 C9     vI
LCB9D:
                ldx #$00                     ; CB9D= A2 00       ".
                lda $034E                    ; CB9F= AD 4E 03    -N.
                jsr LC9F0                    ; CBA2= 20 F0 C9     pI
                jsr LC561                    ; CBA5= 20 61 C5     aE
                jsr LCC03                    ; CBA8= 20 03 CC     .L
                lda #$00                     ; CBAB= A9 00       ).
                sta $0269                    ; CBAD= 8D 69 02    .i.
                sta $0318                    ; CBB0= 8D 18 03    ...
                sta $0319                    ; CBB3= 8D 19 03    ...
                ldx #$06                     ; CBB6= A2 06       ".
                ldy $034E                    ; CBB8= AC 4E 03    ,N.
LCBBB:
                sty $D9,x                    ; CBBB= 94 D9       .Y
                sta $D8,x                    ; CBBD= 95 D8       .X
                iny                          ; CBBF= C8          H
                dex                          ; CBC0= CA          J
                dex                          ; CBC1= CA          J
                bpl LCBBB                    ; CBC2= 10 F7       .w
                tay                          ; CBC4= A8          (
LCBC5:
                lda $0358                    ; CBC5= AD 58 03    -X.
LCBC8:
                sta ($D8),y                  ; CBC8= 91 D8       .X
                sta ($DA),y                  ; CBCA= 91 DA       .Z
                sta ($DC),y                  ; CBCC= 91 DC       .\
                sta ($DE),y                  ; CBCE= 91 DE       .^
                dey                          ; CBD0= 88          .
                bne LCBC8                    ; CBD1= D0 F5       Pu
                ldx #$06                     ; CBD3= A2 06       ".
                clc                          ; CBD5= 18          .
LCBD6:
                lda $D9,x                    ; CBD6= B5 D9       5Y
                adc #$04                     ; CBD8= 69 04       i.
                sta $D9,x                    ; CBDA= 95 D9       .Y
                bmi LCBE4                    ; CBDC= 30 06       0.
                dex                          ; CBDE= CA          J
                dex                          ; CBDF= CA          J
                bpl LCBD6                    ; CBE0= 10 F4       .t
                bmi LCBC5                    ; CBE2= 30 E1       0a
LCBE4:
                lda #$DF                     ; CBE4= A9 DF       )_
                bne LCBEA                    ; CBE6= D0 02       P.

; OSBYTE &73,0 - restore pallette
; -------------------------------
LCBE8:
                lda #$EF                     ; CBE8= A9 EF       )o
LCBEA:
                php                          ; CBEA= 08          .
                sei                          ; CBEB= 78          x
                and $034B                    ; CBEC= 2D 4B 03    -K.
                sta $034B                    ; CBEF= 8D 4B 03    .K.
                and #$30                     ; CBF2= 29 30       )0
                bne LCC01                    ; CBF4= D0 0B       P.
                ldy #$07                     ; CBF6= A0 07        .
LCBF8:
                lda $0804,y                  ; CBF8= B9 04 08    9..
                sta LFE08,y                  ; CBFB= 99 08 FE    ..~
                dey                          ; CBFE= 88          .
                bpl LCBF8                    ; CBFF= 10 F7       .w
LCC01:
                plp                          ; CC01= 28          (
                rts                          ; CC02= 60          `

LCC03:
                lda #$20                     ; CC03= A9 20       )
                bne LCC12                    ; CC05= D0 0B       P.

; OSBYTE &73 - Reset/blank palette
; --------------------------------
LCC07:
                beq LCBE8                    ; X=0 - Restore palette
                lda $0355                    ; Get current MODE
                and #$04                     ; MODE 4-7 - exit
                bne LCC3F
                lda #$10                     ;
LCC12:
                php                          ;
                sei                          ;
                ora $034B                    ;
                sta $034B                    ;
                plp                          ;
                and #$0F                     ;
                tax                          ;
                lda $036F,x                  ; Get palette entry X
                cmp #$08                     ; CC21= C9 08       I.
                bcc LCC28                    ; CC23= 90 03       ..
                eor $0248                    ; CC25= 4D 48 02    MH.
LCC28:
                pha                          ; CC28= 48          H
                ldy #$07                     ; CC29= A0 07        .
                jsr LCC32                    ; CC2B= 20 32 CC     2L
                pla                          ; CC2E= 68          h
                lsr a                        ; CC2F= 4A          J
                ldy #$06                     ; CC30= A0 06        .
LCC32:
                and #$03                     ; CC32= 29 03       ).
                tax                          ; CC34= AA          *
                lda LC423,x                  ; CC35= BD 23 C4    =#D
LCC38:
                sta LFE08,y                  ; CC38= 99 08 FE    ..~
                dey                          ; CC3B= 88          .
                dey                          ; CC3C= 88          .
                bpl LCC38                    ; CC3D= 10 F9       .y
LCC3F:
                rts                          ; CC3F= 60          `

LCC40:
                jsr LCF4F                    ; CC40= 20 4F CF     OO
                ldy #$00                     ; CC43= A0 00        .
LCC45:
                .if version==300
                jsr LE759_300
                .else
                lda ($DC),y                  ; CC45= B1 DC       1\
                .endif
                iny                          ; CC47= C8          H
                sta ($F0),y                  ; CC48= 91 F0       .p
                cpy #$08                     ; CC4A= C0 08       @.
                bne LCC45                    ; CC4C= D0 F7       Pw
                rts                          ; CC4E= 60          `

LCC4F:
                pha                          ; CC4F= 48          H
                txa                          ; CC50= 8A          .
                sec                          ; CC51= 38          8
                sbc $0352                    ; CC52= ED 52 03    mR.
                tax                          ; CC55= AA          *
                pla                          ; CC56= 68          h
                sbc $0353                    ; CC57= ED 53 03    mS.
                cmp $034E                    ; CC5A= CD 4E 03    MN.
LCC5D:
                rts                          ; CC5D= 60          `

LCC5E:
                lda #$0F                     ; CC5E= A9 0F       ).
                sta $0367                    ; CC60= 8D 67 03    .g.
                lda #$0C                     ; CC63= A9 0C       ).
                ldy #$06                     ; CC65= A0 06        .
LCC67:
                sta $0368,y                  ; CC67= 99 68 03    .h.
                dey                          ; CC6A= 88          .
                bpl LCC67                    ; CC6B= 10 FA       .z
                cpx #$07                     ; CC6D= E0 07       `.
                bcc LCC73                    ; CC6F= 90 02       ..
                ldx #$06                     ; CC71= A2 06       ".
LCC73:
                stx $0246                    ; CC73= 8E 46 02    .F.
                lda $0243                    ; CC76= AD 43 02    -C.
                ldx #$00                     ; CC79= A2 00       ".
LCC7B:
                cpx $0246                    ; CC7B= EC 46 02    lF.
                bcs LCC8B                    ; CC7E= B0 0B       0.
                ldy LC41D,x                  ; CC80= BC 1D C4    <.D
                sta $0368,y                  ; CC83= 99 68 03    .h.
                adc #$01                     ; CC86= 69 01       i.
                inx                          ; CC88= E8          h
                bne LCC7B                    ; CC89= D0 F0       Pp
LCC8B:
                sta $0244                    ; CC8B= 8D 44 02    .D.
                tay                          ; CC8E= A8          (
                beq LCC5D                    ; CC8F= F0 CC       pL
                ldx #$11                     ; CC91= A2 11       ".
                jmp LF0A8                    ; CC93= 4C A8 F0    L(p

LCC96:
                lda #$02                     ; CC96= A9 02       ).
                bit $D0                      ; CC98= 24 D0       $P
                bne LCC9E                    ; CC9A= D0 02       P.
                bvc LCCDC                    ; CC9C= 50 3E       P>
LCC9E:
                lda $0309                    ; CC9E= AD 09 03    -..
                bcc LCCA6                    ; CCA1= 90 03       ..
                lda $030B                    ; CCA3= AD 0B 03    -..
LCCA6:
                bvs LCCB0                    ; CCA6= 70 08       p.
                sta $0319                    ; CCA8= 8D 19 03    ...
                pla                          ; CCAB= 68          h
                pla                          ; CCAC= 68          h
                jmp LC62B                    ; CCAD= 4C 2B C6    L+F

LCCB0:
                php                          ; CCB0= 08          .
                cmp $0365                    ; CCB1= CD 65 03    Me.
                beq LCCDB                    ; CCB4= F0 25       p%
                plp                          ; CCB6= 28          (
                bcc LCCBD                    ; CCB7= 90 04       ..
                dec $0365                    ; CCB9= CE 65 03    Ne.
                rts                          ; CCBC= 60          `

LCCBD:
                inc $0365                    ; CCBD= EE 65 03    ne.
                rts                          ; CCC0= 60          `

LCCC1:
                php                          ; CCC1= 08          .
                pha                          ; CCC2= 48          H
                ldy $034F                    ; CCC3= AC 4F 03    ,O.
                dey                          ; CCC6= 88          .
                lda #$FF                     ; CCC7= A9 FF       ).
                cpy #$1F                     ; CCC9= C0 1F       @.
                bne LCCCF                    ; CCCB= D0 02       P.
                lda #$3F                     ; CCCD= A9 3F       )?
LCCCF:
                sta $D8                      ; CCCF= 85 D8       .X
LCCD1:
                lda ($D6),y                  ; CCD1= B1 D6       1V
                eor $D8                      ; CCD3= 45 D8       EX
                sta ($D6),y                  ; CCD5= 91 D6       .V
                dey                          ; CCD7= 88          .
                bpl LCCD1                    ; CCD8= 10 F7       .w
                pla                          ; CCDA= 68          h
LCCDB:
                plp                          ; CCDB= 28          (
LCCDC:
                rts                          ; CCDC= 60          `

LCCDD:
                jsr LCD97                    ; CCDD= 20 97 CD     .M
                lda $0309                    ; CCE0= AD 09 03    -..
                sta $0319                    ; CCE3= 8D 19 03    ...
                jsr LCE42                    ; CCE6= 20 42 CE     BN
LCCE9:
                jsr LCC4F                    ; CCE9= 20 4F CC     OL
                bcs LCCF1                    ; CCEC= B0 03       0.
                adc $0354                    ; CCEE= 6D 54 03    mT.
LCCF1:
                sta $D9                      ; CCF1= 85 D9       .Y
                stx $D8                      ; CCF3= 86 D8       .X
                sta $DA                      ; CCF5= 85 DA       .Z
                bcs LCCFF                    ; CCF7= B0 06       0.
LCCF9:
                jsr LCDAF                    ; CCF9= 20 AF CD     /M
                jmp LCD0A                    ; CCFC= 4C 0A CD    L.M

LCCFF:
                jsr LCAC9                    ; CCFF= 20 C9 CA     IJ
                jsr LCAC9                    ; CD02= 20 C9 CA     IJ
                bmi LCCF9                    ; CD05= 30 F2       0r
                jsr LCD74                    ; CD07= 20 74 CD     tM
LCD0A:
                lda $DA                      ; CD0A= A5 DA       %Z
                ldx $D8                      ; CD0C= A6 D8       &X
                sta $D7                      ; CD0E= 85 D7       .W
                stx $D6                      ; CD10= 86 D6       .V
                dec $DC                      ; CD12= C6 DC       F\
                bne LCCE9                    ; CD14= D0 D3       PS
LCD16:
                ldx #$28                     ; CD16= A2 28       "(
                ldy #$18                     ; CD18= A0 18        .
LCD1A:
                lda #$02                     ; CD1A= A9 02       ).
                bne LCD24                    ; CD1C= D0 06       P.
LCD1E:
                ldx #$24                     ; CD1E= A2 24       "$
LCD20:
                ldy #$14                     ; CD20= A0 14        .
LCD22:
                lda #$04                     ; CD22= A9 04       ).
LCD24:
                sta $D8                      ; CD24= 85 D8       .X
LCD26:
                lda $0300,x                  ; CD26= BD 00 03    =..
                pha                          ; CD29= 48          H
                lda $0300,y                  ; CD2A= B9 00 03    9..
                sta $0300,x                  ; CD2D= 9D 00 03    ...
                pla                          ; CD30= 68          h
                sta $0300,y                  ; CD31= 99 00 03    ...
                inx                          ; CD34= E8          h
                iny                          ; CD35= C8          H
                dec $D8                      ; CD36= C6 D8       FX
                bne LCD26                    ; CD38= D0 EC       Pl
                rts                          ; CD3A= 60          `

LCD3B:
                jsr LCD97                    ; CD3B= 20 97 CD     .M
                ldy $030B                    ; CD3E= AC 0B 03    ,..
                sty $0319                    ; CD41= 8C 19 03    ...
                jsr LCE42                    ; CD44= 20 42 CE     BN
LCD47:
                jsr LCAC9                    ; CD47= 20 C9 CA     IJ
                bpl LCD50                    ; CD4A= 10 04       ..
                sec                          ; CD4C= 38          8
                sbc $0354                    ; CD4D= ED 54 03    mT.
LCD50:
                sta $D9                      ; CD50= 85 D9       .Y
                stx $D8                      ; CD52= 86 D8       .X
                sta $DA                      ; CD54= 85 DA       .Z
                bcc LCD5E                    ; CD56= 90 06       ..
LCD58:
                jsr LCDAF                    ; CD58= 20 AF CD     /M
                jmp LCD66                    ; CD5B= 4C 66 CD    LfM

LCD5E:
                jsr LCAC9                    ; CD5E= 20 C9 CA     IJ
                bmi LCD58                    ; CD61= 30 F5       0u
                jsr LCD74                    ; CD63= 20 74 CD     tM
LCD66:
                lda $DA                      ; CD66= A5 DA       %Z
                ldx $D8                      ; CD68= A6 D8       &X
                sta $D7                      ; CD6A= 85 D7       .W
                stx $D6                      ; CD6C= 86 D6       .V
                dec $DC                      ; CD6E= C6 DC       F\
                bne LCD47                    ; CD70= D0 D5       PU
                beq LCD16                    ; CD72= F0 A2       p"
LCD74:
                ldx $034D                    ; CD74= AE 4D 03    .M.
                beq LCD89                    ; CD77= F0 10       p.
                ldy #$00                     ; CD79= A0 00        .
LCD7B:
                lda ($D8),y                  ; CD7B= B1 D8       1X
                sta ($D6),y                  ; CD7D= 91 D6       .V
                iny                          ; CD7F= C8          H
                bne LCD7B                    ; CD80= D0 F9       Py
                inc $D7                      ; CD82= E6 D7       fW
                inc $D9                      ; CD84= E6 D9       fY
                dex                          ; CD86= CA          J
                bne LCD7B                    ; CD87= D0 F2       Pr
LCD89:
                ldy $034C                    ; CD89= AC 4C 03    ,L.
                beq LCD96                    ; CD8C= F0 08       p.
LCD8E:
                dey                          ; CD8E= 88          .
                lda ($D8),y                  ; CD8F= B1 D8       1X
                sta ($D6),y                  ; CD91= 91 D6       .V
                tya                          ; CD93= 98          .
                bne LCD8E                    ; CD94= D0 F8       Px
LCD96:
                rts                          ; CD96= 60          `

LCD97:
                jsr LCD16                    ; CD97= 20 16 CD     .M
                sec                          ; CD9A= 38          8
                lda $0309                    ; CD9B= AD 09 03    -..
                sbc $030B                    ; CD9E= ED 0B 03    m..
                sta $DC                      ; CDA1= 85 DC       .\
                bne LCDAA                    ; CDA3= D0 05       P.
                pla                          ; CDA5= 68          h
                pla                          ; CDA6= 68          h
                jmp LCD16                    ; CDA7= 4C 16 CD    L.M

LCDAA:
                lda $0308                    ; CDAA= AD 08 03    -..
                bpl LCE1F                    ; CDAD= 10 70       .p
LCDAF:
                lda $D8                      ; CDAF= A5 D8       %X
                pha                          ; CDB1= 48          H
                sec                          ; CDB2= 38          8
                lda $030A                    ; CDB3= AD 0A 03    -..
                sbc $0308                    ; CDB6= ED 08 03    m..
                sta $DD                      ; CDB9= 85 DD       .]
LCDBB:
                ldy $034F                    ; CDBB= AC 4F 03    ,O.
                dey                          ; CDBE= 88          .
LCDBF:
                lda ($D8),y                  ; CDBF= B1 D8       1X
                sta ($D6),y                  ; CDC1= 91 D6       .V
                dey                          ; CDC3= 88          .
                bpl LCDBF                    ; CDC4= 10 F9       .y
                ldx #$02                     ; CDC6= A2 02       ".
LCDC8:
                clc                          ; CDC8= 18          .
                lda $D6,x                    ; CDC9= B5 D6       5V
                adc $034F                    ; CDCB= 6D 4F 03    mO.
                sta $D6,x                    ; CDCE= 95 D6       .V
                lda $D7,x                    ; CDD0= B5 D7       5W
                adc #$00                     ; CDD2= 69 00       i.
                bpl LCDDA                    ; CDD4= 10 04       ..
                sec                          ; CDD6= 38          8
                sbc $0354                    ; CDD7= ED 54 03    mT.
LCDDA:
                sta $D7,x                    ; CDDA= 95 D7       .W
                dex                          ; CDDC= CA          J
                dex                          ; CDDD= CA          J
                beq LCDC8                    ; CDDE= F0 E8       ph
                dec $DD                      ; CDE0= C6 DD       F]
                bpl LCDBB                    ; CDE2= 10 D7       .W
                pla                          ; CDE4= 68          h
                sta $D8                      ; CDE5= 85 D8       .X
                rts                          ; CDE7= 60          `

LCDE8:
                lda $0318                    ; CDE8= AD 18 03    -..
                pha                          ; CDEB= 48          H
                jsr LCDAA                    ; CDEC= 20 AA CD     *M
                jsr LCE42                    ; CDEF= 20 42 CE     BN
                sec                          ; CDF2= 38          8
                lda $030A                    ; CDF3= AD 0A 03    -..
                sbc $0308                    ; CDF6= ED 08 03    m..
                sta $DA                      ; CDF9= 85 DA       .Z
LCDFB:
                lda $0358                    ; CDFB= AD 58 03    -X.
                ldy $034F                    ; CDFE= AC 4F 03    ,O.
LCE01:
                dey                          ; CE01= 88          .
                sta ($D6),y                  ; CE02= 91 D6       .V
                bne LCE01                    ; CE04= D0 FB       P{
                txa                          ; CE06= 8A          .
                clc                          ; CE07= 18          .
                adc $034F                    ; CE08= 6D 4F 03    mO.
                tax                          ; CE0B= AA          *
                lda $D7                      ; CE0C= A5 D7       %W
                adc #$00                     ; CE0E= 69 00       i.
                bpl LCE16                    ; CE10= 10 04       ..
                sec                          ; CE12= 38          8
                sbc $0354                    ; CE13= ED 54 03    mT.
LCE16:
                stx $D6                      ; CE16= 86 D6       .V
                sta $D7                      ; CE18= 85 D7       .W
LCE1A:
                dec $DA                      ; CE1A= C6 DA       FZ
                bpl LCDFB                    ; CE1C= 10 DD       .]
                pla                          ; CE1E= 68          h
LCE1F:
                sta $0318                    ; CE1F= 8D 18 03    ...
LCE22:
                sec                          ; CE22= 38          8
                rts                          ; CE23= 60          `

LCE24:
                ldx $0318                    ; CE24= AE 18 03    ...
                cpx $0308                    ; CE27= EC 08 03    l..
                bmi LCE22                    ; CE2A= 30 F6       0v
                cpx $030A                    ; CE2C= EC 0A 03    l..
                beq LCE33                    ; CE2F= F0 02       p.
                bpl LCE22                    ; CE31= 10 EF       .o
LCE33:
                ldx $0319                    ; CE33= AE 19 03    ...
                cpx $030B                    ; CE36= EC 0B 03    l..
                bmi LCE22                    ; CE39= 30 E7       0g
                cpx $0309                    ; CE3B= EC 09 03    l..
                beq LCE42                    ; CE3E= F0 02       p.
                bpl LCE22                    ; CE40= 10 E0       .`
LCE42:
                lda $0319                    ; CE42= AD 19 03    -..
                asl a                        ; CE45= 0A          .
                tay                          ; CE46= A8          (
                lda LC36D,y                  ; CE47= B9 6D C3    9mC
                sta $D7                      ; CE4A= 85 D7       .W
                lda LC36E,y                  ; CE4C= B9 6E C3    9nC
                ldy $0353                    ; CE4F= AC 53 03    ,S.
                dey                          ; CE52= 88          .
                bne LCE58                    ; CE53= D0 03       P.
                lsr $D7                      ; CE55= 46 D7       FW
                ror a                        ; CE57= 6A          j
LCE58:
                adc $0350                    ; CE58= 6D 50 03    mP.
                sta $D6                      ; CE5B= 85 D6       .V
                lda $D7                      ; CE5D= A5 D7       %W
                adc $0351                    ; CE5F= 6D 51 03    mQ.
                tay                          ; CE62= A8          (
                lda $0318                    ; CE63= AD 18 03    -..
                ldx $034F                    ; CE66= AE 4F 03    .O.
                cpx #$10                     ; CE69= E0 10       `.
                beq LCE70                    ; CE6B= F0 03       p.
                bcc LCE71                    ; CE6D= 90 02       ..
                asl a                        ; CE6F= 0A          .
LCE70:
                asl a                        ; CE70= 0A          .
LCE71:
                asl a                        ; CE71= 0A          .
                asl a                        ; CE72= 0A          .
                bcc LCE77                    ; CE73= 90 02       ..
                iny                          ; CE75= C8          H
                iny                          ; CE76= C8          H
LCE77:
                asl a                        ; CE77= 0A          .
                bcc LCE7C                    ; CE78= 90 02       ..
                iny                          ; CE7A= C8          H
                clc                          ; CE7B= 18          .
LCE7C:
                adc $D6                      ; CE7C= 65 D6       eV
                sta $D6                      ; CE7E= 85 D6       .V
                tax                          ; CE80= AA          *
                tya                          ; CE81= 98          .
                adc #$00                     ; CE82= 69 00       i.
                bpl LCE8A                    ; CE84= 10 04       ..
                sec                          ; CE86= 38          8
                sbc $0354                    ; CE87= ED 54 03    mT.
LCE8A:
                sta $D7                      ; CE8A= 85 D7       .W
                clc                          ; CE8C= 18          .
                rts                          ; CE8D= 60          `

LCE8E:
                ldx $0359                    ; CE8E= AE 59 03    .Y.
                ldy $035B                    ; CE91= AC 5B 03    ,[.
LCE94:
                jsr LCFC4                    ; CE94= 20 C4 CF     DO
                jsr LD39D                    ; CE97= 20 9D D3     .S
                ldy #$00                     ; CE9A= A0 00        .
LCE9C:
                sty $DA                      ; CE9C= 84 DA       .Z
                lda ($DC),y                  ; CE9E= B1 DC       1\
                beq LCEB5                    ; CEA0= F0 13       p.
                sta $DB                      ; CEA2= 85 DB       .[
LCEA4:
                bpl LCEA9                    ; CEA4= 10 03       ..
                jsr LCFF4                    ; CEA6= 20 F4 CF     tO
LCEA9:
                inc $0324                    ; CEA9= EE 24 03    n$.
                bne LCEB1                    ; CEAC= D0 03       P.
                inc $0325                    ; CEAE= EE 25 03    n%.
LCEB1:
                asl $DB                      ; CEB1= 06 DB       .[
                bne LCEA4                    ; CEB3= D0 EF       Po
LCEB5:
                ldx #$28                     ; CEB5= A2 28       "(
                ldy #$24                     ; CEB7= A0 24        $
                jsr LD399                    ; CEB9= 20 99 D3     .S
                ldy $0326                    ; CEBC= AC 26 03    ,&.
                bne LCEC4                    ; CEBF= D0 03       P.
                dec $0327                    ; CEC1= CE 27 03    N'.
LCEC4:
                dec $0326                    ; CEC4= CE 26 03    N&.
                ldy $DA                      ; CEC7= A4 DA       $Z
                iny                          ; CEC9= C8          H
                cpy #$08                     ; CECA= C0 08       @.
                bne LCE9C                    ; CECC= D0 CE       PN
                ldx #$28                     ; CECE= A2 28       "(
                ldy #$24                     ; CED0= A0 24        $
                jmp LD3A1                    ; CED2= 4C A1 D3    L!S

; Copy Electron 'acorn' to soft cursor store
; ------------------------------------------
LCED5:
                ldx #<LC42B                  ; &DC/D=>'acorn' bitmap
                stx $DC
                ldx #>LC42B
                stx $DD
                bne LCEE2

LCEDF:
                jsr LCF4F                    ; CEDF= 20 4F CF     OO
LCEE2:
                ldx $0360                    ; CEE2= AE 60 03    .`.
                lda $D0                      ; CEE5= A5 D0       %P
                and #$20                     ; CEE7= 29 20       )
                bne LCE8E                    ; CEE9= D0 A3       P#
                ldy #$07                     ; CEEB= A0 07        .
                cpx #$03                     ; CEED= E0 03       `.
                beq LCEFF                    ; CEEF= F0 0E       p.
                bcs LCF2F                    ; CEF1= B0 3C       0<
LCEF3:
                lda ($DC),y                  ; CEF3= B1 DC       1\
                ora $D2                      ; CEF5= 05 D2       .R
                eor $D3                      ; CEF7= 45 D3       ES
                sta ($D6),y                  ; CEF9= 91 D6       .V
                dey                          ; CEFB= 88          .
                bpl LCEF3                    ; CEFC= 10 F5       .u
                rts                          ; CEFE= 60          `

LCEFF:
                lda ($DC),y                  ; CEFF= B1 DC       1\
                pha                          ; CF01= 48          H
                lsr a                        ; CF02= 4A          J
                lsr a                        ; CF03= 4A          J
                lsr a                        ; CF04= 4A          J
                lsr a                        ; CF05= 4A          J
                tax                          ; CF06= AA          *
                lda LC317,x                  ; CF07= BD 17 C3    =.C
                ora $D2                      ; CF0A= 05 D2       .R
                eor $D3                      ; CF0C= 45 D3       ES
                sta ($D6),y                  ; CF0E= 91 D6       .V
                tya                          ; CF10= 98          .
                clc                          ; CF11= 18          .
                adc #$08                     ; CF12= 69 08       i.
                tay                          ; CF14= A8          (
                pla                          ; CF15= 68          h
                and #$0F                     ; CF16= 29 0F       ).
                tax                          ; CF18= AA          *
                lda LC317,x                  ; CF19= BD 17 C3    =.C
                ora $D2                      ; CF1C= 05 D2       .R
                eor $D3                      ; CF1E= 45 D3       ES
                sta ($D6),y                  ; CF20= 91 D6       .V
                tya                          ; CF22= 98          .
                sbc #$08                     ; CF23= E9 08       i.
                tay                          ; CF25= A8          (
                bpl LCEFF                    ; CF26= 10 D7       .W
LCF28:
                rts                          ; CF28= 60          `

LCF29:
                tya                          ; CF29= 98          .
                sbc #$21                     ; CF2A= E9 21       i!
                bmi LCF28                    ; CF2C= 30 FA       0z
                tay                          ; CF2E= A8          (
LCF2F:
                lda ($DC),y                  ; CF2F= B1 DC       1\
                sta $DA                      ; CF31= 85 DA       .Z
                sec                          ; CF33= 38          8
LCF34:
                lda #$00                     ; CF34= A9 00       ).
                rol $DA                      ; CF36= 26 DA       &Z
                beq LCF29                    ; CF38= F0 EF       po
                rol a                        ; CF3A= 2A          *
                asl $DA                      ; CF3B= 06 DA       .Z
                rol a                        ; CF3D= 2A          *
                tax                          ; CF3E= AA          *
                lda LC327,x                  ; CF3F= BD 27 C3    ='C
                ora $D2                      ; CF42= 05 D2       .R
                eor $D3                      ; CF44= 45 D3       ES
                sta ($D6),y                  ; CF46= 91 D6       .V
                clc                          ; CF48= 18          .
                tya                          ; CF49= 98          .
                adc #$08                     ; CF4A= 69 08       i.
                tay                          ; CF4C= A8          (
                bcc LCF34                    ; CF4D= 90 E5       .e
LCF4F:
                asl a                        ; CF4F= 0A          .
                rol a                        ; CF50= 2A          *
                rol a                        ; CF51= 2A          *
                sta $DC                      ; CF52= 85 DC       .\
                and #$03                     ; CF54= 29 03       ).
                rol a                        ; CF56= 2A          *
                tax                          ; CF57= AA          *
                and #$03                     ; CF58= 29 03       ).
                adc #$BF                     ; CF5A= 69 BF       i?
                tay                          ; CF5C= A8          (
                lda LC3C8,x                  ; CF5D= BD C8 C3    =HC
                bit $0367                    ; CF60= 2C 67 03    ,g.
                beq LCF68                    ; CF63= F0 03       p.
                ldy $0367,x                  ; CF65= BC 67 03    <g.
LCF68:
                sty $DD                      ; CF68= 84 DD       .]
                lda $DC                      ; CF6A= A5 DC       %\
                and #$F8                     ; CF6C= 29 F8       )x
                sta $DC                      ; CF6E= 85 DC       .\
                rts                          ; CF70= 60          `

LCF71:
                ldx #$20                     ; CF71= A2 20       "
                jsr LD05E                    ; CF73= 20 5E D0     ^P
                lda $031F                    ; CF76= AD 1F 03    -..
                cmp #$04                     ; CF79= C9 04       I.
                beq LCFEA                    ; CF7B= F0 6D       pm
                ldy #$05                     ; CF7D= A0 05        .
                and #$03                     ; CF7F= 29 03       ).
                beq LCF91                    ; CF81= F0 0E       p.
                lsr a                        ; CF83= 4A          J
                bcs LCF89                    ; CF84= B0 03       0.
                dey                          ; CF86= 88          .
                bne LCF91                    ; CF87= D0 08       P.
LCF89:
                tax                          ; CF89= AA          *
                ldy $035B,x                  ; CF8A= BC 5B 03    <[.
                lda $0359,x                  ; CF8D= BD 59 03    =Y.
                tax                          ; CF90= AA          *
LCF91:
                jsr LCFC4                    ; CF91= 20 C4 CF     DO
                lda $031F                    ; CF94= AD 1F 03    -..
                bmi LCFBC                    ; CF97= 30 23       0#
                asl a                        ; CF99= 0A          .
                bpl LCFD7                    ; CF9A= 10 3B       .;
                and #$F0                     ; CF9C= 29 F0       )p
                asl a                        ; CF9E= 0A          .
                beq LCFE7                    ; CF9F= F0 46       pF
                eor #$40                     ; CFA1= 49 40       I@
                beq LCFB9                    ; CFA3= F0 14       p.
                pha                          ; CFA5= 48          H
                jsr LCFED                    ; CFA6= 20 ED CF     mO
                pla                          ; CFA9= 68          h
                eor #$60                     ; CFAA= 49 60       I`
                beq LCFBF                    ; CFAC= F0 11       p.
                cmp #$40                     ; CFAE= C9 40       I@
                bne LCFBC                    ; CFB0= D0 0A       P.
                lda #$02                     ; CFB2= A9 02       ).
                sta $DA                      ; CFB4= 85 DA       .Z
                jmp LD41D                    ; CFB6= 4C 1D D4    L.T

LCFB9:
                jmp LD500                    ; CFB9= 4C 00 D5    L.U

LCFBC:
                jmp LC937                    ; CFBC= 4C 37 C9    L7I

LCFBF:
                sta $DA                      ; CFBF= 85 DA       .Z
                jmp LD3D6                    ; CFC1= 4C D6 D3    LVS

LCFC4:
                txa                          ; CFC4= 8A          .
                ora LC3D7,y                  ; CFC5= 19 D7 C3    .WC
                eor LC3D8,y                  ; CFC8= 59 D8 C3    YXC
                sta $DE                      ; CFCB= 85 DE       .^
                txa                          ; CFCD= 8A          .
                ora LC3D6,y                  ; CFCE= 19 D6 C3    .VC
                eor LC3DB,y                  ; CFD1= 59 DB C3    Y[C
                sta $DF                      ; CFD4= 85 DF       ._
                rts                          ; CFD6= 60          `

LCFD7:
                asl a                        ; CFD7= 0A          .
                bmi LCFBC                    ; CFD8= 30 E2       0b
                asl a                        ; CFDA= 0A          .
                asl a                        ; CFDB= 0A          .
                bpl LCFE1                    ; CFDC= 10 03       ..
                jsr LCFFC                    ; CFDE= 20 FC CF     |O
LCFE1:
                jsr LD0FE                    ; CFE1= 20 FE D0     ~P
                jmp LCFEA                    ; CFE4= 4C EA CF    LjO

LCFE7:
                jsr LCFFC                    ; CFE7= 20 FC CF     |O
LCFEA:
                jsr LCD1E                    ; CFEA= 20 1E CD     .M
LCFED:
                ldy #$24                     ; CFED= A0 24        $
LCFEF:
                ldx #$20                     ; CFEF= A2 20       "
                jmp LD3A1                    ; CFF1= 4C A1 D3    L!S

LCFF4:
                ldx #$24                     ; CFF4= A2 24       "$
                jsr LD775                    ; CFF6= 20 75 D7     uW
                beq LD001                    ; CFF9= F0 06       p.
                rts                          ; CFFB= 60          `

LCFFC:
                jsr LD773                    ; CFFC= 20 73 D7     sW
                bne LD014                    ; CFFF= D0 13       P.
LD001:
                ldy $031A                    ; D001= AC 1A 03    ,..
LD004:
                lda $D1                      ; D004= A5 D1       %Q
                and $DE                      ; D006= 25 DE       %^
                ora ($D4),y                  ; D008= 11 D4       .T
                sta $D8                      ; D00A= 85 D8       .X
                lda $DF                      ; D00C= A5 DF       %_
                and $D1                      ; D00E= 25 D1       %Q
                eor $D8                      ; D010= 45 D8       EX
                sta ($D4),y                  ; D012= 91 D4       .T
LD014:
                rts                          ; D014= 60          `

LD015:
                lda ($D4),y                  ; D015= B1 D4       1T
                ora $DE                      ; D017= 05 DE       .^
                eor $DF                      ; D019= 45 DF       E_
                sta ($D4),y                  ; D01B= 91 D4       .T
                rts                          ; D01D= 60          `

                .if version==300
LD02A_300:
                sta $7fff
                rts
                .endif

LD01E:
                ldx #$24                     ; D01E= A2 24       "$
LD020:
                ldy #$00                     ; D020= A0 00        .
                sty $D8                      ; D022= 84 D8       .X
                ldy #$02                     ; D024= A0 02        .
                jsr LD039                    ; D026= 20 39 D0     9P
                asl $D8                      ; D029= 06 D8       .X
                asl $D8                      ; D02B= 06 D8       .X
                dex                          ; D02D= CA          J
                dex                          ; D02E= CA          J
                ldy #$00                     ; D02F= A0 00        .
                jsr LD039                    ; D031= 20 39 D0     9P
                inx                          ; D034= E8          h
                inx                          ; D035= E8          h
                lda $D8                      ; D036= A5 D8       %X
                rts                          ; D038= 60          `

LD039:
                lda $0302,x                  ; D039= BD 02 03    =..
                cmp $0300,y                  ; D03C= D9 00 03    Y..
                lda $0303,x                  ; D03F= BD 03 03    =..
                sbc $0301,y                  ; D042= F9 01 03    y..
                bmi LD057                    ; D045= 30 10       0.
                lda $0304,y                  ; D047= B9 04 03    9..
                cmp $0302,x                  ; D04A= DD 02 03    ]..
                lda $0305,y                  ; D04D= B9 05 03    9..
                sbc $0303,x                  ; D050= FD 03 03    }..
                bpl LD059                    ; D053= 10 04       ..
                inc $D8                      ; D055= E6 D8       fX
LD057:
                inc $D8                      ; D057= E6 D8       fX
LD059:
                rts                          ; D059= 60          `

LD05A:
                lda #$FF                     ; D05A= A9 FF       ).
                bne LD061                    ; D05C= D0 03       P.
LD05E:
                lda $031F                    ; D05E= AD 1F 03    -..
LD061:
                sta $D8                      ; D061= 85 D8       .X
                ldy #$02                     ; D063= A0 02        .
                jsr LD087                    ; D065= 20 87 D0     .P
                jsr LD0BE                    ; D068= 20 BE D0     >P
                ldy #$00                     ; D06B= A0 00        .
                dex                          ; D06D= CA          J
                dex                          ; D06E= CA          J
                jsr LD087                    ; D06F= 20 87 D0     .P
                ldy $0361                    ; D072= AC 61 03    ,a.
                cpy #$03                     ; D075= C0 03       @.
                beq LD07E                    ; D077= F0 05       p.
                bcs LD081                    ; D079= B0 06       0.
                jsr LD0BE                    ; D07B= 20 BE D0     >P
LD07E:
                jsr LD0BE                    ; D07E= 20 BE D0     >P
LD081:
                lda $0356                    ; D081= AD 56 03    -V.
                bne LD0BE                    ; D084= D0 38       P8
                rts                          ; D086= 60          `

LD087:
                clc                          ; D087= 18          .
                lda $D8                      ; D088= A5 D8       %X
                and #$04                     ; D08A= 29 04       ).
                beq LD097                    ; D08C= F0 09       p.
                lda $0302,x                  ; D08E= BD 02 03    =..
                pha                          ; D091= 48          H
                lda $0303,x                  ; D092= BD 03 03    =..
                bcc LD0A5                    ; D095= 90 0E       ..
LD097:
                lda $0302,x                  ; D097= BD 02 03    =..
                adc $0310,y                  ; D09A= 79 10 03    y..
                pha                          ; D09D= 48          H
                lda $0303,x                  ; D09E= BD 03 03    =..
                adc $0311,y                  ; D0A1= 79 11 03    y..
                clc                          ; D0A4= 18          .
LD0A5:
                sta $0311,y                  ; D0A5= 99 11 03    ...
                adc $030D,y                  ; D0A8= 79 0D 03    y..
                sta $0303,x                  ; D0AB= 9D 03 03    ...
                pla                          ; D0AE= 68          h
                sta $0310,y                  ; D0AF= 99 10 03    ...
                clc                          ; D0B2= 18          .
                adc $030C,y                  ; D0B3= 79 0C 03    y..
                sta $0302,x                  ; D0B6= 9D 02 03    ...
                bcc LD0BE                    ; D0B9= 90 03       ..
                inc $0303,x                  ; D0BB= FE 03 03    ~..
LD0BE:
                lda $0303,x                  ; D0BE= BD 03 03    =..
                asl a                        ; D0C1= 0A          .
                ror $0303,x                  ; D0C2= 7E 03 03    ~..
                ror $0302,x                  ; D0C5= 7E 02 03    ~..
                rts                          ; D0C8= 60          `

LD0C9:
                ldy #$10                     ; D0C9= A0 10        .
                jsr LD39F                    ; D0CB= 20 9F D3     .S
                ldx #$02                     ; D0CE= A2 02       ".
                ldy #$02                     ; D0D0= A0 02        .
                jsr LD0E6                    ; D0D2= 20 E6 D0     fP
                ldx #$00                     ; D0D5= A2 00       ".
                ldy #$04                     ; D0D7= A0 04        .
                lda $0361                    ; D0D9= AD 61 03    -a.
LD0DC:
                dey                          ; D0DC= 88          .
                lsr a                        ; D0DD= 4A          J
                bne LD0DC                    ; D0DE= D0 FC       P|
                lda $0356                    ; D0E0= AD 56 03    -V.
                beq LD0E6                    ; D0E3= F0 01       p.
                iny                          ; D0E5= C8          H
LD0E6:
                asl $0310,x                  ; D0E6= 1E 10 03    ...
                rol $0311,x                  ; D0E9= 3E 11 03    >..
                dey                          ; D0EC= 88          .
                bne LD0E6                    ; D0ED= D0 F7       Pw
                sec                          ; D0EF= 38          8
                jsr LD0F4                    ; D0F0= 20 F4 D0     tP
                inx                          ; D0F3= E8          h
LD0F4:
                lda $0310,x                  ; D0F4= BD 10 03    =..
                sbc $030C,x                  ; D0F7= FD 0C 03    }..
                sta $0310,x                  ; D0FA= 9D 10 03    ...
                rts                          ; D0FD= 60          `

LD0FE:
                jsr LD324                    ; D0FE= 20 24 D3     $S
                lda $032B                    ; D101= AD 2B 03    -+.
                eor $0329                    ; D104= 4D 29 03    M).
                bmi LD118                    ; D107= 30 0F       0.
                lda $032A                    ; D109= AD 2A 03    -*.
                cmp $0328                    ; D10C= CD 28 03    M(.
                lda $032B                    ; D10F= AD 2B 03    -+.
                sbc $0329                    ; D112= ED 29 03    m).
                jmp LD12B                    ; D115= 4C 2B D1    L+Q

LD118:
                lda $0328                    ; D118= AD 28 03    -(.
                clc                          ; D11B= 18          .
                adc $032A                    ; D11C= 6D 2A 03    m*.
                tax                          ; D11F= AA          *
                lda $0329                    ; D120= AD 29 03    -).
                adc $032B                    ; D123= 6D 2B 03    m+.
                bne LD12B                    ; D126= D0 03       P.
                txa                          ; D128= 8A          .
                beq LD135                    ; D129= F0 0A       p.
LD12B:
                ror a                        ; D12B= 6A          j
                ldx #$00                     ; D12C= A2 00       ".
                eor $032B                    ; D12E= 4D 2B 03    M+.
                bpl LD135                    ; D131= 10 02       ..
                ldx #$02                     ; D133= A2 02       ".
LD135:
                stx $DC                      ; D135= 86 DC       .\
                lda LC411,x                  ; D137= BD 11 C4    =.D
                sta $035D                    ; D13A= 8D 5D 03    .].
                lda LC411+1,x                  ; D13D= BD 12 C4    =.D
                sta $035E                    ; D140= 8D 5E 03    .^.
                lda $0329,x                  ; D143= BD 29 03    =).
                bpl LD14C                    ; D146= 10 04       ..
                ldx #$24                     ; D148= A2 24       "$
                bne LD14E                    ; D14A= D0 02       P.
LD14C:
                ldx #$20                     ; D14C= A2 20       "
LD14E:
                stx $DD                      ; D14E= 86 DD       .]
                ldy #$2C                     ; D150= A0 2C        ,
                jsr LD3A1                    ; D152= 20 A1 D3     !S
                lda $DD                      ; D155= A5 DD       %]
                eor #$04                     ; D157= 49 04       I.
                sta $DB                      ; D159= 85 DB       .[
                ora $DC                      ; D15B= 05 DC       .\
                tax                          ; D15D= AA          *
                jsr LD397                    ; D15E= 20 97 D3     .S
                lda $031F                    ; D161= AD 1F 03    -..
                and #$10                     ; D164= 29 10       ).
                asl a                        ; D166= 0A          .
                asl a                        ; D167= 0A          .
                asl a                        ; D168= 0A          .
                sta $D9                      ; D169= 85 D9       .Y
                ldx #$2C                     ; D16B= A2 2C       ",
                jsr LD020                    ; D16D= 20 20 D0      P
                sta $DA                      ; D170= 85 DA       .Z
                beq LD17A                    ; D172= F0 06       p.
                lda #$40                     ; D174= A9 40       )@
                ora $D9                      ; D176= 05 D9       .Y
                sta $D9                      ; D178= 85 D9       .Y
LD17A:
                ldx $DB                      ; D17A= A6 DB       &[
                jsr LD020                    ; D17C= 20 20 D0      P
                bit $DA                      ; D17F= 24 DA       $Z
                beq LD184                    ; D181= F0 01       p.
                rts                          ; D183= 60          `

LD184:
                ldx $DC                      ; D184= A6 DC       &\
                beq LD18A                    ; D186= F0 02       p.
                lsr a                        ; D188= 4A          J
                lsr a                        ; D189= 4A          J
LD18A:
                and #$02                     ; D18A= 29 02       ).
                beq LD195                    ; D18C= F0 07       p.
                txa                          ; D18E= 8A          .
                ora #$04                     ; D18F= 09 04       ..
                tax                          ; D191= AA          *
                jsr LD397                    ; D192= 20 97 D3     .S
LD195:
                jsr LD343                    ; D195= 20 43 D3     CS
                lda $DC                      ; D198= A5 DC       %\
                eor #$02                     ; D19A= 49 02       I.
                tax                          ; D19C= AA          *
                tay                          ; D19D= A8          (
                lda $0329                    ; D19E= AD 29 03    -).
                eor $032B                    ; D1A1= 4D 2B 03    M+.
                bpl LD1A7                    ; D1A4= 10 01       ..
                inx                          ; D1A6= E8          h
LD1A7:
                lda LC415,x                  ; D1A7= BD 15 C4    =.D
                sta $0332                    ; D1AA= 8D 32 03    .2.
                lda LC419,x                  ; D1AD= BD 19 C4    =.D
                sta $0333                    ; D1B0= 8D 33 03    .3.
                lda #$7F                     ; D1B3= A9 7F       ).
                sta $0334                    ; D1B5= 8D 34 03    .4.
                bit $D9                      ; D1B8= 24 D9       $Y
                bvs LD1E5                    ; D1BA= 70 29       p)
                lda LC403,x                  ; D1BC= BD 03 C4    =.D
                tax                          ; D1BF= AA          *
                sec                          ; D1C0= 38          8
                lda $0300,x                  ; D1C1= BD 00 03    =..
                sbc $032C,y                  ; D1C4= F9 2C 03    y,.
                sta $D8                      ; D1C7= 85 D8       .X
                lda $0301,x                  ; D1C9= BD 01 03    =..
                sbc $032D,y                  ; D1CC= F9 2D 03    y-.
                ldy $D8                      ; D1CF= A4 D8       $X
                tax                          ; D1D1= AA          *
                bpl LD1D7                    ; D1D2= 10 03       ..
                jsr LD3B2                    ; D1D4= 20 B2 D3     2S
LD1D7:
                tax                          ; D1D7= AA          *
                iny                          ; D1D8= C8          H
                bne LD1DC                    ; D1D9= D0 01       P.
                inx                          ; D1DB= E8          h
LD1DC:
                txa                          ; D1DC= 8A          .
                beq LD1E1                    ; D1DD= F0 02       p.
                ldy #$00                     ; D1DF= A0 00        .
LD1E1:
                sty $DD                      ; D1E1= 84 DD       .]
                beq LD1EE                    ; D1E3= F0 09       p.
LD1E5:
                txa                          ; D1E5= 8A          .
                lsr a                        ; D1E6= 4A          J
                ror a                        ; D1E7= 6A          j
                ora #$02                     ; D1E8= 09 02       ..
                eor $DC                      ; D1EA= 45 DC       E\
                sta $DC                      ; D1EC= 85 DC       .\
LD1EE:
                ldx #$2C                     ; D1EE= A2 2C       ",
                jsr LD77A                    ; D1F0= 20 7A D7     zW
                ldx $DA                      ; D1F3= A6 DA       &Z
                bne LD1F9                    ; D1F5= D0 02       P.
                dec $DB                      ; D1F7= C6 DB       F[
LD1F9:
                dex                          ; D1F9= CA          J
LD1FA:
                lda $D9                      ; D1FA= A5 D9       %Y
                beq LD21D                    ; D1FC= F0 1F       p.
                bpl LD210                    ; D1FE= 10 10       ..
                bit $0334                    ; D200= 2C 34 03    ,4.
                bpl LD20A                    ; D203= 10 05       ..
                dec $0334                    ; D205= CE 34 03    N4.
                bne LD22D                    ; D208= D0 23       P#
LD20A:
                inc $0334                    ; D20A= EE 34 03    n4.
                asl a                        ; D20D= 0A          .
                bpl LD21D                    ; D20E= 10 0D       ..
LD210:
                stx $DA                      ; D210= 86 DA       .Z
                ldx #$2C                     ; D212= A2 2C       ",
                jsr LD775                    ; D214= 20 75 D7     uW
                ldx $DA                      ; D217= A6 DA       &Z
                ora #$00                     ; D219= 09 00       ..
                bne LD22D                    ; D21B= D0 10       P.
LD21D:
                lda $D1                      ; D21D= A5 D1       %Q
                and $DE                      ; D21F= 25 DE       %^
                ora ($D4),y                  ; D221= 11 D4       .T
                sta $D8                      ; D223= 85 D8       .X
                lda $DF                      ; D225= A5 DF       %_
                and $D1                      ; D227= 25 D1       %Q
                eor $D8                      ; D229= 45 D8       EX
                sta ($D4),y                  ; D22B= 91 D4       .T
LD22D:
                sec                          ; D22D= 38          8
                lda $0335                    ; D22E= AD 35 03    -5.
                sbc $0337                    ; D231= ED 37 03    m7.
                sta $0335                    ; D234= 8D 35 03    .5.
                lda $0336                    ; D237= AD 36 03    -6.
                sbc $0338                    ; D23A= ED 38 03    m8.
                bcs LD250                    ; D23D= B0 11       0.
                sta $D8                      ; D23F= 85 D8       .X
                lda $0335                    ; D241= AD 35 03    -5.
                adc $0339                    ; D244= 6D 39 03    m9.
                sta $0335                    ; D247= 8D 35 03    .5.
                lda $D8                      ; D24A= A5 D8       %X
                adc $033A                    ; D24C= 6D 3A 03    m:.
                clc                          ; D24F= 18          .
LD250:
                sta $0336                    ; D250= 8D 36 03    .6.
                php                          ; D253= 08          .
                bcs LD25F                    ; D254= B0 09       0.
                jmp ($0332)                  ; D256= 6C 32 03    l2.

LD259:
                dey                          ; D259= 88          .
                bpl LD25F                    ; D25A= 10 03       ..
                jsr LD2EA                    ; D25C= 20 EA D2     jR
LD25F:
                jmp ($035D)                  ; D25F= 6C 5D 03    l].

LD262:
                iny                          ; D262= C8          H
                cpy #$08                     ; D263= C0 08       @.
                bne LD25F                    ; D265= D0 F8       Px
                clc                          ; D267= 18          .
                lda $D4                      ; D268= A5 D4       %T
                adc $0352                    ; D26A= 6D 52 03    mR.
                sta $D4                      ; D26D= 85 D4       .T
                lda $D5                      ; D26F= A5 D5       %U
                adc $0353                    ; D271= 6D 53 03    mS.
                bpl LD27A                    ; D274= 10 04       ..
                sec                          ; D276= 38          8
                sbc $0354                    ; D277= ED 54 03    mT.
LD27A:
                sta $D5                      ; D27A= 85 D5       .U
                ldy #$00                     ; D27C= A0 00        .
                jmp ($035D)                  ; D27E= 6C 5D 03    l].

LD281:
                lsr $D1                      ; D281= 46 D1       FQ
                bcc LD25F                    ; D283= 90 DA       .Z
                jsr LD304                    ; D285= 20 04 D3     .S
                jmp ($035D)                  ; D288= 6C 5D 03    l].
                
LD28B:
                asl $D1                      ; D28B= 06 D1       .Q
                bcc LD25F                    ; D28D= 90 D0       .P
                jsr LD314                    ; D28F= 20 14 D3     .S
                jmp ($035D)                  ; D292= 6C 5D 03    l].

LD295:
                dey                          ; D295= 88          .
                bpl LD2A4                    ; D296= 10 0C       ..
                jsr LD2EA                    ; D298= 20 EA D2     jR
                bne LD2A4                    ; D29B= D0 07       P.
LD29D:
                lsr $D1                      ; D29D= 46 D1       FQ
                bcc LD2A4                    ; D29F= 90 03       ..
                jsr LD304                    ; D2A1= 20 04 D3     .S
LD2A4:
                plp                          ; D2A4= 28          (
                inx                          ; D2A5= E8          h
                bne LD2AC                    ; D2A6= D0 04       P.
                inc $DB                      ; D2A8= E6 DB       f[
                beq LD2B6                    ; D2AA= F0 0A       p.
LD2AC:
                bit $D9                      ; D2AC= 24 D9       $Y
                bvs LD2B7                    ; D2AE= 70 07       p.
                bcs LD2E7                    ; D2B0= B0 35       05
                dec $DD                      ; D2B2= C6 DD       F]
                bne LD2E7                    ; D2B4= D0 31       P1
LD2B6:
                rts                          ; D2B6= 60          `

LD2B7:
                lda $DC                      ; D2B7= A5 DC       %\
                stx $DA                      ; D2B9= 86 DA       .Z
                and #$02                     ; D2BB= 29 02       ).
                tax                          ; D2BD= AA          *
                bcs LD2D9                    ; D2BE= B0 19       0.
                bit $DC                      ; D2C0= 24 DC       $\
                bmi LD2CE                    ; D2C2= 30 0A       0.
                inc $032C,x                  ; D2C4= FE 2C 03    ~,.
                bne LD2D9                    ; D2C7= D0 10       P.
                inc $032D,x                  ; D2C9= FE 2D 03    ~-.
                bcc LD2D9                    ; D2CC= 90 0B       ..
LD2CE:
                lda $032C,x                  ; D2CE= BD 2C 03    =,.
                bne LD2D6                    ; D2D1= D0 03       P.
                dec $032D,x                  ; D2D3= DE 2D 03    ^-.
LD2D6:
                dec $032C,x                  ; D2D6= DE 2C 03    ^,.
LD2D9:
                txa                          ; D2D9= 8A          .
                eor #$02                     ; D2DA= 49 02       I.
                tax                          ; D2DC= AA          *
                inc $032C,x                  ; D2DD= FE 2C 03    ~,.
                bne LD2E5                    ; D2E0= D0 03       P.
                inc $032D,x                  ; D2E2= FE 2D 03    ~-.
LD2E5:
                ldx $DA                      ; D2E5= A6 DA       &Z
LD2E7:
                jmp LD1FA                    ; D2E7= 4C FA D1    LzQ

LD2EA:
                sec                          ; D2EA= 38          8
                lda $D4                      ; D2EB= A5 D4       %T
                sbc $0352                    ; D2ED= ED 52 03    mR.
                sta $D4                      ; D2F0= 85 D4       .T
                lda $D5                      ; D2F2= A5 D5       %U
                sbc $0353                    ; D2F4= ED 53 03    mS.
                cmp $034E                    ; D2F7= CD 4E 03    MN.
                bcs LD2FF                    ; D2FA= B0 03       0.
                adc $0354                    ; D2FC= 6D 54 03    mT.
LD2FF:
                sta $D5                      ; D2FF= 85 D5       .U
                ldy #$07                     ; D301= A0 07        .
                rts                          ; D303= 60          `

LD304:
                lda $0362                    ; D304= AD 62 03    -b.
                sta $D1                      ; D307= 85 D1       .Q
                lda $D4                      ; D309= A5 D4       %T
                adc #$07                     ; D30B= 69 07       i.
                sta $D4                      ; D30D= 85 D4       .T
                bcc LD313                    ; D30F= 90 02       ..
                inc $D5                      ; D311= E6 D5       fU
LD313:
                rts                          ; D313= 60          `

LD314:
                lda $0363                    ; D314= AD 63 03    -c.
                sta $D1                      ; D317= 85 D1       .Q
                lda $D4                      ; D319= A5 D4       %T
                bne LD31F                    ; D31B= D0 02       P.
                dec $D5                      ; D31D= C6 D5       FU
LD31F:
                sbc #$08                     ; D31F= E9 08       i.
                sta $D4                      ; D321= 85 D4       .T
                rts                          ; D323= 60          `

LD324:
                ldy #$28                     ; D324= A0 28        (
                ldx #$20                     ; D326= A2 20       "
LD328:
                jsr LD32F                    ; D328= 20 2F D3     /S
                inx                          ; D32B= E8          h
                inx                          ; D32C= E8          h
                iny                          ; D32D= C8          H
                iny                          ; D32E= C8          H
LD32F:
                sec                          ; D32F= 38          8
                lda $0304,x                  ; D330= BD 04 03    =..
                sbc $0300,x                  ; D333= FD 00 03    }..
                sta $0300,y                  ; D336= 99 00 03    ...
                lda $0305,x                  ; D339= BD 05 03    =..
                sbc $0301,x                  ; D33C= FD 01 03    }..
                sta $0301,y                  ; D33F= 99 01 03    ...
                rts                          ; D342= 60          `

LD343:
                lda $DC                      ; D343= A5 DC       %\
                bne LD34E                    ; D345= D0 07       P.
                ldx #$28                     ; D347= A2 28       "(
                ldy #$2A                     ; D349= A0 2A        *
                jsr LCD1A                    ; D34B= 20 1A CD     .M
LD34E:
                ldx #$28                     ; D34E= A2 28       "(
                ldy #$37                     ; D350= A0 37        7
                jsr LD3A1                    ; D352= 20 A1 D3     !S
                sec                          ; D355= 38          8
                ldx $DC                      ; D356= A6 DC       &\
                lda $0330                    ; D358= AD 30 03    -0.
                sbc $032C,x                  ; D35B= FD 2C 03    },.
                tay                          ; D35E= A8          (
                lda $0331                    ; D35F= AD 31 03    -1.
                sbc $032D,x                  ; D362= FD 2D 03    }-.
                bmi LD36A                    ; D365= 30 03       0.
                jsr LD3B2                    ; D367= 20 B2 D3     2S
LD36A:
                sta $DB                      ; D36A= 85 DB       .[
                sty $DA                      ; D36C= 84 DA       .Z
                ldx #$35                     ; D36E= A2 35       "5
LD370:
                jsr LD37E                    ; D370= 20 7E D3     ~S
                lsr a                        ; D373= 4A          J
                sta $0301,x                  ; D374= 9D 01 03    ...
                tya                          ; D377= 98          .
                ror a                        ; D378= 6A          j
                sta $0300,x                  ; D379= 9D 00 03    ...
                dex                          ; D37C= CA          J
                dex                          ; D37D= CA          J
LD37E:
                ldy $0304,x                  ; D37E= BC 04 03    <..
                lda $0305,x                  ; D381= BD 05 03    =..
                bpl LD392                    ; D384= 10 0C       ..
                jsr LD3B2                    ; D386= 20 B2 D3     2S
                sta $0305,x                  ; D389= 9D 05 03    ...
                pha                          ; D38C= 48          H
                tya                          ; D38D= 98          .
                sta $0304,x                  ; D38E= 9D 04 03    ...
                pla                          ; D391= 68          h
LD392:
                rts                          ; D392= 60          `

LD393:
                lda #$08                     ; D393= A9 08       ).
                bne LD3A3                    ; D395= D0 0C       P.
LD397:
                ldy #$30                     ; D397= A0 30        0
LD399:
                lda #$02                     ; D399= A9 02       ).
                bne LD3A3                    ; D39B= D0 06       P.
LD39D:
                ldy #$28                     ; D39D= A0 28        (
LD39F:
                ldx #$24                     ; D39F= A2 24       "$
LD3A1:
                lda #$04                     ; D3A1= A9 04       ).
LD3A3:
                sta $D8                      ; D3A3= 85 D8       .X
LD3A5:
                lda $0300,x                  ; D3A5= BD 00 03    =..
                sta $0300,y                  ; D3A8= 99 00 03    ...
                inx                          ; D3AB= E8          h
                iny                          ; D3AC= C8          H
                dec $D8                      ; D3AD= C6 D8       FX
                bne LD3A5                    ; D3AF= D0 F4       Pt
                rts                          ; D3B1= 60          `

LD3B2:
                pha                          ; D3B2= 48          H
                tya                          ; D3B3= 98          .
                eor #$FF                     ; D3B4= 49 FF       I.
                tay                          ; D3B6= A8          (
                pla                          ; D3B7= 68          h
                eor #$FF                     ; D3B8= 49 FF       I.
                iny                          ; D3BA= C8          H
                bne LD3C0                    ; D3BB= D0 03       P.
                clc                          ; D3BD= 18          .
                adc #$01                     ; D3BE= 69 01       i.
LD3C0:
                rts                          ; D3C0= 60          `

LD3C1:
                jsr LD773                    ; D3C1= 20 73 D7     sW
                bne LD3CE                    ; D3C4= D0 08       P.
                lda ($D4),y                  ; D3C6= B1 D4       1T
                eor $035A                    ; D3C8= 4D 5A 03    MZ.
                sta $D8                      ; D3CB= 85 D8       .X
                rts                          ; D3CD= 60          `

LD3CE:
                pla                          ; D3CE= 68          h
                pla                          ; D3CF= 68          h
LD3D0:
                inc $0326                    ; D3D0= EE 26 03    n&.
                jmp LD45C                    ; D3D3= 4C 5C D4    L\T

LD3D6:
                jsr LD3C1                    ; D3D6= 20 C1 D3     AS
                and $D1                      ; D3D9= 25 D1       %Q
                bne LD3D0                    ; D3DB= D0 F3       Ps
                ldx #$00                     ; D3DD= A2 00       ".
                jsr LD4A8                    ; D3DF= 20 A8 D4     (T
                beq LD411                    ; D3E2= F0 2D       p-
                ldy $031A                    ; D3E4= AC 1A 03    ,..
                asl $D1                      ; D3E7= 06 D1       .Q
                bcs LD3F0                    ; D3E9= B0 05       0.
                jsr LD48A                    ; D3EB= 20 8A D4     .T
                bcc LD411                    ; D3EE= 90 21       .!
LD3F0:
                jsr LD314                    ; D3F0= 20 14 D3     .S
                lda ($D4),y                  ; D3F3= B1 D4       1T
                eor $035A                    ; D3F5= 4D 5A 03    MZ.
                sta $D8                      ; D3F8= 85 D8       .X
                bne LD40E                    ; D3FA= D0 12       P.
                sec                          ; D3FC= 38          8
                txa                          ; D3FD= 8A          .
                adc $0361                    ; D3FE= 6D 61 03    ma.
                bcc LD407                    ; D401= 90 04       ..
                inc $D9                      ; D403= E6 D9       fY
                bpl LD40E                    ; D405= 10 07       ..
LD407:
                tax                          ; D407= AA          *
                jsr LD015                    ; D408= 20 15 D0     .P
                sec                          ; D40B= 38          8
                bcs LD3F0                    ; D40C= B0 E2       0b
LD40E:
                jsr LD48A                    ; D40E= 20 8A D4     .T
LD411:
                ldy #$00                     ; D411= A0 00        .
                jsr LD4C2                    ; D413= 20 C2 D4     BT
                ldy #$20                     ; D416= A0 20
                ldx #$24                     ; D418= A2 24       "$
                jsr LCD22                    ; D41A= 20 22 CD     "M
LD41D:
                jsr LD3C1                    ; D41D= 20 C1 D3     AS
                ldx #$04                     ; D420= A2 04       ".
                jsr LD4A8                    ; D422= 20 A8 D4     (T
                txa                          ; D425= 8A          .
                bne LD42A                    ; D426= D0 02       P.
                dec $D9                      ; D428= C6 D9       FY
LD42A:
                dex                          ; D42A= CA          J
LD42B:
                jsr LD462                    ; D42B= 20 62 D4     bT
                bcc LD457                    ; D42E= 90 27       .'
LD430:
                jsr LD304                    ; D430= 20 04 D3     .S
                lda ($D4),y                  ; D433= B1 D4       1T
                eor $035A                    ; D435= 4D 5A 03    MZ.
                sta $D8                      ; D438= 85 D8       .X
                lda $DA                      ; D43A= A5 DA       %Z
                bne LD42B                    ; D43C= D0 ED       Pm
                lda $D8                      ; D43E= A5 D8       %X
                bne LD454                    ; D440= D0 12       P.
                sec                          ; D442= 38          8
                txa                          ; D443= 8A          .
                adc $0361                    ; D444= 6D 61 03    ma.
                bcc LD44D                    ; D447= 90 04       ..
                inc $D9                      ; D449= E6 D9       fY
                bpl LD454                    ; D44B= 10 07       ..
LD44D:
                tax                          ; D44D= AA          *
                jsr LD015                    ; D44E= 20 15 D0     .P
                sec                          ; D451= 38          8
                bcs LD430                    ; D452= B0 DC       0\
LD454:
                jsr LD462                    ; D454= 20 62 D4     bT
LD457:
                ldy #$04                     ; D457= A0 04        .
                jsr LD4C2                    ; D459= 20 C2 D4     BT
LD45C:
                jsr LCFEA                    ; D45C= 20 EA CF     jO
                jmp LD0C9                    ; D45F= 4C C9 D0    LIP

LD462:
                lda $D1                      ; D462= A5 D1       %Q
                clc                          ; D464= 18          .
                bcc LD475                    ; D465= 90 0E       ..
LD467:
                pla                          ; D467= 68          h
                inx                          ; D468= E8          h
                bne LD46F                    ; D469= D0 04       P.
                inc $D9                      ; D46B= E6 D9       fY
                bpl LD485                    ; D46D= 10 16       ..
LD46F:
                lsr $D1                      ; D46F= 46 D1       FQ
                bcs LD485                    ; D471= B0 12       0.
                ora $D1                      ; D473= 05 D1       .Q
LD475:
                pha                          ; D475= 48          H
                lda $D1                      ; D476= A5 D1       %Q
                bit $D8                      ; D478= 24 D8       $X
                php                          ; D47A= 08          .
                pla                          ; D47B= 68          h
                eor $DA                      ; D47C= 45 DA       EZ
                pha                          ; D47E= 48          H
                plp                          ; D47F= 28          (
                beq LD467                    ; D480= F0 E5       pe
                pla                          ; D482= 68          h
                eor $D1                      ; D483= 45 D1       EQ
LD485:
                sta $D1                      ; D485= 85 D1       .Q
                jmp LD001                    ; D487= 4C 01 D0    L.P

LD48A:
                lda #$00                     ; D48A= A9 00       ).
                clc                          ; D48C= 18          .
                bcc LD499                    ; D48D= 90 0A       ..
LD48F:
                inx                          ; D48F= E8          h
                bne LD496                    ; D490= D0 04       P.
                inc $D9                      ; D492= E6 D9       fY
                bpl LD485                    ; D494= 10 EF       .o
LD496:
                asl a                        ; D496= 0A          .
                bcs LD4A4                    ; D497= B0 0B       0.
LD499:
                ora $D1                      ; D499= 05 D1       .Q
                bit $D8                      ; D49B= 24 D8       $X
                beq LD48F                    ; D49D= F0 F0       pp
                eor $D1                      ; D49F= 45 D1       EQ
                lsr a                        ; D4A1= 4A          J
                bcc LD485                    ; D4A2= 90 E1       .a
LD4A4:
                ror a                        ; D4A4= 6A          j
                sec                          ; D4A5= 38          8
                bcs LD485                    ; D4A6= B0 DD       0]
LD4A8:
                lda $0300,x                  ; D4A8= BD 00 03    =..
                sec                          ; D4AB= 38          8
                sbc $0320                    ; D4AC= ED 20 03    m .
                tay                          ; D4AF= A8          (
                lda $0301,x                  ; D4B0= BD 01 03    =..
                sbc $0321                    ; D4B3= ED 21 03    m!.
                bmi LD4BB                    ; D4B6= 30 03       0.
                jsr LD3B2                    ; D4B8= 20 B2 D3     2S
LD4BB:
                sta $D9                      ; D4BB= 85 D9       .Y
                tya                          ; D4BD= 98          .
                tax                          ; D4BE= AA          *
                ora $D9                      ; D4BF= 05 D9       .Y
                rts                          ; D4C1= 60          `

LD4C2:
                sty $D8                      ; D4C2= 84 D8       .X
                txa                          ; D4C4= 8A          .
                tay                          ; D4C5= A8          (
                lda $D9                      ; D4C6= A5 D9       %Y
                bmi LD4CC                    ; D4C8= 30 02       0.
                lda #$00                     ; D4CA= A9 00       ).
LD4CC:
                ldx $D8                      ; D4CC= A6 D8       &X
                bne LD4D3                    ; D4CE= D0 03       P.
                jsr LD3B2                    ; D4D0= 20 B2 D3     2S
LD4D3:
                pha                          ; D4D3= 48          H
                clc                          ; D4D4= 18          .
                tya                          ; D4D5= 98          .
                adc $0300,x                  ; D4D6= 7D 00 03    }..
                sta $0320                    ; D4D9= 8D 20 03    . .
                pla                          ; D4DC= 68          h
                adc $0301,x                  ; D4DD= 7D 01 03    }..
                sta $0321                    ; D4E0= 8D 21 03    .!.
                rts                          ; D4E3= 60          `

LD4E4:
                lda #$03                     ; D4E4= A9 03       ).
                jsr LD4EB                    ; D4E6= 20 EB D4     kT
                lda #$07                     ; D4E9= A9 07       ).
LD4EB:
                pha                          ; D4EB= 48          H
                jsr LCD1E                    ; D4EC= 20 1E CD     .M
                jsr LD0C9                    ; D4EF= 20 C9 D0     IP
                ldx #$03                     ; D4F2= A2 03       ".
                pla                          ; D4F4= 68          h
                tay                          ; D4F5= A8          (
LD4F6:
                lda $0310,x                  ; D4F6= BD 10 03    =..
                .if version==300
                jsr LE75F_300
                .else
                sta ($F0),y                  ; D4F9= 91 F0       .p
                .endif
                dey                          ; D4FB= 88          .
                dex                          ; D4FC= CA          J
                bpl LD4F6                    ; D4FD= 10 F7       .w
                rts                          ; D4FF= 60          `

LD500:
                ldx #$20                     ; D500= A2 20       "
                ldy #$3E                     ; D502= A0 3E        >
                jsr LD393                    ; D504= 20 93 D3     .S
                jsr LD548                    ; D507= 20 48 D5     HU
                ldx #$14                     ; D50A= A2 14       ".
                ldy #$24                     ; D50C= A0 24        $
                jsr LD54C                    ; D50E= 20 4C D5     LU
                jsr LD548                    ; D511= 20 48 D5     HU
                ldx #$20                     ; D514= A2 20       "
                ldy #$2A                     ; D516= A0 2A        *
                jsr LD328                    ; D518= 20 28 D3     (S
                lda $032B                    ; D51B= AD 2B 03    -+.
                sta $0332                    ; D51E= 8D 32 03    .2.
                ldx #$28                     ; D521= A2 28       "(
                jsr LD370                    ; D523= 20 70 D3     pS
                ldy #$2E                     ; D526= A0 2E        .
                jsr LCFEF                    ; D528= 20 EF CF     oO
                jsr LCD1E                    ; D52B= 20 1E CD     .M
                clc                          ; D52E= 18          .
                jsr LD56E                    ; D52F= 20 6E D5     nU
                jsr LCD1E                    ; D532= 20 1E CD     .M
                ldx #$20                     ; D535= A2 20       "
                jsr LCD20                    ; D537= 20 20 CD      M
                sec                          ; D53A= 38          8
                jsr LD56E                    ; D53B= 20 6E D5     nU
                ldx #$3E                     ; D53E= A2 3E       ">
                ldy #$20                     ; D540= A0 20
                jsr LD393                    ; D542= 20 93 D3     .S
                jmp LCFEA                    ; D545= 4C EA CF    LjO

LD548:
                ldx #$20                     ; D548= A2 20       "
                ldy #$14                     ; D54A= A0 14        .
LD54C:
                lda $0302,x                  ; D54C= BD 02 03    =..
                cmp $0302,y                  ; D54F= D9 02 03    Y..
                lda $0303,x                  ; D552= BD 03 03    =..
                sbc $0303,y                  ; D555= F9 03 03    y..
                bmi LD56D                    ; D558= 30 13       0.
                jmp LCD22                    ; D55A= 4C 22 CD    L"M

LD55D:
                lda $0318                    ; D55D= AD 18 03    -..
                sec                          ; D560= 38          8
                sbc $0308                    ; D561= ED 08 03    m..
                tax                          ; D564= AA          *
                lda $0319                    ; D565= AD 19 03    -..
                sec                          ; D568= 38          8
                sbc $030B                    ; D569= ED 0B 03    m..
                tay                          ; D56C= A8          (
LD56D:
                rts                          ; D56D= 60          `

LD56E:
                php                          ; D56E= 08          .
                ldx #$20                     ; D56F= A2 20       "
                ldy #$35                     ; D571= A0 35        5
                jsr LD328                    ; D573= 20 28 D3     (S
                lda $0336                    ; D576= AD 36 03    -6.
                sta $033D                    ; D579= 8D 3D 03    .=.
                ldx #$33                     ; D57C= A2 33       "3
                jsr LD370                    ; D57E= 20 70 D3     pS
                ldy #$39                     ; D581= A0 39        9
                jsr LCFEF                    ; D583= 20 EF CF     oO
                sec                          ; D586= 38          8
                lda $0322                    ; D587= AD 22 03    -".
                sbc $0326                    ; D58A= ED 26 03    m&.
                sta $031B                    ; D58D= 8D 1B 03    ...
                lda $0323                    ; D590= AD 23 03    -#.
                sbc $0327                    ; D593= ED 27 03    m'.
                sta $031C                    ; D596= 8D 1C 03    ...
                ora $031B                    ; D599= 0D 1B 03    ...
                beq LD5B5                    ; D59C= F0 17       p.
LD59E:
                jsr LD5B8                    ; D59E= 20 B8 D5     8U
                ldx #$33                     ; D5A1= A2 33       "3
                jsr LD68A                    ; D5A3= 20 8A D6     .V
                ldx #$28                     ; D5A6= A2 28       "(
                jsr LD68A                    ; D5A8= 20 8A D6     .V
                inc $031B                    ; D5AB= EE 1B 03    n..
                bne LD59E                    ; D5AE= D0 EE       Pn
                inc $031C                    ; D5B0= EE 1C 03    n..
                bne LD59E                    ; D5B3= D0 E9       Pi
LD5B5:
                plp                          ; D5B5= 28          (
                bcc LD56D                    ; D5B6= 90 B5       .5
LD5B8:
                ldx #$39                     ; D5B8= A2 39       "9
                ldy #$2E                     ; D5BA= A0 2E        .
LD5BC:
                stx $DC                      ; D5BC= 86 DC       .\
                lda $0300,x                  ; D5BE= BD 00 03    =..
                cmp $0300,y                  ; D5C1= D9 00 03    Y..
                lda $0301,x                  ; D5C4= BD 01 03    =..
                sbc $0301,y                  ; D5C7= F9 01 03    y..
                bmi LD5D2                    ; D5CA= 30 06       0.
                tya                          ; D5CC= 98          .
                ldy $DC                      ; D5CD= A4 DC       $\
                tax                          ; D5CF= AA          *
                stx $DC                      ; D5D0= 86 DC       .\
LD5D2:
                sty $DD                      ; D5D2= 84 DD       .]
                lda $0300,y                  ; D5D4= B9 00 03    9..
                pha                          ; D5D7= 48          H
                lda $0301,y                  ; D5D8= B9 01 03    9..
                pha                          ; D5DB= 48          H
                ldx $DD                      ; D5DC= A6 DD       &]
                jsr LD020                    ; D5DE= 20 20 D0      P
                beq LD5F0                    ; D5E1= F0 0D       p.
                cmp #$02                     ; D5E3= C9 02       I.
                bne LD624                    ; D5E5= D0 3D       P=
                ldx #$04                     ; D5E7= A2 04       ".
                ldy $DD                      ; D5E9= A4 DD       $]
                jsr LD399                    ; D5EB= 20 99 D3     .S
                ldx $DD                      ; D5EE= A6 DD       &]
LD5F0:
                jsr LD77A                    ; D5F0= 20 7A D7     zW
                ldx $DC                      ; D5F3= A6 DC       &\
                jsr LD020                    ; D5F5= 20 20 D0      P
                lsr a                        ; D5F8= 4A          J
                bne LD624                    ; D5F9= D0 29       P)
                bcc LD5FF                    ; D5FB= 90 02       ..
                ldx #$00                     ; D5FD= A2 00       ".
LD5FF:
                ldy $DD                      ; D5FF= A4 DD       $]
                sec                          ; D601= 38          8
                lda $0300,y                  ; D602= B9 00 03    9..
                sbc $0300,x                  ; D605= FD 00 03    }..
                sta $DA                      ; D608= 85 DA       .Z
                lda $0301,y                  ; D60A= B9 01 03    9..
                sbc $0301,x                  ; D60D= FD 01 03    }..
                sta $DB                      ; D610= 85 DB       .[
                lda #$00                     ; D612= A9 00       ).
LD614:
                asl a                        ; D614= 0A          .
                ora $D1                      ; D615= 05 D1       .Q
                ldy $DA                      ; D617= A4 DA       $Z
                bne LD62F                    ; D619= D0 14       P.
                dec $DB                      ; D61B= C6 DB       F[
                bpl LD62F                    ; D61D= 10 10       ..
                sta $D1                      ; D61F= 85 D1       .Q
                jsr LD001                    ; D621= 20 01 D0     .P
LD624:
                ldx $DD                      ; D624= A6 DD       &]
                pla                          ; D626= 68          h
                sta $0301,x                  ; D627= 9D 01 03    ...
                pla                          ; D62A= 68          h
                sta $0300,x                  ; D62B= 9D 00 03    ...
                rts                          ; D62E= 60          `

LD62F:
                dec $DA                      ; D62F= C6 DA       FZ
                tax                          ; D631= AA          *
                bpl LD614                    ; D632= 10 E0       .`
                sta $D1                      ; D634= 85 D1       .Q
                jsr LD001                    ; D636= 20 01 D0     .P
                ldx $DA                      ; D639= A6 DA       &Z
                inx                          ; D63B= E8          h
                bne LD640                    ; D63C= D0 02       P.
                inc $DB                      ; D63E= E6 DB       f[
LD640:
                txa                          ; D640= 8A          .
                pha                          ; D641= 48          H
                lsr $DB                      ; D642= 46 DB       F[
                ror a                        ; D644= 6A          j
                ldy $0361                    ; D645= AC 61 03    ,a.
                cpy #$03                     ; D648= C0 03       @.
                beq LD651                    ; D64A= F0 05       p.
                bcc LD654                    ; D64C= 90 06       ..
                lsr $DB                      ; D64E= 46 DB       F[
                ror a                        ; D650= 6A          j
LD651:
                lsr $DB                      ; D651= 46 DB       F[
                lsr a                        ; D653= 4A          J
LD654:
                ldy $031A                    ; D654= AC 1A 03    ,..
                tax                          ; D657= AA          *
                beq LD669                    ; D658= F0 0F       p.
LD65A:
                tya                          ; D65A= 98          .
                sec                          ; D65B= 38          8
                sbc #$08                     ; D65C= E9 08       i.
                tay                          ; D65E= A8          (
                bcs LD663                    ; D65F= B0 02       0.
                dec $D5                      ; D661= C6 D5       FU
LD663:
                jsr LD015                    ; D663= 20 15 D0     .P
                dex                          ; D666= CA          J
                bne LD65A                    ; D667= D0 F1       Pq
LD669:
                pla                          ; D669= 68          h
                and $0361                    ; D66A= 2D 61 03    -a.
                beq LD624                    ; D66D= F0 B5       p5
                tax                          ; D66F= AA          *
                lda #$00                     ; D670= A9 00       ).
LD672:
                asl a                        ; D672= 0A          .
                ora $0363                    ; D673= 0D 63 03    .c.
                dex                          ; D676= CA          J
                bne LD672                    ; D677= D0 F9       Py
                sta $D1                      ; D679= 85 D1       .Q
                tya                          ; D67B= 98          .
                sec                          ; D67C= 38          8
                sbc #$08                     ; D67D= E9 08       i.
                tay                          ; D67F= A8          (
                bcs LD684                    ; D680= B0 02       0.
                dec $D5                      ; D682= C6 D5       FU
LD684:
                jsr LD004                    ; D684= 20 04 D0     .P
                jmp LD624                    ; D687= 4C 24 D6    L$V

LD68A:
                inc $0308,x                  ; D68A= FE 08 03    ~..
                bne LD692                    ; D68D= D0 03       P.
                inc $0309,x                  ; D68F= FE 09 03    ~..
LD692:
                sec                          ; D692= 38          8
                lda $0300,x                  ; D693= BD 00 03    =..
                sbc $0302,x                  ; D696= FD 02 03    }..
                sta $0300,x                  ; D699= 9D 00 03    ...
                lda $0301,x                  ; D69C= BD 01 03    =..
                sbc $0303,x                  ; D69F= FD 03 03    }..
                sta $0301,x                  ; D6A2= 9D 01 03    ...
                bpl LD6D7                    ; D6A5= 10 30       .0
LD6A7:
                lda $030A,x                  ; D6A7= BD 0A 03    =..
                bmi LD6B7                    ; D6AA= 30 0B       0.
                inc $0306,x                  ; D6AC= FE 06 03    ~..
                bne LD6C2                    ; D6AF= D0 11       P.
                inc $0307,x                  ; D6B1= FE 07 03    ~..
                jmp LD6C2                    ; D6B4= 4C C2 D6    LBV

LD6B7:
                lda $0306,x                  ; D6B7= BD 06 03    =..
                bne LD6BF                    ; D6BA= D0 03       P.
                dec $0307,x                  ; D6BC= DE 07 03    ^..
LD6BF:
                dec $0306,x                  ; D6BF= DE 06 03    ^..
LD6C2:
                clc                          ; D6C2= 18          .
                lda $0300,x                  ; D6C3= BD 00 03    =..
                adc $0304,x                  ; D6C6= 7D 04 03    }..
                sta $0300,x                  ; D6C9= 9D 00 03    ...
                lda $0301,x                  ; D6CC= BD 01 03    =..
                adc $0305,x                  ; D6CF= 7D 05 03    }..
                sta $0301,x                  ; D6D2= 9D 01 03    ...
                bmi LD6A7                    ; D6D5= 30 D0       0P
LD6D7:
                rts                          ; D6D7= 60          `

LD6D8:
                jsr LD6DE                    ; D6D8= 20 DE D6     ^V
                jsr LC433                    ; D6DB= 20 33 C4     3D

; Swap software cursor and screen data
; ------------------------------------
LD6DE:
                php                          ; D6DE= 08          .
                sei                          ; D6DF= 78          x
                pha                          ; D6E0= 48          H
                lda $D0                      ; D6E1= A5 D0       %P
                and #$30                     ; D6E3= 29 30       )0
                bne LD70E                    ; No cursor displayed, exit
                lda $0360                    ; D6E7= AD 60 03    -`.
                sta $D8                      ; D6EA= 85 D8       .X
                lda $034B                    ; D6EC= AD 4B 03    -K.
                eor #$80                     ; D6EF= 49 80       I.
                sta $034B                    ; D6F1= 8D 4B 03    .K.
                ldx #$00                     ; D6F4= A2 00       ".
                ldy #$07                     ; D6F6= A0 07        .
                sec                          ; D6F8= 38          8
LD6F9:
                lda ($D6),y                  ; D6F9= B1 D6       1V
                pha                          ; D6FB= 48          H
                lda $080C,x                  ; D6FC= BD 0C 08    =..
                sta ($D6),y                  ; D6FF= 91 D6       .V
                pla                          ; D701= 68          h
                sta $080C,x                  ; D702= 9D 0C 08    ...
                inx                          ; D705= E8          h
                tya                          ; D706= 98          .
                adc #$07                     ; D707= 69 07       i.
                tay                          ; D709= A8          (
                lsr $D8                      ; D70A= 46 D8       FX
                bne LD6F9                    ; D70C= D0 EB       Pk
LD70E:
                pla                          ; D70E= 68          h
                plp                          ; D70F= 28          (
                rts                          ; D710= 60          `

LD711:
                jsr LD6DE                    ; D711= 20 DE D6     ^V
                ldy #$07                     ; D714= A0 07        .
LD716:
                sty $D8                      ; D716= 84 D8       .X
                lda #$01                     ; D718= A9 01       ).
                sta $D9                      ; D71A= 85 D9       .Y
LD71C:
                lda $0362                    ; D71C= AD 62 03    -b.
                sta $DA                      ; D71F= 85 DA       .Z
                lda ($D6),y                  ; D721= B1 D6       1V
                eor $0358                    ; D723= 4D 58 03    MX.
                clc                          ; D726= 18          .
LD727:
                bit $DA                      ; D727= 24 DA       $Z
                beq LD72C                    ; D729= F0 01       p.
                sec                          ; D72B= 38          8
LD72C:
                rol $D9                      ; D72C= 26 D9       &Y
                bcs LD73A                    ; D72E= B0 0A       0.
                lsr $DA                      ; D730= 46 DA       FZ
                bcc LD727                    ; D732= 90 F3       .s
                tya                          ; D734= 98          .
                adc #$07                     ; D735= 69 07       i.
                tay                          ; D737= A8          (
                bcc LD71C                    ; D738= 90 E2       .b
LD73A:
                ldy $D8                      ; D73A= A4 D8       $X
                lda $D9                      ; D73C= A5 D9       %Y
                sta $0328,y                  ; D73E= 99 28 03    .(.
                dey                          ; D741= 88          .
                bpl LD716                    ; D742= 10 D2       .R
                ldx #$20                     ; D744= A2 20       "
LD746:
                txa                          ; D746= 8A          .
                pha                          ; D747= 48          H
                jsr LCF4F                    ; D748= 20 4F CF     OO
                pla                          ; D74B= 68          h
                tax                          ; D74C= AA          *
LD74D:
                ldy #$07                     ; D74D= A0 07        .
LD74F:
                lda $0328,y                  ; D74F= B9 28 03    9(.
                cmp ($DC),y                  ; D752= D1 DC       Q\
                bne LD75E                    ; D754= D0 08       P.
                dey                          ; D756= 88          .
                bpl LD74F                    ; D757= 10 F6       .v
                txa                          ; D759= 8A          .
                cpx #$7F                     ; D75A= E0 7F       `.
                bne LD76B                    ; D75C= D0 0D       P.
LD75E:
                inx                          ; D75E= E8          h
                lda $DC                      ; D75F= A5 DC       %\
                clc                          ; D761= 18          .
                adc #$08                     ; D762= 69 08       i.
                sta $DC                      ; D764= 85 DC       .\
                bne LD74D                    ; D766= D0 E5       Pe
                txa                          ; D768= 8A          .
                bne LD746                    ; D769= D0 DB       P[
LD76B:
                jsr LD6DE                    ; D76B= 20 DE D6     ^V
                ldy $0355                    ; D76E= AC 55 03    ,U.
                tax                          ; D771= AA          *
                rts                          ; D772= 60          `

LD773:
                ldx #$20                     ; D773= A2 20       "
LD775:
                jsr LD020                    ; D775= 20 20 D0      P
                bne LD7E4                    ; D778= D0 6A       Pj
LD77A:
                lda $0302,x                  ; D77A= BD 02 03    =..
                eor #$FF                     ; D77D= 49 FF       I.
                tay                          ; D77F= A8          (
                and #$07                     ; D780= 29 07       ).
                sta $031A                    ; D782= 8D 1A 03    ...
                tya                          ; D785= 98          .
                lsr a                        ; D786= 4A          J
                lsr a                        ; D787= 4A          J
                lsr a                        ; D788= 4A          J
                asl a                        ; D789= 0A          .
                tay                          ; D78A= A8          (
                lda LC36D,y                  ; D78B= B9 6D C3    9mC
                sta $D8                      ; D78E= 85 D8       .X
                lda LC36E,y                  ; D790= B9 6E C3    9nC
                ldy $0356                    ; D793= AC 56 03    ,V.
                beq LD79B                    ; D796= F0 03       p.
                lsr $D8                      ; D798= 46 D8       FX
                ror a                        ; D79A= 6A          j
LD79B:
                adc $0350                    ; D79B= 6D 50 03    mP.
                sta $D4                      ; D79E= 85 D4       .T
                lda $D8                      ; D7A0= A5 D8       %X
                adc $0351                    ; D7A2= 6D 51 03    mQ.
                sta $D5                      ; D7A5= 85 D5       .U
                lda $0301,x                  ; D7A7= BD 01 03    =..
                sta $D8                      ; D7AA= 85 D8       .X
                lda $0300,x                  ; D7AC= BD 00 03    =..
                pha                          ; D7AF= 48          H
                and $0361                    ; D7B0= 2D 61 03    -a.
                adc $0361                    ; D7B3= 6D 61 03    ma.
                tay                          ; D7B6= A8          (
                lda LC3C1,y                  ; D7B7= B9 C1 C3    9AC
                sta $D1                      ; D7BA= 85 D1       .Q
                pla                          ; D7BC= 68          h
                ldy $0361                    ; D7BD= AC 61 03    ,a.
                cpy #$03                     ; D7C0= C0 03       @.
                beq LD7C9                    ; D7C2= F0 05       p.
                bcs LD7CC                    ; D7C4= B0 06       0.
                asl a                        ; D7C6= 0A          .
                rol $D8                      ; D7C7= 26 D8       &X
LD7C9:
                asl a                        ; D7C9= 0A          .
                rol $D8                      ; D7CA= 26 D8       &X
LD7CC:
                and #$F8                     ; D7CC= 29 F8       )x
                clc                          ; D7CE= 18          .
                adc $D4                      ; D7CF= 65 D4       eT
                sta $D4                      ; D7D1= 85 D4       .T
                lda $D8                      ; D7D3= A5 D8       %X
                adc $D5                      ; D7D5= 65 D5       eU
                bpl LD7DD                    ; D7D7= 10 04       ..
                sec                          ; D7D9= 38          8
                sbc $0354                    ; D7DA= ED 54 03    mT.
LD7DD:
                sta $D5                      ; D7DD= 85 D5       .U
                ldy $031A                    ; D7DF= AC 1A 03    ,..
LD7E2:
                lda #$00                     ; D7E2= A9 00       ).
LD7E4:
                rts                          ; D7E4= 60          `

LD7E5:
                pha                          ; D7E5= 48          H
                lda #$A0                     ; D7E6= A9 A0       )
                ldx $026A                    ; D7E8= AE 6A 02    .j.
                bne LD832                    ; D7EB= D0 45       PE
                bit $D0                      ; D7ED= 24 D0       $P
                bne LD832                    ; D7EF= D0 41       PA
                jsr LD6DE                    ; D7F1= 20 DE D6     ^V
                bvs LD808                    ; D7F4= 70 12       p.
                ldx #$18                     ; D7F6= A2 18       ".
                ldy #$64                     ; D7F8= A0 64        d
                jsr LD399                    ; D7FA= 20 99 D3     .S
                jsr LCCC1                    ; D7FD= 20 C1 CC     AL
                lda #$02                     ; D800= A9 02       ).
                jsr LC523                    ; D802= 20 23 C5     #E
                asl $035F                    ; D805= 0E 5F 03    ._.
LD808:
                lda #$BF                     ; D808= A9 BF       )?
                jsr LC530                    ; D80A= 20 30 C5     0E
                pla                          ; D80D= 68          h
                and #$7F                     ; D80E= 29 7F       ).
                jsr LC433                    ; D810= 20 33 C4     3D
                lda #$40                     ; D813= A9 40       )@
                jsr LC523                    ; D815= 20 23 C5     #E
                jmp LD6DE                    ; D818= 4C DE D6    L^V

LD81B:
                lda #$20                     ; D81B= A9 20       )
                bit $D0                      ; D81D= 24 D0       $P
                bvc LD7E2                    ; D81F= 50 C1       PA
                bne LD7E2                    ; D821= D0 BF       P?
                jsr LD711                    ; D823= 20 11 D7     .W
                beq LD833                    ; D826= F0 0B       p.
                pha                          ; D828= 48          H
                jsr LD6DE                    ; D829= 20 DE D6     ^V
                jsr LC5E2                    ; D82C= 20 E2 C5     bE
                jsr LD6DE                    ; D82F= 20 DE D6     ^V
LD832:
                pla                          ; D832= 68          h
LD833:
                rts                          ; D833= 60          `

; OSBYTE &84 - Read top of user memory
; ------------------------------------
LD834:
                ldx $0355                    ; Get current screen MODE

; OSBYTE &85 - Read top of user memory for specified MODE
; -------------------------------------------------------
LD837:
                .if version==300
                lda $027f
                bmi LD841
                .endif
                txa                          ; D837= 8A          .
                and #$07                     ; D838= 29 07       ).
                tay                          ; D83A= A8          (
                ldx LC3FB,y                  ; D83B= BE FB C3    >{C
                lda LC40B,x                  ; D83E= BD 0B C4    =.D
LD841:
                ldx #$00                     ; D841= A2 00       ".
                tay                          ; D843= A8          (
                rts                          ; D844= 60          `

; Default page 2 contents - vectors and OSBYTE variables
; ======================================================
LD845:
                .word LE07E                  ; USERV=$200
                .word LDB33                  ; BRKV=$202 
                .word LDB47                  ; IRQ1V=$204
                .word LDB89                  ; IRQ2V=$206
                .word LDD14                  ; CLIV=$208 
                .word LE544                  ; BYTEV=$20a
                .word LE5BC                  ; WORDV=$20c
                .word LDE2D                  ; WRCHV=$20e
                .word LDC50                  ; RDCHV=$210
                .word LF1D6                  ; FILEV=$212
                .word LF0CC                  ; ARGSV=$214
                .word LF420                  ; BGETV=$216
                .word LF480                  ; BPUTV=$218
                .word LFFA2                  ; GBPBV=$21a
                .word LF320                  ; FINDV=$21c
                .word LF0E8                  ; FSCV=$21e 
                .word LFFA2                  ; EVENTV=$22
                .word LFFA2                  ; UPTV=$222 
                .word LFFA2                  ; NETV=$224 
                .word LFFA2                  ; VDUV=$226 
                .word LEADF                  ; KEYV=$228 
                .word LE221                  ; INSV=$22a 
                .word LE1D2                  ; REMV=$22c 
                .word LDF41                  ; CNPV=$22e 
                .word LFFA2                  ; IND1V=$230
                .word LFFA2                  ; IND2V=$232
                .word LFFA2                  ; IND3V=$234

; Default OSBYTE variables
                .word $0190
                .word extendedVectorSpace
                .word romInformationTable
                .word LEDD3
                .word $0300
                brk                          ; D885= 00          .
                brk                          ; D886= 00          .
                .byte $FF                    ; D887= FF          .
                brk                          ; D888= 00          .
                brk                          ; D889= 00          .
                brk                          ; D88A= 00          .
                brk                          ; D88B= 00          .
                brk                          ; D88C= 00          .
                brk                          ; D88D= 00          .
                brk                          ; D88E= 00          .
                brk                          ; D88F= 00          .
                .byte $FF                    ; D890= FF          .
                ;tsb $04                      ; D891= 04 04       ..
                .byte $04
                .byte $04
                brk                          ; D893= 00          .
                .byte $FF                    ; D894= FF          .
                brk                          ; D895= 00          .
                ora $1919,y                  ; D896= 19 19 19    ...
                ;and ($08)                    ; D899= 32 08       2.
                .byte $32
                .byte $08
                brk                          ; D89B= 00          .
                brk                          ; D89C= 00          .
                brk                          ; D89D= 00          .
                brk                          ; D89E= 00          .
                brk                          ; D89F= 00          .
                .byte $FF                    ; D8A0= FF          .
                brk                          ; D8A1= 00          .
                brk                          ; D8A2= 00          .
                brk                          ; D8A3= 00          .
                brk                          ; D8A4= 00          .
                brk                          ; D8A5= 00          .
                bvc LD8A8                    ; D8A6= 50 00       P.
LD8A8:
                .byte $03                    ; D8A8= 03          .
                ;bcc LD90F                    ; D8A9= 90 64       .d
                .byte $90
                .byte $64
                asl $81                      ; D8AB= 06 81       ..
                brk                          ; D8AD= 00          .
                brk                          ; D8AE= 00          .
                brk                          ; D8AF= 00          .
                brk                          ; D8B0= 00          .
                .byte $1B                    ; D8B1= 1B          .
                ora ($D0,x)                  ; D8B2= 01 D0       .P
                cpx #$F0                     ; D8B4= E0 F0       `p
                ora ($01,x)                  ; D8B6= 01 01       ..
                ora ($00,x)                  ; D8B8= 01 00       ..
                brk                          ; D8BA= 00          .
                brk                          ; D8BB= 00          .
LD8BC:
                .byte $FF                    ; D8BC= FF          .
                .byte $FF                    ; D8BD= FF          .
                .byte $FF                    ; D8BE= FF          .
                brk                          ; D8BF= 00          .
                brk                          ; D8C0= 00          .
                brk                          ; D8C1= 00          .
                brk                          ; D8C2= 00          .
                brk                          ; D8C3= 00          .
                brk                          ; D8C4= 00          .
                brk                          ; D8C5= 00          .
                brk                          ; D8C6= 00          .
                brk                          ; D8C7= 00          .
                ora $FF                      ; D8C8= 05 FF       ..
                brk                          ; D8CA= 00          .
                asl a                        ; D8CB= 0A          .
                brk                          ; D8CC= 00          .
                brk                          ; D8CD= 00          .
                brk                          ; D8CE= 00          .
                brk                          ; D8CF= 00          .
                brk                          ; D8D0= 00          .
                .byte $FF                    ; D8D1= FF          .

; RESET
; =====
LD8D2:
                lda #$40                     ; Put RTI in NMI code space
                sta $0D00
                sei                          ; Disable IRQs, put in Decimal mode
                cld
                ldx #$FF                     ; Reset stack
                txs
                inx                          ; X=&00
                stx $FE00                    ;
                stx $028D                    ; Set Last Break Type to &00=SoftBreak
                lda #$F8                     ;
                sta LFE05
                lda LFE00                    ; Read PowerOn flag from ULA
                and #$02
                eor #$02                     ; Save PowerOn flag
                pha
                beq LD8FB                    ; If PowerOn, jump to clear memory

; Not PowerOn, check BreakAction flags
                lda $0258                    ; Get BreakAction from *FX200
                lsr a                        ; Divide by 2
                cmp #$01                     ; Not *FX200,2 or *FX200,3, skip past
                bne LD912

                .if version==300
LD8FB:
                jsr LE768_300
                .else
                lsr a                        ; Divide by 2 again to give A=0

; Clear memory if PowerOn or *FX200,2/3
LD8FB:
                ldx #$04                     ; Start at page 4
                stx $01
                sta $00                      ; (&00/1)=&0400
                tay                          ; Y=0
LD902:
                sta ($00),y                  ; Clear memory
                iny                          ; Loop for 256 bytes
                bne LD902
                iny                          ; Step from &00 to &01 to skip &0D00
                inc $01                      ; Loop until (&00/1)=&8000
                bpl LD902
                .endif
                sta $028E                    ; MaxMemSize=&00
                stx $0284                    ; Set soft keys as inconsistant

LD912:
                ldx #$3A                     ; Scan for key &3A - CTRL
                jsr LEC1E
                php                          ; D917= 08          .
                pla                          ; D918= 68          h
                asl a                        ; D919= 0A          .
                ldx #$9B                     ; D91A= A2 9B       ".
                ldy #$8D                     ; D91C= A0 8D        .
                pla                          ; D91E= 68          h
                beq LD92A                    ; D91F= F0 09       p.
                ldy #$7E                     ; D921= A0 7E        ~
                bcc LD934                    ; D923= 90 0F       ..
                ldy #$87                     ; D925= A0 87        .
                inc $028D                    ; D927= EE 8D 02    n..
LD92A:
                inc $028D                    ; D92A= EE 8D 02    n..
                lda #$FF                     ; D92D= A9 FF       ).
                sta $028F                    ; D92F= 8D 8F 02    ...
                ldx #$90                     ; D932= A2 90       ".
LD934:
                lda #$00                     ; D934= A9 00       ).
LD936:
                cpx #$C3                     ; D936= E0 C3       `C
                bcc LD93C                    ; D938= 90 02       ..
                lda #$FF                     ; D93A= A9 FF       ).
LD93C:
                sta $0200,x                  ; D93C= 9D 00 02    ...
                inx                          ; D93F= E8          h
                bne LD936                    ; D940= D0 F4       Pt
                stx $02F7                    ; D942= 8E F7 02    .w.
                txa                          ; D945= 8A          .
                ldx #$E2                     ; D946= A2 E2       "b
LD948:
                sta $00,x                    ; D948= 95 00       ..
                inx                          ; D94A= E8          h
                bne LD948                    ; D94B= D0 FB       P{

LD94D:
                lda LD845-1,y                ; Set up vectors
                sta $0200-1,y
                dey
                bne LD94D
                lda #$07                     ; D956= A9 07       ).
                sta $ED                      ; D958= 85 ED       .m
                sty $FC                      ; D95A= 84 FC       .|
                cli                          ; D95C= 58          X
                sei                          ; D95D= 78          x
                lda $FC                      ; D95E= A5 FC       %|
                beq LD965                    ; D960= F0 03       p.
                jsr LEEC2                    ; D962= 20 C2 EE     Bn
LD965:
                lda $028F                    ; Get startup options
                jsr LDADA                    ; Convert mode number into ULA mode setting
                ora #$84                     ; D96B= 09 84       ..
                .if version==300
                jsr LE3C1_300
                .else
                sta $0282                    ; D96D= 8D 82 02    ...
                sta LFE07                    ; D970= 8D 07 FE    ..~
                .endif
                sta LFE04                    ; D973= 8D 04 FE    ..~
                ldx #$0C                     ; D976= A2 0C       ".
                stx $025B                    ; D978= 8E 5B 02    .[.
                stx LFE00                    ; D97B= 8E 00 FE    ..~
                jsr LE976                    ; D97E= 20 76 E9     vi
                ldx $0284                    ; D981= AE 84 02    ...
                beq LD989                    ; D984= F0 03       p.
                jsr LE7C0                    ; D986= 20 C0 E7     @g
LD989:

; Check sideways ROMs and build ROM table
                ldx #$00                     ; Start at ROM 0
LD98B:
                jsr LE39F                    ; Page in ROM X
                ldx #$03                     ; 3+1 bytes to check
                ldy $8007                    ; Get offset to (C) string
LD993:
                lda $8000,y                  ; Get byte from ROM
                cmp LDC97,x                  ; Compare with '(C)'
                .if version==300
                bne LD9E0
                .else
                bne LD9CF                    ; No match, jump to skip this ROM
                .endif
                iny                          ; Step to next byte to check
                dex                          ; Loop to check four bytes
                bpl LD993

; Check if this is a duplicate of a higher ROM
                ldx $F4                      ; D99F= A6 F4       &t
                .if version==300
                cpx #$a
                beq LD9E0
                .else
                txa                          ; D9A1= 8A          .
                tay                          ; D9A2= A8          (
LD9A3:
                iny                          ; D9A3= C8          H
                cpy #$10                     ; D9A4= C0 10       @.
                bcs LD9D3                    ; D9A6= B0 2B       0+
                tya                          ; D9A8= 98          .
                eor #$FF                     ; D9A9= 49 FF       I.
                sta $FA                      ; D9AB= 85 FA       .z
                lda #$7F                     ; D9AD= A9 7F       ).
                sta $FB                      ; D9AF= 85 FB       .{
LD9B1:
                jsr LE3A9                    ; D9B1= 20 A9 E3     )c
                sty LFE05                    ; D9B4= 8C 05 FE    ..~
                lda ($FA),y                  ; D9B7= B1 FA       1z
                jsr LE3A9                    ; D9B9= 20 A9 E3     )c
                stx LFE05                    ; D9BC= 8E 05 FE    ..~
                cmp ($FA),y                  ; D9BF= D1 FA       Qz
                bne LD9A3                    ; D9C1= D0 E0       P`
                inc $FA                      ; D9C3= E6 FA       fz
                bne LD9B1                    ; D9C5= D0 EA       Pj
                inc $FB                      ; D9C7= E6 FB       f{
                lda $FB                      ; D9C9= A5 FB       %{
                cmp #$84                     ; D9CB= C9 84       I.
                bcc LD9B1                    ; D9CD= 90 E2       .b
LD9CF:
                ldx $F4                      ; D9CF= A6 F4       &t
                bpl LD9E0                    ; D9D1= 10 0D       ..
                .endif

; This ROM is not a duplicate
LD9D3:
                lda $8006                    ; Store ROM type in ROM table
                sta $02A0,x
                and #$8F                     ; Check if b7=0 and b3-b0=0
                bne LD9E0                    ; If not 6502 BASIC, skip past
                stx $024B                    ; Store as BASIC
LD9E0:
                .if version==300
                ldx $f4
                .endif
                inx                          ; Step to next ROM
                cpx #$10                     ; Loop until all 16 ROMs done
                bcc LD98B
                .if version==300
                jsr LF0B5_300
                .endif
                lda $028F                    ; Get startup options
                jsr LC300                    ; Use it to select screen mode
                ldy #$CA                     ; Enter f10 into keyboard buffer
                jsr LE25F
                jsr LE87B                    ; Check Break Intercept Vector
                jsr LF08B                    ; Set up casette options
                lda #$81                     ; Write &81 to Tube control
                sta LFCE0
                lda LFCE0                    ; Read back from Tube control
                ror a                        ; Bit 0 didn't remain set, no Tube
                bcc LDA16
                lda #$01                     ; Write &01 to Tube control
                sta LFCE0
                lda LFCE0                    ; Read back from Tube control
                ror a                        ; Bit 0 didn't remain clear, no Tube
                bcs LDA16
                ldx #$FF                     ; Service call &FF - Tube PreInit
                jsr LF0A8
                bne LDA16                    ; No response, no Tube support, skip past
                dec $027A                    ; Set TubePresent to &FF=Present

LDA16:
                ldy #$0E                     ; Initial value for OSHWM (PAGE)
                ldx #$01                     ; Service call &01 - claim shared workspace
                jsr LF0A8
                ldx #$02                     ; Service call &02 - claim private workspace
                jsr LF0A8
                sty $0243                    ; Set primary OSHWM
                sty $0244                    ; Set current OSHWM (PAGE)
                ldx #$FE                     ; Service call &FE - Tube PostInit
                ldy $027A                    ; Y=TubePresent flag
                jsr LF0A8                    ; Send service call
                and $0267                    ; If claimed or banner supressed, skip past
                bpl LDA52

; Print startup banner
                ldy #$02                     ; Print 'Acorn Electron' message
                jsr LDC34
                lda $028D                    ; Soft Break, skip past
                beq LDA4D
                lda #$07                     ; Beep
                jsr OSWRCH

                .if version==300
                ldy #<message64K-1
                lda $027f
                beq LDA31_300
                bmi LDA2A_300
                ldy #<messageTURBO-1
LDA2A_300:
                lda #>message64K
                jsr LDC23_300
                beq LDA4D
LDA31_300:
                .endif
                
                jsr LD6DE                    ; Store software cursor
                jsr LCED5                    ; Copy Electron Acorn bitmap to cursor store
                jsr LD6DE                    ; Restore software cursor to draw the Acorn bitmap
LDA4D:
                ldy #$13                     ; Print Newlines
                jsr LDC34
LDA52:
                sec                          ; Call Break Intercept Vector
                jsr LE87B
                jsr LE7D1                    ; Get Shift key state
                php                          ; Copy flags into A
                pla
                lsr a                        ; Move Sift key state into bit 3
                lsr a
                lsr a
                lsr a
                eor $028F                    ; Toggle with startup options
                and #$08
                tay                          ; Y=Boot option (Shift EOR Startup)
                ldx #$03                     ; Service call 3, boot filing system
                jsr LF0A8
                beq LDA88                    ; Claimed, skip past checking ROMFS
                tya                          ; Shift not pressed, don't boot ROMFS
                bne LDA83
                lda #$8D                     ; Select ROMFS
                jsr LE7A5
                ldx #<LF009                  ; Point to "/!BOOT"
                ldy #>LF009
                dec $0267                    ; Set 'errors return to Reset handler'
                jsr OSCLI                   ; Do */!BOOT
                inc $0267                    ; Clear 'error return to Reset handler'
                bne LDA88

; If ROMFS */!BOOT causes an error, it jumps back to here
LDA83:
                lda #$00                     ; Select TAPEFS
                jsr LE7A7

; look for default language
LDA88:
                lda $028D                    ; Not Soft Break, find default language
                bne LDA92
                ldx $028C                    ; Use current language if b7=0
                bpl LDAB0
LDA92:
                ldx #$0F                     ; Start at ROM 15 to find a default language
LDA94:
                lda $02A0,x                  ; Get ROM type byte
                rol a                        ; If b6 set, use it
                bmi LDAB0
                dex                          ; Loop through all ROMs
                bpl LDA94
                lda #$00
                bit $027A                    ; If Tube present, enter Tube with A=&00
                bmi LDAD7
                brk                          ; No Tube, error 'No language'
                .byte $F9
                .text "Language?"
                brk

; ===========================================
; ENTER LANGUAGE ROM
; X=ROM number
; Cy=0 - entered at RESET
; Cy=1 - entered from OSBYTE 142
; ===========================================
LDAB0:
                clc                          ; CLC=Entering from RESET
LDAB1:
                php                          ; Save Carry flag
                stx $028C                    ; Save as Current Language
                jsr LE39F                    ; Page in this ROM
                lda #$80                     ; Prepare to print from &8008
                ldy #$08
                jsr LDC36                    ; Display ROM title at &8008
                sty $FD                      ; Store offset to end of title as last error message
                jsr OSNEWL                   ; Print two newlines
                jsr OSNEWL
                lda #$00
                sta $025D
                plp                          ; Get RESET/OSBYTE flag back
                lda #$01                     ; A=&01 for language entry
                bit $027A                    ; If Tube present, enter Tube code
                bmi LDAD7
                jmp $8000                    ; Enter ROM language entry
LDAD7:
                jmp $0400                    ; Enter Tube code to start language

; Convert MODE number into table offset
; On entry, A=mode
; On exit,  X=validated mode number 0-6
;           A=validated mode number * 8
LDADA:
                and #$07                     ; DADA= 29 07       ).
                cmp #$07                     ; DADC= C9 07       I.
                bcc LDAE2                    ; DADE= 90 02       ..
                lda #$06                     ; DAE0= A9 06       ).
LDAE2:
                tax                          ; DAE2= AA          *
                asl a                        ; DAE3= 0A          .
                asl a                        ; DAE4= 0A          .
                asl a                        ; DAE5= 0A          .
                rts                          ; DAE6= 60          `

; IRQ Handler
; ===========
LDAE7:
                sta $FC                      ; Save A in IRQ store
                pla                          ; Get flags from stack
                pha
                and #$10                     ; If BRK jump to BRK handler
                bne LDB06
                jmp ($0204)                  ; Pass on to IRQ1V

; OSRDRM - read byte from sideways ROM
; ------------------------------------
LDAF2:
                ldx $F4                      ; Save current ROM in X
                sty $F4                      ; Select ROM Y
                jsr LE3A9                    ; Electron paging mechanism
                sty LFE05                    ; Page in ROM Y
                ldy #$00                     ; Get byte pointed to by &F6/7
                lda ($F6),y
LDB00:
                pha                          ; Page ROM X back in
                jsr LE39F
                pla
LDB05:
                rts

; BRK handler
; -----------
LDB06:
                txa                          ; Save X
                pha
                tsx                          ; Get stacked address of BRK
                lda $0103,x
                cld                          ; Ensure operating in binary
                sec                          ; Subtract 1 from address so that
                sbc #$01
                sta $FD
                lda $0104,x                  ; FAULT at &FD/E points to error block
                sbc #$00
                sta $FE
                stx $F0                      ; &F0=stack pointer when BRK occured
                ldx #$06                     ; Issue service call 6 - BRK occured
                jsr LF0A8
                lda $F4                      ; Save ROM that was paged in at BRK
                sta $024A
                ldx $028C                    ; Get current language ROM and page it in
                jsr LDB00
                pla                          ; Restore X and A, enable IRQs
                tax
                lda $FC
                cli
                jmp ($0202)                  ; Pass on to BRKV error handler

LDB33:
                ldy #$00                     ; DB33= A0 00        .
                jsr LDC3C                    ; DB35= 20 3C DC     <\
                lda $0267                    ; DB38= AD 67 02    -g.
                ror a                        ; DB3B= 6A          j
LDB3C:
                bcs LDB3C                    ; DB3C= B0 FE       0~
                jsr OSNEWL                   ; DB3E= 20 E7 FF     g.
                jsr OSNEWL                   ; DB41= 20 E7 FF     g.
                jmp LDA83                    ; DB44= 4C 83 DA    L.Z

LDB47:
                cld                          ; DB47= D8          X
                lda $FC                      ; DB48= A5 FC       %|
                pha                          ; DB4A= 48          H
                txa                          ; DB4B= 8A          .
                pha                          ; DB4C= 48          H
                tya                          ; DB4D= 98          .
                pha                          ; DB4E= 48          H
                lda #>LDB82-1                ; DB4F= A9 DB       )[
                pha                          ; DB51= 48          H
                lda #<LDB82-1                ; DB52= A9 81       ).
                pha                          ; DB54= 48          H
                ldy LFE00                    ; DB55= AC 00 FE    ,.~
                tya                          ; DB58= 98          .
                lsr a                        ; DB59= 4A          J
                bcc LDB6F                    ; DB5A= 90 13       ..
                tya                          ; DB5C= 98          .
                and $025B                    ; DB5D= 2D 5B 02    -[.
                and #$FE                     ; DB60= 29 FE       )~
                tax                          ; DB62= AA          *
                and #$0C                     ; DB63= 29 0C       ).
                bit $25                      ; DB65= 24 25       $%
                txa                          ; DB67= 8A          .
                and #$70                     ; DB68= 29 70       )p
                beq LDB8C                    ; DB6A= F0 20       p
                jmp LF4DF                    ; DB6C= 4C DF F4    L_t

LDB6F:
                ldx #$05                     ; Issue service call 5 - IRQ occured
                jsr LF0A8
                beq LDB05                    ; If claimed, exit
                pla                          ; Drop caller address
                pla
                pla                          ; Restore Y and X
                tay
                pla
                tax
                pla                          ; Restore A and A store
                sta $FC
                jmp ($0206)                  ; Pass on to IRQ2V

LDB82:
                pla                          ; Restore Y and X
                tay
                pla
                tax
                pla                          ; Restore A and IRQ store
                sta $FC
LDB89:
                lda $FC                      ; Restore A from IRQ store
                rti                          ; Return from IRQ

LDB8C:
                txa                          ; DB8C= 8A          .
                ldy #$20                     ; DB8D= A0 20
                and #$08                     ; DB8F= 29 08       ).
                bne LDBC5                    ; DB91= D0 32       P2
                txa                          ; DB93= 8A          .
                and #$04                     ; DB94= 29 04       ).
                beq LDB6F                    ; DB96= F0 D7       pW
                jsr LC98E                    ; DB98= 20 8E C9     .I
                lda $0251                    ; DB9B= AD 51 02    -Q.
                beq LDBBB                    ; DB9E= F0 1B       p.
                dec $0251                    ; DBA0= CE 51 02    NQ.
                bne LDBBB                    ; DBA3= D0 16       P.
                ldx $0252                    ; DBA5= AE 52 02    .R.
                lda $0248                    ; DBA8= AD 48 02    -H.
                beq LDBB0                    ; DBAB= F0 03       p.
                ldx $0253                    ; DBAD= AE 53 02    .S.
LDBB0:
                eor #$07                     ; DBB0= 49 07       I.
                sta $0248                    ; DBB2= 8D 48 02    .H.
                stx $0251                    ; DBB5= 8E 51 02    .Q.
                jsr LC8A3                    ; DBB8= 20 A3 C8     #H
LDBBB:
                ldy #$04                     ; DBBB= A0 04        .
                jsr LE202                    ; DBBD= 20 02 E2     .b
                dec $0240                    ; DBC0= CE 40 02    N@.
                ldy #$10                     ; DBC3= A0 10        .
LDBC5:
                sty LFE05                    ; DBC5= 8C 05 FE    ..~
                lda $0283                    ; DBC8= AD 83 02    -..
                tax                          ; DBCB= AA          *
                eor #$0F                     ; DBCC= 49 0F       I.
                pha                          ; DBCE= 48          H
                tay                          ; DBCF= A8          (
                sec                          ; DBD0= 38          8
LDBD1:
                lda $0290,x                  ; DBD1= BD 90 02    =..
                adc #$00                     ; DBD4= 69 00       i.
                sta $0290,y                  ; DBD6= 99 90 02    ...
                dex                          ; DBD9= CA          J
                beq LDBDF                    ; DBDA= F0 03       p.
                dey                          ; DBDC= 88          .
                bne LDBD1                    ; DBDD= D0 F2       Pr
LDBDF:
                pla                          ; DBDF= 68          h
                sta $0283                    ; DBE0= 8D 83 02    ...
                ldx #$05                     ; DBE3= A2 05       ".
LDBE5:
                inc $029A,x                  ; DBE5= FE 9A 02    ~..
                bne LDBF2                    ; DBE8= D0 08       P.
                dex                          ; DBEA= CA          J
                bne LDBE5                    ; DBEB= D0 F8       Px
                ldy #$05                     ; DBED= A0 05        .
                jsr LE202                    ; DBEF= 20 02 E2     .b
LDBF2:
                lda $02B0                    ; DBF2= AD B0 02    -0.
                bne LDBFF                    ; DBF5= D0 08       P.
                lda $02B1                    ; DBF7= AD B1 02    -1.
                beq LDC02                    ; DBFA= F0 06       p.
                dec $02B1                    ; DBFC= CE B1 02    N1.
LDBFF:
                dec $02B0                    ; DBFF= CE B0 02    N0.
LDC02:
                bit $0278                    ; DC02= 2C 78 02    ,x.
                bpl LDC12                    ; DC05= 10 0B       ..
                inc $0278                    ; DC07= EE 78 02    nx.
                cli                          ; DC0A= 58          X
                jsr LE893                    ; DC0B= 20 93 E8     .h
                sei                          ; DC0E= 78          x
                dec $0278                    ; DC0F= CE 78 02    Nx.
LDC12:
                lda $0242                    ; DC12= AD 42 02    -B.
                beq LDC22                    ; DC15= F0 0B       p.
                lda $EC                      ; DC17= A5 EC       %l
                ora $ED                      ; DC19= 05 ED       .m
                clc                          ; DC1B= 18          .
                beq LDC1F                    ; DC1C= F0 01       p.
                sec                          ; DC1E= 38          8
LDC1F:
                jsr LEC49                    ; DC1F= 20 49 EC     Il
LDC22:
                ldy $0249                    ; DC22= AC 49 02    ,I.
                beq LDC2C                    ; DC25= F0 05       p.
                ldx #$15                     ; DC27= A2 15       ".
                jsr LF0A8                    ; DC29= 20 A8 F0     (p
LDC2C:
                bit $02C6                    ; DC2C= 2C C6 02    ,F.
                bmi LDC45                    ; DC2F= 30 14       0.
                jmp LDEF9                    ; DC31= 4C F9 DE    Ly^

LDC34:
                lda #$C3                     ; DC34= A9 C3       )C
LDC36:
                sta $FE                      ; DC36= 85 FE       .~
                lda #$00                     ; DC38= A9 00       ).
                sta $FD                      ; DC3A= 85 FD       .}
LDC3C:
                iny                          ; DC3C= C8          H
                .if version==300
                jsr LE765_300
                .else
                lda ($FD),y                  ; DC3D= B1 FD       1}
                .endif
                jsr OSASCI                   ; DC3F= 20 E3 FF     c.
                tax                          ; DC42= AA          *
                bne LDC3C                    ; DC43= D0 F7       Pw
LDC45:
                rts                          ; DC45= 60          `

LDC46:
                stx $02B0                    ; DC46= 8E B0 02    .0.
                sty $02B1                    ; DC49= 8C B1 02    .1.
                lda #$FF                     ; DC4C= A9 FF       ).
                bne LDC52                    ; DC4E= D0 02       P.
LDC50:
                lda #$00                     ; DC50= A9 00       ).
LDC52:
                sta $E6                      ; DC52= 85 E6       .f
                txa                          ; DC54= 8A          .
                pha                          ; DC55= 48          H
                tya                          ; DC56= 98          .
                pha                          ; DC57= 48          H
                ldy $0256                    ; DC58= AC 56 02    ,V.
                beq LDC71                    ; DC5B= F0 14       p.
                sec                          ; DC5D= 38          8
                ror $EB                      ; DC5E= 66 EB       fk
                jsr OSBGET                   ; DC60= 20 D7 FF     W.
                php                          ; DC63= 08          .
                lsr $EB                      ; DC64= 46 EB       Fk
                plp                          ; DC66= 28          (
                bcc LDC8E                    ; DC67= 90 25       .%
                lda #$00                     ; DC69= A9 00       ).
                sta $0256                    ; DC6B= 8D 56 02    .V.
                jsr OSFIND                   ; DC6E= 20 CE FF     N.
LDC71:
                bit $FF                      ; DC71= 24 FF       $.
                bmi LDC8B                    ; DC73= 30 16       0.
                ldx $0241                    ; DC75= AE 41 02    .A.
                jsr LE32E                    ; DC78= 20 2E E3     .c
                bcc LDC8E                    ; DC7B= 90 11       ..
                bit $E6                      ; DC7D= 24 E6       $f
                bvc LDC71                    ; DC7F= 50 F0       Pp
                lda $02B0                    ; DC81= AD B0 02    -0.
                ora $02B1                    ; DC84= 0D B1 02    .1.
                bne LDC71                    ; DC87= D0 E8       Ph
                bcs LDC90                    ; DC89= B0 05       0.
LDC8B:
                sec                          ; DC8B= 38          8
                lda #$1B                     ; DC8C= A9 1B       ).
LDC8E:
                sta $E6                      ; DC8E= 85 E6       .f
LDC90:
                pla                          ; DC90= 68          h
                tay                          ; DC91= A8          (
                pla                          ; DC92= 68          h
                tax                          ; DC93= AA          *
                lda $E6                      ; DC94= A5 E6       %f
                rts                          ; DC96= 60          `

LDC97:
                .text ")C("                  ; Copyright match string
                .byte 0 ;

LDC9B:
                .text "."                    ;
                .beword LDDBA
                .byte $05
                .text "FX"                   ; XY=>parameters
                .beword LE0B0
                .byte $FF
                .text "BASIC"                ;
                .beword LDDA1
                .byte $00
                .text "CAT"                  ; XY=>parameters, FSC &05
                .beword LDDBA
                .byte $05
                .text "CODE"                 ; X,Y=parameters, OSBYTE &88
                .beword LE0B6
                .byte $88
                .text "EXEC"                 ;
                .beword LF5EA
                .byte $00
                .text "HELP"                 ; XY=>parameters
                .beword LEED5
                .byte $FF
                .text "KEY"                  ; XY=>parameters
                .beword LE095
                .byte $FF
                .text "LOAD"                 ;
                .beword LDFAA
                .byte $00
                .text "LINE"                 ;
                .beword LE461
                .byte $01
                .text "MOTOR"                ; X,Y=parameters, OSBYTE &89
                .beword LE0B6
                .byte $89
                .text "OPT"                  ; X,Y=parameters, OSBYTE &8B
                .beword LE0B6
                .byte $8B
                .text "RUN"                  ; XY=>parameters, FSC &04
                .beword LDDBA
                .byte $04
                .text "ROM"                  ; X,Y=parameters, OSBYTE &8D
                .beword LE0B6
                .byte $8D
                .text "SAVE"                 ;
                .beword LDFAC
                .byte $00
                .text "SPOOL"                ;
                .beword LDFEF
                .byte $00
                .text "TAPE"                 ; X,Y=parameters, OSBYTE &8C
                .beword LE0B6
                .byte $8C
                .text "TV"                   ; X,Y=parameters, OSBYTE &90
                .beword LE0B6
                .byte $90
                .text ""                     ; FSC &03
                .beword LDDBA
                .byte $03
                .byte $00

                .if version==100
                .include "oscli.s65"
                .endif
                
LDDD7:
                jsr LDDC3                    ; DDD7= 20 C3 DD     C]
                jsr LDE06                    ; DDDA= 20 06 DE     .^
                .if version==300
                bcc LDD28_300
                .else
                bcc LDE16                    ; DDEA= B0 2A       0*
                .endif
LDDDF:
                sta $E6                      ; DDDF= 85 E6       .f
                jsr LDE05                    ; DDE1= 20 05 DE     .^
                bcc LDDFF                    ; DDE4= 90 19       ..
                tax                          ; DDE6= AA          *
                lda $E6                      ; DDE7= A5 E6       %f
                asl a                        ; DDE9= 0A          .
                .if version==300
                bcs LDD28_300
                .else
                bcs LDE16                    ; DDEA= B0 2A       0*
                .endif
                asl a                        ; DDEC= 0A          .
                .if version==300
                bcs LDD28_300
                .else
                bcs LDE16                    ; DDEA= B0 2A       0*
                .endif
                adc $E6                      ; DDEF= 65 E6       ef
                .if version==300
                bcs LDD28_300
                .else
                bcs LDE16                    ; DDEA= B0 2A       0*
                .endif
                asl a                        ; DDF3= 0A          .
                .if version==300
                bcs LDD28_300
                .else
                bcs LDE16                    ; DDEA= B0 2A       0*
                .endif
                sta $E6                      ; DDF6= 85 E6       .f
                txa                          ; DDF8= 8A          .
                adc $E6                      ; DDF9= 65 E6       ef
                .if version==100
                bcs LDE16                    ; DDEA= B0 2A       0*
                .endif
                bcc LDDDF                    ; DDFD= 90 E0       .`
                .if version==300
LDD28_300:
                clc
                rts
                .endif
LDDFF:
                ldx $E6                      ; DDFF= A6 E6       &f
                cmp #$0D                     ; DE01= C9 0D       I.
                sec                          ; DE03= 38          8
                rts                          ; DE04= 60          `


                .if version==100
                .include "LDE05.s65"
                .include "LDE13.s65"
                .include "LDE18.s65"
                .endif

LDE2D:
                pha                          ; DE2D= 48          H
                txa                          ; DE2E= 8A          .
                pha                          ; DE2F= 48          H
                tya                          ; DE30= 98          .
                pha                          ; DE31= 48          H
                tsx                          ; DE32= BA          :
                lda $0103,x                  ; DE33= BD 03 01    =..
                pha                          ; DE36= 48          H
                bit $0260                    ; DE37= 2C 60 02    ,`.
                bpl LDE44                    ; DE3A= 10 08       ..
                tay                          ; DE3C= A8          (
                lda #$04                     ; DE3D= A9 04       ).
                jsr LE395                    ; DE3F= 20 95 E3     .c
                bcs LDE9D                    ; DE42= B0 59       0Y
LDE44:
                clc                          ; DE44= 18          .
                lda #$02                     ; DE45= A9 02       ).
                bit $027C                    ; DE47= 2C 7C 02    ,|.
                bne LDE51                    ; DE4A= D0 05       P.
                pla                          ; DE4C= 68          h
                pha                          ; DE4D= 48          H
                jsr LD6D8                    ; DE4E= 20 D8 D6     XV
LDE51:
                lda #$08                     ; DE51= A9 08       ).
                bit $027C                    ; DE53= 2C 7C 02    ,|.
                bne LDE5A                    ; DE56= D0 02       P.
                bcc LDE5F                    ; DE58= 90 05       ..
LDE5A:
                pla                          ; DE5A= 68          h
                pha                          ; DE5B= 48          H
                jsr LDEA4                    ; DE5C= 20 A4 DE     $^
LDE5F:
                lda $027C                    ; DE5F= AD 7C 02    -|.
                ror a                        ; DE62= 6A          j
                bcc LDE87                    ; DE63= 90 22       ."
                ldy $EA                      ; DE65= A4 EA       $j
                dey                          ; DE67= 88          .
                bpl LDE87                    ; DE68= 10 1D       ..
                pla                          ; DE6A= 68          h
                pha                          ; DE6B= 48          H
                php                          ; DE6C= 08          .
                sei                          ; DE6D= 78          x
                bit $024F                    ; DE6E= 2C 4F 02    ,O.
                php                          ; DE71= 08          .
                ldx #$02                     ; DE72= A2 02       ".
                jsr LDF68                    ; DE74= 20 68 DF     h_
                plp                          ; DE77= 28          (
                bpl LDE86                    ; DE78= 10 0C       ..
                ldx #$13                     ; DE7A= A2 13       ".
                jsr LF0A8                    ; DE7C= 20 A8 F0     (p
                beq LDE86                    ; DE7F= F0 05       p.
                ldx #$02                     ; DE81= A2 02       ".
                jsr LDF09                    ; DE83= 20 09 DF     ._
LDE86:
                plp                          ; DE86= 28          (
LDE87:
                lda #$10                     ; DE87= A9 10       ).
                bit $027C                    ; DE89= 2C 7C 02    ,|.
                bne LDE9D                    ; DE8C= D0 0F       P.
                ldy $0257                    ; DE8E= AC 57 02    ,W.
                beq LDE9D                    ; DE91= F0 0A       p.
                pla                          ; DE93= 68          h
                pha                          ; DE94= 48          H
                sec                          ; DE95= 38          8
                ror $EB                      ; DE96= 66 EB       fk
                jsr OSBPUT                   ; DE98= 20 D4 FF     T.
                lsr $EB                      ; DE9B= 46 EB       Fk
LDE9D:
                pla                          ; DE9D= 68          h
                pla                          ; DE9E= 68          h
                tay                          ; DE9F= A8          (
                pla                          ; DEA0= 68          h
                tax                          ; DEA1= AA          *
                pla                          ; DEA2= 68          h
                rts                          ; DEA3= 60          `

LDEA4:
                bit $027C                    ; DEA4= 2C 7C 02    ,|.
                bvs LDEC9                    ; DEA7= 70 20       p
                cmp $0286                    ; DEA9= CD 86 02    M..
                beq LDEC9                    ; DEAC= F0 1B       p.
LDEAE:
                php                          ; DEAE= 08          .
                sei                          ; DEAF= 78          x
                tax                          ; DEB0= AA          *
                lda #$04                     ; DEB1= A9 04       ).
                bit $027C                    ; DEB3= 2C 7C 02    ,|.
                bne LDEC8                    ; DEB6= D0 10       P.
                txa                          ; DEB8= 8A          .
                ldx #$03                     ; DEB9= A2 03       ".
                jsr LDF68                    ; DEBB= 20 68 DF     h_
                bcs LDEC8                    ; DEBE= B0 08       0.
                bit $02C6                    ; DEC0= 2C C6 02    ,F.
                bpl LDEC8                    ; DEC3= 10 03       ..
                jsr LDECA                    ; DEC5= 20 CA DE     J^
LDEC8:
                plp                          ; DEC8= 28          (
LDEC9:
                rts                          ; DEC9= 60          `

LDECA:
                lda $0285                    ; DECA= AD 85 02    -..
                beq LDF09                    ; DECD= F0 3A       p:
                cmp #$03                     ; DECF= C9 03       I.
                bcs LDEDE                    ; DED1= B0 0B       0.
                ldx #$14                     ; DED3= A2 14       ".
                jsr LF0A8                    ; DED5= 20 A8 F0     (p
                beq LDEC9                    ; DED8= F0 EF       po
                ldx #$03                     ; DEDA= A2 03       ".
                bne LDF09                    ; DEDC= D0 2B       P+
LDEDE:
                clc                          ; DEDE= 18          .
                lda #$01                     ; DEDF= A9 01       ).
                jsr LDEFB                    ; DEE1= 20 FB DE     {^
LDEE4:
                ror $02C6                    ; DEE4= 6E C6 02    nF.
                rts                          ; DEE7= 60          `

LDEE8:
                bne LDF06                    ; DEE8= D0 1C       P.
LDEEA:
                ldx #$08                     ; DEEA= A2 08       ".
LDEEC:
                cli                          ; DEEC= 58          X
                sei                          ; DEED= 78          x
                jsr LDEF4                    ; DEEE= 20 F4 DE     t^
                dex                          ; DEF1= CA          J
                bpl LDEEC                    ; DEF2= 10 F8       .x
LDEF4:
                cpx #$09                     ; DEF4= E0 09       `.
                bcc LDF09                    ; DEF6= 90 11       ..
                rts                          ; DEF8= 60          `

LDEF9:
                lda #$00                     ; DEF9= A9 00       ).
LDEFB:
                ldx #$03                     ; DEFB= A2 03       ".
LDEFD:
                ldy $0285                    ; DEFD= AC 85 02    ,..
                jsr LE395                    ; DF00= 20 95 E3     .c
                jmp ($0222)                  ; DF03= 6C 22 02    l".

LDF06:
                ldx $0241                    ; DF06= AE 41 02    .A.
LDF09:
                clc                          ; DF09= 18          .
LDF0A:
                pha                          ; DF0A= 48          H
                php                          ; DF0B= 08          .
                sei                          ; DF0C= 78          x
                bcs LDF28                    ; DF0D= B0 19       0.
                txa                          ; DF0F= 8A          .
                and #$04                     ; DF10= 29 04       ).
                beq LDF28                    ; DF12= F0 14       p.
                lda $026B                    ; DF14= AD 6B 02    -k.
                beq LDF25                    ; DF17= F0 0C       p.
                txa                          ; DF19= 8A          .
                pha                          ; DF1A= 48          H
                tay                          ; DF1B= A8          (
                ldx #$17                     ; DF1C= A2 17       ".
                jsr LF0A8                    ; DF1E= 20 A8 F0     (p
                pla                          ; DF21= 68          h
                tax                          ; DF22= AA          *
                bne LDF28                    ; DF23= D0 03       P.
LDF25:
                jsr LE983                    ; DF25= 20 83 E9     .i
LDF28:
                sec                          ; DF28= 38          8
                ror $02C3,x                  ; DF29= 7E C3 02    ~C.
                cpx #$02                     ; DF2C= E0 02       `.
                bcs LDF3B                    ; DF2E= B0 0B       0.
                lda #$00                     ; DF30= A9 00       ).
                sta $0268                    ; DF32= 8D 68 02    .h.
                sta $025D                    ; DF35= 8D 5D 02    .].
                sta $026A                    ; DF38= 8D 6A 02    .j.
LDF3B:
                jsr LE50B                    ; DF3B= 20 0B E5     .e
                plp                          ; DF3E= 28          (
                pla                          ; DF3F= 68          h
                rts                          ; DF40= 60          `

LDF41:
                bvc LDF4A                    ; DF41= 50 07       P.
                lda $02CC,x                  ; DF43= BD CC 02    =L.
                sta $02D5,x                  ; DF46= 9D D5 02    .U.
                rts                          ; DF49= 60          `

LDF4A:
                php                          ; DF4A= 08          .
                sei                          ; DF4B= 78          x
                php                          ; DF4C= 08          .
                sec                          ; DF4D= 38          8
                lda $02D5,x                  ; DF4E= BD D5 02    =U.
                sbc $02CC,x                  ; DF51= FD CC 02    }L.
                bcs LDF5A                    ; DF54= B0 04       0.
                sec                          ; DF56= 38          8
                sbc LE1B5,x                  ; DF57= FD B5 E1    }5a
LDF5A:
                plp                          ; DF5A= 28          (
                bcc LDF63                    ; DF5B= 90 06       ..
                clc                          ; DF5D= 18          .
                adc LE1B5,x                  ; DF5E= 7D B5 E1    }5a
                eor #$FF                     ; DF61= 49 FF       I.
LDF63:
                ldy #$00                     ; DF63= A0 00        .
                tax                          ; DF65= AA          *
                plp                          ; DF66= 28          (
                rts                          ; DF67= 60          `

LDF68:
                sei                          ; DF68= 78          x
                jsr LE21E                    ; DF69= 20 1E E2     .b
                bcc LDF7B                    ; DF6C= 90 0D       ..
                jsr LE7E5                    ; DF6E= 20 E5 E7     eg
                bmi LDF7B                    ; DF71= 30 08       0.
                pha                          ; DF73= 48          H
                jsr LE950                    ; DF74= 20 50 E9     Pi
                pla                          ; DF77= 68          h
                cli                          ; DF78= 58          X
                bcs LDF68                    ; DF79= B0 ED       0m
LDF7B:
                rts                          ; DF7B= 60          `

LDF7C:
                pha                          ; DF7C= 48          H
                lda #$00                     ; DF7D= A9 00       ).
                sta $02E2,x                  ; DF7F= 9D E2 02    .b.
                sta $02E3,x                  ; DF82= 9D E3 02    .c.
                sta $02E4,x                  ; DF85= 9D E4 02    .d.
                sta $02E5,x                  ; DF88= 9D E5 02    .e.
                pla                          ; DF8B= 68          h
                rts                          ; DF8C= 60          `

LDF8D:
                sty $E6                      ; DF8D= 84 E6       .f
                rol a                        ; DF8F= 2A          *
                rol a                        ; DF90= 2A          *
                rol a                        ; DF91= 2A          *
                rol a                        ; DF92= 2A          *
                ldy #$04                     ; DF93= A0 04        .
LDF95:
                rol a                        ; DF95= 2A          *
                rol $02E2,x                  ; DF96= 3E E2 02    >b.
                rol $02E3,x                  ; DF99= 3E E3 02    >c.
                rol $02E4,x                  ; DF9C= 3E E4 02    >d.
                rol $02E5,x                  ; DF9F= 3E E5 02    >e.
                bcs LDFD5                    ; DFA2= B0 31       01
                dey                          ; DFA4= 88          .
                bne LDF95                    ; DFA5= D0 EE       Pn
                ldy $E6                      ; DFA7= A4 E6       $f
                rts                          ; DFA9= 60          `

LDFAA:
                lda #$FF                     ; DFAA= A9 FF       ).
LDFAC:
                stx $F2                      ; DFAC= 86 F2       .r
                sty $F3                      ; DFAE= 84 F3       .s
                stx $02E2                    ; DFB0= 8E E2 02    .b.
                sty $02E3                    ; DFB3= 8C E3 02    .c.
                pha                          ; DFB6= 48          H
                ldx #$02                     ; DFB7= A2 02       ".
                jsr LDF7C                    ; DFB9= 20 7C DF     |_
                ldy #$FF                     ; DFBC= A0 FF        .
                sty $02E8                    ; DFBE= 8C E8 02    .h.
                iny                          ; DFC1= C8          H
                jsr LE7FC                    ; DFC2= 20 FC E7     |g
LDFC5:
                jsr LE80E                    ; DFC5= 20 0E E8     .h
                bcc LDFC5                    ; DFC8= 90 FB       .{
                pla                          ; DFCA= 68          h
                pha                          ; DFCB= 48          H
                beq LE030                    ; DFCC= F0 62       pb
                jsr LE01B                    ; DFCE= 20 1B E0     .`
                bcs LE00E                    ; DFD1= B0 3B       0;
                beq LE013                    ; DFD3= F0 3E       p>
LDFD5:
                brk                          ; DFD5= 00          .
                ; .byte $FC                    ; DFD6= FC          |
                ; .byte $42                    ; DFD7= 42          B
                ; adc ($64,x)                  ; DFD8= 61 64       ad
                ; jsr $6461                    ; DFDA= 20 61 64     ad
                ; stz $72                      ; DFDD= 64 72       dr
                ; adc $73                      ; DFDF= 65 73       es
                ; .byte $73                    ; DFE1= 73          s
                ; brk                          ; DFE2= 00          .
                .text $fc,"Bad address",0
LDFE3:
                ldx #$10                     ; DFE3= A2 10       ".
                jsr LF0A8                    ; DFE5= 20 A8 F0     (p
                beq LE00D                    ; DFE8= F0 23       p#
                jsr LF5E8                    ; DFEA= 20 E8 F5     hu
                lda #$00                     ; DFED= A9 00       ).
LDFEF:
                php                          ; DFEF= 08          .
                sty $E6                      ; DFF0= 84 E6       .f
                ldy $0257                    ; DFF2= AC 57 02    ,W.
                sta $0257                    ; DFF5= 8D 57 02    .W.
                beq LDFFD                    ; DFF8= F0 03       p.
                jsr OSFIND                   ; DFFA= 20 CE FF     N.
LDFFD:
                ldy $E6                      ; DFFD= A4 E6       $f
                plp                          ; DFFF= 28          (
                beq LE00D                    ; E000= F0 0B       p.
                lda #$80                     ; E002= A9 80       ).
                jsr OSFIND                   ; E004= 20 CE FF     N.
                tay                          ; E007= A8          (
                beq LE07E                    ; E008= F0 74       pt
                sta $0257                    ; E00A= 8D 57 02    .W.
LE00D:
                rts                          ; E00D= 60          `

LE00E:
                bne LE07E                    ; E00E= D0 6E       Pn
                inc $02E8                    ; E010= EE E8 02    nh.
LE013:
                ldx #$E2                     ; E013= A2 E2       "b
                ldy #$02                     ; E015= A0 02        .
                pla                          ; E017= 68          h
                jmp OSFILE                   ; E018= 4C DD FF    L].

LE01B:
                jsr LDDC3                    ; E01B= 20 C3 DD     C]
                jsr LDE18                    ; E01E= 20 18 DE     .^
                bcc LE02F                    ; E021= 90 0C       ..
                jsr LDF7C                    ; E023= 20 7C DF     |_
LE026:
                jsr LDF8D                    ; E026= 20 8D DF     ._
                jsr LDE18                    ; E029= 20 18 DE     .^
                bcs LE026                    ; E02C= B0 F8       0x
                sec                          ; E02E= 38          8
LE02F:
                rts                          ; E02F= 60          `

LE030:
                ldx #$0A                     ; E030= A2 0A       ".
                jsr LE01B                    ; E032= 20 1B E0     .`
                bcc LE07E                    ; E035= 90 47       .G
                clv                          ; E037= B8          8
                .if version==300
                jsr LE762_300
                .else
                lda ($F2),y                  ; E038= B1 F2       1r
                .endif
                cmp #$2B                     ; E03A= C9 2B       I+
                bne LE042                    ; E03C= D0 04       P.
                bit LD8BC                    ; E03E= 2C BC D8    ,<X
                iny                          ; E041= C8          H
LE042:
                ldx #$0E                     ; E042= A2 0E       ".
                jsr LE01B                    ; E044= 20 1B E0     .`
                bcc LE07E                    ; E047= 90 35       .5
                php                          ; E049= 08          .
                bvc LE05B                    ; E04A= 50 0F       P.
                ldx #$FC                     ; E04C= A2 FC       "|
                clc                          ; E04E= 18          .
LE04F:
                lda $01F0,x                  ; E04F= BD F0 01    =p.
                adc $01F4,x                  ; E052= 7D F4 01    }t.
                sta $01F4,x                  ; E055= 9D F4 01    .t.
                inx                          ; E058= E8          h
                bne LE04F                    ; E059= D0 F4       Pt
LE05B:
                ldx #$03                     ; E05B= A2 03       ".
LE05D:
                lda $02EC,x                  ; E05D= BD EC 02    =l.
                sta $02E8,x                  ; E060= 9D E8 02    .h.
                sta $02E4,x                  ; E063= 9D E4 02    .d.
                dex                          ; E066= CA          J
                bpl LE05D                    ; E067= 10 F4       .t
                plp                          ; E069= 28          (
                beq LE013                    ; E06A= F0 A7       p'
                ldx #$06                     ; E06C= A2 06       ".
                jsr LE01B                    ; E06E= 20 1B E0     .`
                bcc LE07E                    ; E071= 90 0B       ..
                beq LE013                    ; E073= F0 9E       p.
                ldx #$02                     ; E075= A2 02       ".
                jsr LE01B                    ; E077= 20 1B E0     .`
                bcc LE07E                    ; E07A= 90 02       ..
                beq LE013                    ; E07C= F0 95       p.
LE07E:
                brk                          ; E07E= 00          .
                ; inc $6142,x                  ; E07F= FE 42 61    ~Ba
                ; stz $20                      ; E082= 64 20       d
                ; .byte $63                    ; E084= 63          c
                ; .byte $6F                    ; E085= 6F          o
                ; adc $616D                    ; E086= 6D 6D 61    mma
                ; ror $0064                    ; E089= 6E 64 00    nd.
                .text $fe,"Bad command"
                .cerror *!=LE08B             ; double use of the $00!
                ; .byte $FB                    ; E08C= FB          {
                ; .byte $42                    ; E08D= 42          B
                ; adc ($64,x)                  ; E08E= 61 64       ad
                ; jsr $656B                    ; E090= 20 6B 65     ke
LE08B:
                brk
                .text $fb,"Bad key",0
                ; adc $2000,y                  ; E093= 79 00 20    y.
                ; .byte $D7                    ; E096= D7          W
                ; cmp LF190,x                  ; E097= DD 90 F1    ].q
LE095:
                jsr LDDD7
                bcc LE08B
                cpx #$10                     ; E09A= E0 10       `.
                bcs LE08B                    ; E09C= B0 ED       0m
                jsr LDDCE                    ; E09E= 20 CE DD     N]
                php                          ; E0A1= 08          .
                ldx $0B10                    ; E0A2= AE 10 0B    ...
                tya                          ; E0A5= 98          .
                pha                          ; E0A6= 48          H
                jsr LE13F                    ; E0A7= 20 3F E1     ?a
                pla                          ; E0AA= 68          h
                tay                          ; E0AB= A8          (
                plp                          ; E0AC= 28          (
                bne LE0E5                    ; E0AD= D0 36       P6
                rts                          ; E0AF= 60          `

LE0B0:
                jsr LDDD7                    ; E0B0= 20 D7 DD     W]
                bcc LE07E                    ; E0B3= 90 C9       .I
                txa                          ; E0B5= 8A          .
LE0B6:
                pha                          ; E0B6= 48          H
                lda #$00                     ; E0B7= A9 00       ).
                sta $E5                      ; E0B9= 85 E5       .e
                sta $E4                      ; E0BB= 85 E4       .d
                jsr LDDCC                    ; E0BD= 20 CC DD     L]
                beq LE0DA                    ; E0C0= F0 18       p.
                jsr LDDD7                    ; E0C2= 20 D7 DD     W]
                bcc LE07E                    ; E0C5= 90 B7       .7
                stx $E5                      ; E0C7= 86 E5       .e
                jsr LDDCE                    ; E0C9= 20 CE DD     N]
                beq LE0DA                    ; E0CC= F0 0C       p.
                jsr LDDD7                    ; E0CE= 20 D7 DD     W]
                bcc LE07E                    ; E0D1= 90 AB       .+
                stx $E4                      ; E0D3= 86 E4       .d
                jsr LDDC3                    ; E0D5= 20 C3 DD     C]
                bne LE07E                    ; E0D8= D0 A4       P$
LE0DA:
                ldy $E4                      ; E0DA= A4 E4       $d
                ldx $E5                      ; E0DC= A6 E5       &e
                pla                          ; E0DE= 68          h
                jsr OSBYTE                   ; E0DF= 20 F4 FF     t.
                bvs LE07E                    ; E0E2= 70 9A       p.
                rts                          ; E0E4= 60          `

LE0E5:
                sec                          ; E0E5= 38          8
                jsr LE7FD                    ; E0E6= 20 FD E7     }g
LE0E9:
                jsr LE80E                    ; E0E9= 20 0E E8     .h
                bcs LE0F6                    ; E0EC= B0 08       0.
                inx                          ; E0EE= E8          h
                beq LE08B                    ; E0EF= F0 9A       p.
                sta $0B00,x                  ; E0F1= 9D 00 0B    ...
                bcc LE0E9                    ; E0F4= 90 F3       .s
LE0F6:
                bne LE08B                    ; E0F6= D0 93       P.
                php                          ; E0F8= 08          .
                sei                          ; E0F9= 78          x
                jsr LE13F                    ; E0FA= 20 3F E1     ?a
                ldx #$10                     ; E0FD= A2 10       ".
LE0FF:
                cpx $E6                      ; E0FF= E4 E6       df
                beq LE111                    ; E101= F0 0E       p.
                lda $0B00,x                  ; E103= BD 00 0B    =..
                cmp $0B00,y                  ; E106= D9 00 0B    Y..
                bne LE111                    ; E109= D0 06       P.
                lda $0B10                    ; E10B= AD 10 0B    -..
                sta $0B00,x                  ; E10E= 9D 00 0B    ...
LE111:
                dex                          ; E111= CA          J
                bpl LE0FF                    ; E112= 10 EB       .k
                plp                          ; E114= 28          (
                rts                          ; E115= 60          `

LE116:
                php                          ; E116= 08          .
                sei                          ; E117= 78          x
                lda $0B10                    ; E118= AD 10 0B    -..
                sec                          ; E11B= 38          8
                sbc $0B00,y                  ; E11C= F9 00 0B    y..
                sta $FB                      ; E11F= 85 FB       .{
                txa                          ; E121= 8A          .
                pha                          ; E122= 48          H
                ldx #$10                     ; E123= A2 10       ".
LE125:
                lda $0B00,x                  ; E125= BD 00 0B    =..
                sec                          ; E128= 38          8
                sbc $0B00,y                  ; E129= F9 00 0B    y..
                bcc LE136                    ; E12C= 90 08       ..
                beq LE136                    ; E12E= F0 06       p.
                cmp $FB                      ; E130= C5 FB       E{
                bcs LE136                    ; E132= B0 02       0.
LE134:
                sta $FB                      ; E134= 85 FB       .{
LE136:
                dex                          ; E136= CA          J
                bpl LE125                    ; E137= 10 EC       .l
                pla                          ; E139= 68          h
                tax                          ; E13A= AA          *
                lda $FB                      ; E13B= A5 FB       %{
                plp                          ; E13D= 28          (
                rts                          ; E13E= 60          `

LE13F:
                php                          ; E13F= 08          .
                sei                          ; E140= 78          x
                txa                          ; E141= 8A          .
                pha                          ; E142= 48          H
                ldy $E6                      ; E143= A4 E6       $f
                jsr LE116                    ; E145= 20 16 E1     .a
                lda $0B00,y                  ; E148= B9 00 0B    9..
                tay                          ; E14B= A8          (
                clc                          ; E14C= 18          .
                adc $FB                      ; E14D= 65 FB       e{
                tax                          ; E14F= AA          *
                sta $FA                      ; E150= 85 FA       .z
                lda $0268                    ; E152= AD 68 02    -h.
                beq LE164                    ; E155= F0 0D       p.
                brk                          ; E157= 00          .
                ;plx                          ; E158= FA          z
                .byte $FA
                .byte $4B                    ; E159= 4B          K
                adc $79                      ; E15A= 65 79       ey
                jsr $6E69                    ; E15C= 20 69 6E     in
                jsr $7375                    ; E15F= 20 75 73     us
                adc $00                      ; E162= 65 00       e.
LE164:
                dec $0284                    ; E164= CE 84 02    N..
                pla                          ; E167= 68          h
                sec                          ; E168= 38          8
                sbc $FA                      ; E169= E5 FA       ez
                sta $FA                      ; E16B= 85 FA       .z
                beq LE17B                    ; E16D= F0 0C       p.
LE16F:
                lda $0B01,x                  ; E16F= BD 01 0B    =..
                sta $0B01,y                  ; E172= 99 01 0B    ...
                iny                          ; E175= C8          H
                inx                          ; E176= E8          h
                dec $FA                      ; E177= C6 FA       Fz
                bne LE16F                    ; E179= D0 F4       Pt
LE17B:
                tya                          ; E17B= 98          .
                pha                          ; E17C= 48          H
                ldy $E6                      ; E17D= A4 E6       $f
                ldx #$10                     ; E17F= A2 10       ".
LE181:
                lda $0B00,x                  ; E181= BD 00 0B    =..
                cmp $0B00,y                  ; E184= D9 00 0B    Y..
                bcc LE190                    ; E187= 90 07       ..
                beq LE190                    ; E189= F0 05       p.
                sbc $FB                      ; E18B= E5 FB       e{
                sta $0B00,x                  ; E18D= 9D 00 0B    ...
LE190:
                dex                          ; E190= CA          J
                bpl LE181                    ; E191= 10 EE       .n
                lda $0B10                    ; E193= AD 10 0B    -..
                sta $0B00,y                  ; E196= 99 00 0B    ...
                pla                          ; E199= 68          h
                sta $0B10                    ; E19A= 8D 10 0B    ...
                tax                          ; E19D= AA          *
                inc $0284                    ; E19E= EE 84 02    n..
                plp                          ; E1A1= 28          (
                rts                          ; E1A2= 60          `

LE1A3:
                .byte $03                    ; E1A3= 03          .
                asl a                        ; E1A4= 0A          .
                ;php                          ; E1A5= 08          .
                .byte $08
                .byte $07                    ; E1A6= 07          .
                .byte $07                    ; E1A7= 07          .
                .byte $07                    ; E1A8= 07          .
                .byte $07                    ; E1A9= 07          .
                .byte $07                    ; E1AA= 07          .
                ;ora #$00                     ; E1AB= 09 00       ..
                .byte $09
LE1AC:
                .byte $00
                brk                          ; E1AD= 00          .
                ;cpy #$C0                     ; E1AE= C0 C0       @@
                .byte $C0
                .byte $C0
                ;bvc LE212                    ; E1B0= 50 60       P`
                .byte $50
                .byte $60
                ;bvs LE134                    ; E1B2= 70 80       p.
                .byte $70
                .byte $80
                ;brk                          ; E1B4= 00          .
                .byte $00
LE1B5:
                ;cpx #$00                     ; E1B5= E0 00       `.
                .byte $E0
                .byte $00
                ;rti                          ; E1B7= 40          @
                .byte $40

                ;cpy #$F0                     ; E1B8= C0 F0       @p
                .byte $C0
                .byte $F0
                ;beq LE1AC                    ; E1BA= F0 F0       pp
                .byte $F0
                .byte $F0
                ;beq LE17E                    ; E1BC= F0 C0       p@
                .byte $F0
                .byte $C0
LE1BE:
                lda LE1AC,x                  ; E1BE= BD AC E1    =,a
                sta $FA                      ; E1C1= 85 FA       .z
                lda LE1A3,x                  ; E1C3= BD A3 E1    =#a
                sta $FB                      ; E1C6= 85 FB       .{
                rts                          ; E1C8= 60          `

                .if version==300
                .include "LDE18.s65"
                .include "LDE13.s65"
                .include "LDE05.s65"
                .include "LE251.s65"
                .endif
                
LE1C9:
                bit LD8BC                    ; E1C9= 2C BC D8    ,<X
                bvs LE1CF                    ; E1CC= 70 01       p.
LE1CE:
                clv                          ; E1CE= B8          8
LE1CF:
                jmp ($022C)                  ; E1CF= 6C 2C 02    l,.

LE1D2:
                php                          ; E1D2= 08          .
                sei                          ; E1D3= 78          x
                lda $02CC,x                  ; E1D4= BD CC 02    =L.
                cmp $02D5,x                  ; E1D7= DD D5 02    ]U.
                beq LE24E                    ; E1DA= F0 72       pr
                tay                          ; E1DC= A8          (
                jsr LE1BE                    ; E1DD= 20 BE E1     >a
                lda ($FA),y                  ; E1E0= B1 FA       1z
                bvs LE1FE                    ; E1E2= 70 1A       p.
                pha                          ; E1E4= 48          H
                iny                          ; E1E5= C8          H
                tya                          ; E1E6= 98          .
                bne LE1EC                    ; E1E7= D0 03       P.
                lda LE1B5,x                  ; E1E9= BD B5 E1    =5a
LE1EC:
                sta $02CC,x                  ; E1EC= 9D CC 02    .L.
                cpx #$02                     ; E1EF= E0 02       `.
                bcc LE1FD                    ; E1F1= 90 0A       ..
                cmp $02D5,x                  ; E1F3= DD D5 02    ]U.
                bne LE1FD                    ; E1F6= D0 05       P.
                ldy #$00                     ; E1F8= A0 00        .
                jsr LE202                    ; E1FA= 20 02 E2     .b
LE1FD:
                pla                          ; E1FD= 68          h
LE1FE:
                tay                          ; E1FE= A8          (
                plp                          ; E1FF= 28          (
                clc                          ; E200= 18          .
                rts                          ; E201= 60          `

LE202:
                php                          ; E202= 08          .
                sei                          ; E203= 78          x
                pha                          ; E204= 48          H
                sta $FA                      ; E205= 85 FA       .z
                lda $02B5,y                  ; E207= B9 B5 02    95.
                beq LE24D                    ; E20A= F0 41       pA
                tya                          ; E20C= 98          .
                ldy $FA                      ; E20D= A4 FA       $z
                jsr LE7E2                    ; E20F= 20 E2 E7     bg
LE212:
                pla                          ; E212= 68          h
                plp                          ; E213= 28          (
                clc                          ; E214= 18          .
                rts                          ; E215= 60          `

LE216:
                tya                          ; E216= 98          .
                ldy #$02                     ; E217= A0 02        .
                jsr LE202                    ; E219= 20 02 E2     .b
                tay                          ; E21C= A8          (
LE21D:
                tya                          ; E21D= 98          .
LE21E:
                jmp ($022A)                  ; E21E= 6C 2A 02    l*.

LE221:
                php                          ; E221= 08          .
                sei                          ; E222= 78          x
                pha                          ; E223= 48          H
                ldy $02D5,x                  ; E224= BC D5 02    <U.
                iny                          ; E227= C8          H
                bne LE22D                    ; E228= D0 03       P.
                ldy LE1B5,x                  ; E22A= BC B5 E1    <5a
LE22D:
                tya                          ; E22D= 98          .
                cmp $02CC,x                  ; E22E= DD CC 02    ]L.
                beq LE242                    ; E231= F0 0F       p.
                ldy $02D5,x                  ; E233= BC D5 02    <U.
                sta $02D5,x                  ; E236= 9D D5 02    .U.
                jsr LE1BE                    ; E239= 20 BE E1     >a
                pla                          ; E23C= 68          h
                sta ($FA),y                  ; E23D= 91 FA       .z
                plp                          ; E23F= 28          (
                clc                          ; E240= 18          .
                rts                          ; E241= 60          `

LE242:
                pla                          ; E242= 68          h
                cpx #$02                     ; E243= E0 02       `.
                bcs LE24E                    ; E245= B0 07       0.
                ldy #$01                     ; E247= A0 01        .
                jsr LE202                    ; E249= 20 02 E2     .b
                pha                          ; E24C= 48          H
LE24D:
                pla                          ; E24D= 68          h
LE24E:
                plp                          ; E24E= 28          (
                sec                          ; E24F= 38          8
                rts                          ; E250= 60          `

                .if version==100
                .include "LE251.s65"
                .endif

LE25F:
                ldx #$00                     ; E25F= A2 00       ".
LE261:
                txa                          ; E261= 8A          .
                and $0245                    ; E262= 2D 45 02    -E.
                bne LE21D                    ; E265= D0 B6       P6
                tya                          ; E267= 98          .
                eor $026C                    ; E268= 4D 6C 02    Ml.
                ora $0275                    ; E26B= 0D 75 02    .u.
                bne LE216                    ; E26E= D0 A6       P&
                lda $0258                    ; E270= AD 58 02    -X.
                ror a                        ; E273= 6A          j
                tya                          ; E274= 98          .
                bcs LE281                    ; E275= B0 0A       0.
                ldy #$06                     ; E277= A0 06        .
                jsr LE202                    ; E279= 20 02 E2     .b
                bcc LE281                    ; E27C= 90 03       ..
                jsr LE480                    ; E27E= 20 80 E4     .d
LE281:
                clc                          ; E281= 18          .
                rts                          ; E282= 60          `

LE283:
                cmp #$A0                     ; E283= C9 A0       I
                bcc LE28C                    ; E285= 90 05       ..
                lda $0273                    ; E287= AD 73 02    -s.
                bcs LE28F                    ; E28A= B0 03       0.
LE28C:
                lda $0272                    ; E28C= AD 72 02    -r.
LE28F:
                beq LE2B2                    ; E28F= F0 21       p!
                lsr a                        ; E291= 4A          J
                bne LE2C5                    ; E292= D0 31       P1
                lda $F4                      ; E294= A5 F4       %t
                pha                          ; E296= 48          H
                lda $028C                    ; E297= AD 8C 02    -..
                bmi LE2B5                    ; E29A= 30 19       0.
                jsr LE3A0                    ; E29C= 20 A0 E3      c
                lda $8006                    ; E29F= AD 06 80    -..
                and #$10                     ; E2A2= 29 10       ).
                beq LE2B5                    ; E2A4= F0 0F       p.
                lda #$03                     ; E2A6= A9 03       ).
                jsr $8000                    ; E2A8= 20 00 80     ..
LE2AB:
                sty $025D                    ; E2AB= 8C 5D 02    .].
                pla                          ; E2AE= 68          h
                jsr LE3A0                    ; E2AF= 20 A0 E3      c
LE2B2:
                jmp LE333                    ; E2B2= 4C 33 E3    L3c

LE2B5:
                lda LEE89,y                  ; E2B5= B9 89 EE    9.n
                sta $025C                    ; E2B8= 8D 5C 02    .\.
                lda LEEA9,y                  ; E2BB= B9 A9 EE    9)n
                tay                          ; E2BE= A8          (
                bcs LE2AB                    ; E2BF= B0 EA       0j
LE2C1:
                ror a                        ; E2C1= 6A          j
                pla                          ; E2C2= 68          h
                bcs LE281                    ; E2C3= B0 BC       0<
LE2C5:
                tya                          ; E2C5= 98          .
                pha                          ; E2C6= 48          H
                lsr a                        ; E2C7= 4A          J
                lsr a                        ; E2C8= 4A          J
                lsr a                        ; E2C9= 4A          J
                lsr a                        ; E2CA= 4A          J
                eor #$04                     ; E2CB= 49 04       I.
                tay                          ; E2CD= A8          (
                lda $0265,y                  ; E2CE= B9 65 02    9e.
                cmp #$01                     ; E2D1= C9 01       I.
                beq LE353                    ; E2D3= F0 7E       p~
                pla                          ; E2D5= 68          h
                bcc LE2E5                    ; E2D6= 90 0D       ..
                and #$0F                     ; E2D8= 29 0F       ).
                clc                          ; E2DA= 18          .
                adc $0265,y                  ; E2DB= 79 65 02    ye.
                clc                          ; E2DE= 18          .
                rts                          ; E2DF= 60          `

LE2E0:
                jsr LE64B                    ; E2E0= 20 4B E6     Kf
                pla                          ; E2E3= 68          h
                tax                          ; E2E4= AA          *
LE2E5:
                jsr LE1CE                    ; E2E5= 20 CE E1     Na
                bcs LE350                    ; E2E8= B0 66       0f
                cpx #$01                     ; E2EA= E0 01       `.
                bne LE2F3                    ; E2EC= D0 05       P.
                ldy $0245                    ; E2EE= AC 45 02    ,E.
                bne LE34F                    ; E2F1= D0 5C       P\
LE2F3:
                tay                          ; E2F3= A8          (
                bpl LE34F                    ; E2F4= 10 59       .Y
                cmp #$90                     ; E2F6= C9 90       I.
                bcc LE2FE                    ; E2F8= 90 04       ..
                cmp #$B0                     ; E2FA= C9 B0       I0
                bcc LE283                    ; E2FC= 90 85       ..
LE2FE:
                and #$0F                     ; E2FE= 29 0F       ).
                cmp #$0B                     ; E300= C9 0B       I.
                bcc LE2C5                    ; E302= 90 C1       .A
                adc #$7B                     ; E304= 69 7B       i{
                pha                          ; E306= 48          H
                lda $027D                    ; E307= AD 7D 02    -}.
                bne LE2C1                    ; E30A= D0 B5       P5
                lda $027C                    ; E30C= AD 7C 02    -|.
                ror a                        ; E30F= 6A          j
                ror a                        ; E310= 6A          j
                pla                          ; E311= 68          h
                bcs LE2E5                    ; E312= B0 D1       0Q
                cmp #$87                     ; E314= C9 87       I.
                bne LE325                    ; E316= D0 0D       P.
                txa                          ; E318= 8A          .
                pha                          ; E319= 48          H
                jsr LD81B                    ; E31A= 20 1B D8     .X
                tay                          ; E31D= A8          (
                beq LE2E0                    ; E31E= F0 C0       p@
                pla                          ; E320= 68          h
                tax                          ; E321= AA          *
                tya                          ; E322= 98          .
                clc                          ; E323= 18          .
                rts                          ; E324= 60          `

LE325:
                tay                          ; E325= A8          (
                txa                          ; E326= 8A          .
                pha                          ; E327= 48          H
                tya                          ; E328= 98          .
                jsr LD7E5                    ; E329= 20 E5 D7     eW
                pla                          ; E32C= 68          h
                tax                          ; E32D= AA          *
LE32E:
                bit $025F                    ; E32E= 2C 5F 02    ,_.
                bmi LE393                    ; E331= 30 60       0`
LE333:
                txa                          ; E333= 8A          .
                and $0245                    ; E334= 2D 45 02    -E.
                bne LE2E5                    ; E337= D0 AC       P,
                lda $025D                    ; E339= AD 5D 02    -].
                bne LE365                    ; E33C= D0 27       P'
                lda $0268                    ; E33E= AD 68 02    -h.
                beq LE2E5                    ; E341= F0 A2       p"
                ldy $0279                    ; E343= AC 79 02    ,y.
                lda $0B01,y                  ; E346= B9 01 0B    9..
                inc $0279                    ; E349= EE 79 02    ny.
                dec $0268                    ; E34C= CE 68 02    Nh.
LE34F:
                clc                          ; E34F= 18          .
LE350:
                bcs LE398                    ; E350= B0 46       0F
                rts                          ; E352= 60          `

LE353:
                pla                          ; E353= 68          h
                and #$0F                     ; E354= 29 0F       ).
                tay                          ; E356= A8          (
                jsr LE116                    ; E357= 20 16 E1     .a
                sta $0268                    ; E35A= 8D 68 02    .h.
                lda $0B00,y                  ; E35D= B9 00 0B    9..
                sta $0279                    ; E360= 8D 79 02    .y.
                bne LE32E                    ; E363= D0 C9       PI
LE365:
                tax                          ; E365= AA          *
                lda $F4                      ; E366= A5 F4       %t
                pha                          ; E368= 48          H
                lda $028C                    ; E369= AD 8C 02    -..
                bmi LE387                    ; E36C= 30 19       0.
                jsr LE3A0                    ; E36E= 20 A0 E3      c
                lda $8006                    ; E371= AD 06 80    -..
                and #$10                     ; E374= 29 10       ).
                beq LE387                    ; E376= F0 0F       p.
                lda #$02                     ; E378= A9 02       ).
                jsr $8000                    ; E37A= 20 00 80     ..
LE37D:
                dec $025D                    ; E37D= CE 5D 02    N].
                pla                          ; E380= 68          h
                jsr LE3A0                    ; E381= 20 A0 E3      c
                tya                          ; E384= 98          .
                clc                          ; E385= 18          .
                rts                          ; E386= 60          `

LE387:
                ldy $025C                    ; E387= AC 5C 02    ,\.
                lda LEF59,y                  ; E38A= B9 59 EF    9Yo
                tay                          ; E38D= A8          (
                inc $025C                    ; E38E= EE 5C 02    n\.
                bne LE37D                    ; E391= D0 EA       Pj
LE393:
                lda #$06                     ; E393= A9 06       ).
LE395:
                jmp ($0224)                  ; E395= 6C 24 02    l$.

LE398:
                pha                          ; E398= 48          H
                jsr LE950                    ; E399= 20 50 E9     Pi
LE39C:
                pla                          ; E39C= 68          h
                sec                          ; E39D= 38          8
                rts                          ; E39E= 60          `

; Select ROM in X
; ---------------
LE39F:
                txa                          ; E39F= 8A          .

; Select ROM in A
; ---------------
LE3A0:
                sta $F4                      ; E3A0= 85 F4       .t
                jsr LE3A9                    ; E3A2= 20 A9 E3     )c
                sta LFE05                    ; E3A5= 8D 05 FE    ..~
                rts                          ; E3A8= 60          `

LE3A9:
                pha                          ; E3A9= 48          H
                lda #$0C                     ; E3AA= A9 0C       ).
                sta LFE05                    ; E3AC= 8D 05 FE    ..~
                pla                          ; E3AF= 68          h
                rts                          ; E3B0= 60          `

; OSBYTE/OSWORD dispatch table
; ============================
LE3B1:
                .word LE5F2
                .word LE780
                .word LE532
                .word LE78F
                .word LE78F
                .word LE767
                .word LE780
                .word LE538
                .word LE538
                .word LE49C
                .word LE49E
                .word LE78D
                .word LE784
                .word LE4C2
                .word LE4C3
                .word LDEE8
                .word LE538
                .word LE538
                .word LE7C0
                .word LE7AE
                .word LCC5E
                .word LDEF4
                .word LE464 ; &16 - Increment ROM polling semaphore
                .word LEF14 ; &17 - Decrement ROM polling semaphore
                .word LE538 ; &18 - Select external sound system
                .word LCC07 ; &73 - Reset palette
                .word LE976 ; &74 - Reset sound system
                .word LE648 ; &75 - Read VDU status byte
                .word LE7D1 ; &76 -
                .word LDFE3 ; &77 -
                .word LF010 ; &78 - Write keys pressed
                .word LEC51 ; &79 -
                .word LEC4F ; &7A - Keyboard scan from &10
                .word LDEE4 ; &7B - Printer going idle
                .word LE47F ; &7C - Set Escape state
                .word LE480 ; &7D - Clear Escape state
                .word LE468 ; &7E - Acknowledge Escape state
                .word LDDBE ; &7F - Read EOF
                .word LE511 ; &80 - ADVAL
                .word LE4D0 ; &81 - INKEY
                .word LE4EB ; &82 - Read memory high word
                .word LEFDD ; &83 - Read bottom of user memory
                .word LD834 ; &84 - Read top of user memory
                .word LD837 ; &85 - Read top of user memory for specified MODE
                .word LD55D
                .word LD711
                .word LE45F
                .word LE48A
                .word LE21D
                .word LDDBD
                .word LE7A5
                .word LE7A5
                .word LDAB1
                .word LF0A8
                .word LE889
                .word LE1CE
                .word LE88F
                .word LE88A
                .word LFFA8
                .word LFFA3
                .word LF032
                .word LE885
                .word LE1C9
                .word LE261
                .word LEEE8
                .word LFFA2
                .word LE538
                .word LFFB3
                .word LE538
                .word LE538
                .word LE7B8
                .word LE794
                .word LE461
                .word LE6F3
                .word LE6C6
                .word LE6D9
                .word LE6C2
                .word LE6D5
                .word LE5D4
                .word LE5DC
                .word LE5FE
                .word LE67F
                .word LC6AD
                .word LCC40
                .word LC6E5
                .word LC89D
                .word LD4E4
LE45F:
                lda #$00
LE461:
                jmp ($0200)

; OSBYTE xx - Increment ROM polling semaphore
; -------------------------------------------
LE464:
                inc $0249                    ; E464= EE 49 02    nI.
LE467:
                rts                          ; E467= 60          `

; OSBYTE &7E - Acknowledge Escape state
; -------------------------------------
LE468:
                ldx #$00                     ; X=0 for no pending Escape
                bit $FF                      ; If no pending, tell Tube and return
                bpl LE47F
                lda $0276                    ; Check Escape effects, skip if disabled
                bne LE47D
                cli                          ; Enable IRQs
                sta $0269                    ; Clear paged line counter
                jsr LF5EA                    ; Close any open EXEC file
                jsr LDEEA                    ; Flush all buffers
LE47D:
                ldx #$FF                     ; X=&FF for Escape was pending

; OSBYTE &7C - Clear Escape state
; -------------------------------
LE47F:
                clc                          ; CLC to clear Escape state

; OSBYTE &7D - Set Escape state
; -----------------------------
LE480:
                ror $FF                      ; Rotate into Escape flag
                bit $027A                    ; If no Tube, return
                bpl LE467
                jmp $0403                    ; Inform Tube and return

LE48A:
                lda $0282                    ; E48A= AD 82 02    -..
                and #$BF                     ; E48D= 29 BF       )?
                cpx #$00                     ; E48F= E0 00       `.
                beq LE495                    ; E491= F0 02       p.
                ora #$40                     ; E493= 09 40       .@
LE495:
                sta $0282                    ; E495= 8D 82 02    ...
                sta LFE07                    ; E498= 8D 07 FE    ..~
                rts                          ; E49B= 60          `

LE49C:
                iny                          ; E49C= C8          H
                clc                          ; E49D= 18          .
LE49E:
                lda $0252,y                  ; E49E= B9 52 02    9R.
                pha                          ; E4A1= 48          H
                txa                          ; E4A2= 8A          .
                sta $0252,y                  ; E4A3= 99 52 02    .R.
                pla                          ; E4A6= 68          h
                tay                          ; E4A7= A8          (
                lda $0251                    ; E4A8= AD 51 02    -Q.
                bne LE4C0                    ; E4AB= D0 13       P.
                stx $0251                    ; E4AD= 8E 51 02    .Q.
                lda #$00                     ; E4B0= A9 00       ).
                bcc LE4B6                    ; E4B2= 90 02       ..
                lda #$07                     ; E4B4= A9 07       ).
LE4B6:
                sta $0248                    ; E4B6= 8D 48 02    .H.
                tya                          ; E4B9= 98          .
                pha                          ; E4BA= 48          H
                jsr LC8A3                    ; E4BB= 20 A3 C8     #H
                pla                          ; E4BE= 68          h
                tay                          ; E4BF= A8          (
LE4C0:
                bvc LE4CD                    ; E4C0= 50 0B       P.
LE4C2:
                tya                          ; E4C2= 98          .
LE4C3:
                cpx #$0A                     ; E4C3= E0 0A       `.
                bcs LE4CE                    ; E4C5= B0 07       0.
                ldy $02B5,x                  ; E4C7= BC B5 02    <5.
                sta $02B5,x                  ; E4CA= 9D B5 02    .5.
LE4CD:
                tya                          ; E4CD= 98          .
LE4CE:
                tax                          ; E4CE= AA          *
                rts                          ; E4CF= 60          `

; OSBYTE &81 - INKEY
; ==================
LE4D0:
                tya                          ; E4D0= 98          .
                bmi LE4DE                    ; E4D1= 30 0B       0.
                cli                          ; E4D3= 58          X
                jsr LDC46                    ; E4D4= 20 46 DC     F\
                bcs LE4DC                    ; E4D7= B0 03       0.
                tax                          ; E4D9= AA          *
LE4DA:
                lda #$00                     ; E4DA= A9 00       ).
LE4DC:
                tay                          ; E4DC= A8          (
                rts                          ; E4DD= 60          `

; Negative INKEY
; --------------
LE4DE:
                txa                          ; Check low nybble of INKEY number
                and #$0F
                beq LE4F4                    ; INKEY -&x0 passed to sideways ROMs
;                 :\ Would be better as AND #&0F, CMP #&05, BCC LE4F4
                txa                          ; Toggle to convert to keyscan number
                eor #$7F
                tax
                jsr LEC4C                    ; Scan for key or keys
                rol a                        ; Move &00/&80 keypress to Carry

; OSBYTE &82 - Read address high word
; -----------------------------------
LE4EB:
                ldx #$FF                     ; Prepare XY=&FFFF for pressed
                ldy #$FF
                bcs LE4F3                    ; Return XY=&FFFF if pressed
                inx                          ; Return XY=&0000 for not pressed
                iny
LE4F3:
                rts

LE4F4:
                txa                          ; INKEY-256, jump to return MOS type
                beq LE4FE
                jsr LE538                    ; If INKEY -&x0, pass to sideways ROMs
                clc                          ; If not claimed, jump to return &0000
                bne LE4EB
                rts                          ; Otherwise, return result from ROM call

LE4FE:
                ldx #$01                     ; INKEY-256 returns &0001
                bne LE4DA

LE502:
                txa                          ; Toggle X to convert to buffer number
                eor #$FF
                tax
                cpx #$02                     ; CC=input, read used; CS=output, read free
                clv                          ; VC=read size, jump to CNTV
                bvc LE50E
LE50B:
                bit LD8BC                    ; Set V
LE50E:
                jmp ($022E)                  ; CNTV, examine buffer status

; OSBYTE &80 - ADVAL
; ------------------
LE511:
                bmi LE502                    ; Negative ADVAL - read buffer status
                beq LE522                    ; ADVAL(0)
                jsr LE538                    ; Positive ADVAL - pass to sideways ROMs
                beq LE521                    ; If claimed, return the result
                ldy $02FB,x                  ; Otherwise, get from workspace updated in background
                lda $02F7,x                  ;
                tax
LE521:
                rts

; ADVAL(0)
; --------
LE522:
                jsr LE538                    ; Pass to sideways ROMs
                beq LE529                    ; If claimed, return result from X, buttons pressed
                ldx #$00                     ; Otherwise, X=0
LE529:
                ldy $02F7                    ; Get Y from workspace, last channel converted
                lda #$00                     ; And clear it
                sta $02F7
                rts

LE532:
                txa                          ; E532= 8A          .
                ora $0241                    ; E533= 0D 41 02    .A.
                beq LE4F3                    ; E536= F0 BB       p;

; Pass on unsupported call as Unknown OSBYTE service call
; -------------------------------------------------------
; Eg, unknown SOUND, ADVAL, INKEY, etc.
LE538:
                ldx #$07                     ; E538= A2 07       ".
                jsr LF0A8                    ; E53A= 20 A8 F0     (p
                ldx $F0                      ; E53D= A6 F0       &p
                ldy $F1                      ; E53F= A4 F1       $q
                eor #$00                     ; E541= 49 00       I.
                rts                          ; E543= 60          `

; OSBYTE handler
; ==============
LE544:
                pha                          ; E544= 48          H
                php                          ; E545= 08          .
                sei                          ; E546= 78          x
                sta $EF                      ; E547= 85 EF       .o
                stx $F0                      ; E549= 86 F0       .p
                sty $F1                      ; E54B= 84 F1       .q
                ldx #$07                     ; E54D= A2 07       ".
                cmp #$73                     ; E54F= C9 73       Is
                bcc LE593                    ; E551= 90 40       .@
                cmp #$A1                     ; E553= C9 A1       I!
                bcc LE560                    ; E555= 90 09       ..
                cmp #$A6                     ; E557= C9 A6       I&
                bcc LE599                    ; E559= 90 3E       .>
                clc                          ; E55B= 18          .
LE55C:
                lda #$A1                     ; E55C= A9 A1       )!
                adc #$00                     ; E55E= 69 00       i.
LE560:
                sbc #$59                     ; E560= E9 59       iY
LE562:
                asl a                        ; E562= 0A          .
                sec                          ; E563= 38          8
LE564:
                sty $F1                      ; E564= 84 F1       .q
                tay                          ; E566= A8          (
                bit $025E                    ; E567= 2C 5E 02    ,^.
                bpl LE573                    ; E56A= 10 07       ..
                txa                          ; E56C= 8A          .
                clv                          ; E56D= B8          8
                jsr LE395                    ; E56E= 20 95 E3     .c
                bvs LE58D                    ; E571= 70 1A       p.
LE573:
                lda LE3B1+1,y                  ; E573= B9 B2 E3    92c
                sta $FB                      ; E576= 85 FB       .{
                lda LE3B1,y                  ; E578= B9 B1 E3    91c
                sta $FA                      ; E57B= 85 FA       .z
                lda $EF                      ; E57D= A5 EF       %o
                ldy $F1                      ; E57F= A4 F1       $q
                bcs LE587                    ; E581= B0 04       0.
                ldy #$00                     ; E583= A0 00        .
                lda ($F0),y                  ; E585= B1 F0       1p
LE587:
                sec                          ; E587= 38          8
                ldx $F0                      ; E588= A6 F0       &p
                jsr LEEBF                    ; E58A= 20 BF EE     ?n
LE58D:
                ror a                        ; E58D= 6A          j
                plp                          ; E58E= 28          (
                rol a                        ; E58F= 2A          *
                pla                          ; E590= 68          h
                clv                          ; E591= B8          8
                rts                          ; E592= 60          `

LE593:
                ldy #$00                     ; E593= A0 00        .
                cmp #$19                     ; E595= C9 19       I.
                bcc LE562                    ; E597= 90 C9       .I
LE599:
                php                          ; E599= 08          .
                php                          ; E59A= 08          .
LE59B:
                pla                          ; E59B= 68          h
                pla                          ; E59C= 68          h
                jsr LF0A8                    ; E59D= 20 A8 F0     (p
                bne LE5A7                    ; E5A0= D0 05       P.
                ldx $F0                      ; E5A2= A6 F0       &p
                jmp LE58D                    ; E5A4= 4C 8D E5    L.e

LE5A7:
                plp                          ; E5A7= 28          (
                pla                          ; E5A8= 68          h
                bit LD8BC                    ; E5A9= 2C BC D8    ,<X
                rts                          ; E5AC= 60          `

LE5AD:
                lda $EB                      ; E5AD= A5 EB       %k
                bmi LE5E3                    ; E5AF= 30 32       02
                lda #$08                     ; E5B1= A9 08       ).
                and $E2                      ; E5B3= 25 E2       %b
                bne LE5BB                    ; E5B5= D0 04       P.
                lda #$88                     ; E5B7= A9 88       ).
                and $BB                      ; E5B9= 25 BB       %;
LE5BB:
                rts                          ; E5BB= 60          `

; OSWORD handler
; ==============
LE5BC:
                pha                          ; E5BC= 48          H
                php                          ; E5BD= 08          .
                sei                          ; E5BE= 78          x
                sta $EF                      ; E5BF= 85 EF       .o
                stx $F0                      ; E5C1= 86 F0       .p
                sty $F1                      ; E5C3= 84 F1       .q
                ldx #$08                     ; E5C5= A2 08       ".
                cmp #$E0                     ; E5C7= C9 E0       I`
                bcs LE55C                    ; E5C9= B0 91       0.
                cmp #$0E                     ; E5CB= C9 0E       I.
                bcs LE599                    ; E5CD= B0 CA       0J
                adc #$49                     ; E5CF= 69 49       iI
                asl a                        ; E5D1= 0A          .
                bcc LE564                    ; E5D2= 90 90       ..

LE5D4:
                jsr LE5E6                    ; E5D4= 20 E6 E5     fe
                lda ($FA,x)                  ; E5D7= A1 FA       !z
                sta ($F0),y                  ; E5D9= 91 F0       .p
                rts                          ; E5DB= 60          `

LE5DC:
                jsr LE5E6                    ; E5DC= 20 E6 E5     fe
                lda ($F0),y                  ; E5DF= B1 F0       1p
                sta ($FA,x)                  ; E5E1= 81 FA       .z
LE5E3:
                lda #$00                     ; E5E3= A9 00       ).
                rts                          ; E5E5= 60          `

LE5E6:
                sta $FA                      ; E5E6= 85 FA       .z
                iny                          ; E5E8= C8          H
                lda ($F0),y                  ; E5E9= B1 F0       1p
                sta $FB                      ; E5EB= 85 FB       .{
                ldy #$04                     ; E5ED= A0 04        .
LE5EF:
                ldx #$00
                rts

; OSBYTE &00 - Read host
; ======================
LE5F2:
                bne LE5EF                    ; If X<>0, jump to return X=0
                brk
                .byte $F7
                .if version==300
                .text "OS 3.00"
                .else
                .text "OS 1.00"
                .endif
                brk

LE5FE:
                lda $0262                    ; E5FE= AD 62 02    -b.
                bne LE64A                    ; E601= D0 47       PG
                lda $026B                    ; E603= AD 6B 02    -k.
                bne LE60D                    ; E606= D0 05       P.
                iny                          ; E608= C8          H
                lda ($F0),y                  ; E609= B1 F0       1p
                cmp #$20                     ; E60B= C9 20       I
LE60D:
                ldx #$08                     ; E60D= A2 08       ".
                bcs LE59B                    ; E60F= B0 8A       0.
                dey                          ; E611= 88          .
                lda ($F0),y                  ; E612= B1 F0       1p
                jsr LE6A4                    ; E614= 20 A4 E6     $f
                jsr LE6BA                    ; E617= 20 BA E6     :f
                ora #$04                     ; E61A= 09 04       ..
                tax                          ; E61C= AA          *
                bcc LE624                    ; E61D= 90 05       ..
                jsr LDF0A                    ; E61F= 20 0A DF     ._
                ldy #$01                     ; E622= A0 01        .
LE624:
                jsr LE6BA                    ; E624= 20 BA E6     :f
                sta $FA                      ; E627= 85 FA       .z
                php                          ; E629= 08          .
                ldy #$06                     ; E62A= A0 06        .
                lda ($F0),y                  ; E62C= B1 F0       1p
                pha                          ; E62E= 48          H
                ldy #$04                     ; E62F= A0 04        .
                lda ($F0),y                  ; E631= B1 F0       1p
                pha                          ; E633= 48          H
                ldy #$02                     ; E634= A0 02        .
                lda ($F0),y                  ; E636= B1 F0       1p
                rol a                        ; E638= 2A          *
                sec                          ; E639= 38          8
                sbc #$02                     ; E63A= E9 02       i.
                asl a                        ; E63C= 0A          .
                asl a                        ; E63D= 0A          .
                ora $FA                      ; E63E= 05 FA       .z
                jsr LDF68                    ; E640= 20 68 DF     h_
                bcc LE671                    ; E643= 90 2C       .,
                pla                          ; E645= 68          h
                pla                          ; E646= 68          h
                plp                          ; E647= 28          (

; OSBYTE &75 - Read VDU status byte
; ---------------------------------
LE648:
                ldx $D0                      ; E648= A6 D0       &P
LE64A:
                rts                          ; E64A= 60          `

LE64B:
                lda $0262                    ; E64B= AD 62 02    -b.
                bne LE64A                    ; E64E= D0 FA       Pz
                lda $026B                    ; E650= AD 6B 02    -k.
                beq LE65A                    ; E653= F0 05       p.
                ldx #$16                     ; E655= A2 16       ".
                jmp LF0A8                    ; E657= 4C A8 F0    L(p

LE65A:
                php                          ; E65A= 08          .
                sei                          ; E65B= 78          x
                lda $0263                    ; E65C= AD 63 02    -c.
                jsr LE6A4                    ; E65F= 20 A4 E6     $f
                tax                          ; E662= AA          *
                lda $0264                    ; E663= AD 64 02    -d.
                jsr LE21E                    ; E666= 20 1E E2     .b
                lda $0266                    ; E669= AD 66 02    -f.
                pha                          ; E66C= 48          H
                lda $0265                    ; E66D= AD 65 02    -e.
                pha                          ; E670= 48          H
LE671:
                sec                          ; E671= 38          8
                ror $0814                    ; E672= 6E 14 08    n..
                pla                          ; E675= 68          h
                jsr LE21E                    ; E676= 20 1E E2     .b
                pla                          ; E679= 68          h
                jsr LE21E                    ; E67A= 20 1E E2     .b
                plp                          ; E67D= 28          (
                rts                          ; E67E= 60          `

LE67F:
                ldx $0262                    ; E67F= AE 62 02    .b.
                bne LE64A                    ; E682= D0 C6       PF
                ldx $026B                    ; E684= AE 6B 02    .k.
                bne LE60D                    ; E687= D0 84       P.
                sbc #$01                     ; E689= E9 01       i.
                asl a                        ; E68B= 0A          .
                asl a                        ; E68C= 0A          .
                asl a                        ; E68D= 0A          .
                asl a                        ; E68E= 0A          .
                ora #$0F                     ; E68F= 09 0F       ..
                tax                          ; E691= AA          *
                lda #$00                     ; E692= A9 00       ).
                ldy #$10                     ; E694= A0 10        .
LE696:
                cpy #$0E                     ; E696= C0 0E       @.
                bcs LE69C                    ; E698= B0 02       0.
                lda ($F0),y                  ; E69A= B1 F0       1p
LE69C:
                sta $08C0,x                  ; E69C= 9D C0 08    .@.
                dex                          ; E69F= CA          J
                dey                          ; E6A0= 88          .
                bne LE696                    ; E6A1= D0 F3       Ps
                rts                          ; E6A3= 60          `

LE6A4:
                and #$03                     ; E6A4= 29 03       ).
                ora #$04                     ; E6A6= 09 04       ..
                cmp $0825                    ; E6A8= CD 25 08    M%.
                beq LE6B9                    ; E6AB= F0 0C       p.
                pha                          ; E6AD= 48          H
                clc                          ; E6AE= 18          .
                ldx $0825                    ; E6AF= AE 25 08    .%.
                sta $0825                    ; E6B2= 8D 25 08    .%.
                jsr LDF0A                    ; E6B5= 20 0A DF     ._
                pla                          ; E6B8= 68          h
LE6B9:
                rts                          ; E6B9= 60          `

LE6BA:
                lda ($F0),y                  ; E6BA= B1 F0       1p
                cmp #$10                     ; E6BC= C9 10       I.
                and #$03                     ; E6BE= 29 03       ).
                iny                          ; E6C0= C8          H
                rts                          ; E6C1= 60          `

LE6C2:
                ldx #$0F                     ; E6C2= A2 0F       ".
                bne LE6C9                    ; E6C4= D0 03       P.
LE6C6:
                ldx $0283                    ; E6C6= AE 83 02    ...
LE6C9:
                ldy #$04                     ; E6C9= A0 04        .
LE6CB:
                lda $028C,x                  ; E6CB= BD 8C 02    =..
                sta ($F0),y                  ; E6CE= 91 F0       .p
                inx                          ; E6D0= E8          h
                dey                          ; E6D1= 88          .
                bpl LE6CB                    ; E6D2= 10 F7       .w
LE6D4:
                rts                          ; E6D4= 60          `

LE6D5:
                lda #$0F                     ; E6D5= A9 0F       ).
                bne LE6DF                    ; E6D7= D0 06       P.
LE6D9:
                lda $0283                    ; E6D9= AD 83 02    -..
                eor #$0F                     ; E6DC= 49 0F       I.
                clc                          ; E6DE= 18          .
LE6DF:
                pha                          ; E6DF= 48          H
                tax                          ; E6E0= AA          *
                ldy #$04                     ; E6E1= A0 04        .
LE6E3:
                lda ($F0),y                  ; E6E3= B1 F0       1p
                sta $028C,x                  ; E6E5= 9D 8C 02    ...
                inx                          ; E6E8= E8          h
                dey                          ; E6E9= 88          .
                bpl LE6E3                    ; E6EA= 10 F7       .w
                pla                          ; E6EC= 68          h
                bcs LE6D4                    ; E6ED= B0 E5       0e
                sta $0283                    ; E6EF= 8D 83 02    ...
                rts                          ; E6F2= 60          `

LE6F3:
                ldy #$04                     ; E6F3= A0 04        .
LE6F5:
                lda ($F0),y                  ; E6F5= B1 F0       1p
                sta $02B0,y                  ; E6F7= 99 B0 02    .0.
                dey                          ; E6FA= 88          .
                cpy #$02                     ; E6FB= C0 02       @.
                bcs LE6F5                    ; E6FD= B0 F6       0v
                lda ($F0),y                  ; E6FF= B1 F0       1p
                sta $E9                      ; E701= 85 E9       .i
                dey                          ; E703= 88          .
                sty $0269                    ; E704= 8C 69 02    .i.
                lda ($F0),y                  ; E707= B1 F0       1p
                sta $E8                      ; E709= 85 E8       .h
                cli                          ; E70B= 58          X
                bcc LE715                    ; E70C= 90 07       ..
LE70E:
                lda #$07                     ; E70E= A9 07       ).
                dey                          ; E710= 88          .
LE711:
                iny                          ; E711= C8          H
LE712:
                jsr OSWRCH                   ; E712= 20 EE FF     n.
LE715:
                jsr OSRDCH                   ; E715= 20 E0 FF     `.
                bcs LE763                    ; E718= B0 49       0I
                tax                          ; E71A= AA          *
                lda $027C                    ; E71B= AD 7C 02    -|.
                ror a                        ; E71E= 6A          j
                ror a                        ; E71F= 6A          j
                txa                          ; E720= 8A          .
                bcs LE728                    ; E721= B0 05       0.
                ldx $026A                    ; E723= AE 6A 02    .j.
                bne LE712                    ; E726= D0 EA       Pj
LE728:
                cmp #$7F                     ; E728= C9 7F       I.
                bne LE733                    ; E72A= D0 07       P.
                cpy #$00                     ; E72C= C0 00       @.
                beq LE715                    ; E72E= F0 E5       pe
                dey                          ; E730= 88          .
                bcs LE712                    ; E731= B0 DF       0_
LE733:
                cmp #$15                     ; E733= C9 15       I.
                bne LE744                    ; E735= D0 0D       P.
                tya                          ; E737= 98          .
                beq LE715                    ; E738= F0 DB       p[
                lda #$7F                     ; E73A= A9 7F       ).
LE73C:
                jsr OSWRCH                   ; E73C= 20 EE FF     n.
                dey                          ; E73F= 88          .
                bne LE73C                    ; E740= D0 FA       Pz
                beq LE715                    ; E742= F0 D1       pQ
LE744:
                sta ($E8),y                  ; E744= 91 E8       .h
                cmp #$0D                     ; E746= C9 0D       I.
                beq LE75D                    ; E748= F0 13       p.
                cpy $02B2                    ; E74A= CC B2 02    L2.
                bcs LE70E                    ; E74D= B0 BF       0?
                cmp $02B3                    ; E74F= CD B3 02    M3.
                bcc LE712                    ; E752= 90 BE       .>
                cmp $02B4                    ; E754= CD B4 02    M4.
                beq LE711                    ; E757= F0 B8       p8
                bcc LE711                    ; E759= 90 B6       .6
                bcs LE712                    ; E75B= B0 B5       05
LE75D:
                jsr OSNEWL                   ; E75D= 20 E7 FF     g.
                jsr LE395                    ; E760= 20 95 E3     .c
LE763:
                lda $FF                      ; E763= A5 FF       %.
                rol a                        ; E765= 2A          *
                rts                          ; E766= 60          `

                .if version==300
                .include "oscli.s65"

LE756_300:
                sta ($da),y
                rts

LE759_300:
                lda ($dc),y
                rts

LE75C_300:
                lda ($f0),y
                rts

LE75F_300:
                sta ($f0),y
                rts

LE762_300:
                lda ($f2),y
                rts

LE765_300:
                lda ($fd),y
                rts

LE768_300:
                ldx #$04
                stx $01
                lda #$00
                sta $00
                tay
LE771_300:
                sta ($00),y
                iny
                bne LE771_300
                iny
                inc $01
                bpl LE771_300
                rts
                .endif

LE767:
                cli                          ; E767= 58          X
                sei                          ; E768= 78          x
                bit $FF                      ; E769= 24 FF       $.
                bmi LE7A4                    ; E76B= 30 37       07
                bit $02C6                    ; E76D= 2C C6 02    ,F.
                bpl LE767                    ; E770= 10 F5       .u
                jsr LDEFD                    ; E772= 20 FD DE     }^
                ldy #$00                     ; E775= A0 00        .
                sty $F1                      ; E777= 84 F1       .q
                stx $F0                      ; E779= 86 F0       .p
                jsr LE538                    ; E77B= 20 38 E5     8e
                lda #$05                     ; E77E= A9 05       ).
LE780:
                ora #$F0                     ; E780= 09 F0       .p
                bne LE792                    ; E782= D0 0E       P.
LE784:
                bne LE78D                    ; E784= D0 07       P.
                ldx #$32                     ; E786= A2 32       "2
                stx $0254                    ; E788= 8E 54 02    .T.
                ldx #$08                     ; E78B= A2 08       ".
LE78D:
                adc #$CF                     ; E78D= 69 CF       iO
LE78F:
                clc                          ; E78F= 18          .
                adc #$E9                     ; E790= 69 E9       ii
LE792:
                stx $F0                      ; E792= 86 F0       .p
LE794:
                tay                          ; E794= A8          (
                lda $0190,y                  ; E795= B9 90 01    9..
                tax                          ; E798= AA          *
                and $F1                      ; E799= 25 F1       %q
                eor $F0                      ; E79B= 45 F0       Ep
                sta $0190,y                  ; E79D= 99 90 01    ...
                lda $0191,y                  ; E7A0= B9 91 01    9..
                tay                          ; E7A3= A8          (
LE7A4:
                rts                          ; E7A4= 60          `

LE7A5:
                eor #$8C                     ; E7A5= 49 8C       I.
LE7A7:
                asl a                        ; E7A7= 0A          .
                sta $0247                    ; E7A8= 8D 47 02    .G.
                jmp LF094                    ; E7AB= 4C 94 F0    L.p

LE7AE:
                lda $0240                    ; E7AE= AD 40 02    -@.
LE7B1:
                cli                          ; E7B1= 58          X
                sei                          ; E7B2= 78          x
                cmp $0240                    ; E7B3= CD 40 02    M@.
                beq LE7B1                    ; E7B6= F0 F9       py
LE7B8:
                ldy $0301,x                  ; E7B8= BC 01 03    <..
                lda $0300,x                  ; E7BB= BD 00 03    =..
                tax                          ; E7BE= AA          *
                rts                          ; E7BF= 60          `

LE7C0:
                lda #$10                     ; E7C0= A9 10       ).
                sta $0284                    ; E7C2= 8D 84 02    ...
                ldx #$00                     ; E7C5= A2 00       ".
LE7C7:
                sta $0B00,x                  ; E7C7= 9D 00 0B    ...
                inx                          ; E7CA= E8          h
                bne LE7C7                    ; E7CB= D0 FA       Pz
                stx $0284                    ; E7CD= 8E 84 02    ...
                rts                          ; E7D0= 60          `

LE7D1:
                php                          ; E7D1= 08          .
                sei                          ; E7D2= 78          x
                lda #$40                     ; E7D3= A9 40       )@
                jsr LE7E5                    ; E7D5= 20 E5 E7     eg
                bmi LE7DF                    ; E7D8= 30 05       0.
                clc                          ; E7DA= 18          .
                clv                          ; E7DB= B8          8
                jsr LEC4C                    ; E7DC= 20 4C EC     Ll
LE7DF:
                plp                          ; E7DF= 28          (
                rol a                        ; E7E0= 2A          *
                rts                          ; E7E1= 60          `

LE7E2:
                jmp ($0220)                  ; E7E2= 6C 20 02    l .

LE7E5:
                bcc LE7F9                    ; E7E5= 90 12       ..
                pha                          ; E7E7= 48          H
                lda $0282                    ; E7E8= AD 82 02    -..
                ora #$80                     ; E7EB= 09 80       ..
                sta LFE07                    ; E7ED= 8D 07 FE    ..~
                and #$7F                     ; E7F0= 29 7F       ).
                .if version==300
                jsr LE3C1_300
                .else
                sta $0282                    ; E7F2= 8D 82 02    ...
                sta LFE07                    ; E7F5= 8D 07 FE    ..~
                .endif
                pla                          ; E7F8= 68          h
LE7F9:
                bit $FF                      ; E7F9= 24 FF       $.
                rts                          ; E7FB= 60          `

LE7FC:
                clc                          ; E7FC= 18          .
LE7FD:
                ror $E4                      ; E7FD= 66 E4       fd
                jsr LDDC3                    ; E7FF= 20 C3 DD     C]
                iny                          ; E802= C8          H
                cmp #$22                     ; E803= C9 22       I"
                beq LE809                    ; E805= F0 02       p.
                dey                          ; E807= 88          .
                clc                          ; E808= 18          .
LE809:
                ror $E4                      ; E809= 66 E4       fd
                cmp #$0D                     ; E80B= C9 0D       I.
                rts                          ; E80D= 60          `

LE80E:
                lda #$00                     ; E80E= A9 00       ).
LE810:
                sta $E5                      ; E810= 85 E5       .e
                lda ($F2),y                  ; E812= B1 F2       1r
                cmp #$0D                     ; E814= C9 0D       I.
                bne LE81E                    ; E816= D0 06       P.
                bit $E4                      ; E818= 24 E4       $d
                bmi LE86E                    ; E81A= 30 52       0R
                bpl LE839                    ; E81C= 10 1B       ..
LE81E:
                cmp #$20                     ; E81E= C9 20       I
                bcc LE86E                    ; E820= 90 4C       .L
                bne LE82A                    ; E822= D0 06       P.
                bit $E4                      ; E824= 24 E4       $d
                bmi LE868                    ; E826= 30 40       0@
                bvc LE839                    ; E828= 50 0F       P.
LE82A:
                cmp #$22                     ; E82A= C9 22       I"
                bne LE83E                    ; E82C= D0 10       P.
                bit $E4                      ; E82E= 24 E4       $d
                bpl LE868                    ; E830= 10 36       .6
                iny                          ; E832= C8          H
                lda ($F2),y                  ; E833= B1 F2       1r
                cmp #$22                     ; E835= C9 22       I"
                beq LE868                    ; E837= F0 2F       p/
LE839:
                jsr LDDC3                    ; E839= 20 C3 DD     C]
                sec                          ; E83C= 38          8
                rts                          ; E83D= 60          `

LE83E:
                cmp #$7C                     ; E83E= C9 7C       I|
                bne LE868                    ; E840= D0 26       P&
                iny                          ; E842= C8          H
                lda ($F2),y                  ; E843= B1 F2       1r
                cmp #$7C                     ; E845= C9 7C       I|
                beq LE868                    ; E847= F0 1F       p.
                cmp #$22                     ; E849= C9 22       I"
                beq LE868                    ; E84B= F0 1B       p.
                cmp #$21                     ; E84D= C9 21       I!
                bne LE856                    ; E84F= D0 05       P.
                iny                          ; E851= C8          H
                lda #$80                     ; E852= A9 80       ).
                bne LE810                    ; E854= D0 BA       P:
LE856:
                cmp #$20                     ; E856= C9 20       I
                bcc LE86E                    ; E858= 90 14       ..
                cmp #$3F                     ; E85A= C9 3F       I?
                beq LE866                    ; E85C= F0 08       p.
                jsr LEFF3                    ; E85E= 20 F3 EF     so
                bit LD8BC                    ; E861= 2C BC D8    ,<X
                bvs LE869                    ; E864= 70 03       p.
LE866:
                lda #$7F                     ; E866= A9 7F       ).
LE868:
                clv                          ; E868= B8          8
LE869:
                iny                          ; E869= C8          H
                ora $E5                      ; E86A= 05 E5       .e
                clc                          ; E86C= 18          .
                rts                          ; E86D= 60          `

LE86E:
                brk                          ; E86E= 00          .
                ; sbc $6142,x                  ; E86F= FD 42 61    }Ba
                ; stz $20                      ; E872= 64 20       d
                ; .byte $73                    ; E874= 73          s
                ; stz $72,x                    ; E875= 74 72       tr
                ; adc #$6E                     ; E877= 69 6E       in
                ; .byte $67                    ; E879= 67          g
                ; brk                          ; E87A= 00          .
                .text $fd,"Bad string",0
LE87B:
                lda $0287                    ; E87B= AD 87 02    -..
                eor #$4C                     ; E87E= 49 4C       IL
                bne LE889                    ; E880= D0 07       P.
                jmp $0287                    ; E882= 4C 87 02    L..

LE885:
                tya                          ; E885= 98          .
                sta LFE00,x                  ; E886= 9D 00 FE    ..~
LE889:
                rts                          ; E889= 60          `

LE88A:
                tya                          ; E88A= 98          .
                sta LFC00,x                  ; E88B= 9D 00 FC    ..|
                rts                          ; E88E= 60          `

LE88F:
                ldy LFC00,x                  ; E88F= BC 00 FC    <.|
                rts                          ; E892= 60          `

LE893:
                lda $026B                    ; E893= AD 6B 02    -k.
                bne LE89D                    ; E896= D0 05       P.
                lda $0814                    ; E898= AD 14 08    -..
                bne LE89E                    ; E89B= D0 01       P.
LE89D:
                rts                          ; E89D= 60          `

LE89E:
                ldx $0825                    ; E89E= AE 25 08    .%.
                lda $02C3,x                  ; E8A1= BD C3 02    =C.
                bmi LE8AB                    ; E8A4= 30 05       0.
                lda $081B                    ; E8A6= AD 1B 08    -..
                bne LE8AE                    ; E8A9= D0 03       P.
LE8AB:
                jsr LE993                    ; E8AB= 20 93 E9     .i
LE8AE:
                lda $081B                    ; E8AE= AD 1B 08    -..
                beq LE8C4                    ; E8B1= F0 11       p.
                cmp #$FF                     ; E8B3= C9 FF       I.
                beq LE8C7                    ; E8B5= F0 10       p.
                dec $081C                    ; E8B7= CE 1C 08    N..
                bne LE8C7                    ; E8BA= D0 0B       P.
                jsr LEA01                    ; E8BC= 20 01 EA     .j
                dec $081B                    ; E8BF= CE 1B 08    N..
                bne LE8C7                    ; E8C2= D0 03       P.
LE8C4:
                jsr LE993                    ; E8C4= 20 93 E9     .i
LE8C7:
                ldy $081D                    ; E8C7= AC 1D 08    ,..
                cpy #$FF                     ; E8CA= C0 FF       @.
                beq LE92D                    ; E8CC= F0 5F       p_
                lda $081E                    ; E8CE= AD 1E 08    -..
                beq LE8D8                    ; E8D1= F0 05       p.
                dec $081E                    ; E8D3= CE 1E 08    N..
                bne LE92D                    ; E8D6= D0 55       PU
LE8D8:
                lda $0819                    ; E8D8= AD 19 08    -..
                cmp #$03                     ; E8DB= C9 03       I.
                beq LE92D                    ; E8DD= F0 4E       pN
                lda $08C0,y                  ; E8DF= B9 C0 08    9@.
                and #$7F                     ; E8E2= 29 7F       ).
                sta $081E                    ; E8E4= 8D 1E 08    ...
                lda $081A                    ; E8E7= AD 1A 08    -..
                bne LE916                    ; E8EA= D0 2A       P*
                inc $0819                    ; E8EC= EE 19 08    n..
                lda $0819                    ; E8EF= AD 19 08    -..
                cmp #$03                     ; E8F2= C9 03       I.
                bne LE906                    ; E8F4= D0 10       P.
                ldy $081D                    ; E8F6= AC 1D 08    ,..
                lda $08C0,y                  ; E8F9= B9 C0 08    9@.
                bmi LE92D                    ; E8FC= 30 2F       0/
                lda #$00                     ; E8FE= A9 00       ).
                sta $0819                    ; E900= 8D 19 08    ...
                jsr LEA1F                    ; E903= 20 1F EA     .j
LE906:
                lda $0819                    ; E906= AD 19 08    -..
                clc                          ; E909= 18          .
                adc $081D                    ; E90A= 6D 1D 08    m..
                tay                          ; E90D= A8          (
                lda $08C4,y                  ; E90E= B9 C4 08    9D.
                sta $081A                    ; E911= 8D 1A 08    ...
                beq LE92D                    ; E914= F0 17       p.
LE916:
                dec $081A                    ; E916= CE 1A 08    N..
                lda $081D                    ; E919= AD 1D 08    -..
                clc                          ; E91C= 18          .
                adc $0819                    ; E91D= 6D 19 08    m..
                tay                          ; E920= A8          (
                lda $08C1,y                  ; E921= B9 C1 08    9A.
                beq LE92D                    ; E924= F0 07       p.
                clc                          ; E926= 18          .
                adc $081F                    ; E927= 6D 1F 08    m..
                jsr LEA1F                    ; E92A= 20 1F EA     .j
LE92D:
                lda $EA                      ; E92D= A5 EA       %j
                ora $0262                    ; E92F= 0D 62 02    .b.
                bne LE975                    ; E932= D0 41       PA
                php                          ; E934= 08          .
                sei                          ; E935= 78          x
                lda $0282                    ; E936= AD 82 02    -..
                and #$F9                     ; E939= 29 F9       )y
                ora $0820                    ; E93B= 0D 20 08    . .
                cmp $0282                    ; E93E= CD 82 02    M..
                beq LE949                    ; E941= F0 06       p.
                .if version==300
                jsr LE3C1_300
                .else
                sta $0282                    ; E943= 8D 82 02    ...
                sta LFE07                    ; E946= 8D 07 FE    ..~
                .endif
LE949:
                plp                          ; E949= 28          (
                lda $0821                    ; E94A= AD 21 08    -!.
                sta LFE06                    ; E94D= 8D 06 FE    ..~

; Update a counter
LE950:
                lda $0822                    ; E950= AD 22 08    -".
                beq LE975                    ; E953= F0 20       p
                lda $EA                      ; E955= A5 EA       %j
                bne LE975                    ; E957= D0 1C       P.
                txa                          ; E959= 8A          .
                pha                          ; E95A= 48          H
                inc $0824                    ; E95B= EE 24 08    n$.
                ldx $0824                    ; E95E= AE 24 08    .$.
                lda LE893,x                  ; E961= BD 93 E8    =.h
                .if version==300
                ldx $0295
                .else
                ldx $0292                    ; E964= AE 92 02    ...
                .endif
                eor LE893+7,x                  ; E967= 5D 9A E8    ].h
                and $0822                    ; E96A= 2D 22 08    -".
                ora $0823                    ; E96D= 0D 23 08    .#.
                sta LFE06                    ; ULA counter
                pla                          ; E973= 68          h
                tax                          ; E974= AA          *
LE975:
                rts                          ; E975= 60          `

; OSBYTE &74 - Reset sound system
; -------------------------------
LE976:
                ldx #$04                     ; E976= A2 04       ".
                stx $0825                    ; E978= 8E 25 08    .%.
LE97B:
                jsr LE983                    ; E97B= 20 83 E9     .i
                inx                          ; E97E= E8          h
                cpx #$07                     ; E97F= E0 07       `.
                bne LE97B                    ; E981= D0 F8       Px
LE983:
                lda #$00                     ; E983= A9 00       ).
                sta $081B                    ; E985= 8D 1B 08    ...
                sta $02C3,x                  ; E988= 9D C3 02    .C.
                sta $0814                    ; E98B= 8D 14 08    ...
                jsr LEA14                    ; E98E= 20 14 EA     .j
                beq LE92D                    ; E991= F0 9A       p.
LE993:
                ldx $0825                    ; E993= AE 25 08    .%.
                jsr LEA14                    ; E996= 20 14 EA     .j
                lda $02C3,x                  ; E999= BD C3 02    =C.
                beq LE9A6                    ; E99C= F0 08       p.
                lda #$00                     ; E99E= A9 00       ).
                sta $02C3,x                  ; E9A0= 9D C3 02    .C.
                sta $081B                    ; E9A3= 8D 1B 08    ...
LE9A6:
                jsr LE1C9                    ; E9A6= 20 C9 E1     Ia
                bcs LEA07                    ; E9A9= B0 5C       0\
                php                          ; E9AB= 08          .
                sei                          ; E9AC= 78          x
                jsr LE1CE                    ; E9AD= 20 CE E1     Na
                pha                          ; E9B0= 48          H
                and #$04                     ; E9B1= 29 04       ).
                beq LE9C3                    ; E9B3= F0 0E       p.
                pla                          ; E9B5= 68          h
                jsr LEA14                    ; E9B6= 20 14 EA     .j
                jsr LE1CE                    ; E9B9= 20 CE E1     Na
                jsr LE1CE                    ; E9BC= 20 CE E1     Na
                plp                          ; E9BF= 28          (
                jmp LE9FE                    ; E9C0= 4C FE E9    L~i

LE9C3:
                lda #$02                     ; E9C3= A9 02       ).
                sta $0820                    ; E9C5= 8D 20 08    . .
                pla                          ; E9C8= 68          h
                and #$F8                     ; E9C9= 29 F8       )x
                asl a                        ; E9CB= 0A          .
                bcc LE9D9                    ; E9CC= 90 0B       ..
                cmp #$F0                     ; E9CE= C9 F0       Ip
                bne LE9D7                    ; E9D0= D0 05       P.
                lda #$00                     ; E9D2= A9 00       ).
                sta $0820                    ; E9D4= 8D 20 08    . .
LE9D7:
                lda #$FF                     ; E9D7= A9 FF       ).
LE9D9:
                sta $081D                    ; E9D9= 8D 1D 08    ...
                ldy #$01                     ; E9DC= A0 01        .
                sty $081E                    ; E9DE= 8C 1E 08    ...
                dey                          ; E9E1= 88          .
                sty $081A                    ; E9E2= 8C 1A 08    ...
                sty $081F                    ; E9E5= 8C 1F 08    ...
                dey                          ; E9E8= 88          .
                sty $0819                    ; E9E9= 8C 19 08    ...
                jsr LE1CE                    ; E9EC= 20 CE E1     Na
                sta $0818                    ; E9EF= 8D 18 08    ...
                jsr LE1CE                    ; E9F2= 20 CE E1     Na
                plp                          ; E9F5= 28          (
                pha                          ; E9F6= 48          H
                lda $0818                    ; E9F7= AD 18 08    -..
                jsr LEA26                    ; E9FA= 20 26 EA     &j
                pla                          ; E9FD= 68          h
LE9FE:
                sta $081B                    ; E9FE= 8D 1B 08    ...
LEA01:
                lda #$05                     ; EA01= A9 05       ).
                sta $081C                    ; EA03= 8D 1C 08    ...
                rts                          ; EA06= 60          `

LEA07:
                php                          ; EA07= 08          .
                sei                          ; EA08= 78          x
                jsr LE1C9                    ; EA09= 20 C9 E1     Ia
                bcc LEA13                    ; EA0C= 90 05       ..
                lda #$00                     ; EA0E= A9 00       ).
                sta $0814                    ; EA10= 8D 14 08    ...
LEA13:
                plp                          ; EA13= 28          (
LEA14:
                lda #$00                     ; EA14= A9 00       ).
                sta $0820                    ; EA16= 8D 20 08    . .
LEA19:
                lda #$00                     ; EA19= A9 00       ).
LEA1B:
                sta $0822                    ; EA1B= 8D 22 08    .".
                rts                          ; EA1E= 60          `

LEA1F:
                sta $081F                    ; EA1F= 8D 1F 08    ...
                clc                          ; EA22= 18          .
                adc $0818                    ; EA23= 6D 18 08    m..
LEA26:
                pha                          ; EA26= 48          H
                and #$03                     ; EA27= 29 03       ).
                tax                          ; EA29= AA          *
                lda $0825                    ; EA2A= AD 25 08    -%.
                cmp #$04                     ; EA2D= C9 04       I.
                bne LEA49                    ; EA2F= D0 18       P.
                pla                          ; EA31= 68          h
                and #$04                     ; EA32= 29 04       ).
                beq LEA41                    ; EA34= F0 0B       p.
                lda LEA8A,x                  ; EA36= BD 8A EA    =.j
                sta $0823                    ; EA39= 8D 23 08    .#.
                lda LED2D,x                  ; EA3C= BD 2D ED    =-m
                bne LEA1B                    ; EA3F= D0 DA       PZ
LEA41:
                lda *+77,x                   ; EA41= BD 8E EA    =.j
                sta $0821                    ; EA44= 8D 21 08    .!.
                bne LEA19                    ; EA47= D0 D0       PP
LEA49:
                inx                          ; EA49= E8          h
                lda #$00                     ; EA4A= A9 00       ).
                sta $0821                    ; EA4C= 8D 21 08    .!.
                pla                          ; EA4F= 68          h
                lsr a                        ; EA50= 4A          J
                lsr a                        ; EA51= 4A          J
LEA52:
                cmp #$0C                     ; EA52= C9 0C       I.
                bcc LEA5D                    ; EA54= 90 07       ..
                inc $0821                    ; EA56= EE 21 08    n!.
                sbc #$0C                     ; EA59= E9 0C       i.
                bne LEA52                    ; EA5B= D0 F5       Pu
LEA5D:
                tay                          ; EA5D= A8          (
                lda $0821                    ; EA5E= AD 21 08    -!.
                pha                          ; EA61= 48          H
                lda LEA7E,y                  ; EA62= B9 7E EA    9~j
LEA65:
                cpy #$07                     ; EA65= C0 07       @.
                sbc #$02                     ; EA67= E9 02       i.
                dex                          ; EA69= CA          J
                bne LEA65                    ; EA6A= D0 F9       Py
                sta $0821                    ; EA6C= 8D 21 08    .!.
                pla                          ; EA6F= 68          h
                tay                          ; EA70= A8          (
                beq LEA79                    ; EA71= F0 06       p.
LEA73:
                lsr $0821                    ; EA73= 4E 21 08    N!.
                dey                          ; EA76= 88          .
                bne LEA73                    ; EA77= D0 FA       Pz
LEA79:
                dec $0821                    ; EA79= CE 21 08    N!.
                bne LEA19                    ; EA7C= D0 9B       P.
LEA7E:
                brk                          ; EA7E= 00          .
                ;beq LEA64                    ; EA7F= F0 E3       pc
                .byte $F0
                .byte $E3
                ;dec $CB,x                    ; EA81= D6 CB       VK
                .byte $D6
                .byte $CB
                .byte $BF                    ; EA83= BF          ?
                ;lda $AA,x                    ; EA84= B5 AA       5*
                .byte $B5
                .byte $AA
                ;ldy #$97                     ; EA86= A0 97        .
                .byte $A0
                .byte $97
                .byte $8F                    ; EA88= 8F          .
                .byte $87                    ; EA89= 87          .
LEA8A:
                ;rti                          ; EA8A= 40          @
                .byte $40

                ;bra LEA4D                    ; EA8B= 80 C0       .@
                .byte $80
                .byte $C0

                ;bra LEACA                    ; EA8D= 80 3B       .;
                .byte $80
                .byte $3B

                ;ror $F0,x                    ; EA8F= 76 F0       vp
                .byte $76
                .byte $F0
                ;ror $A9,x                    ; EA91= 76 A9       v)
                .byte $76

LEA92:
                lda #$ef
                sta $f5
                rts

LEA97:
                inc $F5                      ; EA97= E6 F5       fu
                ldy $F5                      ; EA99= A4 F5       $u
                ldx #$0D                     ; EA9B= A2 0D       ".
LEA9D:
                php                          ; EA9D= 08          .
                jsr LF0A8                    ; EA9E= 20 A8 F0     (p
                plp                          ; EAA1= 28          (
                cmp #$01                     ; EAA2= C9 01       I.
                tya                          ; EAA4= 98          .
                rts                          ; EAA5= 60          `

LEAA6:
                ldx #$0E                     ; EAA6= A2 0E       ".
                ldy #$FF                     ; EAA8= A0 FF        .
                jmp LEA9D                    ; EAAA= 4C 9D EA    L.j

LEAAD:
                lda $03CB                    ; EAAD= AD CB 03    -K.
                sta $F6                      ; EAB0= 85 F6       .v
                lda $03CC                    ; EAB2= AD CC 03    -L.
                sta $F7                      ; EAB5= 85 F7       .w
                lda $F5                      ; EAB7= A5 F5       %u
                rts                          ; EAB9= 60          `

LEABA:
                ldx #$FF                     ; EABA= A2 FF       ".
                stx $0242                    ; EABC= 8E 42 02    .B.
LEABF:
                php                          ; EABF= 08          .
                lda $0282                    ; EAC0= AD 82 02    -..
                and #$7F                     ; EAC3= 29 7F       ).
                pha                          ; EAC5= 48          H
                lda #$10                     ; EAC6= A9 10       ).
                .if version==300
                and $025a
                .else
                bit $025A                    ; EAC8= 2C 5A 02    ,Z.
                .endif
                bne LEAD1                    ; EACB= D0 04       P.
                pla                          ; EACD= 68          h
                ora #$80                     ; EACE= 09 80       ..
                pha                          ; EAD0= 48          H
LEAD1:
                pla                          ; EAD1= 68          h
                cmp $0282                    ; EAD2= CD 82 02    M..
                beq LEADD                    ; EAD5= F0 06       p.
                .if version==300
                jsr LE3C1_300
                .else
                sta $0282                    ; EAD7= 8D 82 02    ...
                sta LFE07                    ; EADA= 8D 07 FE    ..~
                .endif
LEADD:
                pla                          ; EADD= 68          h
                rts                          ; EADE= 60          `

; KEYV handler
; ************
LEADF:
                bvc LEAE9                    ; V=0, jump to keyscan routines (eg INKEY-num)
                inc $0242                    ; Increment keyboard semaphore
                bcs LEAEE                    ; V=1, C=1, jump with timer interupt
                jmp LEC06                    ; V=1, C=0, jump with keypress interupt

; VC, keyscan call
; ----------------
LEAE9:
                bcc LEAEE                    ; V=0, C=0, jump to test SHIFT and CTRL
                jmp LEC53                    ; V=0, C=1, jump to scan whole keyboard

LEAEE:
                lda $025A                    ; Get current keyboard status
;                   :\   Bit 7  =1 Control pressed
;                   :\   Bit 6  =1 Shift pressed
;                   :\   bit 5  =1 Func is pressed
                and #$1F                     ; Clear bits 7-5, Shift off, Ctrl off, Func off
                ldx #$3B                     ; Scan for key &3B - SHIFT
                jsr LEC1E
                stx $0277                    ; Save SHIFT keystate
                clv                          ; Clear V = SHIFT is not pressed
                bpl LEB03                    ; If no key pressed, skip past
                bit LD8BC                    ; Set V = SHIFT is pressed
                ora #$40                     ; Set bit 6 to indicate SHIFT is pressed
LEB03:
                dex                          ; Scan for key &3A - CTRL
                jsr LEC1E
                bcc LEABF                    ; If Carry clear, was entered to test keys
                bpl LEB0D                    ; CTRL not pressed, skip past
                ora #$80                     ; Set bit 7 to indicate CTRL is pressed
LEB0D:
                dex                          ; Scan for key &39 - CAPS/FUNC
                jsr LEC1E
                bpl LEB15                    ; CAPS/FUNC not pressed, skip past
                ora #$20                     ; Set bit 5 to indicate FUNC is pressed
LEB15:
                sta $025A                    ; Update keyboard status byte
                ldx $EC                      ; EB18= A6 EC       &l
                beq LEB2E                    ; EB1A= F0 12       p.
                jsr LEC1E                    ; Scan for key
                bmi LEB31                    ; EB1F= 30 10       0.
                cpx $EC                      ; EB21= E4 EC       dl
LEB23:
                stx $EC                      ; EB23= 86 EC       .l
                bne LEB2E                    ; EB25= D0 07       P.
                ldx #$00                     ; EB27= A2 00       ".
                stx $EC                      ; EB29= 86 EC       .l
LEB2B:
                jsr LEC13                    ; EB2B= 20 13 EC     .l
LEB2E:
                jmp LEBDD                    ; EB2E= 4C DD EB    L]k

LEB31:
                cpx $EC                      ; EB31= E4 EC       dl
                bne LEB23                    ; EB33= D0 EE       Pn
                lda $E7                      ; EB35= A5 E7       %g
                beq LEB5F                    ; EB37= F0 26       p&
                dec $E7                      ; EB39= C6 E7       Fg
                bne LEB5F                    ; EB3B= D0 22       P"
                lda $02BF                    ; EB3D= AD BF 02    -?.
                sta $E7                      ; EB40= 85 E7       .g
                lda $0255                    ; EB42= AD 55 02    -U.
                sta $02BF                    ; EB45= 8D BF 02    .?.
                lda $025A                    ; EB48= AD 5A 02    -Z.
                ldx $EC                      ; EB4B= A6 EC       &l
                cpx #$B9                     ; EB4D= E0 B9       `9
                bne LEB62                    ; EB4F= D0 11       P.
                bit $0277                    ; EB51= 2C 77 02    ,w.
                bpl LEB58                    ; EB54= 10 02       ..
                eor #$30                     ; EB56= 49 30       I0
LEB58:
                sta $025A                    ; EB58= 8D 5A 02    .Z.
                lda #$00                     ; EB5B= A9 00       ).
                sta $E7                      ; EB5D= 85 E7       .g
LEB5F:
                jmp LEBDD                    ; EB5F= 4C DD EB    L]k

; Convert keypress to ASCII and insert in keyboard buffer
; --------------------------------------------------------
; On entry, X=internal key number &04-&3B OR &80 keypress
LEB62:
                lda LEDD3-$80-4,x            ; Get code from lookup table
                ldx $025A                    ; Get keyboard status
                stx $0277                    ; Store it in &0277
                tax                          ; Copy key code to X
                cmp #$21                     ; Jump with control code or space
                bcc LEBC4
                cmp #$26                     ; Jump with non-special keys
                bcs LEB85
                lda #$C0                     ; Test SHIFT+CTRL in copy of keyboard state
                bit $0277
                beq LEB7F                    ; Neither pressed, treat as editing key
                ldy $ED                      ; If not first keypress, treat as normal key
                beq LEB85
LEB7F:
                clc                          ; Convert &21-&25 to &8B-&8F
                txa
                adc #$6A
                bne LEBC3                    ; Jump to insert into buffer

; Modify keypress according to modifiers
; --------------------------------------
LEB85:
                lda $0277                    ; Get copy of keyboard status
                eor #$10                     ;
                beq LEBC4
                rol $0277                    ; Ctrl not pressed, skip past
                bcc LEB9A
                ldy $ED                      ; More than one key pressed....
                bne LEB2B
                lda LEEC5-$2C,x              ; Translate Ctrl+Key
                bcs LEBC3                    ; Jump to insert in buffer

LEB9A:
                rol $0277                    ; Shift not pressed, skip past
                bcc LEBA9
                ldy $ED                      ; More than one key pressed...
                bne LEB2B
                lda LEFE3-$2C,x              ; Translate Shift+Keypress
                tax
                bcs LEBB3                    ; EBA7= B0 0A       0.

LEBA9:
                rol $0277                    ; Func not pressed...
                bcc LEBB6
                lda LF018-13,x              ; Translate Func+Keypress
                bcs LEBC3                    ; Jump to insert in buffer

LEBB3:
                rol $0277                    ; Move CAPS bit up
LEBB6:
                rol $0277                    ; CAPS not set, skip past
                bcs LEBC3
                txa                          ;
                jsr LE251                    ; If not a letter, skip past
                bcs LEBC3
                eor #$20                     ; Toggle case
LEBC3:
                tax                          ; Copy code to X for insertion

; Keycode has been modified, prepare to insert in keyboard buffer
LEBC4:
                txa                          ; Is it Escape character?
                cmp $026C
                bne LEBD1                    ; No, skip to insert it
                ldx $0275                    ; Get Escape key status
                bne LEBD1                    ; If Escape returns ASCII, skip to insert it
                stx $E7                      ; Cancel autorepeat timer
LEBD1:
                tay                          ; Y=character for insertion
                jsr LED34                    ; Disable keyboard
                lda $0259                    ; If keyboard locked, skip
                bne LEBDD
                jsr LE25F                    ; Insert into keyboard buffer
LEBDD:
                ldx $ED                      ; EBDD= A6 ED       &m
                beq LEBEC                    ; EBDF= F0 0B       p.
                jsr LEC1E                    ; EBE1= 20 1E EC     .l
                .if version==300
                bmi LEBF4_300
                .else
                stx $ED                      ; EBE4= 86 ED       .m
                bmi LEBEC                    ; EBE6= 30 04       0.
                .endif
                ldx #$00                     ; EBE8= A2 00       ".
LEBF4_300:
                stx $ED                      ; EBEA= 86 ED       .m
LEBEC:
                .if version==300
                txa
                .else
                ldx $ED                      ; EBEC= A6 ED       &m
                .endif
                bne LEC06                    ; EBEE= D0 16       P.
                ldy #$EC                     ; EBF0= A0 EC        l
                jsr LED76                    ; EBF2= 20 76 ED     vm
                bmi LEC03                    ; EBF5= 30 0C       0.
                jsr LE950                    ; EBF7= 20 50 E9     Pi
                lda $EC                      ; EBFA= A5 EC       %l
                sta $ED                      ; EBFC= 85 ED       .m
LEBFE:
                stx $EC                      ; EBFE= 86 EC       .l
                jsr LEC13                    ; EC00= 20 13 EC     .l
LEC03:
                jmp LEABA                    ; EC03= 4C BA EA    L:j

; VS, CC - keypressed interupt
; ----------------------------
LEC06:
                lda $EC                      ; Get current keypress, if pressed back to housekeeping
                bne LEC03
                ldy #$ED                     ; Point Y to last keypress location
                jsr LED76                    ; EC0C= 20 76 ED     vm
                bmi LEC03                    ; EC0F= 30 F2       0r
                bpl LEBFE                    ; EC11= 10 EB       .k
LEC13:
                ldx #$01                     ; EC13= A2 01       ".
                stx $E7                      ; EC15= 86 E7       .g
                ldx $0254                    ; EC17= AE 54 02    .T.
                stx $02BF                    ; EC1A= 8E BF 02    .?.
                rts                          ; EC1D= 60          `

; Scan keyboard for internal key in X
; -----------------------------------
; Internal key numbers are &00-&3F, &00 indicates nonexistant key
; Actual keys are &04-&3B
; On entry, X=internal key number &00-&3F with or without bit 7 set
; On exit,  X=keynumber OR &00/&80 keypress
;           Y=&00/&80 keypress
;           A=preserved
;           F=set from &00/&80 keypress in Y
LEC1E:
                .if version==300

                beq LEC66_300
                pha
                lda $f4
                pha
                txa
                and #$3f
                pha
                lda #$c
                jsr LE2CC_300
                lda L9FFD_300
                eor #$4C
                bne LEC42_300
                jsr L9FFD_300
                bmi LEC57_300
LEC42_300:
                pla
                pha
                jsr LED16_300
                sta $fc
                lda #8
                jsr LE2CC_300
                php
                jsr LED5A_300
                plp
                and $fc
                beq LEC59_300
LEC57_300:
                lda #$80
LEC59_300:
                sta $fc
                pla
                ora $fc
                tax
                pla
                jsr LE2CC_300
                pla
                ldy $fc
LEC66_300:
                rts

                .else
                
                beq LEC48                    ; X=0, nonexistant key, exit
                pha                          ; Save A
                txa                          ; Save keynum b0-b5
                and #$3F
                pha
                jsr LECF8                    ; Get address and map of key
                sta $FC                      ; Store bitmask in &FC
                ldx $F4                      ; X=current ROM
                lda #$08                     ; Page in keyboard in ROM 8
                jsr LE3A0
                php                          ; Read internal keypress from ROM
                jsr LED38
                plp
                and $FC                      ; Mask with row bitmask to get b0-b3 set
                beq LEC3C                    ; Nothing set, skip forward
                lda #$80                     ; Bit set, convert it to &80
LEC3C:
                sta $FC                      ; Store &00/&80 keypress state
                jsr LE39F                    ; Restore current ROM from X
                pla                          ; Get original keypress back
                ora $FC                      ; OR with &00/&80 keypress state, return in X
                tax
                pla                          ; Restore A
                ldy $FC                      ; Return keypress &00/&80 in Y
LEC48:
                rts
                .endif

LEC49:
                bit LD8BC                    ; EC49= 2C BC D8    ,<X
LEC4C:
                jmp ($0228)                  ; EC4C= 6C 28 02    l(.

; OSBYTE &7A - Keyboard scan from &10
; -----------------------------------
LEC4F:
                ldx #$01                     ; Start from key &01

; OSBYTE &79 - Keyboard scan from X
; ---------------------------------
LEC51:
                bcs LEC4C                    ; If Carry set from OSBYTE entry, vector via KEYV
;               :\ And thence back to:

; KEYV - Scan keyboard, C=1, V=0, X=first key
; ===========================================
LEC53:
                txa                          ; If X<&80, scan multiple keys
                bpl LEC95
                and #$7F                     ; Lose bit 7
                tay
                jsr LE950                    ; Some counter stuff
                ldx LEE40,y                  ; Translate keypress
                jsr LEC1E                    ; Scan for this key
                txa                          ; Copy keystate to A and return
                rts

LEC64:
                bvc LEC75                    ; EC64= 50 0F       P.
                jsr LEC82                    ; EC66= 20 82 EC     .l
                bcc LEC75                    ; EC69= 90 0A       ..
                bit $02C0                    ; EC6B= 2C C0 02    ,@.
                beq LEC75                    ; EC6E= F0 05       p.
                eor $02C0                    ; EC70= 4D C0 02    M@.
                beq LEC81                    ; EC73= F0 0C       p.
LEC75:
                ldx #$FF                     ; EC75= A2 FF       ".
LEC77:
                lsr a                        ; EC77= 4A          J
                inx                          ; EC78= E8          h
                bcc LEC77                    ; EC79= 90 FC       .|
                lda #$00                     ; EC7B= A9 00       ).
LEC7D:
                rol a                        ; EC7D= 2A          *
                dex                          ; EC7E= CA          J
                bpl LEC7D                    ; EC7F= 10 FC       .|
LEC81:
                rts                          ; EC81= 60          `

LEC82:
                clc                          ; EC82= 18          .
                pha                          ; EC83= 48          H
LEC84:
                lda $FA                      ; EC84= A5 FA       %z
                eor $02C1                    ; EC86= 4D C1 02    MA.
                bne LEC93                    ; EC89= D0 08       P.
                lda $FB                      ; EC8B= A5 FB       %{
                eor $02C2                    ; EC8D= 4D C2 02    MB.
                bne LEC93                    ; EC90= D0 01       P.
                sec                          ; EC92= 38          8
LEC93:
                pla                          ; EC93= 68          h
                rts                          ; EC94= 60          `

LEC95:
                inx                          ; EC95= E8          h
                txa                          ; EC96= 8A          .
                and #$7F                     ; EC97= 29 7F       ).
                tax                          ; EC99= AA          *
                sei                          ; EC9A= 78          x
                lda $F4                      ; EC9B= A5 F4       %t
                pha                          ; EC9D= 48          H
                lda #$08                     ; Select ROM 8 to read keyboard
                jsr LE3A0
                lda #$FF                     ;
                tay
                sta $02C0                    ; ECA6= 8D C0 02    .@.
                stx $02C1                    ; ECA9= 8E C1 02    .A.
                lda $8000                    ; Read from %xx00000000000 - all columns
                and #$0F                     ; Mask and keep all rows
                beq LECE9                    ; If zero, nothing pressed anywhere, quickly exit
                sty $FA                      ; Start from &9FFF for column A13
                ldx #$9F                     ;
                stx $FB
                ldx #$00                     ; ECB9= A2 00       ".
LECBB:
                .if version==300
                jsr LED5A_300
                .else
                jsr LED38                    ; Read this column
                .endif
                and #$0F                     ; If nothing pressed, skip to check next column
                beq LECF2
                ldy #$04                     ; ECC2= A0 04        .
LECC4:
                lsr a                        ; ECC4= 4A          J
                bcc LECD9                    ; ECC5= 90 12       ..
                pha                          ; ECC7= 48          H
                lda LEE08,x                  ; ECC8= BD 08 EE    =.n
                cmp $02C1                    ; ECCB= CD C1 02    MA.
                bcc LECD8                    ; ECCE= 90 08       ..
                cmp $02C0                    ; ECD0= CD C0 02    M@.
                bcs LECD8                    ; ECD3= B0 03       0.
                sta $02C0                    ; ECD5= 8D C0 02    .@.
LECD8:
                pla                          ; ECD8= 68          h
LECD9:
                inx                          ; ECD9= E8          h
                dey                          ; ECDA= 88          .
                bne LECC4                    ; ECDB= D0 E7       Pg
LECDD:
                lda $FB                      ; Get high byte of address
                eor #$C0                     ; Swap b15/b14
                sec                          ; Move bits down, keeping in &80-&BF range
                ror a
                ror $FA                      ; Rotate into low byte
                sta $FB                      ; Update high byte
                bcs LECBB                    ; If zero bit hasn't fallen out, loop back
LECE9:
                ldx $02C0                    ; Get result
                pla                          ; Restore previous ROM
                jsr LE3A0
                txa                          ; Copy result to A and return
                rts

LECF2:
                inx                          ; Set to next keynum
                inx
                inx
                inx
                bpl LECDD                    ; Will always be positive, loop back

; Translate keynumber to address and bitmask
; ------------------------------------------
; A=internal key number
; Returns low address line A0-A13 for key column
; and bitmask 1,2,4,8 for D0-D3 for key row
LECF8:
                php                          ; Save flags
                pha                          ; Save key number
                and #$3F                     ; Reduce to key number &00-&3F
                lsr a                        ; Divide by four
                lsr a
                tax
                .if version==300
                lda LED18,x
                .else
                lda LED18-1,x                ; Get high byte of address of this key
                .endif
                sta $FB
                sta $02C2
                lda LED26-1,x                ; Get low byte of address of this key
                sta $FA
                sta $02C1
                pla                          ; Get b0-b1 of keynum back
                and #$03
                tax
                lda LF086,x                  ; Get bit position for b0-b1
                plp                          ; Restore flags and return
                rts

; Addresses in ROM 8 of internal keypresses
; -----------------------------------------
; (keynum DIV 4) high byte
; Translates column number 0-13 to low address line A0-A13
LED18:                                       ;         b0  b1  b2  b3
                .byte $BF                    ; ED18= BF          ?  \ &04-&07 ->  CPY     SPC
                .byte $BF                    ; ED19= BF          ?  \ &08-&0B <-  DWN RET DEL
                .byte $BF                    ; ED1A= BF          ?  \ &0C-&0F  -  UP   :
                .byte $BF                    ; ED1B= BF          ?  \ &10-&13  0   P   ;   ?
                .byte $BF                    ; ED1C= BF          ?  \ &14-&17  9   O   L   >
                .byte $BF                    ; ED1D= BF          ?  \ &18-&1B  8   I   K   <
                .byte $BF                    ; ED1E= BF          ?  \ &1C-&1F  7   U   J   M
                .byte $BF                    ; ED1F= BF          ?  \ &20-&23  6   Y   H   N
                .if version==300
                .byte $BF
                .endif
                .byte $BE                    ; ED20= BE          >  \ &24-&27  5   T   G   B
                .byte $BD                    ; ED21= BD          =  \ &28-&2B  4   R   F   V
                .byte $BB                    ; ED22= BB          ;  \ &2C-&2F  3   E   D   C
                .byte $B7                    ; ED23= B7          7  \ &30-&33  2   W   S   X
                .byte $AF                    ; ED24= AF          /  \ &34-&37  1   Q   A   Z
                .byte $9F                    ; ED25= 9F          .  \ &38-&3B ESC CAP CTL SFT
                .if version==300
                .byte $BF
                .byte $00
                .endif

; (keynum DIV 4) low byte
LED26:
                .byte $FE
                .byte $FD
                .byte $FB
                .byte $F7                    ; ED29= F7          w
                .byte $EF                    ; ED2A= EF          o
                .byte $DF                    ; ED2B= DF          _
                .byte $BF                    ; ED2C= BF          ?
LED2D:
                .byte $7F                    ; ED2D= 7F          .
                .byte $FF                    ; ED2E= FF          .
                .byte $FF                    ; ED2F= FF          .
                .byte $FF                    ; ED30= FF          .
                .byte $FF                    ; ED31= FF          .
                .byte $FF                    ; ED32= FF          .
                .byte $FF                    ; ED33= FF          .
                .if version==300
                .byte $00
                .endif

LED34:
                cli                          ; ED34= 58          X
                sei                          ; ED35= 78          x
                txa                          ; ED36= 8A          .
                rts                          ; ED37= 60          `

                .if version==300
LED5A_300:
                ldy #0
                lda ($fa),y
                rts
                .endif

                .if version==100
                .include "LED38.s65"
                .else
LED38:
                .endif

LED76:
                clv                          ; ED76= B8          8
                lda $0000,y                  ; ED77= B9 00 00    9..
                beq LED85                    ; ED7A= F0 09       p.
                bit LD8BC                    ; ED7C= 2C BC D8    ,<X
                jsr LECF8                    ; Scan for a keypress
                sta $02C0                    ; ED82= 8D C0 02    .@.
LED85:
                lda $F4                      ; Save current ROM
                pha
                lda #$08
                sta $F4                      ; Page in ROM 8 to read keyboard
                sta LFE05
                ldy #$FF                     ; Start at &AFFF for column 12
                sty $FA
                ldx #$AF
                stx $FB
                lda $A000                    ; Check if any key (except SHIFT/CTRL) pressed
                and #$0F                     ; Check all row bits
                beq LEDB6                    ; Nothing pressed
LED9E:
                .if version==300
                jsr LED5A_300
                .else
                jsr LED38                    ; Read keypress location
                .endif
                and #$0F                     ; EDA1= 29 0F       ).
                beq LEDAA                    ; EDA3= F0 05       p.
                jsr LEC64                    ; EDA5= 20 64 EC     dl
                bne LEDCA                    ; EDA8= D0 20       P
LEDAA:
                lda $FB                      ; EDAA= A5 FB       %{
                eor #$C0                     ; EDAC= 49 C0       I@
                sec                          ; EDAE= 38          8
                ror a                        ; EDAF= 6A          j
                ror $FA                      ; EDB0= 66 FA       fz
                sta $FB                      ; EDB2= 85 FB       .{
                bcs LED9E                    ; EDB4= B0 E8       0h
LEDB6:
                lda #$9F                     ; EDB6= A9 9F       ).
                sta $FB                      ; EDB8= 85 FB       .{
                lda $9FFF                    ; EDBA= AD FF 9F    -..
                and #$03                     ; EDBD= 29 03       ).
                beq LEDC6                    ; EDBF= F0 05       p.
                jsr LEC64                    ; EDC1= 20 64 EC     dl
                bne LEDCA                    ; EDC4= D0 04       P.
LEDC6:
                ldx #$80                     ; EDC6= A2 80       ".
                bmi LEDCD                    ; EDC8= 30 03       0.
LEDCA:
                jsr LF047                    ; EDCA= 20 47 F0     Gp
LEDCD:
                pla                          ; EDCD= 68          h
                jsr LE3A0                    ; EDCE= 20 A0 E3      c
                txa                          ; EDD1= 8A          .
                rts                          ; EDD2= 60          `

; Translation table from internal key number to ASCII
; ---------------------------------------------------
; &21-&25 values are multi-function keys
; &21 -  COPY   &22 -  <-    &23 -  ->
; &24 -  DWN    &25 -  UP
LEDD3:
                .text "#!",0," "         ; EDD3= 23          #
                .text """$",13,127   ; EDD6= 20 22 24     "$
                .text "-%:",0            ; EDD9= 0D 7F 2D    ..-
                .text "0p;/"                 ; EDDF= 30 70       0p
                .text "9ol."                 ; EDE3= 39 6F 6C    9ol
                .text "8ik,"                 ; EDE6= 2E 38 69    .8i
                .text "7ujm"                 ; EDEA= 2C 37 75    ,7u
                .text "6yhn"                 ; EDEE= 6D 36 79    m6y
                .text "5tgb"                 ; EDF2= 6E 35 74    n5t
                .text "4rfv"                 ; EDF7= 34 72       4r
                .text "3edc"                 ; EDFB= 33          3
                .text "2wsx"                 ; EDFF= 32 77       2w
                .text "1qaz"                 ; EE03= 31 71       1q
                .byte $1B                    ; EE07= 1B          .

LEE08:
                bvs LEE4A                    ; EE08= 70 40       p@
                ora ($00,x)                  ; EE0A= 01 00       ..
                bmi LEE1E                    ; EE0C= 30 10       0.
                eor ($61,x)                  ; EE0E= 41 61       Aa
                and ($21),y                  ; EE10= 31 21       1!
                eor ($42),y                  ; EE12= 51 42       QB
                ora ($22),y                  ; EE14= 11 22       ."
                ;and ($52)                    ; EE16= 32 52       2R
                .byte $32
                .byte $52
                ;ora ($33)                    ; EE18= 12 33       .3
                .byte $12
                .byte $33
                .byte $43                    ; EE1A= 43          C
                .byte $63                    ; EE1B= 63          c
                .byte $13                    ; EE1C= 13          .
                .byte $23                    ; EE1D= 23          #
LEE1E:
                .byte $53                    ; EE1E= 53          S
                ;stz $34                      ; EE1F= 64 34       d4
                .byte $64
                .byte $34
                .byte $44                    ; EE21= 44          D
                .byte $54                    ; EE22= 54          T
                eor $24,x                    ; EE23= 55 24       U$
                and $45,x                    ; EE25= 35 45       5E
                adc $15                      ; EE27= 65 15       e.
                and $46                      ; EE29= 25 46       %F
                ror $26                      ; EE2B= 66 26       f&
                rol $56,x                    ; EE2D= 36 56       6V
                .byte $67                    ; EE2F= 67          g
                .byte $27                    ; EE30= 27          '
                .byte $37                    ; EE31= 37          7
                .byte $57                    ; EE32= 57          W
                pla                          ; EE33= 68          h
                .byte $17                    ; EE34= 17          .
                and LFF48,y                  ; EE35= 39 48 FF    9H.
                ora $4929,y                  ; EE38= 19 29 49    .)I
                eor $6979,y                  ; EE3B= 59 79 69    Yyi
                .byte $FF                    ; EE3E= FF          .
                .byte $62                    ; EE3F= 62          b

; Negative INKEY keypress translation table
; -----------------------------------------
; Key numbers &xF are filtered out and passed to sideways ROMs
LEE40:
                .byte $3B                    ; EE40= 3B          ; \ 00  -1  SHIFT
                ;dec a                        ; EE41= 3A          : \ 01  -2  CTRL
                .byte $3A
                brk                          ; EE42= 00          . \ 02  -3  l1 - doesn't exist
                brk                          ; EE43= 00          . \ 03  -4  l2 - doesn't exist
                brk                          ; EE44= 00          . \ 04  -5  l3 - doesn't exist
                brk                          ; EE45= 00          . \ 05  -6  l4 - doesn't exist
                brk                          ; EE46= 00          . \ 06  -7  l5 - doesn't exist
                brk                          ; EE47= 00          . \ 07  -8  l6 - doesn't exist
                brk                          ; EE48= 00          . \ 08  -9  l7 - doesn't exist
                brk                          ; EE49= 00          . \ 09 -10  l8 - doesn't exist
LEE4A:
                brk                          ; EE4A= 00          . \ 0A -11
                brk                          ; EE4B= 00          . \ 0B -12
                brk                          ; EE4C= 00          . \ 0C -13
                brk                          ; EE4D= 00          . \ 0D -14
                brk                          ; EE4E= 00          . \ 0E -15
                brk                          ; EE4F= 00          . \ 0F -16
                .byte $35                    ; EE50= 35          5 \ 10 -17  Q
                .byte $2C                    ; EE51= 2C          , \ 11 -18  3
                plp                          ; EE52= 28          ( \ 12 -19  4
                .byte $24                    ; EE53= 24          $ \ 13 -20  5
                brk                          ; EE54= 00          . \ 14 -21  f4 - doesn't exist
                clc                          ; EE55= 18          . \ 15 -22  8
                brk                          ; EE56= 00          . \ 16 -23  f7 - doesn't exist
                .byte $0C                    ; EE57= 0C          . \ 17 -24  -
                .byte $08                    ; EE58= 08          . \ 18 -25  ^
                .byte $08                    ; EE59= 08          . \ 19 -26  <-
                brk                          ; EE5A= 00          . \ 1A -27
                brk                          ; EE5B= 00          . \ 1B -28
                brk                          ; EE5C= 00          . \ 1C -29
                brk                          ; EE5D= 00          . \ 1D -30
                brk                          ; EE5E= 00          . \ 1E -31
                brk                          ; EE5F= 00          . \ 1F -32
                brk                          ; EE60= 00          . \ 20 -33  f0 - doesn't exist
                .byte $31                    ; EE61= 31            \ 21 -34  W
                .byte $2D                    ; EE62= 2D            \ 22 -35  E
                .byte $25                    ; EE63= 25            \ 23 -36  T
                .byte $1C                    ; EE64= 1C            \ 24 -37  7
                .byte $19                    ; EE65= 19            \ 25 -38  I
                .byte $14                    ; EE66= 14            \ 26 -39  9
                .byte $10                    ; EE67= 10            \ 27 -40  0
                .byte $09                    ; EE68= 09            \ 28 -41  _
                .byte $09                    ; EE69= 09            \ 29 -42  DWN
                brk                          ; EE6A= 00          . \ 2A -43
                brk                          ; EE6B= 00          . \ 2B -44
                brk                          ; EE6C= 00          . \ 2C -45
                brk                          ; EE6D= 00          . \ 2D -46
                brk                          ; EE6E= 00          . \ 2E -47
                brk                          ; EE6F= 00          . \ 2F -48
                .byte $34                    ; EE70= 34            \ 30 -49  1
                .byte $30                    ; EE71= 30            \ 31 -50  2
                .byte $2E                    ; EE72= 2E            \ 32 -51  D
                .byte $29                    ; EE73= 29            \ 33 -52  R
                .byte $20                    ; EE74= 20            \ 34 -53  6
                .byte $1D                    ; EE75= 1D            \ 35 -54  U
                .byte $15                    ; EE76= 15            \ 36 -55  O
                .byte $11                    ; EE77= 11            \ 37 -56  P
                .byte $05                    ; EE78= 05            \ 38 -57  [
                .byte $0D                    ; EE79= 0D            \ 39 -58  UP
                brk                          ; EE7A= 00          . \ 3A -59
                brk                          ; EE7B= 00          . \ 3B -60
                brk                          ; EE7C= 00          . \ 3C -61
                brk                          ; EE7D= 00          . \ 3D -62
                brk                          ; EE7E= 00          . \ 3E -63
                brk                          ; EE7F= 00          . \ 3F -64
                .byte $39                    ; EE80= 39            \ 40 -65  CAPS
                .byte $36                    ; EE81= 36            \ 41 -66  A
                .byte $33                    ; EE82= 33            \ 42 -67  X
                rol a                        ; EE83= 2A          * \ 43 -68  F
                .byte $21                    ; EE84= 21          ! \ 44 -69  Y
                .byte $1E                    ; EE85= 1E          . \ 45 -70  J
                ;inc a                        ; EE86= 1A          . \ 46 -71  K
                .byte $1A
                .byte $10                    ; EE87= 10          . \ 47 -72  @
                .byte $0E                    ; EE88= 0E          . \ 48 -73  :
LEE89:
                asl a                        ; EE89= 0A          . \ 49 -74  RET
                brk                          ; EE8A= 00          . \ 4A -75
                brk                          ; EE8B= 00          . \ 4B -76
                brk                          ; EE8C= 00          . \ 4C -77
                brk                          ; EE8D= 00          . \ 4D -78
                brk                          ; EE8E= 00          . \ 4E -79
                brk                          ; EE8F= 00          . \ 4F -80
                brk                          ; EE90= 00          . \ 50 -81  SHLOCK
                .byte $32                    ; EE91= 32          . \ 51 -82  S
                .byte $2F                    ; EE92= 2F          . \ 52 -83  C
                .byte $26                    ; EE93= 26          . \ 53 -84  G
                .byte $22                    ; EE94= 22          . \ 54 -85  H
                .byte $23                    ; EE95= 23          # \ 55 -86  N
                .byte $16                    ; EE96= 16          . \ 56 -87  L
                .byte $12                    ; EE97= 12          . \ 57 -88  ;
                .byte $05                    ; EE98= 05          . \ 58 -89  ]
                .byte $0B                    ; EE99= 0B          . \ 59 -90  DEL
                brk                          ; EE9A= 00          . \ 5A -91
                brk                          ; EE9B= 00          . \ 5B -92
                brk                          ; EE9C= 00          . \ 5C -93
                brk                          ; EE9D= 00          . \ 5D -94
                brk                          ; EE9E= 00          . \ 5E -95
                brk                          ; EE9F= 00          . \ 5F -96
                brk                          ; EEA0= 00          . \ 60 -97   TAB
                .byte $37                    ; EEA1= 37          7 \ 61 -98   Z
                .byte $07                    ; EEA2= 07          . \ 62 -99   SPC
                .byte $2B                    ; EEA3= 2B          + \ 63 -100  V
                .byte $27                    ; EEA4= 27          ' \ 64 -101  B
                .byte $1F                    ; EEA5= 1F          . \ 65 -102  M
                .byte $1B                    ; EEA6= 1B          . \ 66 -103  <
                .byte $17                    ; EEA7= 17          . \ 67 -104  >
                .byte $13                    ; EEA8= 13          . \ 68 -105  ?
LEEA9:
                .byte $05                    ; EEA9= 05          . \ 69 -106  COPY
                brk                          ; EEAA= 00          . \ 6A -107
                brk                          ; EEAB= 00          . \ 6B -108
                brk                          ; EEAC= 00          . \ 6C -109
                brk                          ; EEAD= 00          . \ 6D -110
                brk                          ; EEAE= 00          . \ 6E -111
                brk                          ; EEAF= 00          . \ 6F -112
                sec                          ; EEB0= 38          8 \ 70 -113  Esc
                brk                          ; EEB1= 00          . \ 71 -114  f1 - doesn't exist
                brk                          ; EEB2= 00          . \ 72 -115  f2 - doesn't exist
                brk                          ; EEB3= 00          . \ 73 -116  f3 - doesn't exist
                brk                          ; EEB4= 00          . \ 74 -117  f5 - doesn't exist
                brk                          ; EEB5= 00          . \ 75 -118  f6 - doesn't exist
                brk                          ; EEB6= 00          . \ 76 -119  f8 - doesn't exist
                brk                          ; EEB7= 00          . \ 77 -120  f9 - doesn't exist
                .byte $04                    ; EEB8= 04          . \ 78 -121  \
                .byte $04                    ; EEB9= 04          . \ 79 -122  ->

; Negative INKEY translation table overlaps following, giving results for -123 to -126
; ------------------------------------------------------------------------------------
; Mixed keys translation table
;
LEEBA:
                .text "]"                    ; EEBA= 5D          ] \ 7A -123 -> &1D U
                .text "~"                    ; EEBB= 7E          ~ \ 7B -124 -> &3E selects H to RETURN
                .byte $5c     ; EEBC= 5C          \ \ 7C -125 -> &1C 7
                .text "}"                    ; EEBD= 7D          } \ 7D -126 -> &3D selects Y to COPY
                .text "{"                    ; EEBE= 7B          { \ 7E -127 -> &3B SHIFT

LEEBF:
                jmp ($00FA)                  ; EEBF= 6C FA 00    lz.
LEEC2:
                jmp (LFDFE)                  ; EEC2= 6C FE FD    l~}

; Ctrl+Keypress translation table
; -------------------------------
; Converts &2C-&3B to control code
LEEC5:
                ;trb $1E1D                    ; EEC5= 1C 1D 1E    ...
                .byte $1C
                .byte $1D
                .byte $1E
                .byte $1F                    ; EEC8= 1F          .
                brk                          ; EEC9= 00          .
                and ($32),y                  ; EECA= 31 32       12
                .byte $33                    ; EECC= 33          3
                ;bit $35,x                    ; EECD= 34 35       45
                .byte $34
                .byte $35
                rol $37,x                    ; EECF= 36 37       67
                sec                          ; EED1= 38          8
                and $3B3A,y                  ; EED2= 39 3A 3B    9:;

; *HELP
; =====
LEED5:
                ldx #$09                     ; Issue service 9 - *Help
                jsr LF0A8
                jsr LF9BA                    ; Print inline text, corrupting FS workspace at &B8/9
LEEDD:
                .byte 13
                .if version==300
                .text "OS 3.00"
                .else
                .text "OS 1.00"
                .endif
                .byte 13
                .byte 0
                rts

LEEE8:
                php                          ; EEE8= 08          .
                sei                          ; EEE9= 78          x
                ldx #$00                     ; EEEA= A2 00       ".
                stx $0248                    ; EEEC= 8E 48 02    .H.
                lda $0253                    ; EEEF= AD 53 02    -S.
                sta $0251                    ; EEF2= 8D 51 02    .Q.
                jsr LC8A3                    ; EEF5= 20 A3 C8     #H
                plp                          ; EEF8= 28          (
                rts                          ; EEF9= 60          `

; Ctrl+Keypress translation table
; -------------------------------
; Converts &61-&7A to control code
LEEFA:
                ora ($02,x)                  ; EEFA= 01 02       ..
                .byte $03                    ; EEFC= 03          .
                ;tsb $05                      ; EEFD= 04 05       ..
                .byte $04
                .byte $05
                asl $07                      ; EEFF= 06 07       ..
                php                          ; EF01= 08          .
                ora #$0A                     ; EF02= 09 0A       ..
                .byte $0B                    ; EF04= 0B          .
                ;tsb $0E0D                    ; EF05= 0C 0D 0E    ...
                .byte $0C
                .byte $0D
                .byte $0E
                .byte $0F                    ; EF08= 0F          .
                bpl LEF1C                    ; EF09= 10 11       ..
                ;ora ($13)                    ; EF0B= 12 13       ..
                .byte $12
                .byte $13
                ;trb $15                      ; EF0D= 14 15       ..
                .byte $14
                .byte $15
                asl $17,x                    ; EF0F= 16 17       ..
                clc                          ; EF11= 18          .
                .word $1A19                  ; EF12= 19 1A       ..

; OSBYTE xx - Decrement ROM polling semaphore
; -------------------------------------------
LEF14:
                dec $0249                    ; EF14= CE 49 02    NI.
                rts                          ; EF17= 60          `

; Ctrl+Keypress translation table
; -------------------------------
; Converts &7F to control code
LEF18:
                .byte $7F                    ; EF18= 7F          .

LEF19:
                brk                          ; EF19= 00          .
                ;tsb $0C                      ; EF1A= 04 0C       ..
                .byte $04
                .byte $0C
LEF1C:
                ;ora ($16)                    ; EF1C= 12 16       ..
                .byte $12
                .byte $16
                ;inc a                        ; EF1E= 1A          .
                .byte $1A
                ora $2421,x                  ; EF1F= 1D 21 24    .!$
                and #$2C                     ; EF22= 29 2C       ),
                and ($35),y                  ; EF24= 31 35       15
                and $413D,y                  ; EF26= 39 3D 41    9=A
                eor $4A                      ; EF29= 45 4A       EJ
                lsr $5652                    ; EF2B= 4E 52 56    NRV
                .byte $5B                    ; EF2E= 5B          [
                lsr $6965,x                  ; EF2F= 5E 65 69    ^ei
                .byte $6F                    ; EF32= 6F          o
                ;adc ($72)                    ; EF33= 72 72       rr
                .byte $72
                .byte $72
                ;adc ($76)                    ; EF35= 72 76       rv
                .byte $72
                .byte $76
                ror $7A,x                    ; EF37= 76 7A       vz
                ;tsb $08                      ; EF39= 04 08       ..
                .byte $04
                .byte $08
                asl $04                      ; EF3B= 06 04       ..
                ;tsb $03                      ; EF3D= 04 03       ..
                .byte $04
                .byte $03
                ;tsb $03                      ; EF3F= 04 03       ..
                .byte $04
                .byte $03
                ora $03                      ; EF41= 05 03       ..
                ora $04                      ; EF43= 05 04       ..
                ;tsb $04                      ; EF45= 04 04       ..
                .byte $04
                .byte $04
                ;tsb $04                      ; EF47= 04 04       ..
                .byte $04
                .byte $04
                ora $04                      ; EF49= 05 04       ..
                ;tsb $04                      ; EF4B= 04 04       ..
                .byte $04
                .byte $04
                ora $03                      ; EF4D= 05 03       ..
                .byte $07                    ; EF4F= 07          .
                ;tsb $06                      ; EF50= 04 06       ..
                .byte $04
                .byte $06
                .byte $03                    ; EF52= 03          .
                brk                          ; EF53= 00          .
                brk                          ; EF54= 00          .
                ;tsb $00                      ; EF55= 04 00       ..
                .byte $04
                .byte $00
                ;tsb $05                      ; EF57= 04 05       ..
                .byte $04
                .byte $05
LEF59:
                .text "AUTO"
                .text "RENUMBER"
                .text "COLOUR"
                .text "DRAW"
                .text "ELSE"
                .text "FOR"
                .text "GOTO"
                .text "DEG"
                .text "INPUT"
                .text "RAD"
                .text "CHAIN"
                .text "LIST"
                .text "MODE"
                .text "NEXT"
                .text "OLD",13
                .text "PLOT"
                .text "LOCAL"
                .text "RUN",13
                .text "STEP"
                .text "THEN"
                .text "UNTIL"
                .text "VDU"
                .text "RESTORE"
                .text "PROC"
                .text "REPEAT"
                .text "END"
                .text "LOAD"
                .text "SAVE"
                .text "PRINT"
                .text "["
                .text "^"
                .text "|"
                .text "_"
                .text "`"

; Read bottom of user memory
; --------------------------
LEFDD:
                ldy $0244                    ; EFDD= AC 44 02    ,D.
                ldx #$00                     ; EFE0= A2 00       ".
                rts                          ; EFE2= 60          `

; Shift+Keypress translation table
; --------------------------------
; Converts &2C-&3A to shifted code
LEFE3:
                ;bit $3E3D,x                  ; EFE3= 3C 3D 3E    <=>
                .byte $3C
                .byte $3D
                .byte $3E
                .byte $3F                    ; EFE6= 3F          ?
                rti                          ; EFE7= 40          @

LEFE8:
                and ($22,x)                  ; EFE8= 21 22       !"
                .byte $23                    ; EFEA= 23          #
                bit $25                      ; EFEB= 24 25       $%
                rol $27                      ; EFED= 26 27       &'
                plp                          ; EFEF= 28          (
                and #$2A                     ; EFF0= 29 2A       )*
                .byte $2B                    ; EFF2= 2B          +
LEFF3:
                cmp #$7F                     ; EFF3= C9 7F       I.
                beq LF008                    ; EFF5= F0 11       p.
                bcc LEFFC                    ; EFF7= 90 03       ..
                eor #$20                     ; EFF9= 49 20       I
                rts                          ; EFFB= 60          `

LEFFC:
                cmp #$60                     ; EFFC= C9 60       I`
                bne LF002                    ; EFFE= D0 02       P.
                lda #$5F                     ; F000= A9 5F       )_
LF002:
                cmp #$40                     ; F002= C9 40       I@
                bcc LF008                    ; F004= 90 02       ..
                and #$1F                     ; F006= 29 1F       ).
LF008:
                rts                          ; F008= 60          `

LF009:
                .text "/!BOOT"               ; Command string for ROMFS boot
                .byte 13

; OSBYTE &78 - Write keys pressed data
; ------------------------------------
LF010:
                sty $EC                      ; Clear rollover keypress
LF012:
                lda LEE40,x                  ; Translate keypress in X
                sta $ED                      ; Store as current key pressed
                rts                          ;

; Shift+Keypress translation table
; --------------------------------
; Converts &61-&7A to shifted code
LF018:
                eor ($42,x)                  ; F018= 41 42       AB
                .byte $43                    ; F01A= 43          C
                .byte $44                    ; F01B= 44          D
                eor $46                      ; F01C= 45 46       EF
                .byte $47                    ; F01E= 47          G
                pha                          ; F01F= 48          H
                eor #$4A                     ; F020= 49 4A       IJ
                .byte $4B                    ; F022= 4B          K
                jmp $4E4D                    ; F023= 4C 4D 4E    LMN

                .byte $4F                    ; F026= 4F          O
                ;bvc LF07A                    ; F027= 50 51       PQ
                .byte $50
                .byte $51
                ;eor ($53)                    ; F029= 52 53       RS
                .byte $52
                .byte $53
                .byte $54                    ; F02B= 54          T
                eor $56,x                    ; F02C= 55 56       UV
                .byte $57                    ; F02E= 57          W
                cli                          ; F02F= 58          X
                .text "YZ"                   ; F030= 59 5A BC    YZ<

LF032:
                ldy $FE00,x                  ; F032= BC 00 FE    <.~
                rts                          ; F035= 60          `

; Shift+Keypress translation table
; --------------------------------
; Converts &61-&7A to shifted code
LF036:
                .byte $7F                    ; F036= 7F          .

; Func+Keypress translation table
; -------------------------------
; Func+number -> function key
; Func+letter -> &90-&A9
; Func+symbol -> &AA-&AF
;
; Converts &2C-&3B to Function code
LF037:
                .byte $AC                    ; F037= AC          ,   \ Func+, ->
                .byte $AD                    ; F038= AD          -   \ Func+- ->
                .byte $AE                    ; F039= AE          /   \ Func+/ ->
                .byte $AF                    ; F03A= AF          .   \ Func+. ->
                ;bra LEFBE                    ; F03B= 80 81       ..  \ Func+0 -> f0
                .byte $80
                .byte $81
                .byte $82                    ; F03D= 82          .
                .byte $83                    ; F03E= 83          .
                sty $85                      ; F03F= 84 85       ..
                stx $87                      ; F041= 86 87       ..
                dey                          ; F043= 88          .
                ;bit #$AA                     ; F044= 89 AA       .*  \ Func+: ->
                .byte $89
                .byte $AA
                .byte $AB                    ; F046= AB          +   \ Func+; ->

LF047:
                ldx #$FF                     ; F047= A2 FF       ".
LF049:
                inx                          ; F049= E8          h
                lsr a                        ; F04A= 4A          J
                bcc LF049                    ; F04B= 90 FC       .|
                stx $FC                      ; F04D= 86 FC       .|
                lda $FA                      ; F04F= A5 FA       %z
                eor #$FF                     ; F051= 49 FF       I.
                beq LF062                    ; F053= F0 0D       p.
                ldx #$00                     ; F055= A2 00       ".
LF057:
                inx                          ; F057= E8          h
                lsr a                        ; F058= 4A          J
                bcc LF057                    ; F059= 90 FC       .|
                txa                          ; F05B= 8A          .
                asl a                        ; F05C= 0A          .
                asl a                        ; F05D= 0A          .
                ora $FC                      ; F05E= 05 FC       .|
                tax                          ; F060= AA          *
                rts                          ; F061= 60          `

LF062:
                lda $FB                      ; F062= A5 FB       %{
                and #$3F                     ; F064= 29 3F       )?
                eor #$3F                     ; F066= 49 3F       I?
                ldx #$08                     ; F068= A2 08       ".
                bne LF057                    ; F06A= D0 EB       Pk

; Func+Keypress translation table
; -------------------------------
; Converts &61-&7A to Function code
LF06C:
                ; bcc LEFFF                    ; F06C= 90 91       ..
                ; sta ($93)                    ; F06E= 92 93       ..
                ; sty $95,x                    ; F070= 94 95       ..
                ; stx $97,y                    ; F072= 96 97       ..
                ; tya                          ; F074= 98          .
                ; sta $9B9A,y                  ; F075= 99 9A 9B    ...
                ; stz $9E9D                    ; F078= 9C 9D 9E    ...
                ; .byte $9F                    ; F07B= 9F          .
                .byte $90
                .byte $91
                .byte $92
                .byte $93
                .byte $94
                .byte $95
                .byte $96
                .byte $97
                .byte $98
                .byte $99
                .byte $9a
                .byte $9b
                .byte $9c
                .byte $9d
                .byte $9e
                .byte $9f
                .byte $a0
                .byte $a1
                .byte $a2
                .byte $a3
                .byte $a4
                .byte $a5
                .byte $a6
                .byte $a7
                .byte $a8
                .byte $a9

; Bitmask for 0-3
; ---------------
LF086:
                .byte $01                    ; F086= 01          .
                .byte $02                    ; F087= 02          .
                ;tsb $08                      ; F088= 04 08       ..
                .byte $04
                .byte $08

; Func+Keypress translation table
; -------------------------------
; Converts &7F to Function code
LF08A:
                .byte $7F                    ; F08A= 7F          .

LF08B:
                lda #$A1                     ; F08B= A9 A1       )!
                sta $E3                      ; F08D= 85 E3       .c
                lda #$19                     ; F08F= A9 19       ).
                sta $03D1                    ; F091= 8D D1 03    .Q.
LF094:
                lda #$06                     ; F094= A9 06       ).
                jsr LDDBA                    ; F096= 20 BA DD     :]
                ldx #$0E                     ; F099= A2 0E       ".
LF09B:
                lda LD845+$11,x                  ; F09B= BD 56 D8    =VX
                sta $0211,x                  ; F09E= 9D 11 02    ...
                dex                          ; F0A1= CA          J
                bne LF09B                    ; F0A2= D0 F7       Pw
                stx $C2                      ; F0A4= 86 C2       .B
                ldx #$0F                     ; F0A6= A2 0F       ".
LF0A8:
                lda $F4                      ; F0A8= A5 F4       %t
                pha                          ; F0AA= 48          H
                txa                          ; F0AB= 8A          .
                ldx #$0F                     ; F0AC= A2 0F       ".
LF0AE:
                inc $02A0,x                  ; F0AE= FE A0 02    ~ .
                dec $02A0,x                  ; F0B1= DE A0 02    ^ .
                bpl LF0C3                    ; F0B4= 10 0D       ..
                pha                          ; F0B6= 48          H
                jsr LE39F                    ; F0B7= 20 9F E3     .c
                pla                          ; F0BA= 68          h
                jsr $8003                    ; F0BB= 20 03 80     ..
                tax                          ; F0BE= AA          *
                beq LF0C6                    ; F0BF= F0 05       p.
                ldx $F4                      ; F0C1= A6 F4       &t
LF0C3:
                dex                          ; F0C3= CA          J
                bpl LF0AE                    ; F0C4= 10 E8       .h
LF0C6:
                pla                          ; F0C6= 68          h
                jsr LE3A0                    ; F0C7= 20 A0 E3      c
                txa                          ; F0CA= 8A          .
                rts                          ; F0CB= 60          `

                .if version==300
LF0B5_300:
                lda $7fff
                pha
                lda #$80
                sta $7fff
                asl a
                jsr LD02A_300
                lda $7fff
                bmi LF0D3_300
                ldx #$d8
                ldy #$01
                sty $d8
                tay
                jsr LFBF7_300
                lda $d8
LF0D3_300:
                sta $027f
                pla
                sta $7fff
                rts
                .endif

                .if version==300
LF0DB_300:
                php
                sei
                sec
                ror a
                sta LFC7F
                rol a
                stx $d6
                sty $d7
                ldy #0
                bvs LF0ED_300
                lda ($d6),y
LF0ED_300:
                sta ($d6),y
                ldy $d7
                clc
                ror a
                sta LFC7F
                rol a
                plp
                rts
                .endif

; OSARGS
; ======
LF0CC:
                cpy #$00                     ; Y<>0, exit
                bne LF0D9
                ora #$00                     ; A<>0, exit
                bne LF0D9
                lda $0247                    ; Get CFS/RFS switch, convert to FS number
                ora #$01
LF0D9:
                rts

; FSCV DISPATCH TABLE
; -------------------
LF0DA:
                .word LF4A4-1
                .word LF578-1
                .word LF25B-1
                .word LE07E-1
                .word LF25B-1
                .word LF281-1
                .word LDFE3-1

; CFS/RFS FSC
; ===========
LF0E8:
                cmp #$07                     ; F0E8= C9 07       I.
                bcs LF0D9                    ; F0EA= B0 ED       0m
                stx $BC                      ; F0EC= 86 BC       .<
                asl a                        ; F0EE= 0A          .
                tax                          ; F0EF= AA          *
                lda LF0DA+1,x                  ; F0F0= BD DB F0    =[p
                pha                          ; F0F3= 48          H
                lda LF0DA,x                  ; F0F4= BD DA F0    =Zp
                pha                          ; F0F7= 48          H
                ldx $BC                      ; F0F8= A6 BC       &<
                rts                          ; F0FA= 60          `

; CFS/RFS Load file
; =================
; A=&FF - called from LOAD
; A=&00 - called from RUN
LF0FB:
                php                          ; F0FB= 08          .
                pha                          ; F0FC= 48          H
                jsr LFA82                    ; F0FD= 20 82 FA     .z
                lda $03C2                    ; F100= AD C2 03    -B.
                pha                          ; F103= 48          H
                jsr LF58B                    ; F104= 20 8B F5     .u
                pla                          ; F107= 68          h
                beq LF124                    ; F108= F0 1A       p.
                ldx #$03                     ; F10A= A2 03       ".
                lda #$FF                     ; F10C= A9 FF       ).
LF10E:
                pha                          ; F10E= 48          H
                lda $03BE,x                  ; F10F= BD BE 03    =>.
                sta $B0,x                    ; F112= 95 B0       .0
                pla                          ; F114= 68          h
                and $B0,x                    ; F115= 35 B0       50
                dex                          ; F117= CA          J
                bpl LF10E                    ; F118= 10 F4       .t
                cmp #$FF                     ; F11A= C9 FF       I.
                bne LF124                    ; F11C= D0 06       P.
                jsr LFA59                    ; F11E= 20 59 FA     Yz
                jmp LDFD5                    ; F121= 4C D5 DF    LU_

LF124:
                lda $03CA                    ; F124= AD CA 03    -J.
                lsr a                        ; F127= 4A          J
                pla                          ; F128= 68          h
                beq LF139                    ; F129= F0 0E       p.
                bcc LF140                    ; F12B= 90 13       ..
LF12D:
                jsr LFA63                    ; F12D= 20 63 FA     cz
                brk                          ; F130= 00          .
                cmp $4C,x                    ; F131= D5 4C       UL
                .byte $6F                    ; F133= 6F          o
                .byte $63                    ; F134= 63          c
                .byte $6B                    ; F135= 6B          k
                adc $64                      ; F136= 65 64       ed
                brk                          ; F138= 00          .
LF139:
                bcc LF140                    ; F139= 90 05       ..
                lda #$03                     ; F13B= A9 03       ).
                sta $0258                    ; F13D= 8D 58 02    .X.
LF140:
                lda #$30                     ; F140= A9 30       )0
                and $BB                      ; F142= 25 BB       %;
                beq LF14A                    ; F144= F0 04       p.
                lda $C1                      ; F146= A5 C1       %A
                bne LF154                    ; F148= D0 0A       P.
LF14A:
                tya                          ; F14A= 98          .
                pha                          ; F14B= 48          H
                jsr LFB5C                    ; F14C= 20 5C FB     \{
                pla                          ; F14F= 68          h
                tay                          ; F150= A8          (
                jsr LF735                    ; F151= 20 35 F7     5w
LF154:
                jsr LF924                    ; F154= 20 24 F9     $y
                bne LF1AC                    ; F157= D0 53       PS
                jsr LFAFA                    ; F159= 20 FA FA     zz
                bit $03CA                    ; F15C= 2C CA 03    ,J.
                bmi LF169                    ; F15F= 30 08       0.
                jsr LF8DA                    ; F161= 20 DA F8     Zx
                jsr LF6DB                    ; F164= 20 DB F6     [v
                bne LF140                    ; F167= D0 D7       PW

; Update control block
; BUG! &C8/9 only set when called from OSFILE, will not be set by *RUN
LF169:
                ldy #$02
LF16B:
                lda $03BC,y                  ; Copy load/exec addresses
                sta ($C8),y
                iny
                cpy #$0A
                bne LF16B
                lda $03C8                    ; Length b0-b7=block length
                sta ($C8),y
                iny
                lda $03C9
                clc
                adc $03C6                    ; Length b8-b23=block number
                sta ($C8),y
                iny
                lda #$00
                adc $03C7                    ; Length b16-b23=overflow
                sta ($C8),y
                iny                          ; Length b24-b31=0
                lda #$00
                sta ($C8),y
                iny
LF192:
                lda $03BD,y                  ; Copy RFS address at &03CB-&03CE to Attr
                sta ($C8),y
                iny
                cpy #$12
                bne LF192
                plp
LF19D:
                jsr LFA59                    ; F19D= 20 59 FA     Yz
LF1A0:
                bit $BA                      ; F1A0= 24 BA       $:
                bmi LF1AB                    ; F1A2= 30 07       0.
LF1A4:
                php
                jsr LF9B6                    ; Print inline text
                .byte 13                     ; Could just do JSR OSNEWL
                .byte 0
                plp
LF1AB:
                rts                          ; F1AB= 60          `

LF1AC:
                jsr LF591                    ; F1AC= 20 91 F5     .u
                bne LF140                    ; F1AF= D0 8F       P.
LF1B1:
                sei                          ; F1B1= 78          x
                stx $F2                      ; F1B2= 86 F2       .r
                sty $F3                      ; F1B4= 84 F3       .s
                ldy #$00                     ; F1B6= A0 00        .
                jsr LE7FC                    ; F1B8= 20 FC E7     |g
                ldx #$00                     ; F1BB= A2 00       ".
LF1BD:
                jsr LE80E                    ; F1BD= 20 0E E8     .h
                bcs LF1CF                    ; F1C0= B0 0D       0.
                beq LF1CC                    ; F1C2= F0 08       p.
                sta $03D2,x                  ; F1C4= 9D D2 03    .R.
                inx                          ; F1C7= E8          h
                cpx #$0B                     ; F1C8= E0 0B       `.
                bne LF1BD                    ; F1CA= D0 F1       Pq
LF1CC:
                jmp LE86E                    ; F1CC= 4C 6E E8    Lnh

LF1CF:
                lda #$00                     ; F1CF= A9 00       ).
                sta $03D2,x                  ; F1D1= 9D D2 03    .R.
                cli                          ; F1D4= 58          X
LF1D5:
                rts                          ; F1D5= 60          `

; CFS/RFS OSFILE
; ==============
LF1D6:
                pha                          ; F1D6= 48          H
                stx $C8                      ; F1D7= 86 C8       .H
                sty $C9                      ; F1D9= 84 C9       .I
                ldy #$00                     ; F1DB= A0 00        .
                lda ($C8),y                  ; F1DD= B1 C8       1H
                tax                          ; F1DF= AA          *
                iny                          ; F1E0= C8          H
                lda ($C8),y                  ; F1E1= B1 C8       1H
                tay                          ; F1E3= A8          (
                jsr LF1B1                    ; F1E4= 20 B1 F1     1q
                ldy #$02                     ; F1E7= A0 02        .
LF1E9:
                lda ($C8),y                  ; F1E9= B1 C8       1H
                sta $03BC,y                  ; F1EB= 99 BC 03    .<.
                sta $00AE,y                  ; F1EE= 99 AE 00    ...
                iny                          ; F1F1= C8          H
                cpy #$0A                     ; F1F2= C0 0A       @.
                bne LF1E9                    ; F1F4= D0 F3       Ps
                pla                          ; F1F6= 68          h
                beq LF200                    ; F1F7= F0 07       p.
                cmp #$FF                     ; F1F9= C9 FF       I.
                bne LF1D5                    ; F1FB= D0 D8       PX
                jmp LF0FB                    ; F1FD= 4C FB F0    L{p

LF200:
                sta $03C6                    ; F200= 8D C6 03    .F.
                sta $03C7                    ; F203= 8D C7 03    .G.
LF206:
                lda ($C8),y                  ; F206= B1 C8       1H
                sta $00A6,y                  ; F208= 99 A6 00    .&.
                iny                          ; F20B= C8          H
                cpy #$12                     ; F20C= C0 12       @.
                bne LF206                    ; F20E= D0 F6       Pv
                txa                          ; F210= 8A          .
                beq LF1CC                    ; F211= F0 B9       p9
                jsr LFA82                    ; F213= 20 82 FA     .z
                jsr LF893                    ; F216= 20 93 F8     .x
                lda #$00                     ; F219= A9 00       ).
                jsr LFB5E                    ; F21B= 20 5E FB     ^{
LF21E:
                sec                          ; F21E= 38          8
                ldx #$FD                     ; F21F= A2 FD       "}
LF221:
                lda LFFB7,x                  ; F221= BD B7 FF    =7.
                sbc LFFB3,x                  ; F224= FD B3 FF    }3.
                sta $02CB,x                  ; F227= 9D CB 02    .K.
                inx                          ; F22A= E8          h
                bne LF221                    ; F22B= D0 F4       Pt
                tay                          ; F22D= A8          (
                bne LF23E                    ; F22E= D0 0E       P.
                cpx $03C8                    ; F230= EC C8 03    lH.
                lda #$01                     ; F233= A9 01       ).
                sbc $03C9                    ; F235= ED C9 03    mI.
                bcc LF23E                    ; F238= 90 04       ..
                ldx #$80                     ; F23A= A2 80       ".
                bne LF246                    ; F23C= D0 08       P.
LF23E:
                lda #$01                     ; F23E= A9 01       ).
                sta $03C9                    ; F240= 8D C9 03    .I.
                stx $03C8                    ; F243= 8E C8 03    .H.
LF246:
                stx $03CA                    ; F246= 8E CA 03    .J.
                jsr LF74C                    ; F249= 20 4C F7     Lw
                bmi LF1D5                    ; F24C= 30 87       0.
                jsr LF8DA                    ; F24E= 20 DA F8     Zx
                inc $03C6                    ; F251= EE C6 03    nF.
                bne LF21E                    ; F254= D0 C8       PH
                inc $03C7                    ; F256= EE C7 03    nG.
                bne LF21E                    ; F259= D0 C3       PC

; *RUN <filename>
; ===============
LF25B:
                jsr LF1B1                    ; F25B= 20 B1 F1     1q
                ldx #$FF                     ; F25E= A2 FF       ".
                stx $03C2                    ; F260= 8E C2 03    .B.
                jsr LF0FB                    ; F263= 20 FB F0     {p
                bit $027A                    ; F266= 2C 7A 02    ,z.
                bpl LF275                    ; F269= 10 0A       ..
                lda $03C4                    ; F26B= AD C4 03    -D.
                and $03C5                    ; F26E= 2D C5 03    -E.
                cmp #$FF                     ; F271= C9 FF       I.
                bne LF278                    ; F273= D0 03       P.
LF275:
                jmp ($03C2)                  ; F275= 6C C2 03    lB.

LF278:
                ldx #$C2                     ; F278= A2 C2       "B
                ldy #$03                     ; F27A= A0 03        .
                lda #$04                     ; F27C= A9 04       ).
                jmp LFB68                    ; F27E= 4C 68 FB    Lh{

; *CAT
; ====
LF281:
                lda #$08                     ; F281= A9 08       ).
                jsr LF29A                    ; F283= 20 9A F2     .r
                jsr LFA82                    ; F286= 20 82 FA     .z
                lda #$00                     ; F289= A9 00       ).
                jsr LF29E                    ; F28B= 20 9E F2     .r
                jsr LFA6D                    ; F28E= 20 6D FA     mz
LF291:
                lda #$F7                     ; F291= A9 F7       )w
LF293:
                and $E2                      ; F293= 25 E2       %b
LF295:
                sta $E2                      ; F295= 85 E2       .b
                rts                          ; F297= 60          `

LF298:
                lda #$40                     ; F298= A9 40       )@
LF29A:
                ora $E2                      ; F29A= 05 E2       .b
                bne LF295                    ; F29C= D0 F7       Pw
LF29E:
                pha                          ; F29E= 48          H
                lda $0247                    ; F29F= AD 47 02    -G.
                beq LF2AF                    ; F2A2= F0 0B       p.
                jsr LEA92                    ; F2A4= 20 92 EA     .j
                jsr LEA97                    ; F2A7= 20 97 EA     .j
                bcc LF2AF                    ; F2AA= 90 03       ..
                clv                          ; F2AC= B8          8
                bvc LF2F0                    ; F2AD= 50 41       PA
LF2AF:
                jsr LF6DB                    ; F2AF= 20 DB F6     [v
                lda $03C6                    ; F2B2= AD C6 03    -F.
                sta $B4                      ; F2B5= 85 B4       .4
                lda $03C7                    ; F2B7= AD C7 03    -G.
                sta $B5                      ; F2BA= 85 B5       .5
                ldx #$FF                     ; F2BC= A2 FF       ".
                stx $03DF                    ; F2BE= 8E DF 03    ._.
                inx                          ; F2C1= E8          h
                stx $BA                      ; F2C2= 86 BA       .:
                beq LF2CC                    ; F2C4= F0 06       p.
LF2C6:
                jsr LFAFA                    ; F2C6= 20 FA FA     zz
                jsr LF6DB                    ; F2C9= 20 DB F6     [v
LF2CC:
                lda $0247                    ; F2CC= AD 47 02    -G.
                beq LF2D3                    ; F2CF= F0 02       p.
                bvc LF2F0                    ; F2D1= 50 1D       P.
LF2D3:
                pla                          ; F2D3= 68          h
                pha                          ; F2D4= 48          H
                beq LF304                    ; F2D5= F0 2D       p-
                jsr LF9E2                    ; F2D7= 20 E2 F9     by
                bne LF2F2                    ; F2DA= D0 16       P.
                lda #$30                     ; F2DC= A9 30       )0
                and $BB                      ; F2DE= 25 BB       %;
                beq LF2F0                    ; F2E0= F0 0E       p.
                lda $03C6                    ; F2E2= AD C6 03    -F.
                cmp $B6                      ; F2E5= C5 B6       E6
                bne LF2F2                    ; F2E7= D0 09       P.
                lda $03C7                    ; F2E9= AD C7 03    -G.
                cmp $B7                      ; F2EC= C5 B7       E7
                bne LF2F2                    ; F2EE= D0 02       P.
LF2F0:
                pla                          ; F2F0= 68          h
                rts                          ; F2F1= 60          `

LF2F2:
                lda $0247                    ; F2F2= AD 47 02    -G.
                beq LF304                    ; F2F5= F0 0D       p.
LF2F7:
                jsr LEAAD                    ; F2F7= 20 AD EA     -j
LF2FA:
                lda #$FF                     ; F2FA= A9 FF       ).
                sta $03C6                    ; F2FC= 8D C6 03    .F.
                sta $03C7                    ; F2FF= 8D C7 03    .G.
                bne LF2C6                    ; F302= D0 C2       PB
LF304:
                bvc LF30B                    ; F304= 50 05       P.
                lda #$FF                     ; F306= A9 FF       ).
                jsr LF737                    ; F308= 20 37 F7     7w
LF30B:
                ldx #$00                     ; F30B= A2 00       ".
                jsr LF949                    ; F30D= 20 49 F9     Iy
                lda $0247                    ; F310= AD 47 02    -G.
                beq LF319                    ; F313= F0 04       p.
                bit $BB                      ; F315= 24 BB       $;
                bvc LF2F7                    ; F317= 50 DE       P^
LF319:
                bit $03CA                    ; F319= 2C CA 03    ,J.
                bmi LF2FA                    ; F31C= 30 DC       0\
                bpl LF2C6                    ; F31E= 10 A6       .&

; CFS/RFS OSFIND HANDLER
; ======================
LF320:
                sta $BC                      ; F320= 85 BC       .<
                txa                          ; F322= 8A          .
                pha                          ; F323= 48          H
                tya                          ; F324= 98          .
                pha                          ; F325= 48          H
                lda $BC                      ; F326= A5 BC       %<
                bne LF348                    ; F328= D0 1E       P.
                tya                          ; F32A= 98          .
                bne LF339                    ; F32B= D0 0C       P.
                jsr LDFE3                    ; F32D= 20 E3 DF     c_
                jsr LF3CE                    ; F330= 20 CE F3     Ns
LF333:
                lsr $E2                      ; F333= 46 E2       Fb
                asl $E2                      ; F335= 06 E2       .b
                bcc LF345                    ; F337= 90 0C       ..
LF339:
                lsr a                        ; F339= 4A          J
                bcs LF333                    ; F33A= B0 F7       0w
                lsr a                        ; F33C= 4A          J
                bcs LF342                    ; F33D= B0 03       0.
                jmp LFB43                    ; F33F= 4C 43 FB    LC{

LF342:
                jsr LF3CE                    ; F342= 20 CE F3     Ns
LF345:
                jmp LF3C7                    ; F345= 4C C7 F3    LGs

LF348:
                jsr LF1B1                    ; F348= 20 B1 F1     1q
                bit $BC                      ; F34B= 24 BC       $<
                bvc LF38C                    ; F34D= 50 3D       P=
                lda #$00                     ; F34F= A9 00       ).
                sta $039E                    ; F351= 8D 9E 03    ...
                sta $03DD                    ; F354= 8D DD 03    .].
                sta $03DE                    ; F357= 8D DE 03    .^.
                lda #$3E                     ; F35A= A9 3E       )>
                jsr LF293                    ; F35C= 20 93 F2     .r
                jsr LFA75                    ; F35F= 20 75 FA     uz
                php                          ; F362= 08          .
                jsr LF58B                    ; F363= 20 8B F5     .u
                jsr LF611                    ; F366= 20 11 F6     .v
                plp                          ; F369= 28          (
                ldx #$FF                     ; F36A= A2 FF       ".
LF36C:
                inx                          ; F36C= E8          h
                lda $03B2,x                  ; F36D= BD B2 03    =2.
                sta $03A7,x                  ; F370= 9D A7 03    .'.
                bne LF36C                    ; F373= D0 F7       Pw
                lda #$01                     ; F375= A9 01       ).
                jsr LF29A                    ; F377= 20 9A F2     .r
                lda $02DE                    ; F37A= AD DE 02    -^.
                ora $02DF                    ; F37D= 0D DF 02    ._.
                bne LF385                    ; F380= D0 03       P.
                jsr LF298                    ; F382= 20 98 F2     .r
LF385:
                lda #$01                     ; F385= A9 01       ).
                ora $0247                    ; F387= 0D 47 02    .G.
                bne LF3C5                    ; F38A= D0 39       P9
LF38C:
                txa                          ; F38C= 8A          .
                bne LF392                    ; F38D= D0 03       P.
                jmp LE86E                    ; F38F= 4C 6E E8    Lnh

LF392:
                ldx #$FF                     ; F392= A2 FF       ".
LF394:
                inx                          ; F394= E8          h
                lda $03D2,x                  ; F395= BD D2 03    =R.
                sta $0380,x                  ; F398= 9D 80 03    ...
                bne LF394                    ; F39B= D0 F7       Pw
                lda #$FF                     ; F39D= A9 FF       ).
                ldx #$08                     ; F39F= A2 08       ".
LF3A1:
                sta $038B,x                  ; F3A1= 9D 8B 03    ...
                dex                          ; F3A4= CA          J
                bne LF3A1                    ; F3A5= D0 FA       Pz
                txa                          ; F3A7= 8A          .
                ldx #$14                     ; F3A8= A2 14       ".
LF3AA:
                sta $0380,x                  ; F3AA= 9D 80 03    ...
                inx                          ; F3AD= E8          h
                cpx #$1E                     ; F3AE= E0 1E       `.
                bne LF3AA                    ; F3B0= D0 F8       Px
                rol $0397                    ; F3B2= 2E 97 03    ...
                jsr LFA82                    ; F3B5= 20 82 FA     .z
                jsr LF893                    ; F3B8= 20 93 F8     .x
                jsr LFA63                    ; F3BB= 20 63 FA     cz
                lda #$02                     ; F3BE= A9 02       ).
                jsr LF29A                    ; F3C0= 20 9A F2     .r
                lda #$02                     ; F3C3= A9 02       ).
LF3C5:
                sta $BC                      ; F3C5= 85 BC       .<
LF3C7:
                pla                          ; F3C7= 68          h
                tay                          ; F3C8= A8          (
                pla                          ; F3C9= 68          h
                tax                          ; F3CA= AA          *
                lda $BC                      ; F3CB= A5 BC       %<
LF3CD:
                rts                          ; F3CD= 60          `

LF3CE:
                lda #$02                     ; F3CE= A9 02       ).
                and $E2                      ; F3D0= 25 E2       %b
                beq LF3CD                    ; F3D2= F0 F9       py
                lda #$00                     ; F3D4= A9 00       ).
                sta $0397                    ; F3D6= 8D 97 03    ...
                lda #$80                     ; F3D9= A9 80       ).
                ldx $039D                    ; F3DB= AE 9D 03    ...
                stx $0396                    ; F3DE= 8E 96 03    ...
                sta $0398                    ; F3E1= 8D 98 03    ...
                jsr LF3EC                    ; F3E4= 20 EC F3     ls
                lda #$FD                     ; F3E7= A9 FD       )}
                jmp LF293                    ; F3E9= 4C 93 F2    L.r

LF3EC:
                jsr LFA75                    ; F3EC= 20 75 FA     uz
                jsr LF8C9                    ; F3EF= 20 C9 F8     Ix
                ldx #$11                     ; F3F2= A2 11       ".
LF3F4:
                lda $038C,x                  ; F3F4= BD 8C 03    =..
                sta $03BE,x                  ; F3F7= 9D BE 03    .>.
                dex                          ; F3FA= CA          J
                bpl LF3F4                    ; F3FB= 10 F7       .w
                stx $B2                      ; F3FD= 86 B2       .2
                stx $B3                      ; F3FF= 86 B3       .3
                lda #$00                     ; F401= A9 00       ).
                sta $B0                      ; F403= 85 B0       .0
                lda #$09                     ; F405= A9 09       ).
                sta $B1                      ; F407= 85 B1       .1
                ldx #$7F                     ; F409= A2 7F       ".
                jsr LFB12                    ; F40B= 20 12 FB     .{
                sta $03DF                    ; F40E= 8D DF 03    ._.
                jsr LFB1F                    ; F411= 20 1F FB     .{
                jsr LF74C                    ; F414= 20 4C F7     Lw
                inc $0394                    ; F417= EE 94 03    n..
                bne LF41F                    ; F41A= D0 03       P.
                inc $0395                    ; F41C= EE 95 03    n..
LF41F:
                rts                          ; F41F= 60          `

LF420:
                txa                          ; F420= 8A          .
                pha                          ; F421= 48          H
                tya                          ; F422= 98          .
                pha                          ; F423= 48          H
                lda #$01                     ; F424= A9 01       ).
                jsr LFB2D                    ; F426= 20 2D FB     -{
                lda $E2                      ; F429= A5 E2       %b
                asl a                        ; F42B= 0A          .
                bcs LF47A                    ; F42C= B0 4C       0L
                asl a                        ; F42E= 0A          .
                bcc LF43A                    ; F42F= 90 09       ..
                lda #$80                     ; F431= A9 80       ).
                jsr LF29A                    ; F433= 20 9A F2     .r
                lda #$FE                     ; F436= A9 FE       )~
                bcs LF472                    ; F438= B0 38       08
LF43A:
                ldx $039E                    ; F43A= AE 9E 03    ...
                inx                          ; F43D= E8          h
                cpx $02DE                    ; F43E= EC DE 02    l^.
                bne LF46D                    ; F441= D0 2A       P*
                bit $02E0                    ; F443= 2C E0 02    ,`.
                bmi LF46A                    ; F446= 30 22       0"
                lda $02E1                    ; F448= AD E1 02    -a.
                pha                          ; F44B= 48          H
                jsr LFA75                    ; F44C= 20 75 FA     uz
                php                          ; F44F= 08          .
                jsr LF609                    ; F450= 20 09 F6     .v
                plp                          ; F453= 28          (
                pla                          ; F454= 68          h
                sta $BC                      ; F455= 85 BC       .<
                clc                          ; F457= 18          .
                bit $02E0                    ; F458= 2C E0 02    ,`.
                bpl LF474                    ; F45B= 10 17       ..
                lda $02DE                    ; F45D= AD DE 02    -^.
                ora $02DF                    ; F460= 0D DF 02    ._.
                bne LF474                    ; F463= D0 0F       P.
                jsr LF298                    ; F465= 20 98 F2     .r
                bne LF474                    ; F468= D0 0A       P.
LF46A:
                jsr LF298                    ; F46A= 20 98 F2     .r
LF46D:
                dex                          ; F46D= CA          J
                clc                          ; F46E= 18          .
                lda $0A00,x                  ; F46F= BD 00 0A    =..
LF472:
                sta $BC                      ; F472= 85 BC       .<
LF474:
                inc $039E                    ; F474= EE 9E 03    n..
                jmp LF3C7                    ; F477= 4C C7 F3    LGs

LF47A:
                brk                          ; F47A= 00          .
                .byte $DF                    ; F47B= DF          _
                eor $4F                      ; F47C= 45 4F       EO
                lsr $00                      ; F47E= 46 00       F.
LF480:
                sta $C4                      ; F480= 85 C4       .D
                txa                          ; F482= 8A          .
                pha                          ; F483= 48          H
                tya                          ; F484= 98          .
                pha                          ; F485= 48          H
                lda #$02                     ; F486= A9 02       ).
                jsr LFB2D                    ; F488= 20 2D FB     -{
                ldx $039D                    ; F48B= AE 9D 03    ...
                lda $C4                      ; F48E= A5 C4       %D
                sta $0900,x                  ; F490= 9D 00 09    ...
                inx                          ; F493= E8          h
                bne LF49C                    ; F494= D0 06       P.
                jsr LF3EC                    ; F496= 20 EC F3     ls
                jsr LFA63                    ; F499= 20 63 FA     cz
LF49C:
                inc $039D                    ; F49C= EE 9D 03    n..
                lda $C4                      ; F49F= A5 C4       %D
                jmp LF3C5                    ; F4A1= 4C C5 F3    LEs

; CFS/RFS FILE OPTIONS, OPT X,Y
; =============================
LF4A4:
                txa                          ; *OPT 0 - set default options
                beq LF4D5
                cpx #$03                     ; *OPT 3 - set interblock gap
                beq LF4CA
                cpy #$03                     ; Y>2, jump to Bad command
                bcs LF4B5
                dex                          ; *OPT 1 - set message level
                beq LF4B8
                dex                          ; *OPT 2 - set error level
                beq LF4BF
LF4B5:
                jmp LE07E                    ; Bad option, jump to Bad command

; OPT 1,Y - set message level
; ---------------------------
LF4B8:
                lda #$33                     ; F4B8= A9 33       )3
                iny                          ; F4BA= C8          H
                iny                          ; F4BB= C8          H
                iny                          ; F4BC= C8          H
                bne LF4C1                    ; F4BD= D0 02       P.

; OPT 2,Y - set error level
; -------------------------
LF4BF:
                lda #$CC                     ; F4BF= A9 CC       )L
LF4C1:
                iny                          ; F4C1= C8          H
                and $E3                      ; F4C2= 25 E3       %c
LF4C4:
                ora LF4D8,y                  ; F4C4= 19 D8 F4    .Xt
                sta $E3                      ; F4C7= 85 E3       .c
                rts                          ; F4C9= 60          `

; OPT 3,Y - set interblock gap
; ----------------------------
LF4CA:
                tya                          ; F4CA= 98          .
                bmi LF4CF                    ; F4CB= 30 02       0.
                bne LF4D1                    ; F4CD= D0 02       P.
LF4CF:
                lda #$19                     ; F4CF= A9 19       ).
LF4D1:
                sta $03D1                    ; F4D1= 8D D1 03    .Q.
                rts                          ; F4D4= 60          `

LF4D5:
                tay                          ; F4D5= A8          (
                beq LF4C4                    ; F4D6= F0 EC       pl

; CFS/RFS OPTION LOOKUP TABLE
; ---------------------------
LF4D8:
                .byte $A1                    ; %1010 0001 - default
;                   :\  +------- load/save=short messages, retry errors
;                   :\       +-- bget/bput=no messages, abort errors
                .byte $00                    ; %0000 0000 - *OPT 2,0 - ignore errors
                .byte $22                    ; %0010 0010 - *OPT 2,1 - retry errors
                .byte $11                    ; %0001 0001 - *OPT 2,2 - abort errors
                .byte $00                    ; %0000 0000 - *OPT 1,0 - no messages
                .byte $88                    ; %1000 1000 - *OPT 1,1 - short messages
                .byte $CC                    ; %1100 1100 - *OPT 1,2 - long messages

LF4DF:
                tax
                dec $C0                      ; filing system buffer flag
                lda $0247                    ; filing system flag 0=CFS 2=RFS
                beq LF4EE                    ; F4E5= F0 07       p.
                jsr LEAA6                    ; F4E7= 20 A6 EA     &j
                tay                          ; F4EA= A8          (
                clc                          ; F4EB= 18          .
                bcc LF50A                    ; F4EC= 90 1C       ..

LF4EE:
                txa                          ; F4EE= 8A          .
                pha                          ; F4EF= 48          H
                and #$20                     ; F4F0= 29 20       )
                beq LF4FF                    ; F4F2= F0 0B       p.
                ldy $CA                      ; F4F4= A4 CA       $J
                beq LF4FF                    ; F4F6= F0 07       p.
                pla                          ; F4F8= 68          h
                lda $BD                      ; F4F9= A5 BD       %=
                sta LFE04                    ; F4FB= 8D 04 FE    ..~
                rts                          ; F4FE= 60          `

LF4FF:
                ldy LFE04                    ; F4FF= AC 04 FE    ,.~
                lda #$40                     ; F502= A9 40       )@
                sta LFE05                    ; F504= 8D 05 FE    ..~
                pla                          ; F507= 68          h
                asl a                        ; F508= 0A          .
                asl a                        ; F509= 0A          .
LF50A:
                ldx $C2                      ; F50A= A6 C2       &B
                beq LF577                    ; F50C= F0 69       pi
                dex                          ; F50E= CA          J
                bne LF517                    ; F50F= D0 06       P.
                bcc LF577                    ; F511= 90 64       .d
                ldy #$02                     ; F513= A0 02        .
                bne LF575                    ; F515= D0 5E       P^
LF517:
                dex                          ; F517= CA          J
                bne LF52D                    ; F518= D0 13       P.
                bcs LF577                    ; F51A= B0 5B       0[
                tya                          ; F51C= 98          .
                jsr LFB09                    ; F51D= 20 09 FB     .{
                ldy #$03                     ; F520= A0 03        .
                cmp #$2A                     ; F522= C9 2A       I*
                beq LF575                    ; F524= F0 4F       pO
                jsr LFACD                    ; F526= 20 CD FA     Mz
                ldy #$01                     ; F529= A0 01        .
                bne LF575                    ; F52B= D0 48       PH
LF52D:
                dex                          ; F52D= CA          J
                bne LF53C                    ; F52E= D0 0C       P.
                bcs LF536                    ; F530= B0 04       0.
                sty $BD                      ; F532= 84 BD       .=
                beq LF577                    ; F534= F0 41       pA

LF536:
                lda #$80                     ; else A=&80
                sta $C0                      ; filing system buffer flag
                bne LF577                    ; exit

LF53C:
                dex                          ; F53C= CA          J
                bne LF568                    ; F53D= D0 29       P)
                bcs LF570                    ; F53F= B0 2F       0/
                tya                          ; F541= 98          .
                jsr LF710                    ; update CRC
                ldy $BC                      ; get offset into current block
                inc $BC                      ; increment offset into current block
                bit $BD                      ; if bit 7 set this is the last byte read
                bmi LF55A                    ; F54B= 30 0D       0.
                jsr LFB4D                    ; F54D= 20 4D FB     M{
                beq LF557                    ; F550= F0 05       p.
                stx LFCE5                    ; send to Tube
                bne LF55A
LF557:
                txa                          ; store to I/O memory
                sta ($B0),y
LF55A:
                iny                          ; increment block offset
                cpy $03C8                    ; exit if not end of block
                bne LF577
                lda #$01                     ; A=1 for two bytes of CRC to fetch
                sta $BC
                ldy #$05                     ; jump to set progress=&05, fetching CRC
                bne LF575

; Progress=&05, fetching CRC
LF568:
                tya                          ; F568= 98          .
                jsr LF710                    ; F569= 20 10 F7     .w
                dec $BC                      ; F56C= C6 BC       F<
                bpl LF577                    ; F56E= 10 07       ..
LF570:
                jsr LFAB0                    ; F570= 20 B0 FA     0z
                ldy #$00                     ; F573= A0 00        .
LF575:
                sty $C2                      ; F575= 84 C2       .B
LF577:
                rts                          ; F577= 60          `

; CFS/RFS FSCV &01 - check EOF
; ============================
LF578:
                pha                          ; F578= 48          H
                tya                          ; F579= 98          .
                pha                          ; F57A= 48          H
                txa                          ; F57B= 8A          .
                tay                          ; F57C= A8          (
                lda #$03                     ; F57D= A9 03       ).
                jsr LFB2D                    ; F57F= 20 2D FB     -{
                lda $E2                      ; F582= A5 E2       %b
                and #$40                     ; F584= 29 40       )@
                tax                          ; F586= AA          *
                pla                          ; F587= 68          h
                tay                          ; F588= A8          (
                pla                          ; F589= 68          h
                rts                          ; F58A= 60          `

; Search for file
; ===============
LF58B:
                lda #$00                     ; F58B= A9 00       ).
                sta $B4                      ; F58D= 85 B4       .4
                sta $B5                      ; F58F= 85 B5       .5
LF591:
                lda $B4                      ; F591= A5 B4       %4
                pha                          ; F593= 48          H
                sta $B6                      ; F594= 85 B6       .6
                lda $B5                      ; F596= A5 B5       %5
                pha                          ; F598= 48          H
                sta $B7                      ; F599= 85 B7       .7
                jsr LF9B6                    ; F59B= 20 B6 F9     6y
                .text "Searching"
                .byte $0D
                .byte $00
                lda #$FF                     ; A=&FF for loading (A=0 for CAT)
                jsr LF29E                    ; Search for header
                pla                          ; F5AE= 68          h
                sta $B5                      ; F5AF= 85 B5       .5
                pla                          ; F5B1= 68          h
                sta $B4                      ; F5B2= 85 B4       .4
                lda $B6                      ; F5B4= A5 B6       %6
                ora $B7                      ; F5B6= 05 B7       .7
                bne LF5E2                    ; F5B8= D0 28       P(
                sta $B4                      ; F5BA= 85 B4       .4
                sta $B5                      ; F5BC= 85 B5       .5
;
; BBC here updates filename if CRC ok
;
                lda $0247                    ; F5BE= AD 47 02    -G.
                beq LF5D9                    ; F5C1= F0 16       p.
                bvs LF5D9                    ; F5C3= 70 14       p.
LF5C5:
                jsr LFA6D                    ; F5C5= 20 6D FA     mz
                brk
                .byte $D6
                .text "File not found"
                brk

LF5D9:
; BBC does this code earlier
                lda $C1                      ; If bad CRC, skip past
                bne LF5E2
                ldx #$B1                     ; update filename
                jsr LFB12
LF5E2:
                ldy #$FF                     ; set last block flag=&FF
                sty $03DF
                rts


; Close EXEC file
; ===============
LF5E8:
                lda #$00                     ; F5E8= A9 00       ).

; *EXEC <filename>
; ================
LF5EA:
                php                          ; F5EA= 08          .
                sty $E6                      ; F5EB= 84 E6       .f
                ldy $0256                    ; F5ED= AC 56 02    ,V.
                sta $0256                    ; F5F0= 8D 56 02    .V.
                beq LF5F8                    ; F5F3= F0 03       p.
                jsr OSFIND                   ; F5F5= 20 CE FF     N.
LF5F8:
                ldy $E6                      ; F5F8= A4 E6       $f
                plp                          ; F5FA= 28          (
                beq LF608                    ; F5FB= F0 0B       p.
                lda #$40                     ; F5FD= A9 40       )@
                jsr OSFIND                   ; F5FF= 20 CE FF     N.
                tay                          ; F602= A8          (
                beq LF5C5                    ; F603= F0 C0       p@
                sta $0256                    ; F605= 8D 56 02    .V.
LF608:
                rts                          ; F608= 60          `

; Read a block
; ------------
LF609:
                ldx #$A6                     ; F609= A2 A6       "&
                jsr LFB12                    ; F60B= 20 12 FB     .{
                jsr LF6DB                    ; F60E= 20 DB F6     [v
LF611:
                lda $03CA                    ; F611= AD CA 03    -J.
                lsr a                        ; F614= 4A          J
                bcc LF61A                    ; F615= 90 03       ..
                jmp LF12D                    ; F617= 4C 2D F1    L-q

LF61A:
                lda $03DD                    ; F61A= AD DD 03    -].
                sta $B4                      ; F61D= 85 B4       .4
                lda $03DE                    ; F61F= AD DE 03    -^.
                sta $B5                      ; F622= 85 B5       .5
                lda #$00                     ; F624= A9 00       ).
                sta $B0                      ; F626= 85 B0       .0
                lda #$0A                     ; F628= A9 0A       ).
                sta $B1                      ; F62A= 85 B1       .1
                lda #$FF                     ; F62C= A9 FF       ).
                sta $B2                      ; F62E= 85 B2       .2
                sta $B3                      ; F630= 85 B3       .3
                jsr LF735                    ; F632= 20 35 F7     5w
                jsr LF924                    ; F635= 20 24 F9     $y
                bne LF65F                    ; F638= D0 25       P%
                lda $0AFF                    ; F63A= AD FF 0A    -..
                sta $02E1                    ; F63D= 8D E1 02    .a.
                jsr LFAFA                    ; F640= 20 FA FA     zz
                stx $03DD                    ; F643= 8E DD 03    .].
                sty $03DE                    ; F646= 8C DE 03    .^.
                ldx #$02                     ; F649= A2 02       ".
LF64B:
                lda $03C8,x                  ; F64B= BD C8 03    =H.
                sta $02DE,x                  ; F64E= 9D DE 02    .^.
                dex                          ; F651= CA          J
                bpl LF64B                    ; F652= 10 F7       .w
                bit $02E0                    ; F654= 2C E0 02    ,`.
                bpl LF65C                    ; F657= 10 03       ..
                jsr LF1A0                    ; F659= 20 A0 F1      q
LF65C:
                jmp LFA63                    ; F65C= 4C 63 FA    Lcz

LF65F:
                jsr LF591                    ; F65F= 20 91 F5     .u
                bne LF611                    ; F662= D0 AD       P-
LF664:
                lda #$F7                     ; F664= A9 F7       )w
                jsr LF293                    ; F666= 20 93 F2     .r
                jsr LFA6D                    ; F669= 20 6D FA     mz
                brk
                .byte $D7
                .text "Bad ROM"
                brk

LF676:
                cmp #$2A                     ; is it Synchronising byte &2A?
                beq LF6A2                    ; F678= F0 28       p(
                cmp #$23                     ; F67A= C9 23       I#
                bne LF664                    ; F67C= D0 E6       Pf
                inc $03C6                    ; F67E= EE C6 03    nF.
                bne LF686                    ; F681= D0 03       P.
                inc $03C7                    ; F683= EE C7 03    nG.
LF686:
                ldx #$FF                     ; F686= A2 FF       ".
                bit LD8BC                    ; F688= 2C BC D8    ,<X
                bne LF6D3                    ; F68B= D0 46       PF

LF68D:
                ldy #$FF                     ; F68D= A0 FF        .
                jsr LFB21                    ; F68F= 20 21 FB     !{
                lda #$01                     ; F692= A9 01       ).
                sta $C2                      ; F694= 85 C2       .B
                jsr LFACD                    ; F696= 20 CD FA     Mz
LF699:
                jsr LF905                    ; F699= 20 05 F9     .y
                lda #$03                     ; F69C= A9 03       ).
                cmp $C2                      ; F69E= C5 C2       EB
                bne LF699                    ; F6A0= D0 F7       Pw

LF6A2:
                ldy #$00                     ; F6A2= A0 00        .
                jsr LFB0D                    ; F6A4= 20 0D FB     .{
LF6A7:
                jsr LF6F7                    ; F6A7= 20 F7 F6     wv
                bvc LF6C6                    ; F6AA= 50 1A       P.
                sta $03B2,y                  ; F6AC= 99 B2 03    .2.
                beq LF6B7                    ; F6AF= F0 06       p.
                iny                          ; F6B1= C8          H
                cpy #$0B                     ; F6B2= C0 0B       @.
                bne LF6A7                    ; F6B4= D0 F1       Pq
                dey                          ; F6B6= 88          .
LF6B7:
                ldx #$0C                     ; F6B7= A2 0C       ".
LF6B9:
                jsr LF6F7                    ; F6B9= 20 F7 F6     wv
                bvc LF6C6                    ; F6BC= 50 08       P.
                sta $03B2,x                  ; F6BE= 9D B2 03    .2.
                inx                          ; F6C1= E8          h
                cpx #$1F                     ; F6C2= E0 1F       `.
                bne LF6B9                    ; F6C4= D0 F3       Ps

LF6C6:
                tya                          ; F6C6= 98          .
                tax                          ; F6C7= AA          *
                lda #$00                     ; F6C8= A9 00       ).
                sta $03B2,y                  ; F6CA= 99 B2 03    .2.
                lda $BE                      ; F6CD= A5 BE       %>
                ora $BF                      ; F6CF= 05 BF       .?
                sta $C1                      ; F6D1= 85 C1       .A

LF6D3:
                jsr LFB09                    ; F6D3= 20 09 FB     .{
                sty $C2                      ; F6D6= 84 C2       .B
                txa                          ; F6D8= 8A          .
                bne LF734                    ; F6D9= D0 59       PY

LF6DB:
                lda $0247                    ; F6DB= AD 47 02    -G.
                beq LF68D                    ; F6DE= F0 AD       p-
LF6E0:
                jsr LEAA6                    ; F6E0= 20 A6 EA     &j
                cmp #$2B                     ; F6E3= C9 2B       I+
                bne LF676                    ; F6E5= D0 8F       P.
                lda #$08                     ; F6E7= A9 08       ).
                and $E2                      ; F6E9= 25 E2       %b
                beq LF6F0                    ; F6EB= F0 03       p.
                jsr LF1A4                    ; F6ED= 20 A4 F1     $q
LF6F0:
                jsr LEA97                    ; F6F0= 20 97 EA     .j
;LF6F3:
                bcc LF6E0                    ; F6F3= 90 EB       .k
                clv                          ; F6F5= B8          8
                rts                          ; F6F6= 60          `

LF6F7:
                lda $0247                    ; F6F7= AD 47 02    -G.
                beq LF70D                    ; F6FA= F0 11       p.
                txa                          ; F6FC= 8A          .
                pha                          ; F6FD= 48          H
                tya                          ; F6FE= 98          .
                pha                          ; F6FF= 48          H
                jsr LEAA6                    ; F700= 20 A6 EA     &j
                sta $BD                      ; F703= 85 BD       .=
                lda #$FF                     ; F705= A9 FF       ).
                sta $C0                      ; F707= 85 C0       .@
                pla                          ; F709= 68          h
                tay                          ; F70A= A8          (
                pla                          ; F70B= 68          h
                tax                          ; F70C= AA          *
LF70D:
                jsr LF7E5                    ; F70D= 20 E5 F7     ew

; Update CRC
; ==========
LF710:
                php                          ; F710= 08          .
                pha                          ; F711= 48          H
                sec                          ; F712= 38          8
                ror $CB                      ; F713= 66 CB       fK
                eor $BF                      ; F715= 45 BF       E?
                sta $BF                      ; F717= 85 BF       .?
LF719:
                lda $BF                      ; F719= A5 BF       %?
                rol a                        ; F71B= 2A          *
                bcc LF72A                    ; F71C= 90 0C       ..
                ror a                        ; F71E= 6A          j
                eor #$08                     ; F71F= 49 08       I.
                sta $BF                      ; F721= 85 BF       .?
                lda $BE                      ; F723= A5 BE       %>
                eor #$10                     ; F725= 49 10       I.
                sta $BE                      ; F727= 85 BE       .>
                sec                          ; F729= 38          8
LF72A:
                rol $BE                      ; F72A= 26 BE       &>
                rol $BF                      ; F72C= 26 BF       &?
                lsr $CB                      ; F72E= 46 CB       FK
                bne LF719                    ; F730= D0 E7       Pg
                pla                          ; F732= 68          h
                plp                          ; F733= 28          (
LF734:
                rts                          ; F734= 60          `

LF735:
                lda #$00                     ; F735= A9 00       ).
LF737:
                sta $BD                      ; F737= 85 BD       .=
                ldx #$00                     ; F739= A2 00       ".
                stx $BC                      ; F73B= 86 BC       .<
                bvc LF749                    ; F73D= 50 0A       P.
                lda $03C8                    ; F73F= AD C8 03    -H.
                ora $03C9                    ; F742= 0D C9 03    .I.
                beq LF749                    ; F745= F0 02       p.
                ldx #$04                     ; F747= A2 04       ".
LF749:
                stx $C2                      ; F749= 86 C2       .B
                rts                          ; F74B= 60          `

; Save a block
; ------------
LF74C:
                php                          ; F74C= 08          .
                ldx #$03                     ; F74D= A2 03       ".
                lda #$00                     ; F74F= A9 00       ).
LF751:
                sta $03CB,x                  ; F751= 9D CB 03    .K.
                dex                          ; F754= CA          J
                bpl LF751                    ; F755= 10 FA       .z
                lda $03C6                    ; F757= AD C6 03    -F.
                ora $03C7                    ; F75A= 0D C7 03    .G.
                bne LF764                    ; F75D= D0 05       P.
                jsr LF7F3                    ; F75F= 20 F3 F7     sw
                beq LF767                    ; F762= F0 03       p.
LF764:
                jsr LF7F7                    ; F764= 20 F7 F7     ww
LF767:
                lda #$2A                     ; F767= A9 2A       )*
                sta $BD                      ; F769= 85 BD       .=
                jsr LFB09                    ; F76B= 20 09 FB     .{
                jsr LFABF                    ; F76E= 20 BF FA     ?z
                jsr LF7E5                    ; F771= 20 E5 F7     ew
                ldy #$FF                     ; F774= A0 FF        .
LF776:
                iny                          ; F776= C8          H
                lda $03D2,y                  ; F777= B9 D2 03    9R.
                sta $03B2,y                  ; F77A= 99 B2 03    .2.
                jsr LF7D6                    ; F77D= 20 D6 F7     Vw
                bne LF776                    ; F780= D0 F4       Pt
                ldx #$0C                     ; F782= A2 0C       ".
LF784:
                lda $03B2,x                  ; F784= BD B2 03    =2.
                jsr LF7D6                    ; F787= 20 D6 F7     Vw
                inx                          ; F78A= E8          h
                cpx #$1D                     ; F78B= E0 1D       `.
                bne LF784                    ; F78D= D0 F5       Pu
                jsr LF7DC                    ; F78F= 20 DC F7     \w
                lda $03C8                    ; F792= AD C8 03    -H.
                ora $03C9                    ; F795= 0D C9 03    .I.
                beq LF7B6                    ; F798= F0 1C       p.
                ldy #$00                     ; F79A= A0 00        .
                jsr LFB0D                    ; F79C= 20 0D FB     .{
LF79F:
                lda ($B0),y                  ; F79F= B1 B0       10
                jsr LFB4D                    ; F7A1= 20 4D FB     M{
                beq LF7A9                    ; F7A4= F0 03       p.
                ldx LFCE5                    ; F7A6= AE E5 FC    .e|
LF7A9:
                txa                          ; F7A9= 8A          .
                jsr LF7D6                    ; F7AA= 20 D6 F7     Vw
                iny                          ; F7AD= C8          H
                cpy $03C8                    ; F7AE= CC C8 03    LH.
                bne LF79F                    ; F7B1= D0 EC       Pl
                jsr LF7DC                    ; F7B3= 20 DC F7     \w
LF7B6:
                bit LF7E5                    ; F7B6= 2C E5 F7    ,ew
                bit LF7E5                    ; F7B9= 2C E5 F7    ,ew
                jsr LFAB0                    ; F7BC= 20 B0 FA     0z
                lda #$01                     ; F7BF= A9 01       ).
                jsr LF7F9                    ; F7C1= 20 F9 F7     yw
                plp                          ; F7C4= 28          (
                jsr LF81A                    ; F7C5= 20 1A F8     .x
                bit $03CA                    ; F7C8= 2C CA 03    ,J.
                bpl LF7D5                    ; F7CB= 10 08       ..
                php                          ; F7CD= 08          .
                jsr LF7F3                    ; F7CE= 20 F3 F7     sw
                jsr LF19D                    ; F7D1= 20 9D F1     .q
                plp                          ; F7D4= 28          (
LF7D5:
                rts                          ; F7D5= 60          `

LF7D6:
                jsr LF7E3                    ; F7D6= 20 E3 F7     cw
                jmp LF710                    ; F7D9= 4C 10 F7    L.w

LF7DC:
                lda $BF                      ; F7DC= A5 BF       %?
                jsr LF7E3                    ; F7DE= 20 E3 F7     cw
                lda $BE                      ; F7E1= A5 BE       %>
LF7E3:
                sta $BD                      ; F7E3= 85 BD       .=
LF7E5:
                jsr LF905                    ; F7E5= 20 05 F9     .y
                bit $C0                      ; F7E8= 24 C0       $@
                bpl LF7E5                    ; F7EA= 10 F9       .y
                lda #$00                     ; F7EC= A9 00       ).
                sta $C0                      ; F7EE= 85 C0       .@
                lda $BD                      ; F7F0= A5 BD       %=
                rts                          ; F7F2= 60          `

LF7F3:
                lda #$32                     ; F7F3= A9 32       )2
                bne LF7F9                    ; F7F5= D0 02       P.
LF7F7:
                lda $C7                      ; F7F7= A5 C7       %G
LF7F9:
                ldx #$05                     ; F7F9= A2 05       ".
LF7FB:
                sta $0240                    ; F7FB= 8D 40 02    .@.
LF7FE:
                jsr LF905                    ; F7FE= 20 05 F9     .y
                bit $0240                    ; F801= 2C 40 02    ,@.
                bpl LF7FE                    ; F804= 10 F8       .x
                dex                          ; F806= CA          J
                bne LF7FB                    ; F807= D0 F2       Pr
                rts                          ; F809= 60          `

LF80A:
                lda $03C6                    ; F80A= AD C6 03    -F.
                ora $03C7                    ; F80D= 0D C7 03    .G.
                beq LF817                    ; F810= F0 05       p.
                bit $03DF                    ; F812= 2C DF 03    ,_.
                bpl LF81A                    ; F815= 10 03       ..
LF817:
                jsr LF1A0                    ; F817= 20 A0 F1      q
LF81A:
                ldx #$00                     ; F81A= A2 00       ".
                stx $BA                      ; F81C= 86 BA       .:
                lda $03CA                    ; F81E= AD CA 03    -J.
                sta $03DF                    ; F821= 8D DF 03    ._.
                jsr LE5AD                    ; F824= 20 AD E5     -e
                beq LF892                    ; F827= F0 69       pi
                lda #$0D                     ; F829= A9 0D       ).
                jsr OSWRCH                   ; F82B= 20 EE FF     n.
                ldy #$00                     ; F82E= A0 00        .
LF830:
                lda $03B2,y                  ; F830= B9 B2 03    92.
                beq LF845                    ; F833= F0 10       p.
                cmp #$20                     ; F835= C9 20       I
                bcc LF83D                    ; F837= 90 04       ..
                cmp #$7F                     ; F839= C9 7F       I.
                bcc LF83F                    ; F83B= 90 02       ..
LF83D:
                lda #$3F                     ; F83D= A9 3F       )?
LF83F:
                jsr OSWRCH                   ; F83F= 20 EE FF     n.
                iny                          ; F842= C8          H
                bne LF830                    ; F843= D0 EB       Pk
LF845:
                lda $0247                    ; F845= AD 47 02    -G.
                beq LF84E                    ; F848= F0 04       p.
                bit $BB                      ; F84A= 24 BB       $;
                bvc LF892                    ; F84C= 50 44       PD
LF84E:
                jsr LF901                    ; F84E= 20 01 F9     .y
                iny                          ; F851= C8          H
                cpy #$0B                     ; F852= C0 0B       @.
                bcc LF845                    ; F854= 90 EF       .o
                lda $03C6                    ; F856= AD C6 03    -F.
                tax                          ; F859= AA          *
                jsr LF8EA                    ; F85A= 20 EA F8     jx
                bit $03CA                    ; F85D= 2C CA 03    ,J.
                bpl LF892                    ; F860= 10 30       .0
                txa                          ; F862= 8A          .
                clc                          ; F863= 18          .
                adc $03C9                    ; F864= 6D C9 03    mI.
                jsr LF8E5                    ; F867= 20 E5 F8     ex
                lda $03C8                    ; F86A= AD C8 03    -H.
                jsr LF8EA                    ; F86D= 20 EA F8     jx
                bit $BB                      ; F870= 24 BB       $;
                bvc LF892                    ; F872= 50 1E       P.
                ldx #$04                     ; F874= A2 04       ".
LF876:
                jsr LF901                    ; F876= 20 01 F9     .y
                dex                          ; F879= CA          J
                bne LF876                    ; F87A= D0 FA       Pz
                ldx #$0F                     ; F87C= A2 0F       ".
                jsr LF886                    ; F87E= 20 86 F8     .x
                jsr LF901                    ; F881= 20 01 F9     .y
                ldx #$13                     ; F884= A2 13       ".
LF886:
                ldy #$04                     ; F886= A0 04        .
LF888:
                lda $03B2,x                  ; F888= BD B2 03    =2.
                jsr LF8EA                    ; F88B= 20 EA F8     jx
                dex                          ; F88E= CA          J
                dey                          ; F88F= 88          .
                bne LF888                    ; F890= D0 F6       Pv
LF892:
                rts                          ; F892= 60          `

; Prompt for saving
; -----------------
LF893:
                lda $0247                    ; F893= AD 47 02    -G.
                beq LF89B                    ; F896= F0 03       p.
                jmp LE07E                    ; F898= 4C 7E E0    L~`

LF89B:
                jsr LF8C9                    ; F89B= 20 C9 F8     Ix
                jsr LFB1F                    ; F89E= 20 1F FB     .{
                jsr LE5AD                    ; F8A1= 20 AD E5     -e
                beq LF892                    ; F8A4= F0 EC       pl
                jsr LF9B6                    ; Print inline text
                .text "RECORD then RETURN"
                .byte 0
LF8BC:
                jsr LF905
                jsr OSRDCH                   ; F8BF= 20 E0 FF     `.
                cmp #$0D                     ; F8C2= C9 0D       I.
                bne LF8BC                    ; F8C4= D0 F6       Pv
                jmp OSNEWL                   ; F8C6= 4C E7 FF    Lg.

LF8C9:
                php                          ; F8C9= 08          .
                sei                          ; F8CA= 78          x
                lda $0282                    ; F8CB= AD 82 02    -..
                and #$F9                     ; F8CE= 29 F9       )y
                ora #$04                     ; F8D0= 09 04       ..
                .if version==300
                jsr LE3C1_300
                .else
                sta $0282                    ; F8D2= 8D 82 02    ...
                sta LFE07                    ; F8D5= 8D 07 FE    ..~
                .endif
                plp                          ; F8D8= 28          (
                rts                          ; F8D9= 60          `

LF8DA:
                inc $B1                      ; F8DA= E6 B1       f1
                .if version==300
                bne LF8E4
                .else
                bne LF8E0                    ; F8DC= D0 02       P.
                .endif
                inc $B2                      ; F8DE= E6 B2       f2
LF8E0:
                bne LF8E4                    ; F8E0= D0 02       P.
                inc $B3                      ; F8E2= E6 B3       f3
LF8E4:
                rts                          ; F8E4= 60          `

LF8E5:
                pha                          ; F8E5= 48          H
                jsr LF901                    ; F8E6= 20 01 F9     .y
                pla                          ; F8E9= 68          h
LF8EA:
                pha                          ; F8EA= 48          H
                lsr a                        ; F8EB= 4A          J
                lsr a                        ; F8EC= 4A          J
                lsr a                        ; F8ED= 4A          J
                lsr a                        ; F8EE= 4A          J
                jsr LF8F3                    ; F8EF= 20 F3 F8     sx
                pla                          ; F8F2= 68          h
LF8F3:
                .if version==300
                and #$f
                sed
                clc
                adc #$90
                adc #$40
                cld
                .else
                clc                          ; F8F3= 18          .
                and #$0F                     ; F8F4= 29 0F       ).
                adc #$30                     ; F8F6= 69 30       i0
                cmp #$3A                     ; F8F8= C9 3A       I:
                bcc LF8FE                    ; F8FA= 90 02       ..
                adc #$06                     ; F8FC= 69 06       i.
                .endif
LF8FE:
                jmp OSWRCH                   ; F8FE= 4C EE FF    Ln.

LF901:
                lda #$20                     ; F901= A9 20       )
                bne LF8FE                    ; F903= D0 F9       Py

; If not BGET/BPUT check for Escape
; =================================
LF905:
                php                          ; F905= 08          .
                bit $EB                      ; F906= 24 EB       $k
                bmi LF90E                    ; F908= 30 04       0.
                bit $FF                      ; F90A= 24 FF       $.
                bmi LF910                    ; F90C= 30 02       0.
LF90E:
                plp                          ; F90E= 28          (
                rts                          ; F90F= 60          `

LF910:
                jsr LF291                    ; F910= 20 91 F2     .r
                jsr LFA63                    ; F913= 20 63 FA     cz
                lda #$7E                     ; A=&7E (126) Acknowledge ESCAPE
                jsr OSBYTE                   ; OSBYTE Call
                brk
                .byte 17
                .text "Escape"
                brk

; Load data block
; ---------------
LF924:
                tya                          ; F924= 98          .
                beq LF934                    ; F925= F0 0D       p.
                jsr LF9B6                    ; F927= 20 B6 F9     6y
                .byte 13
                .text "Loading"
                .byte 13
                .byte 0
LF934:
                sta $BA                      ; clear current block flag
                ldx #$FF                     ; X=&FF
                lda $C1                      ; check checksum result
                bne LF949                    ; F93A= D0 0D       P.
                jsr LF9E2                    ; F93C= 20 E2 F9     by
                php                          ; F93F= 08          .
                ldx #$FF                     ; F940= A2 FF       ".
                ldy #<fileError
                lda #>fileError
                plp                          ; F946= 28          (
                bne LF965                    ; F947= D0 1C       P.
LF949:
                ldy #<dataError
                lda $C1                      ; F94B= A5 C1       %A
                beq LF953                    ; F94D= F0 04       p.
                lda #>dataError
                bne LF965                    ; F951= D0 12       P.
LF953:
                lda $03C6                    ; F953= AD C6 03    -F.
                cmp $B4                      ; F956= C5 B4       E4
                bne LF961                    ; F958= D0 07       P.
                lda $03C7                    ; F95A= AD C7 03    -G.
                cmp $B5                      ; F95D= C5 B5       E5
                beq LF974                    ; F95F= F0 13       p.
LF961:
                ldy #<blockError
                lda #>blockError
LF965:
                pha                          ; F965= 48          H
                tya                          ; F966= 98          .
                pha                          ; F967= 48          H
                txa                          ; F968= 8A          .
                pha                          ; F969= 48          H
                jsr LF817                    ; F96A= 20 17 F8     .x
                pla                          ; F96D= 68          h
                tax                          ; F96E= AA          *
                pla                          ; F96F= 68          h
                tay                          ; F970= A8          (
                pla                          ; F971= 68          h
                bne LF988                    ; F972= D0 14       P.

; Header checksum ok
; Header filename matches
; Header block number matches
; Load the data block
LF974:
                txa                          ; F974= 8A          .
                pha                          ; F975= 48          H
                jsr LF80A                    ; F976= 20 0A F8     .x
                jsr LFA47                    ; F979= 20 47 FA     Gz
                pla                          ; F97C= 68          h
                tax                          ; F97D= AA          *
                lda $BE                      ; F97E= A5 BE       %>
                ora $BF                      ; F980= 05 BF       .?
                beq LF9FD                    ; F982= F0 79       py
                ldy #<dataError
                lda #>dataError
LF988:
                dec $BA                      ; F988= C6 BA       F:
                pha                          ; F98A= 48          H
                bit $EB                      ; F98B= 24 EB       $k
                bmi LF99C                    ; F98D= 30 0D       0.
                txa                          ; F98F= 8A          .
                and $0247                    ; F990= 2D 47 02    -G.
                bne LF99C                    ; F993= D0 07       P.
                txa                          ; F995= 8A          .
                and #$11                     ; F996= 29 11       ).
                and $BB                      ; F998= 25 BB       %;
                beq LF9AC                    ; F99A= F0 10       p.
LF99C:
                pla                          ; F99C= 68          h
                sta $B9                      ; F99D= 85 B9       .9
                sty $B8                      ; F99F= 84 B8       .8
                jsr LF5E8                    ; F9A1= 20 E8 F5     hu
                lsr $EB                      ; F9A4= 46 EB       Fk
                jsr LFA59                    ; F9A6= 20 59 FA     Yz
                jmp ($00B8)                  ; F9A9= 6C B8 00    l8.

; stacked-A,Y=>message to print or skip
LF9AC:
                pla                          ; F9AC= 68          h
                iny                          ; F9AD= C8          H
                bne LF9B3                    ; F9AE= D0 03       P.
                clc                          ; F9B0= 18          .
                adc #$01                     ; F9B1= 69 01       i.
LF9B3:
                pha                          ; F9B3= 48          H
                tya                          ; F9B4= 98          .
                pha                          ; F9B5= 48          H
LF9B6:
                jsr LE5AD                    ; F9B6= 20 AD E5     -e
                tay                          ; F9B9= A8          (

; Print inline text
; -----------------
; On entry, if Y=0 don't print, Y<>0 print
LF9BA:
                pla                          ; Get inline address to &B8/9
                sta $B8
                pla
                sta $B9
                tya                          ; Stack 0/<>0 from Y
                php
LF9C2:
                inc $B8                      ; Update address
                bne LF9C8
                inc $B9
LF9C8:
                ldy #$00                     ; Get character
                lda ($B8),y
                beq LF9D8                    ; If &00, jump to finish
                plp                          ; If Y=0 on entry, don't print
                php
                beq LF9C2
                jsr OSASCI                   ; Print character and loop for next
                jmp LF9C2

LF9D8:
                plp                          ; Drop stacked flag
                inc $B8                      ; Update address
                bne LF9DF
                inc $B9
LF9DF:
                jmp ($00B8)                  ; Return by jumping to address

LF9E2:
                ldx #$FF                     ; F9E2= A2 FF       ".
LF9E4:
                inx                          ; F9E4= E8          h
                lda $03D2,x                  ; F9E5= BD D2 03    =R.
                bne LF9F1                    ; F9E8= D0 07       P.
                txa                          ; F9EA= 8A          .
                beq LF9F0                    ; F9EB= F0 03       p.
                lda $03B2,x                  ; F9ED= BD B2 03    =2.
LF9F0:
                rts                          ; F9F0= 60          `

LF9F1:
                jsr LE251                    ; F9F1= 20 51 E2     Qb
                eor $03B2,x                  ; F9F4= 5D B2 03    ]2.
                bcs LF9FB                    ; F9F7= B0 02       0.
                and #$DF                     ; F9F9= 29 DF       )_
LF9FB:
                beq LF9E4                    ; F9FB= F0 E7       pg
LF9FD:
                rts                          ; F9FD= 60          `

dataError:
                brk
                .text $d8,13,"Data?",0

                bne LFA1E                    ; FA07= D0 15       P.

fileError:
                brk
                .text $db,13,"File?",0

                bne LFA1E                    ; FA12= D0 0A       P.
blockError:      
                brk
                .text $da,13,"Block?",0
LFA1E:
                lda $BA                      ; FA1E= A5 BA       %:
                beq LFA44                    ; FA20= F0 22       p"
                txa                          ; FA22= 8A          .
                beq LFA44                    ; FA23= F0 1F       p.
                lda #$22                     ; FA25= A9 22       )"
                bit $BB                      ; FA27= 24 BB       $;
                beq LFA44                    ; FA29= F0 19       p.
                jsr LFAB0                    ; FA2B= 20 B0 FA     0z
                ldy #$FF                     ; Print inline text
                jsr LF9BA
                .text 13,7,"Rewind tape",13,13,0
LFA43:
                rts                          ; FA43= 60          `

LFA44:
                jsr LF1A4                    ; FA44= 20 A4 F1     $q

; Loop to fetch bytes from cassette/rom until done or escape
LFA47:
                lda $C2                      ; FA47= A5 C2       %B
                beq LFA43                    ; FA49= F0 F8       px
                jsr LF905                    ; FA4B= 20 05 F9     .y
                lda $0247                    ; FA4E= AD 47 02    -G.
                beq LFA47                    ; FA51= F0 F4       pt
                jsr LF4DF                    ; FA53= 20 DF F4     _t
                jmp LFA47                    ; FA56= 4C 47 FA    LGz

LFA59:
                jsr LE5AD                    ; FA59= 20 AD E5     -e
                beq LFA63                    ; FA5C= F0 05       p.
                lda #$07                     ; FA5E= A9 07       ).
                jsr OSWRCH                   ; FA60= 20 EE FF     n.
LFA63:
                lda #$80                     ; FA63= A9 80       ).
                jsr LFB5E                    ; FA65= 20 5E FB     ^{
                ldx #$00                     ; FA68= A2 00       ".
                jsr LFB26                    ; FA6A= 20 26 FB     &{
LFA6D:
                jsr LFAB0                    ; FA6D= 20 B0 FA     0z
                lda #$00                     ; FA70= A9 00       ).
                sta $EA                      ; FA72= 85 EA       .j
                rts                          ; FA74= 60          `

LFA75:
                lda $E3                      ; FA75= A5 E3       %c
                asl a                        ; FA77= 0A          .
                asl a                        ; FA78= 0A          .
                asl a                        ; FA79= 0A          .
                asl a                        ; FA7A= 0A          .
                sta $BB                      ; FA7B= 85 BB       .;
                lda $03D1                    ; FA7D= AD D1 03    -Q.
                bne LFA8A                    ; FA80= D0 08       P.
LFA82:
                lda $E3                      ; FA82= A5 E3       %c
                and #$F0                     ; FA84= 29 F0       )p
                sta $BB                      ; FA86= 85 BB       .;
                lda #$06                     ; FA88= A9 06       ).
LFA8A:
                sta $C7                      ; FA8A= 85 C7       .G
LFA8C:
                cli                          ; FA8C= 58          X
                php                          ; FA8D= 08          .
                sei                          ; FA8E= 78          x
                bit $024F                    ; FA8F= 2C 4F 02    ,O.
                bpl LFAAA                    ; FA92= 10 16       ..
                bit $EA                      ; FA94= 24 EA       $j
                bmi LFAAA                    ; FA96= 30 12       0.
                lda #$01                     ; FA98= A9 01       ).
                sta $EA                      ; FA9A= 85 EA       .j
                lda $0282                    ; FA9C= AD 82 02    -..
                and #$F9                     ; FA9F= 29 F9       )y
                .if version==300
                jsr LE3C1_300
                .else
                sta $0282                    ; FAA1= 8D 82 02    ...
                sta LFE07                    ; FAA4= 8D 07 FE    ..~
                .endif
                plp                          ; FAA7= 28          (
                sec                          ; FAA8= 38          8
                rts                          ; FAA9= 60          `

LFAAA:
                plp                          ; FAAA= 28          (
                bit $FF                      ; FAAB= 24 FF       $.
                bpl LFA8C                    ; FAAD= 10 DD       .]
                rts                          ; FAAF= 60          `

LFAB0:
                php                          ; FAB0= 08          .
                sei                          ; FAB1= 78          x
                lda $025B                    ; FAB2= AD 5B 02    -[.
                and #$8F                     ; FAB5= 29 8F       ).
                sta $025B                    ; FAB7= 8D 5B 02    .[.
                sta LFE00                    ; FABA= 8D 00 FE    ..~
                plp                          ; FABD= 28          (
                rts                          ; FABE= 60          `

LFABF:
                .if version==300
                ldx #$04
                lda $025b
                and #$af
                ora #$20
                .else
                lda $025B                    ; FABF= AD 5B 02    -[.
                and #$AF                     ; FAC2= 29 AF       )/
                ora #$20                     ; FAC4= 09 20       .
                tay                          ; FAC6= A8          (
                lda #$04                     ; FAC7= A9 04       ).
                sta $CA                      ; FAC9= 85 CA       .J
                .endif
                bne LFADD                    ; FACB= D0 10       P.
LFACD:
                ldx #$00                     ; FACD= A2 00       ".
                stx LFE06                    ; FACF= 8E 06 FE    ..~
                .if version==100
                stx $CA                      ; FAD2= 86 CA       .J
                .endif
                lda $025B                    ; FAD4= AD 5B 02    -[.
                and #$DF                     ; FAD7= 29 DF       )_
                ora #$50                     ; FAD9= 09 50       .P
                .if version==100
                tay                          ; FADB= A8          (
                txa                          ; FADC= 8A          .
                .endif
LFADD:
                .if version==300
                tay
                stx $ca
                txa
                ora #$40
                php
                sei
                pha
                lda $0282
                and #$f9
                sta $0282
                pla
                ora $0282
                sta $0282
                plp
                sta LFE07
                sty $025b
                sty LFE00
                rts
                .else
                ora #$40                     ; FADD= 09 40       .@
                sta $02F4                    ; FADF= 8D F4 02    .t.
                php                          ; FAE2= 08          .
                sei                          ; FAE3= 78          x
                lda $0282                    ; FAE4= AD 82 02    -..
                and #$F9                     ; FAE7= 29 F9       )y
                ora $02F4                    ; FAE9= 0D F4 02    .t.
                sta $0282                    ; FAEC= 8D 82 02    ...
                plp                          ; FAEF= 28          (
                sta LFE07                    ; FAF0= 8D 07 FE    ..~
                sty $025B                    ; FAF3= 8C 5B 02    .[.
                sty LFE00                    ; FAF6= 8C 00 FE    ..~
                rts                          ; FAF9= 60          `
                .endif

LFAFA:
                ldx $03C6                    ; FAFA= AE C6 03    .F.
                ldy $03C7                    ; FAFD= AC C7 03    ,G.
                inx                          ; FB00= E8          h
                stx $B4                      ; FB01= 86 B4       .4
                bne LFB06                    ; FB03= D0 01       P.
                iny                          ; FB05= C8          H
LFB06:
                sty $B5                      ; FB06= 84 B5       .5
                rts                          ; FB08= 60          `

LFB09:
                ldy #$00                     ; FB09= A0 00        .
                sty $C0                      ; FB0B= 84 C0       .@
LFB0D:
                sty $BE                      ; FB0D= 84 BE       .>
                sty $BF                      ; FB0F= 84 BF       .?
                rts                          ; FB11= 60          `

LFB12:
                ldy #$FF                     ; FB12= A0 FF        .
LFB14:
                iny                          ; FB14= C8          H
                inx                          ; FB15= E8          h
                lda $0300,x                  ; FB16= BD 00 03    =..
                sta $03D2,y                  ; FB19= 99 D2 03    .R.
                bne LFB14                    ; FB1C= D0 F6       Pv
                rts                          ; FB1E= 60          `

LFB1F:
                ldy #$00                     ; FB1F= A0 00        .
LFB21:
                cli                          ; FB21= 58          X
                ldx #$01                     ; FB22= A2 01       ".
                sty $C3                      ; FB24= 84 C3       .C
LFB26:
                lda #$89                     ; FB26= A9 89       ).
                ldy $C3                      ; FB28= A4 C3       $C
                jmp OSBYTE                   ; FB2A= 4C F4 FF    Lt.

LFB2D:
                sta $BC                      ; FB2D= 85 BC       .<
                tya                          ; FB2F= 98          .
                eor $0247                    ; FB30= 4D 47 02    MG.
                tay                          ; FB33= A8          (
                lda $E2                      ; FB34= A5 E2       %b
                and $BC                      ; FB36= 25 BC       %<
                lsr a                        ; FB38= 4A          J
                dey                          ; FB39= 88          .
                beq LFB40                    ; FB3A= F0 04       p.
                lsr a                        ; FB3C= 4A          J
                dey                          ; FB3D= 88          .
                bne LFB43                    ; FB3E= D0 03       P.
LFB40:
                bcc LFB43                    ; FB40= 90 01       ..
LFB42:
                rts                          ; FB42= 60          `

LFB43:
                brk                          ; FB43= 00          .
                dec $6843,x                  ; FB44= DE 43 68    ^Ch
                adc ($6E,x)                  ; FB47= 61 6E       an
                ror $6C65                    ; FB49= 6E 65 6C    nel
                brk                          ; FB4C= 00          .
LFB4D:
                tax                          ; FB4D= AA          *
                lda $B2                      ; FB4E= A5 B2       %2
                and $B3                      ; FB50= 25 B3       %3
                cmp #$FF                     ; FB52= C9 FF       I.
                beq LFB5B                    ; FB54= F0 05       p.
                lda $027A                    ; FB56= AD 7A 02    -z.
                and #$80                     ; FB59= 29 80       ).
LFB5B:
                rts                          ; FB5B= 60          `

LFB5C:
                lda #$01                     ; FB5C= A9 01       ).
LFB5E:
                jsr LFB4D                    ; FB5E= 20 4D FB     M{
                beq LFB42                    ; FB61= F0 DF       p_
                txa                          ; FB63= 8A          .
                ldx #$B0                     ; FB64= A2 B0       "0
                ldy #$00                     ; FB66= A0 00        .
LFB68:
                pha                          ; FB68= 48          H
                lda #$C0                     ; FB69= A9 C0       )@
LFB6B:
                jsr $0406                    ; FB6B= 20 06 04     ..
                bcc LFB6B                    ; FB6E= 90 FB       .{
                pla                          ; FB70= 68          h
                jmp $0406                    ; FB71= 4C 06 04    L..

                .if version==300

                .fill $fbf7-*,0
LFBF7_300:
                bit LD8BC
                bvs LFBFD_300
                clv
LFBFD_300:
                jmp LF0DB_300

                .else

                .fill $fbfe-*,0

                ; This doesn't seem to be used, and doesn't seem to
                ; refer to anything meaningful.
                .byte $20                    ; ???
                .byte $ed                    ; ???

                .endif

                .if version==300

                ; I assume the dump I've got comes from *SAVE on an
                ; Electron, rather than reading the ROM directly.
                .binary "../orig/os300.rom",$3c00,768

                .else

                .text "(C) 1983 Acorn Computers Ltd."
                .text "Thanks are due to the following contributors to the development of the Electron (among others too numerous to mention):- "
                .text "Bob Austin,"
                .text "Astec,"
                .text "Harry Barman,"
                .text "Paul Bond,"
                .text "Allen Boothroyd,"
                .text "Ben Bridgewater,"
                .text "Cambridge,"
                .text "John Cox,"
                .text "Chris Curry,"
                .text "6502 designers,"
                .text "Jeremy Dion,"
                .text "Tim Dobson,"
                .text "Joe Dunn,"
                .text "Ferranti,"
                .text "Steve Furber,"
                .text "David Gale,"
                .text "Andrew Gordon,"
                .text "Martyn Gilbert,"
                .text "Lawrence Hardwick,"
                .text "Hermann Hauser,"
                .text "John Herbert,"
                .text "Hitachi,"
                .text "Andy Hopper,"
                .text "Paul Jephcot,"
                .text "Brian Jones,"
                .text "Chris Jordan,"
                .text "Computer Laboratory,"
                .text "Tony Mann,"
                .text "Peter Miller,"
                .text "Trevor Morris,"
                .text "Steve Parsons,"
                .text "Robin Pain,"
                .text "Glyn Phillips,"
                .text "Brian Robertson,"
                .text "Peter Robinson,"
                .text "David Seal,"
                .text "Kim Spence-Jones,"
                .text "Graham Tebby,"
                .text "Jon Thackray,"
                .text "Topexpress,"
                .text "Chris Turner,"
                .text "Hugo Tyson,"
                .text "John Umney,"
                .text "Alex van Someren,"
                .text "Geoff Vincent,"
                .text "Adrian Warner,"
                .text "Robin Williamson,"
                .text "Roger Wilson."

                .endif

; Extended vector jump table
; ==========================
                jsr LFF51                    ; FF00= 20 51 FF     Q.
                jsr LFF51                    ; FF03= 20 51 FF     Q.
                jsr LFF51                    ; FF06= 20 51 FF     Q.
                jsr LFF51                    ; FF09= 20 51 FF     Q.
                jsr LFF51                    ; FF0C= 20 51 FF     Q.
                jsr LFF51                    ; FF0F= 20 51 FF     Q.
                jsr LFF51                    ; FF12= 20 51 FF     Q.
                jsr LFF51                    ; FF15= 20 51 FF     Q.
                jsr LFF51                    ; FF18= 20 51 FF     Q.
                jsr LFF51                    ; FF1B= 20 51 FF     Q.
                jsr LFF51                    ; FF1E= 20 51 FF     Q.
                jsr LFF51                    ; FF21= 20 51 FF     Q.
                jsr LFF51                    ; FF24= 20 51 FF     Q.
                jsr LFF51                    ; FF27= 20 51 FF     Q.
                jsr LFF51                    ; FF2A= 20 51 FF     Q.
                jsr LFF51                    ; FF2D= 20 51 FF     Q.
                jsr LFF51                    ; FF30= 20 51 FF     Q.
                jsr LFF51                    ; FF33= 20 51 FF     Q.
                jsr LFF51                    ; FF36= 20 51 FF     Q.
                jsr LFF51                    ; FF39= 20 51 FF     Q.
                jsr LFF51                    ; FF3C= 20 51 FF     Q.
                jsr LFF51                    ; FF3F= 20 51 FF     Q.
                jsr LFF51                    ; FF42= 20 51 FF     Q.
                jsr LFF51                    ; FF45= 20 51 FF     Q.
LFF48:
                jsr LFF51                    ; FF48= 20 51 FF     Q.
                jsr LFF51                    ; FF4B= 20 51 FF     Q.
                jsr LFF51                    ; FF4E= 20 51 FF     Q.
LFF51:
                pha                          ; FF51= 48          H
                pha                          ; FF52= 48          H
                pha                          ; FF53= 48          H
                pha                          ; FF54= 48          H
                pha                          ; FF55= 48          H
                php                          ; FF56= 08          .
                pha                          ; FF57= 48          H
                txa                          ; FF58= 8A          .
                pha                          ; FF59= 48          H
                tya                          ; FF5A= 98          .
                pha                          ; FF5B= 48          H
                tsx                          ; FF5C= BA          :
                lda #$FF                     ; FF5D= A9 FF       ).
                sta $0108,x                  ; FF5F= 9D 08 01    ...
                lda #$86                     ; FF62= A9 86       ).
                sta $0107,x                  ; FF64= 9D 07 01    ...
                ldy $010A,x                  ; FF67= BC 0A 01    <..
                lda $0D9D,y                  ; FF6A= B9 9D 0D    9..
                sta $0105,x                  ; FF6D= 9D 05 01    ...
                lda $0D9E,y                  ; FF70= B9 9E 0D    9..
                sta $0106,x                  ; FF73= 9D 06 01    ...
                lda $F4                      ; FF76= A5 F4       %t
                sta $0109,x                  ; FF78= 9D 09 01    ...
                lda $0D9F,y                  ; FF7B= B9 9F 0D    9..
                jsr LE3A0                    ; FF7E= 20 A0 E3      c
                pla                          ; FF81= 68          h
                tay                          ; FF82= A8          (
                pla                          ; FF83= 68          h
                tax                          ; FF84= AA          *
                pla                          ; FF85= 68          h
                rti                          ; FF86= 40          @

                php                          ; FF87= 08          .
                pha                          ; FF88= 48          H
                txa                          ; FF89= 8A          .
                pha                          ; FF8A= 48          H
                tsx                          ; FF8B= BA          :
                lda $0102,x                  ; FF8C= BD 02 01    =..
                sta $0105,x                  ; FF8F= 9D 05 01    ...
                lda $0103,x                  ; FF92= BD 03 01    =..
                sta $0106,x                  ; FF95= 9D 06 01    ...
                pla                          ; FF98= 68          h
                tax                          ; FF99= AA          *
                pla                          ; FF9A= 68          h
                pla                          ; FF9B= 68          h
                pla                          ; FF9C= 68          h
                jsr LE3A0                    ; FF9D= 20 A0 E3      c
                pla                          ; FFA0= 68          h
                plp                          ; FFA1= 28          (
LFFA2:
                rts                          ; FFA2= 60          `

LFFA3:
                tya                          ; FFA3= 98          .
                sta LFD00,x                  ; FFA4= 9D 00 FD    ..}
                rts                          ; FFA7= 60          `

LFFA8:
                ldy LFD00,x                  ; FFA8= BC 00 FD    <.}
                rts                          ; FFAB= 60          `

                asl LFE05                    ; FFAC= 0E 05 FE    ..~
                bit LFC2C                    ; FFAF= 2C 2C FC    ,,|
                rti                          ; FFB2= 40          @

LFFB3:
                txa
                bcs OSBPUT
LFFB6:                                       ; Size of default vector table
                .byte $36
LFFB7:                                       ; Address of default vector and system table
                .word LD845
OSRDRM:                                      ; FFB9
                jmp LDAF2
                jmp LD6D8                    ; FFBC
                jmp LE202                    ; FFBF
                jmp LE7FD                    ; FFC2
                jmp LE80E                    ; FFC5
                jmp LDC50                    ; FFC8
                jmp LDE2D                    ; FFCB
OSFIND:                                      ; FFCE
                jmp ($021C)
OSGBPB:                                      ; FFD1
                jmp ($021A)
OSBPUT:                                      ; FFD4
                jmp ($0218)
OSBGET:                                      ; FFD7
                jmp ($0216)
OSARGS:                                      ; FFDA
                jmp ($0214)
OSFILE:                                      ; FFDD
                jmp ($0212)
OSRDCH:                                      ; FFE0
                jmp ($0210)
OSASCI:                                      ; FFE3
                cmp #$0D
                bne OSWRCH
OSNEWL:                                      ; FFE7
                lda #$0A
                jsr OSWRCH
OSWRCR:                                      ; FFEC
                lda #$0D
OSWRCH:                                      ; FFEE
                jmp ($020E)
OSWORD:                                      ; FFF1
                jmp ($020C)
OSBYTE:                                      ; FFF4
                jmp ($020A)
OSCLI:                                      ; FFF7
                jmp ($0208)
NMIV:                                        ; FFFA
                .word $0D00
RSTV:                                        ; FFFC
                .word LD8D2
IRQV:                                        ; FFFE
                .word LDAE7
